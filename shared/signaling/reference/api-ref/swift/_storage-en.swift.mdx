import * as storage from '../shared/_storage.mdx'
import * as config from '../shared/_configuration.mdx'
import * as lock from '../shared/_lock.mdx'
import * as enumv from '../shared/_enumv.mdx'
import Status from '../shared/_rtmstatus-en.mdx'

The storage feature provides a dynamic database mechanism that allows developers to dynamically set, store, update, and delete data such as channel metadata and user metadata.

### {storage.setchannel[props.ag_platform]}

#### Description

The <code>{storage.setchannel[props.ag_platform]}</code> method sets metadata for a message channel or stream channel. A channel can only have one set of metadata, but each set of metadata can have one or more metadata items. When you call this method multiple times, the SDK retrieves the `key` of the metadata items in turn and applies settings according to the following rules:

- If you set metadata with different keys, the SDK adds each set of metadata in sequence according to the order of the method calls.
- If you set metadata with the same `key`, the `value` of the last setting overwrites the previous one.

After successfully setting channel metadata, users who subscribe to the channel and enable event listeners receive the <code>{enumv.storagetypechannel[props.ag_platform]}</code> type of <code>{config.onstorageevent[props.ag_platform]}</code> event notification. See [Event listeners](#event-listeners).

Channel metadata also provides version control logic CAS (Compare And Set). This feature provides two independent version control fields. You can set one or both according to your actual business use-case:

- Enable version number verification for the entire set of channel metadata by setting the `majorRevision` property in the <code>{storage.metadata[props.ag_platform]}</code> data type.

- Enable version number verification for a single metadata item by setting the `revision` property in the <code>{storage.metadataitem[props.ag_platform]}</code> class.

When setting channel metadata or metadata items, you can control whether to enable version number verification by specifying the revision property:

- The default value of the revision property is `-1`, which indicates that this method call does not perform any CAS verification. If the channel metadata or metadata item already exists, the latest value overwrites the previous one. If the channel metadata or metadata item does not exist, the SDK creates it.

- If the revision property is a positive integer, this method call performs CAS verification. If the channel metadata or metadata item already exists, the SDK updates the corresponding value after the version number verification succeeds. If the channel metadata or metadata item does not exist, the SDK returns the error code.

#### Method

Call the <code>{storage.setchannel[props.ag_platform]}</code> method as follows:

```swift
setChannelMetadata(
    channelName: String,
    channelType: AgoraRtmChannelType,
    data: AgoraRtmMetadata,
    options: AgoraRtmMetadataOptions?,
    lock: String?
)   async -> (AgoraRtmCommonResponse?, AgoraRtmErrorInfo?)
```

```swift
setChannelMetadata(
    channelName: String,
    channelType: AgoraRtmChannelType,
    data: AgoraRtmMetadata,
    options: AgoraRtmMetadataOptions?,
    lock: String?,
    completion completionBlock: AgoraRtmOperationBlock? = nil
)
```

| Parameters | Type | Required | Default | Description |
| :-----------: | :-------------: | :------: | :----: | ------------------------------------------------------------------------------------------------------------------------------------------- |
| `channelName` | String | Required | - | Channel name. |
| `channelType` | <code>{enumv.channeltype[props.ag_platform]}</code> | Required | - | Channel type. See <a href="#enumvchanneltypepropsag_platform"><code>{enumv.channeltype[props.ag_platform]}</code></a>. |
| `data` | <code>{storage.metadata[props.ag_platform]}</code> | Required | - | Metadata item. See [`AgoraRtmMetadata`](#storagemetadatapropsag_platform). |
| `options` | <code>{storage.metadataoptions[props.ag_platform]}</code> | Optional | - | Options for setting the channel metadata. |
| `lock` | String | Optional |  nil string `''` | Lock name. If set, only users who call the <code>{lock.acquire[props.ag_platform]}</code> method to acquire the lock can perform operations. |
| `completion` | `AgoraRtmOperationBlock` | Optional | - | Callback of invocation result:<ul><li>Success: Returns the `AgoraRtmCommonResponse` data in the `response` parameter, and `nil` in the `errorInfo` parameter.</li><li>Failure: Returns `nil` in the `response` parameter, and error information in the `errorInfo` parameter.</li></ul> |

The <code>{storage.metadataoptions[props.ag_platform]}</code> data type contains the following properties:

| Properties | Type | Required | Default | Description |
| :-------------: | :-----: | :------: | :-----: | ----------------------------------------------------------------------------------------------------------------- |
| `recordTs` | Bool | Optional | `false` | Whether to record the timestamp of the edits. |
| `recordUserId` | Bool | Optional | `false` | Whether to record the user ID of the editor. |

#### Basic usage


```swift
// async-await
let channelName = "exampleChannel"
let channelType: AgoraRtmChannelType = .message

// Create metadata items
let metadataItem1 = AgoraRtmMetadataItem(key: "topic", value: "discussion", revision: 174298200)
let metadataItem2 = AgoraRtmMetadataItem(key: "status", value: "active", revision: 174298100)

// Create metadata
let metadata = AgoraRtmMetadata()
metadata.majorRevision = 174298270
metadata.items = [metadataItem1, metadataItem2]

// Set metadata options
let metadataOptions = AgoraRtmMetadataOptions()
metadataOptions.recordTs = true
metadataOptions.recordUserId = true

// Set channel metadata
let (response, error) = await rtmClient.setChannelMetadata(
    channelName: channelName,
    channelType: channelType,
    data: metadata,
    options: metadataOptions,
    lock: nil // or provide a lock name
)

if let errorInfo = error {
// Handle error
    print("Failed to set channel metadata with error: \(errorInfo.reason)")
} else if let setMetadataResponse = response {
// Handle success
    print("Channel metadata set successfully.")
} else {
// Handle unknown error
    print("Unknown error occurred while setting channel metadata.")
}
```

```swift
// callback
let channelName = "exampleChannel"
let channelType: AgoraRtmChannelType = .message

// Create metadata items
let metadataItem1 = AgoraRtmMetadataItem(key: "topic", value: "discussion", revision: 174298200)
let metadataItem2 = AgoraRtmMetadataItem(key: "status", value: "active", revision: 174298100)

// Create metadata
let metadata = AgoraRtmMetadata()
metadata.majorRevision = 174298270
metadata.items = [metadataItem1, metadataItem2]

// Set metadata options
let metadataOptions = AgoraRtmMetadataOptions()
metadataOptions.recordTs = true
metadataOptions.recordUserId = true

// Set channel metadata
rtmClient.setChannelMetadata(
    channelName: channelName,
    channelType: channelType,
    data: metadata,
    options: metadataOptions,
    lock: nil, // or provide a lock name
    completion: { (response, error) in
        if let errorInfo = error {
            // Handle error
            print("Failed to set channel metadata with error: \(errorInfo.reason)")
        } else if let setMetadataResponse = response {
            // Handle success
            print("Channel metadata set successfully.")
        } else {
            // Handle unknown error
            print("Unknown error occurred while setting channel metadata.")
        }
    }
)
```

### {storage.getchannel[props.ag_platform]}

#### Description

The <code>{storage.getchannel[props.ag_platform]}</code> method gets the metadata of the specified channel.

#### Method

Call the <code>{storage.getchannel[props.ag_platform]}</code> method as follows:

```swift
getChannelMetadata(
    channelName: String,
    channelType: AgoraRtmChannelType
)   async -> (AgoraRtmGetMetadataResponse?, AgoraRtmErrorInfo?)
```
```swift
getChannelMetadata(
    channelName: String,
    channelType: AgoraRtmChannelType,
    completion completionBlock: AgoraRtmGetMetadataBlock? = nil
)
```

| Parameters | Type | Required | Default | Description |
| :-----------: | :----: | :------: | :----: | --------------------------------- |
| `channelName` | String | Required | - | Channel name. |
| `channelType` | <code>{enumv.channeltype[props.ag_platform]}</code> | Required | - | Channel type. See <a href="#enumvchanneltypepropsag_platform"><code>{enumv.channeltype[props.ag_platform]}</code></a>. |
| `completion` | `AgoraRtmGetMetadataBlock` | Optional | - | Callback of invocation result:<ul><li>Success: Returns the `AgoraRtmGetMetadataResponse` data in the `response` parameter, and `nil` in the `errorInfo` parameter.</li><li>Failure: Returns `nil` in the `response` parameter, and error information in the `errorInfo` parameter.</li></ul> |

The `AgoraRtmGetMetadataResponse` data type contains the following properties:

| Properties | Type | Description |
| :------------------ | :--------------------: | ------------------------------------- |
| `data` | <code>{storage.metadata[props.ag_platform]}</code> | Metadata item. See [`AgoraRtmMetadata`](#storagemetadatapropsag_platform). |

#### Basic usage


```swift
// async-await
let channelName = "exampleChannel"
let channelType: AgoraRtmChannelType = .message

// Retrieve channel metadata
let (response, error) = await rtmClient.getChannelMetadata(
    channelName: channelName,
    channelType: channelType
)
if let errorInfo = error {
    // Handle error
    print("Failed to get channel metadata with error: \(errorInfo.reason)")
} else if let getMetadataResponse = response, let metadata = getMetadataResponse.data {
    // Handle success and access the metadata
    print("Retrieved channel metadata: \(metadata)")
    for item in metadata.items ?? [] {
        print("Key: \(item.key), Value: \(item.value), Last updated by: \(item.authorUserId)")
    }
} else {
    // Handle unknown error
    print("Unknown error occurred while getting channel metadata.")
}
```

```swift
// callback
let channelName = "exampleChannel"
let channelType: AgoraRtmChannelType = .message

// Retrieve channel metadata
rtmClient.getChannelMetadata(
    channelName: channelName,
    channelType: channelType,
    completion: { (response, error) in
        if let errorInfo = error {
            // Handle error
            print("Failed to get channel metadata with error: \(errorInfo.reason)")
        } else if let getMetadataResponse = response, let metadata = getMetadataResponse.data {
            // Handle success and access the metadata
            print("Retrieved channel metadata: \(metadata)")
            for item in metadata.items ?? [] {
                print("Key: \(item.key), Value: \(item.value), Last updated by: \(item.authorUserId)")
            }
        } else {
            // Handle unknown error
            print("Unknown error occurred while getting channel metadata.")
        }
    }
)
```

### {storage.removechannel[props.ag_platform]}

#### Description

The <code>{storage.removechannel[props.ag_platform]}</code> method removes channel metadata or metadata items.

When removing channel metadata or metadata items, you can control whether to enable version number verification by specifying the revision property:

- The default value of the revision property is `-1`, which indicates that this method call does not perform any CAS verification. If the channel metadata or metadata item already exists, the SDK removes it. If the channel metadata or metadata item does not exist, the SDK returns the error code.

- If the revision property is a positive integer, this method call performs CAS verification. If the channel metadata or metadata item already exists, the SDK removes the corresponding value after the version number verification succeeds. If the channel metadata or metadata item does not exist, the SDK returns the error code.

After successfully removing channel metadata or metadata items, users who subscribe to the channel and enable event listeners receive the <code>{enumv.storagetypechannel[props.ag_platform]}</code> type of <code>{config.onstorageevent[props.ag_platform]}</code> event notification. See [Event listeners](#event-listeners).

#### Method

Call the <code>{storage.removechannel[props.ag_platform]}</code> method as follows:


```swift
removeChannelMetadata(
    channelName: String,
    channelType: AgoraRtmChannelType,
    data: AgoraRtmMetadata,
    options: AgoraRtmMetadataOptions?,
    lock: String?
)   async -> (AgoraRtmCommonResponse?, AgoraRtmErrorInfo?)
```

```swift
removeChannelMetadata(
    channelName: String,
    channelType: AgoraRtmChannelType,
    data: AgoraRtmMetadata,
    options: AgoraRtmMetadataOptions?,
    lock: String?,
    completion completionBlock: AgoraRtmOperationBlock? = nil
)
```

| Parameters | Type | Required | Default | Description |
| :-----------: | :----: | :------: | :----: | --------------------------------- |
| `channelName` | String | Required | - | Channel name. |
| `channelType` | <code>{enumv.channeltype[props.ag_platform]}</code> | Required | - | Channel type. See <a href="#enumvchanneltypepropsag_platform"><code>{enumv.channeltype[props.ag_platform]}</code></a>. |
| `data` | <code>{storage.metadata[props.ag_platform]}</code> | Required | - | Metadata item. See [`AgoraRtmMetadata`](#storagemetadatapropsag_platform). |
| `options` | <code>{storage.metadataoptions[props.ag_platform]}</code> | Optional | - | Options for setting the channel metadata. |
| `lock` | String | Optional |  nil string `''` | Lock name. If set, only users who call the <code>{lock.acquire[props.ag_platform]}</code> method to acquire the lock can perform operations. |
| `completion` | `AgoraRtmOperationBlock` | Optional | - | Callback of invocation result:<ul><li>Success: Returns the `AgoraRtmCommonResponse` data in the `response` parameter, and `nil` in the `errorInfo` parameter.</li><li>Failure: Returns `nil` in the `response` parameter, and error information in the `errorInfo` parameter.</li></ul> |


The <code>{storage.metadataoptions[props.ag_platform]}</code> data type contains the following properties:

| Properties | Type | Required | Default | Description |
| :-------------: | :-----: | :------: | :-----: | ----------------------------------------------------------------------------------------------------------------- |
| `recordTs` | Bool | Optional | `false` | Whether to record the timestamp of the edits. |
| `recordUserId` | Bool | Optional | `false` | Whether to record the user ID of the editor. |

#### Basic usage


```swift
// async-await
let channelName = "exampleChannel"
let channelType: AgoraRtmChannelType = .message
// Create metadata items to remove
let itemToRemove = AgoraRtmMetadataItem()
itemToRemove.key = "topic"
itemToRemove.revision = 174298200
// Create metadata object
let metadata = AgoraRtmMetadata()
metadata.majorRevision = 174298270
metadata.items = [itemToRemove]

// Call removeChannelMetadata with async/await
let (response, error) = await rtmClient.removeChannelMetadata(
    channelName: channelName,
    channelType: channelType,
    data: metadata,
    options: nil,
    lock: nil
)
if let errorInfo = error {
    // Handle error
    print("Failed to remove metadata with error: \(errorInfo.reason)")
} else if let removeMetadataResponse = response {
    // Handle success
    print("Metadata removed successfully.")
} else {
    // Handle unknown error
    print("Unknown error occurred while removing metadata.")
}
```

```swift
// callback
let channelName = "exampleChannel"
let channelType: AgoraRtmChannelType = .message
// Create metadata items to remove
let itemToRemove = AgoraRtmMetadataItem()
itemToRemove.key = "topic"
itemToRemove.revision = 174298200
// Create metadata object
let metadata = AgoraRtmMetadata()
metadata.majorRevision = 174298270
metadata.items = [itemToRemove]

// Call removeChannelMetadata with callback
rtmClient.removeChannelMetadata(
    channelName: channelName,
    channelType: channelType,
    data: metadata,
    options: nil,
    lock: nil
) { (response, error) in
    if let errorInfo = error {
        // Handle error
        print("Failed to remove metadata with error: \(errorInfo.reason)")
    } else if let removeMetadataResponse = response {
        // Handle success
        print("Metadata removed successfully.")
    } else {
        // Handle unknown error
        print("Unknown error occurred while removing metadata.")
    }
}
```

### {storage.updatechannel[props.ag_platform]}

#### Description

The <code>{storage.updatechannel[props.ag_platform]}</code> method updates existing channel metadata. Each time you call this method, you can update one channel metadata or a channel metadata item.

After successfully updating channel metadata, users who subscribe to the channel and enable event listeners receive the <code>{enumv.storagetypechannel[props.ag_platform]}</code> type of <code>{config.onstorageevent[props.ag_platform]}</code> event notification. See [Event listeners](#event-listeners).

<Admonition type="info" title="Information">You cannot use this method to update metadata items which do not exist.</Admonition>

#### Method

Call the <code>{storage.updatechannel[props.ag_platform]}</code> method as follows:

```swift
updateChannelMetadata(
    channelName: String,
    channelType: AgoraRtmChannelType,
    data: AgoraRtmMetadata, options: AgoraRtmMetadataOptions?, lock: String?
)   async -> (AgoraRtmCommonResponse?, AgoraRtmErrorInfo?)
```

```swift
updateChannelMetadata(
    channelName: String,
    channelType: AgoraRtmChannelType,
    data: AgoraRtmMetadata,
    options: AgoraRtmMetadataOptions?,
    lock: String?,
    completion completionBlock: AgoraRtmOperationBlock? = nil
)
```

| Parameters | Type | Required | Default | Description |
| :-----------: | :----: | :------: | :----: | --------------------------------- |
| `channelName` | String | Required | - | Channel name. |
| `channelType` | <code>{enumv.channeltype[props.ag_platform]}</code> | Required | - | Channel type. See <a href="#enumvchanneltypepropsag_platform"><code>{enumv.channeltype[props.ag_platform]}</code></a>. |
| `data` | <code>{storage.metadata[props.ag_platform]}</code> | Required | - | Metadata item. See [`AgoraRtmMetadata`](#storagemetadatapropsag_platform). |
| `options` | <code>{storage.metadataoptions[props.ag_platform]}</code> | Optional | - | Options for setting the channel metadata. |
| `lock` | String | Optional |  nil string `''` | Lock name. If set, only users who call the <code>{lock.acquire[props.ag_platform]}</code> method to acquire the lock can perform operations. |
| `completion` | `AgoraRtmOperationBlock` | Optional | - | Callback of invocation result:<ul><li>Success: Returns the `AgoraRtmCommonResponse` data in the `response` parameter, and `nil` in the `errorInfo` parameter.</li><li>Failure: Returns `nil` in the `response` parameter, and error information in the `errorInfo` parameter.</li></ul> |


The <code>{storage.metadataoptions[props.ag_platform]}</code> data type contains the following properties:

| Properties | Type | Required | Default | Description |
| :-------------: | :-----: | :------: | :-----: | ----------------------------------------------------------------------------------------------------------------- |
| `recordTs` | Bool | Optional | `false` | Whether to record the timestamp of the edits. |
| `recordUserId` | Bool | Optional | `false` | Whether to record the user ID of the editor. |

#### Basic usage

```swift
// async-await
let channelName = "exampleChannel"
let channelType: AgoraRtmChannelType = .message
// Create metadata items to update
let metadataItem = AgoraRtmMetadataItem()
metadataItem.key = "topic"
metadataItem.value = "New Topic"
metadataItem.revision = 174298200
// Create metadata object
let metadata = AgoraRtmMetadata()
metadata.majorRevision = 174298270
metadata.items = [metadataItem]
// Optional: Define metadata options if needed
let metadataOptions = AgoraRtmMetadataOptions()
metadataOptions.recordTs = true
metadataOptions.recordUserId = true

// Call updateChannelMetadata with async/await
let (response, error) = await rtmClient.updateChannelMetadata(
    channelName: channelName,
    channelType: channelType,
    data: metadata,
    options: metadataOptions,
    lock: nil
)
if let errorInfo = error {
    // Handle error
    print("Failed to update metadata with error: \(errorInfo.reason)")
} else if let updateMetadataResponse = response {
    // Handle success
    print("Metadata updated successfully.")
} else {
    // Handle unknown error
    print("Unknown error occurred while updating metadata.")
}
```

```swift
// callback
let channelName = "exampleChannel"
let channelType: AgoraRtmChannelType = .message
// Create metadata items to update
let metadataItem = AgoraRtmMetadataItem()
metadataItem.key = "topic"
metadataItem.value = "New Topic"
metadataItem.revision = 174298200
// Create metadata object
let metadata = AgoraRtmMetadata()
metadata.majorRevision = 174298270
metadata.items = [metadataItem]
// Optional: Define metadata options if needed
let metadataOptions = AgoraRtmMetadataOptions()
metadataOptions.recordTs = true
metadataOptions.recordUserId = true

// Call updateChannelMetadata with completion block (callback)
rtmClient.updateChannelMetadata(
    channelName: channelName,
    channelType: channelType,
    data: metadata,
    options: metadataOptions,
    lock: nil
) { (response, error) in
    if let errorInfo = error {
        // Handle error
        print("Failed to update metadata with error: \(errorInfo.reason)")
    } else if let updateMetadataResponse = response {
        // Handle success
        print("Metadata updated successfully.")
    } else {
        // Handle unknown error
        print("Unknown error occurred while updating metadata.")
    }
}
```

### {storage.setuser[props.ag_platform]}

#### Description

<div className="index-desc-setuser">
The <code>{storage.setuser[props.ag_platform]}</code> method sets metadata for a user. If you call this method multiple times, the SDK retrieves the `key` of the metadata items and applies settings according to the following rules:

- If you set metadata with different keys, the SDK adds each set of metadata in sequence according to the order of the method calls.

- If you set metadata with the same `key`, the `value` of the last setting overwrites the previous one.
</div>

After successfully setting user metadata, users who subscribe to the user and enable event listeners receive the <code>{enumv.storagetypeuser[props.ag_platform]}</code> type of <code>{config.onstorageevent[props.ag_platform]}</code> event notification. See [Event listeners](#event-listeners).

User metadata also provides version control logic CAS (Compare And Set). This method provides two independent version control fields. You can set one or both of them according to your actual business use-case:

- Enable version number verification for the entire set of channel metadata by setting the `majorRevision` property in the <code>{storage.metadata[props.ag_platform]}</code> data type.

- Enable version number verification for a single metadata item by setting the `revision` property in the <code>{storage.metadataitem[props.ag_platform]}</code> class.

When setting user metadata or metadata items, you can control whether to enable version number verification by specifying the revision property:

- The default value of the revision property is `-1`, which indicates that this method call does not perform any CAS verification. If the user metadata or metadata item already exists, the latest value overwrites the previous one. If the user metadata or metadata item does not exist, the SDK creates it.

- If the revision property is a positive integer, this method call performs the CAS verification. If the user metadata or metadata item already exists, the SDK updates the corresponding value after the version number verification succeeds. If the user metadata or metadata item does not exist, the SDK returns the error code.

#### Method

Call the <code>{storage.setuser[props.ag_platform]}</code> method as follows:

```swift
setUserMetadata(
    userId: String,
    data: AgoraRtmMetadata,
    options: AgoraRtmMetadataOptions?
)   async -> (AgoraRtmCommonResponse?, AgoraRtmErrorInfo?)
```

```swift
setUserMetadata(
    userId: String,
    data: AgoraRtmMetadata,
    options: AgoraRtmMetadataOptions?,
    completion completionBlock: AgoraRtmOperationBlock? = nil
)
```

| Parameters | Type | Required | Default | Description |
| :-------: | :-------------: | :------: | :----: | ------------------------------------------------------------------------------------------------------------------------------------------------ |
| `userId` | String | Required | `userId` of the current user | User ID. |
| `data` | <code>{storage.metadata[props.ag_platform]}</code> | Required | - | Metadata item. See [`AgoraRtmMetadata`](#storagemetadatapropsag_platform). |
| `options` | <code>{storage.metadataoptions[props.ag_platform]}</code> | Optional | - | Options for setting the channel metadata. |
| `completion` | `AgoraRtmOperationBlock` | Optional | - | Callback of invocation result:<ul><li>Success: Returns the `AgoraRtmCommonResponse` data in the `response` parameter, and `nil` in the `errorInfo` parameter.</li><li>Failure: Returns `nil` in the `response` parameter, and error information in the `errorInfo` parameter.</li></ul> |


The <code>{storage.metadataoptions[props.ag_platform]}</code> data type contains the following properties:

| Properties | Type | Required | Default | Description |
| :-------------: | :-----: | :------: | :-----: | ----------------------------------------------------------------------------------------------------------------- |
| `recordTs` | Bool | Optional | `false` | Whether to record the timestamp of the edits. |
| `recordUserId` | Bool | Optional | `false` | Whether to record the user ID of the editor. |

#### Basic usage


```swift
// async-await
let userId = "exampleUser"
// Create metadata items to update
let metadataItem = AgoraRtmMetadataItem()
metadataItem.key = "status"
metadataItem.value = "active"
metadataItem.revision = 12345
// Create metadata object
let metadata = AgoraRtmMetadata()
metadata.majorRevision = 12346
metadata.items = [metadataItem]
// Optional: Define metadata options if needed
let metadataOptions = AgoraRtmMetadataOptions()
metadataOptions.recordTs = true
metadataOptions.recordUserId = true

// Call setUserMetadata with async/await
let (response, error) = await rtmClient.setUserMetadata(
    userId: userId,
    data: metadata,
    options: metadataOptions
)
if let errorInfo = error {
    // Handle error
    print("Failed to set user metadata with error: \(errorInfo.reason)")
} else if let setUserMetadataResponse = response {
    // Handle success
    print("User metadata set successfully.")
} else {
    // Handle unknown error
    print("Unknown error occurred while setting user metadata.")
}
```

```swift
// callback
let userId = "exampleUser"
// Create metadata items to update
let metadataItem = AgoraRtmMetadataItem()
metadataItem.key = "status"
metadataItem.value = "active"
metadataItem.revision = 12345
// Create metadata object
let metadata = AgoraRtmMetadata()
metadata.majorRevision = 12346
metadata.items = [metadataItem]
// Optional: Define metadata options if needed
let metadataOptions = AgoraRtmMetadataOptions()
metadataOptions.recordTs = true
metadataOptions.recordUserId = true

// Call setUserMetadata with a callback
rtmClient.setUserMetadata(
    userId: userId,
    data: metadata,
    options: metadataOptions
) { (response, error) in
    if let errorInfo = error {
        // Handle error
        print("Failed to set user metadata with error: \(errorInfo.reason)")
    } else if let setUserMetadataResponse = response {
        // Handle success
        print("User metadata set successfully.")
    } else {
        // Handle unknown error
        print("Unknown error occurred while setting user metadata.")
    }
}
```

### {storage.getuser[props.ag_platform]}

#### Description

The <code>{storage.getuser[props.ag_platform]}</code> method gets the metadata and metadata item for the specified user.

#### Method

Call the <code>{storage.getuser[props.ag_platform]}</code> method as follows:

```swift
getUserMetadata(userId: String) async -> (AgoraRtmGetMetadataResponse?, AgoraRtmErrorInfo?)
```

```swift
getUserMetadata(userId: String, completion completionBlock: AgoraRtmGetMetadataBlock? = nil)
```

| Parameters | Type | Required | Default | Description |
| :-------: | :-------------: | :------: | :----: | ------------------------------------------------------------------------------------------------------------------------------------------------ |
| `userId` | String | Required | `userId` of the current user | User ID. |
| `completion` | `AgoraRtmGetMetadataBlock` | Optional | - | Callback of invocation result:<ul><li>Success: Returns the `AgoraRtmGetMetadataResponse` data in the `response` parameter, and `nil` in the `errorInfo` parameter.</li><li>Failure: Returns `nil` in the `response` parameter, and error information in the `errorInfo` parameter.</li></ul> |

The `AgoraRtmGetMetadataResponse` data type contains the following properties:

| Properties | Type | Description |
| :------------------ | :--------------------: | ------------------------------------- |
| `data` | <code>{storage.metadata[props.ag_platform]}</code> | Metadata item. See [`AgoraRtmMetadata`](#storagemetadatapropsag_platform). |

#### Basic usage

```swift
// async-await
let userId = "exampleUser"

// Call getUserMetadata with async/await
let (response, error) = await rtmClient.getUserMetadata(userId: userId)
if let errorInfo = error {
    // Handle error
    print("Failed to get user metadata with error: \(errorInfo.reason)")
} else if let getUserMetadataResponse = response {
    // Handle success and access the metadata
    if let metadata = getUserMetadataResponse.data {
        print("User metadata retrieved successfully.")
        for item in metadata.items ?? [] {
            print("Key: \(item.key), Value: \(item.value), Author: \(item.authorUserId), Revision: \(item.revision)")
        }
    }
} else {
    // Handle unknown error
    print("Unknown error occurred while getting user metadata.")
}
```

```swift
// callback
let userId = "exampleUser"

// Call getUserMetadata with a callback
rtmClient.getUserMetadata(userId: userId) { (response, error) in
    if let errorInfo = error {
        // Handle error
        print("Failed to get user metadata with error: \(errorInfo.reason)")
    } else if let getUserMetadataResponse = response {
        // Handle success and access the metadata
        if let metadata = getUserMetadataResponse.data {
            print("User metadata retrieved successfully.")
            for item in metadata.items ?? [] {
                print("Key: \(item.key), Value: \(item.value), Author: \(item.authorUserId), Revision: \(item.revision)")
            }
        }
    } else {
        // Handle unknown error
        print("Unknown error occurred while getting user metadata.")
    }
}
```

### {storage.removeuser[props.ag_platform]}

#### Description

The <code>{storage.removeuser[props.ag_platform]}</code> method removes user metadata or metadata items.

After successfully removing user metadata, users who subscribe to the user and enable event listeners receive the <code>{enumv.storagetypeuser[props.ag_platform]}</code> type of <code>{config.onstorageevent[props.ag_platform]}</code> event notification. See [Event listeners](#event-listeners).

#### Method

Call the <code>{storage.removeuser[props.ag_platform]}</code> method as follows:

```swift
removeUserMetadata(
    userId: String,
    data: AgoraRtmMetadata,
    options: AgoraRtmMetadataOptions?
)   async -> (AgoraRtmCommonResponse?, AgoraRtmErrorInfo?)
```

```swift
removeUserMetadata(
    userId: String,
    data: AgoraRtmMetadata,
    options: AgoraRtmMetadataOptions?,
    completion completionBlock: AgoraRtmOperationBlock? = nil
)
```

| Parameters | Type | Required | Default | Description |
| :-------: | :-------------: | :------: | :----: | -------------------------------------- |
| `userId` | String | Required | `userId` of the current user | User ID. |
| `data` | <code>{storage.metadata[props.ag_platform]}</code> | Required | - | Metadata item. See [`AgoraRtmMetadata`](#storagemetadatapropsag_platform). |
| `options` | <code>{storage.metadataoptions[props.ag_platform]}</code> | Optional | - | Options for setting the channel metadata. |
| `completion` | `AgoraRtmOperationBlock` | Optional | - | Callback of invocation result:<ul><li>Success: Returns the `AgoraRtmCommonResponse` data in the `response` parameter, and `nil` in the `errorInfo` parameter.</li><li>Failure: Returns `nil` in the `response` parameter, and error information in the `errorInfo` parameter.</li></ul> |


The <code>{storage.metadataoptions[props.ag_platform]}</code> data type contains the following properties:

| Properties | Type | Required | Default | Description |
| :-------------: | :-----: | :------: | :-----: | ----------------------------------------------------------------------------------------------------------------- |
| `recordTs` | Bool | Optional | `false` | Whether to record the timestamp of the edits. |
| `recordUserId` | Bool | Optional | `false` | Whether to record the user ID of the editor. |

#### Basic usage

```swift
// async-await
let userId = "exampleUser"
// Create metadata items to remove
let metadataItem = AgoraRtmMetadataItem()
metadataItem.key = "status"
metadataItem.revision = 12345 // Make sure to provide the correct revision
// Create metadata object
let metadata = AgoraRtmMetadata()
metadata.majorRevision = 12346
metadata.items = [metadataItem]
// Call removeUserMetadata with async/await
let (response, error) = await rtmClient.removeUserMetadata(
    userId: userId,
    data: metadata,
    options: nil
)

if let errorInfo = error {
    // Handle error
    print("Failed to remove user metadata with error: \(errorInfo.reason)")
} else if let removeUserMetadataResponse = response {
    // Handle success
    print("User metadata removed successfully.")
} else {
    // Handle unknown error
    print("Unknown error occurred while removing user metadata.")
}
```

```swift
// callback
let userId = "exampleUser"

// Create metadata items to remove
let metadataItem = AgoraRtmMetadataItem()
metadataItem.key = "status"
metadataItem.revision = 12345 // Make sure to provide the correct revision

// Create metadata object
let metadata = AgoraRtmMetadata()
metadata.majorRevision = 12346
metadata.items = [metadataItem]

// Call removeUserMetadata with a callback
rtmClient.removeUserMetadata(userId: userId, data: metadata, options: nil) { (response, error) in
    if let errorInfo = error {
        // Handle error
        print("Failed to remove user metadata with error: \(errorInfo.reason)")
    } else if let removeUserMetadataResponse = response {
        // Handle success
        print("User metadata removed successfully.")
    } else {
        // Handle unknown error
        print("Unknown error occurred while removing user metadata.")
    }
}
```

### {storage.updateuser[props.ag_platform]}

#### Description

The <code>{storage.updateuser[props.ag_platform]}</code> method updates existing user metadata. After successfully updating channel metadata, users who subscribe to the user and enable event listeners receive the <code>{enumv.storagetypeuser[props.ag_platform]}</code> type of <code>{config.onstorageevent[props.ag_platform]}</code> event notification. See [Event listeners](#event-listeners).

<Admonition type="info" title="Information">You cannot use this method to update metadata items which do not exist.</Admonition>

#### Method

Call the <code>{storage.updateuser[props.ag_platform]}</code> method as follows:

```swift
updateUserMetadata(
    userId: String,
    data: AgoraRtmMetadata,
    options: AgoraRtmMetadataOptions?
)   async -> (AgoraRtmCommonResponse?, AgoraRtmErrorInfo?)
```

```swift
updateUserMetadata(
    userId: String,
    data: AgoraRtmMetadata,
    options: AgoraRtmMetadataOptions?,
    completion completionBlock: AgoraRtmOperationBlock? = nil
)
```

| Parameters | Type | Required | Default | Description |
| :-------: | :-------------: | :------: | :----: | ------------------------------------------------------------------------------------------------------------------------------------------------ |
| `userId` | String | Required | `userId` of the current user | User ID. |
| `data` | <code>{storage.metadata[props.ag_platform]}</code> | Required | - | Metadata item. See [`AgoraRtmMetadata`](#storagemetadatapropsag_platform). |
| `options` | <code>{storage.metadataoptions[props.ag_platform]}</code> | Optional | - | Options for setting the channel metadata. |
| `completion` | `AgoraRtmOperationBlock` | Optional | - | Callback of invocation result:<ul><li>Success: Returns the `AgoraRtmCommonResponse` data in the `response` parameter, and `nil` in the `errorInfo` parameter.</li><li>Failure: Returns `nil` in the `response` parameter, and error information in the `errorInfo` parameter.</li></ul> |


The <code>{storage.metadataoptions[props.ag_platform]}</code> data type contains the following properties:

| Properties | Type | Required | Default | Description |
| :-------------: | :-----: | :------: | :-----: | ----------------------------------------------------------------------------------------------------------------- |
| `recordTs` | Bool | Optional | `false` | Whether to record the timestamp of the edits. |
| `recordUserId` | Bool | Optional | `false` | Whether to record the user ID of the editor. |

#### Basic usage


```swift
// async-await
let userId = "exampleUser"
// Create metadata items to update
let metadataItem = AgoraRtmMetadataItem()
metadataItem.key = "status"
metadataItem.value = "active"// Set the new value
metadataItem.revision = 12345// Provide the current revision
// Create metadata object
let metadata = AgoraRtmMetadata()
metadata.majorRevision = 12346
metadata.items = [metadataItem]
// Optional: Define metadata options if needed
let metadataOptions = AgoraRtmMetadataOptions()
metadataOptions.recordTs = true
metadataOptions.recordUserId = true

// Call updateUserMetadata with async/await
let (response, error) = await rtmClient.updateUserMetadata(
    userId: userId,
    data: metadata,
    options: metadataOptions
)
if let errorInfo = error {
    // Handle error
    print("Failed to update user metadata with error: \(errorInfo.reason)")
} else if let updateUserMetadataResponse = response {
    // Handle success
    print("User metadata updated successfully.")
} else {
    // Handle unknown error
    print("Unknown error occurred while updating user metadata.")
}
```

```swift
// callback
let userId = "exampleUser"
// Create metadata items to update
let metadataItem = AgoraRtmMetadataItem()
metadataItem.key = "status"
metadataItem.value = "active"// Set the new value
metadataItem.revision = 12345// Provide the current revision
// Create metadata object
let metadata = AgoraRtmMetadata()
metadata.majorRevision = 12346
metadata.items = [metadataItem]
// Optional: Define metadata options if needed
let metadataOptions = AgoraRtmMetadataOptions()
metadataOptions.recordTs = true
metadataOptions.recordUserId = true

// Call updateUserMetadata with a callback
rtmClient.updateUserMetadata(userId: userId, data: metadata, options: metadataOptions) { (response, error) in
    if let errorInfo = error {
        // Handle error
        print("Failed to update user metadata with error: \(errorInfo.reason)")
    } else if let updateUserMetadataResponse = response {
        // Handle success
        print("User metadata updated successfully.")
    } else {
        // Handle unknown error
        print("Unknown error occurred while updating user metadata.")
    }
}
```

### {storage.subscribeuser[props.ag_platform]}

#### Description

The <code>{storage.subscribeuser[props.ag_platform]}</code> method subscribes to metadata for a specified user. After successfully subscribing to the user metadata, you receive the <code>{enumv.storagetypeuser[props.ag_platform]}</code> type of <code>{config.onstorageevent[props.ag_platform]}</code> event notification when the metadata for that user changes. See [Event listeners](#event-listeners).

#### Method

Call the <code>{storage.subscribeuser[props.ag_platform]}</code> method as follows:

```swift
subscribeUserMetadata(userId: String) async -> (AgoraRtmCommonResponse?, AgoraRtmErrorInfo?)
```

```swift
subscribeUserMetadata(userId: String, completion completionBlock: AgoraRtmOperationBlock? = nil)
```

| Parameters | Type | Required | Default | Description |
| :-------: | :-------------: | :------: | :----: | ---------------------------------- |
| `userId` | String | Required | `userId` of the current user | User ID. |
| `completion` | `AgoraRtmOperationBlock` | Optional | - | Callback of invocation result:<ul><li>Success: Returns the `AgoraRtmCommonResponse` data in the `response` parameter, and `nil` in the `errorInfo` parameter.</li><li>Failure: Returns `nil` in the `response` parameter, and error information in the `errorInfo` parameter.</li></ul> |

#### Basic usage


```swift
// async-await
let userId = "exampleUser"

// Call subscribeUserMetadata with async/await
let (response, error) = await rtmClient.subscribeUserMetadata(userId: userId)
if let errorInfo = error {
    // Handle error
    print("Failed to subscribe to user metadata with error: \(errorInfo.reason)")
} else if let subscribeResponse = response {
    // Handle success
    print("Successfully subscribed to user metadata.")
} else {
    // Handle unknown error
    print("Unknown error occurred while subscribing to user metadata.")
}
```

```swift
// callback
let userId = "exampleUser"

// Call subscribeUserMetadata with a callback
rtmClient.subscribeUserMetadata(userId: userId) { (response, error) in
    if let errorInfo = error {
        // Handle error
        print("Failed to subscribe to user metadata with error: \(errorInfo.reason)")
    } else if let subscribeResponse = response {
        // Handle success
        print("Successfully subscribed to user metadata.")
    } else {
        // Handle unknown error
        print("Unknown error occurred while subscribing to user metadata.")
    }
}
```

### {storage.unsubscribeuser[props.ag_platform]}

#### Description

When you no longer need to receive notifications of changes to a user's metadata, call the <code>{storage.unsubscribeuser[props.ag_platform]}</code> method to unsubscribe.

#### Method

Call the <code>{storage.unsubscribeuser[props.ag_platform]}</code> method as follows:

```swift
unsubscribeUserMetadata(userId: String) async -> (AgoraRtmCommonResponse?, AgoraRtmErrorInfo?)
```
```swift
unsubscribeUserMetadata(userId: String, completion completionBlock: AgoraRtmOperationBlock? = nil)
```

| Parameters | Type | Required | Default | Description |
| :------: | :----: | :------: | :----: | --------- |
| `userId` | String | Required | `userId` of the current user | User ID. |
| `completion` | `AgoraRtmOperationBlock` | Optional | - | Callback of invocation result:<ul><li>Success: Returns the `AgoraRtmCommonResponse` data in the `response` parameter, and `nil` in the `errorInfo` parameter.</li><li>Failure: Returns `nil` in the `response` parameter, and error information in the `errorInfo` parameter.</li></ul> |

#### Basic usage

```swift
// async-await
let userId = "exampleUser"

// Call unsubscribeUserMetadata with async/await
let (response, error) = await rtmClient.unsubscribeUserMetadata(userId: userId)
if let errorInfo = error {
    // Handle error
    print("Failed to unsubscribe from user metadata with error: \(errorInfo.reason)")
} else if let unsubscribeResponse = response {
    // Handle success
    print("Successfully unsubscribed from user metadata.")
} else {
    // Handle unknown error
    print("Unknown error occurred while unsubscribing from user metadata.")
}
```

```swift
// callback
let userId = "exampleUser"

// Call unsubscribeUserMetadata with a callback
rtmClient.unsubscribeUserMetadata(userId: userId) { (response, error) in
    if let errorInfo = error {
        // Handle error
        print("Failed to unsubscribe from user metadata with error: \(errorInfo.reason)")
    } else if let unsubscribeResponse = response {
        // Handle success
        print("Successfully unsubscribed from user metadata.")
    } else {
        // Handle unknown error
        print("Unknown error occurred while unsubscribing from user metadata.")
    }
}
```

### {storage.metadata[props.ag_platform]}

Use the <code>{storage.metadata[props.ag_platform]}</code> data type to set and manage metadata, containing the following properties:

| Properties | Type | Required | Default | Description |
| :------------: | :----: | :------: | :----: | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `majorRevision` | Int64 | Optional | `-1` | The version control switch:<ul><li> `-1`: Disable the version verification.</li><li>> `0`: Enable the version verification. The operation can only be performed if the target version number matches this value.</li></ul> |
| `items` | `[AgoraRtmMetadataItem]` | Optional | `nil` |  Metadata items. |

The <code>{storage.metadataitem[props.ag_platform]}</code> data type contains the following properties:

| Properties | Type | Required | Default | Description |
| :----------: | :------------: | :------: | :-----: | ---------------------------------------------------------- |
| `key` | String | Required | - | Key. |
| `value` | String | Required | - | Value. |
| `authorUserId` | String | Required | - | The user ID of the editor. This value is read-only and does not support writing. |
| `revision` | UInt64 | Optional | `-1` | <li>Returns the real version number in read operations.</li><li>Serves as a version control switch in write operations:</li><ul><li> `-1`: Disable the version verification.</li><li>> `0`: Enable version verification, only perform the operation if the target version number matches this value.</li></ul> |
| `updateTs` | UInt64 | Optional | `0` | Update timestamp. This value is read-only and does not support writing. |