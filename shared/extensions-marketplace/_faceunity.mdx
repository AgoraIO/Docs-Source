import Prerequisites from '@docs/shared/extensions-marketplace/common/_prerequities.mdx';
import ProjectSetup from '@docs/shared/extensions-marketplace/faceunity/project-setup/index.mdx';
import ProjectImplementation from '@docs/shared/extensions-marketplace/faceunity/project-implementation/index.mdx';
import ProjectTest from '@docs/shared/extensions-marketplace/faceunity/project-test/index.mdx'
import Reference from '@docs/shared/extensions-marketplace/faceunity/reference/index.mdx';
import NotSupported from '@docs/shared/extensions-marketplace/not-supported.mdx'

The <Vg k="RTEE_FU" /> AR Filter extension uses 3D vision, 3D graphics, and deep learning technologies to provide industryâ€™s leading AR portrait video effects for <Vg k="VSDK"/>. It enables you to add diverse special effects that provide full coverage of the human face, including:

* **Basic beauty**: Skin beautification, whitening, rosy.
* **Advanced beauty**: Video beauty effects for shape, face and skin.
* **Number detection**: Detect the number of faces, humans, or gestures.

This page shows you how to integrate and use the <Vg k="RTEE_FU" /> AR Filter extension in your <Vpl k="CLIENT" />.

<PlatformWrapper notAllowed="{['android','ios','flutter']}">
  <NotSupported />
</PlatformWrapper>

<PlatformWrapper notAllowed="{['web','macos','windows','react-native']}">

## Understand the tech

To quickly integrate <Vg k="RTEE_FU" />'s AR filter capabilities in your <Vpl k="CLIENT" />, you set extension properties using the `key` and `value` parameters in <Vg k="VSDK" />. When you call `setExtensionProperty` or `setExtensionPropertyWithVendor` method of <Vg k="VSDK" /> and pass in a pair of `key` and `value` parameters, it is equivalent to calling the corresponding <Vg k="RTEE_FU" /> API. The `key` is named after the <Vg k="RTEE_FU" /> API method, and `value` wraps the parameters required  for that method in JSON. Currently, the extension encapsulates part of the APIs of the <Vg k="RTEE_FU" /> Nama SDK. For details, see the <a href="#faceunity-key-value-overview">FaceUnity key-value overview</a>.

## Prerequisites

The development environment requirements are as follows:

<Prerequisites />
- Implemented <Link to="/realtime-communication/get-started/get-started-sdk"><Vg k="GET_STARTED"/> for <Vg k="VIDEO"/></Link>.

## Project Setup

To implement <Vg k="RTEE_FU" /> features in your <Vpl k="CLIENT" />, open the <Link to="/realtime-communication/get-started/get-started-sdk"><Vg k="GET_STARTED"/> for <Vg k="VIDEO"/></Link> project you created previously.

<ProjectSetup />

2. **Get the <Vg k="RTEE_FU" /> extension**

    To get the <Vg k="RTEE_FU" /> extension license, filters, and resource files, take the following steps:

    1. [Contact <Vg k="COMPANY" />](mailto:support@agora.io) for activation and provide your package name. For example,
      `yourCompany.yourProject.faceunity`.

        You receive the `authpack` certificate file from <Vg k="COMPANY" /> that corresponds to your package name.
  You use this file to integrate FaceUnity into your  <Vpl k="CLIENT" />.
    1. [Download](https://console.agora.io/v2/extensions-marketplace/faceunity-ar-en) the <Vg k="RTEE_FU" /> AR Filter package for your platform from the Extensions Marketplace.
    1. [Download](https://download.agora.io/marketplace/release/FaceUnity_v8.6.1_Resources.zip) the FaceUnity resource package.


## Integrate the extension

This section describes the call sequence you implement to use <Vg k="RTEE_FU"/> features in your <Vpl k="CLIENT"/>. 

<ProjectImplementation />

<ProjectTest />

## Reference

This section contains content that completes the information on this page, or points you to documentation that explains other aspects to this product.

### FaceUnity key-values

This section lists the <Vg k="RTEE_FU" /> APIs you can use with Agora SDK.

The key corresponds to the name of the <Vg k="RTEE_FU" /> API, and the value corresponds to the parameters of the API. In this section, if the value is the same as the parameters of the <Vg k="RTEE_FU" /> API, the link leads to the <Vg k="RTEE_FU" /> documentation. If the value is different from the parameters of the <Vg k="RTEE_FU" /> API, the link leads to a section on this page.

#### Method keys

Method keys refer to the keys you pass in when calling the `setExtensionProperty` or `setExtensionPropertyWithVendor` method of the <Vg k="VSDK"/>.

##### Initialization
| Method keys | Description |
| ------------------------------------ | -------- |
| [fuSetup](#fusetup) | Initialize the extension and authenticate the user. Must be executed before other keys. |
| [fuLoadAIModelFromPackage](#fuloadaimodelfrompackage) | Preload AI capabilities. |
| [fuReleaseAIModel](https://www.faceunity.com/DOCS/API/NamaC/#/?id=fureleaseaimodel-%e5%87%bd%e6%95%b0) | Free up resources occupied by AI capabilities. |

##### Prop package loading
| Method keys | Description |
| ------------------------------------ | -------- |
| [fuCreateItemFromPackage](#fucreateitemfrompackage) | Loads the prop package. |
| [fuLoadTongueModel](#fuloadtonguemodel) | Loads tongue detection data. |
| [fuItemSetParam](#fuitemsetparam) | Modifies or sets the value of a variable in the prop package. |

##### Destruction
| Method keys | Description |
| ------------------------------------ | -------- |
| [fuDestroyItem](#fudestroyitem) | Destroys a specified item. |
| [fuDestroyAllItems](https://www.faceunity.com/DOCS/API/NamaC/#/?id=fudestroyallitems-%e5%87%bd%e6%95%b0) | Destroys all loaded items and releases all occupied resources. |
| [fuOnDeviceLost](https://www.faceunity.com/DOCS/API/NamaC/#/?id=fuondevicelost-%e5%87%bd%e6%95%b0) | Resets the system's GL state. Use this key when the OpenGL context is released/destroyed by external resources. |
| [fuDestroyLibData](https://www.faceunity.com/DOCS/API/NamaC/#/?id=fudestroylibdata-%e5%87%bd%e6%95%b0) | Frees up the memory allocated to the face tracking module after calling ` fuSetup`. |

##### System functions
| Method keys | Description |
| ------------------------------------ | -------- |
| [fuBindItems](#fubinditems) | Binds resource items to a target item. |
| [fuUnbindItems](#fuunbinditems) | Unbinds the resource items from a target item. |
| [fuIsTracking](#fuistracking) | Sets whether to get the number of faces being tracked. |
| [fuSetMaxFaces](https://www.faceunity.com/DOCS/API/NamaC/#/?id=fusetmaxfaces-%e5%87%bd%e6%95%b0) | Sets the maximum number of tarcked faces. |
| [fuSetDefaultRotationMode](https://www.faceunity.com/DOCS/API/NamaC/#/?id=fusetdefaultrotationmode-%e5%87%bd%e6%95%b0) | Sets the default human face orientation. |

##### Algorithm functions
| Method keys | Description |
| ------------------------------------ | -------- |
| [fuFaceProcessorSetMinFaceRatio](https://www.faceunity.com/DOCS/API/NamaC/#/?id=fufaceprocessorsetminfaceratio-%e5%87%bd%e6%95%b0) | Sets the distance of face detection. |
| [fuSetTrackFaceAIType](https://www.faceunity.com/DOCS/API/NamaC/#/?id=fusettrackfaceaitype-%e5%87%bd%e6%95%b0) | Sets the `fuTrackFace` algorithm type. |
| [fuSetFaceProcessorFov](https://www.faceunity.com/DOCS/API/NamaC/#/?id=fusetfaceprocessorfov-%e5%87%bd%e6%95%b0) | Sets the fov (equivalent to focal length) of the `FaceProcessor` algorithm module. |
| [fuHumanProcessorReset](https://www.faceunity.com/DOCS/API/NamaC/#/?id=fuhumanprocessorreset-%e5%87%bd%e6%95%b0) | Resets the state of the `HumanProcessor` algorithm module. |
| [fuHumanProcessorSetMaxHumans](https://www.faceunity.com/DOCS/API/NamaC/#/?id=fuhumanprocessorsetmaxhumans-%e5%87%bd%e6%95%b0) | Sets the number of bodies tracked by the `HumanProcessor` algorithm module. |
| [fuHumanProcessorGetNumResults](#fuhumanprocessorgetnumresults) | Sets whether to get the number of bodies tracked by the `HumanProcessor` algorithm module. |
| [fuHumanProcessorSetFov](https://www.faceunity.com/DOCS/API/NamaC/#/?id=fuhumanprocessorsetfov-%e5%87%bd%e6%95%b0) | Sets the fov (equivalent to focal length) used by the `HumanProcessor` algorithm module to track 3D key points on human bodies. |
| [fuHandDetectorGetResultNumHands](#fuhanddetectorgetresultnumhands) | Sets whether to get the number of gestures tracked by the `HandGesture` algorithm module. Note that `ai_gesture.bundle` needs to be loaded. |

####  Method key description

##### fuSetup

| Value parameters | Description |
| ----------- | ---------------------- |
| `authdata` | The path to the certificate file. |

##### fuLoadAIModelFromPackage

| Value parameters | Description |
| ----------- | ---------------------- |
| `data` | String. The path of the AI capability model file `ai_xxx.bundle`. Such model files are located in the `assets/AI_Model` directory of the resource package. |
| `type` | Int. The AI capability type corresponding to the bundle file. Possible values are listed in [enum FUAITYPE](https://github.com/Faceunity/FULivePC/blob/5061509684360285b2d0b2be76e3eedb93a041ba/ThirdParty/Windows/FaceUnity-SDK-PC/include/CNamaSDK.h#L41). |

##### fuCreateItemFromPackage

| Value parameters | Description |
| ----------- | ---------------------- |
| `data` | String. The path to the prop package you want to load. A prop package usually has a suffix `*.bundle` . |

##### fuLoadTongueModel

| Value parameters | Description |
| ----------- | ---------------------- |
| `data` | String. The path of tongue model data `tongue.bundle`. |

##### fuItemSetParam

| Value parameters | Description |
| ----------- | ---------------------- |
| `obj_handle` | String. The path of the prop package passed in when calling [fuCreateItemFromPackage](#fucreateitemfrompackage). |
| `name` | String. The name of the variable to set in the prop package. |
| `value` | Object. The variable value to be set. |

For details on the variable names and values in the prop package, refer to the [<Vg k="RTEE_FU" /> documentation](https://github.com/Faceunity/FULiveDemoDroid/blob/master/doc/nama/%E7%BE%8E%E9%A2%9C%E9%81%93%E5%85%B7%E5%8A%9F%E8%83%BD%E6%96%87%E6%A1%A3.md).

##### fuDestroyItem

| Value parameters | Description |
| ----------- | ---------------------- |
| `item` | String. The path of the prop package passed in when calling [fuCreateItemFromPackage](#fucreateitemfrompackage). |


##### fuBindItems

| Value parameters | Description |
| ----------- | ---------------------- |
| `obj_handle` | String. The path of the target item. |
| `p_items` | String Array. The paths to the resource items you want to bind. |

##### fuUnbindItems

| Value parameters | Description |
| ----------- | ---------------------- |
| `obj_handle` | String. The path of the target item. |
| `p_items` | String Array, the paths to the resource items you want to unbind. |

##### fuIsTracking

| Value parameters | Description |
| ----------- | ---------------------- |
| `enable` | Bool. Whether to get the number of faces being tracked. If set to `true`, you can receive the [fuIsTracking](#fuIsTracking1) callback. |

##### fuHumanProcessorGetNumResults

| Value parameters | Description |
| ----------- | ---------------------- |
| `enable` | Bool. Whether to get the number of human bodies tracked by the `HumanProcessor` algorithm module. If set to `true`, you can receive the [fuHumanProcessorGetNumResults](#fuHumanProcessorGetNumResults1) callback. |

##### fuHandDetectorGetResultNumHands

| Value parameters | Description |
| ----------- | ---------------------- |
| `enable` | Bool. Whether to get the number of gestures tracked by the `HandGesture` algorithm module. If set to `true`, you can receive the [fuHandDetectorGetResultNumHands](#fuHandDetectorGetResultNumHands1) callback. |


#### Callback keys <a name="onevent"></a>

Callback keys refer to the keys returned in the `onEvent` callback of the Agora SDK.

| Callback keys | Description |
| ------------------------------------ | -------- |
| [fuIsTracking](#fuIsTracking1) | Returns the number of faces being tracked. |
| [fuHumanProcessorGetNumResults](#fuHumanProcessorGetNumResults1) | Returns the number of human bodies tracked by the HumanProcessor algorithm module. |
| [fuHandDetectorGetResultNumHands](#fuHandDetectorGetResultNumHands1) | Returns the number of gestures tracked by the HandGesture algorithm module. |
| [fuDestroyLibData](#fuDestroyLibData1)                       | Reports that the memory allocated to the face tracking module after calling ` fuSetup` is released. |

####  Callback key description

##### fuIsTracking<a name="fuIsTracking1"></a>

| Value parameters | Description |
| ----------- | ---------------------- |
| `faces` | Int. The number of faces being tracked. |

##### fuHumanProcessorGetNumResults<a name="fuHumanProcessorGetNumResults1"></a>

| Value parameters | Description |
| ----------- | ---------------------- |
| `people` | Int. The number of bodies being tracked. |

##### fuHandDetectorGetResultNumHands<a name="fuHandDetectorGetResultNumHands1"></a>

| Value parameters | Description |
| ----------- | ---------------------- |
| `hands` | Int. The number of gestures being tracked. |

##### fuDestroyLibData <a name="fuDestroyLibData1"></a>

Its value contains no parameters.

<PlatformWrapper platform ="flutter">
### Resource package structure

For a full description of the <Vg k="RTEE_FU" /> resource package, refer to:

- [Android resource package](https://github.com/Faceunity/FULiveDemoDroid/blob/master/doc/Android_Nama_Demo_Guide.md)

- [iOS resource package](https://github.com/FaceUnity/FULiveDemo/blob/master/docs/iOS_Nama_Demo_Guide.md#2-file-structure)
</PlatformWrapper>
<Reference />

</PlatformWrapper>
