import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';

import ProjectImplement from '@docs/shared/video-sdk/authentication-workflow/project-implementation/index.mdx';
import ProjectTest from '@docs/shared/video-sdk/authentication-workflow/project-test/index.mdx';
import Reference from '@docs/shared/video-sdk/authentication-workflow/reference/index.mdx';
import ProjectImplementUIKit from '@docs/shared/video-sdk/authentication-workflow/project-implementation-uikit/index.mdx';

Authentication is the act of validating the identity of each user before they access a system. <Vg k="COMPANY" /> uses digital tokens to authenticate users and their privileges. A token is a string used to verify user privileges when joining a channel. When a user connects to <Vg k="COMPANY" /> and passes in the token, the server verifies the user's identity and permissions based on the information in the token.

This page shows you how to quickly set up an authentication token server, retrieve a token from the server, and use it to connect securely to a  <Vpd k="NAME"/> channel. You use this server for development purposes. To see how to develop your own token generator and integrate it into your production IAM system, read [Token generators](/video-calling/develop/integrate-token-generation).



| Language | Core Method         | Sample Code                           |
|:----------|:----------------------|:---------------------------------------|
| C++      | [buildTokenWithUid](https://github.com/AgoraIO/Tools/blob/master/DynamicKey/AgoraDynamicKey/cpp/src/RtcTokenBuilder2.h#L69)   | [RtcTokenBuilder2Sample.cpp](https://github.com/AgoraIO/Tools/tree/master/DynamicKey/AgoraDynamicKey/cpp/sample/RtcTokenBuilder2Sample.cpp)            |
| Golang   | [BuildTokenWithUid](https://github.com/AgoraIO/Tools/blob/master/DynamicKey/AgoraDynamicKey/go/src/rtctokenbuilder2/rtctokenbuilder.go#L32)   | [sample.go](https://github.com/AgoraIO/Tools/tree/master/DynamicKey/AgoraDynamicKey/go/sample/rtctokenbuilder2/sample.go)                             |
| Java     | [buildTokenWithUid](https://github.com/AgoraIO/Tools/blob/master/DynamicKey/AgoraDynamicKey/java/src/main/java/io/agora/media/RtcTokenBuilder2.java#L35)   | [RtcTokenBuilder2Sample.java](https://github.com/AgoraIO/Tools/tree/master/DynamicKey/AgoraDynamicKey/java/src/main/java/io/agora/sample/RtcTokenBuilder2Sample.java)           |
| Node.js  | [buildTokenWithUid](https://github.com/AgoraIO/Tools/blob/master/DynamicKey/AgoraDynamicKey/nodejs/src/RtcTokenBuilder2.js#L30)   | [RtcTokenBuilder2Sample.js](https://github.com/AgoraIO/Tools/tree/master/DynamicKey/AgoraDynamicKey/nodejs/sample/RtcTokenBuilder2Sample.js)             |
| PHP      | [buildTokenWithUid](https://github.com/AgoraIO/Tools/blob/master/DynamicKey/AgoraDynamicKey/php/src/RtcTokenBuilder2.php#L26)   | [RtcTokenBuilder2Sample.php](https://github.com/AgoraIO/Tools/tree/master/DynamicKey/AgoraDynamicKey/php/sample/RtcTokenBuilder2Sample.php)            |
| Python   | [build_token_with_uid](https://github.com/AgoraIO/Tools/blob/master/DynamicKey/AgoraDynamicKey/python/src/RtcTokenBuilder2.py#L12C1-L12C1) | [RtcTokenBuilder2Sample.py](https://github.com/AgoraIO/Tools/tree/master/DynamicKey/AgoraDynamicKey/python/sample/RtcTokenBuilder2Sample.py)             |
| Python3  | [build_token_with_uid](https://github.com/AgoraIO/Tools/blob/master/DynamicKey/AgoraDynamicKey/python3/src/RtcTokenBuilder2.py#L12) | [RtcTokenBuilder2Sample.py](https://github.com/AgoraIO/Tools/tree/master/DynamicKey/AgoraDynamicKey/python3/sample/RtcTokenBuilder2Sample.py)             |


<Tabs>
  <TabItem value="cpp" label="C++" default>
    <CodeBlock language="cpp" showLineNumbers>
    {`#include <cstdlib>
#include <iostream>

#include "../src/RtcTokenBuilder2.h"

using namespace agora::tools;

int main(int argc, char const *argv[]) {
    (void)argc;
    (void)argv;

    // 获取环境变量 AGORA_APP_ID 的值。请确保你将该变量设为你在声网控制台获取的 App ID
    const char *env_app_id = getenv("AGORA_APP_ID");
    std::string app_id = env_app_id ? env_app_id : "";
    // 获取环境变量 AGORA_APP_CERTIFICATE 的值。请确保你将该变量设为你在声网控制台获取的 App 证书
    const char *env_app_certificate = getenv("AGORA_APP_CERTIFICATE");
    std::string app_certificate = env_app_certificate ? env_app_certificate : "";
    // 将 channelName 替换为需要加入的频道名
    std::string channel_name = "channelName";
    // 填入你实际的用户 ID
    uint32_t uid = 2882341273
    // Token 的有效时间，单位秒
    uint32_t token_expiration_in_seconds = 3600;
    // 所有的权限的有效时间，单位秒
    uint32_t privilege_expiration_in_seconds = 3600;
    std::string result;

    std::cout << "App Id:" << app_id << std::endl;
    std::cout << "App Certificate:" << app_certificate << std::endl;
    if (app_id == "" || app_certificate == "") {
        std::cout << "Need to set environment variable AGORA_APP_ID and "
                    "AGORA_APP_CERTIFICATE"
                << std::endl;
        return -1;
    }
    // 生成 Token
    result = RtcTokenBuilder2::BuildTokenWithUid(
        app_id, app_certificate, channel_name, uid, UserRole::kRolePublisher,
        token_expiration_in_seconds, privilege_expiration_in_seconds);
    std::cout << "Token With Int Uid:" << result << std::endl;

    return 0;
}`}
    </CodeBlock>
  </TabItem>
  <TabItem value="golang" label="Golang">
    <CodeBlock language="go" showLineNumbers>
    {`package main

import (
    "fmt"
    "os"

    rtctokenbuilder "github.com/AgoraIO/Tools/DynamicKey/AgoraDynamicKey/go/src/rtctokenbuilder2"
)

func main() {
    // 获取环境变量 AGORA_APP_ID 的值。请确保你将该变量设为你在声网控制台获取的 App ID
    appId := os.Getenv("AGORA_APP_ID")
    // 获取环境变量 AGORA_APP_CERTIFICATE 的值。请确保你将该变量设为你在声网控制台获取的 App 证书
    appCertificate := os.Getenv("AGORA_APP_CERTIFICATE")
    // 将 channelName 替换为需要加入的频道名
    channelName := "channelName"
    // 填入你实际的用户 ID
    uid := uint32(2882341273)
    // Token 的有效时间，单位秒
    tokenExpirationInSeconds := uint32(3600)
    // 所有的权限的有效时间，单位秒
    privilegeExpirationInSeconds := uint32(3600)

    fmt.Println("App Id:", appId)
    fmt.Println("App Certificate:", appCertificate)
    if appId == "" || appCertificate == "" {
        fmt.Println("Need to set environment variable AGORA_APP_ID and AGORA_APP_CERTIFICATE")
        return
    }
        // 生成 Token
        result, err := rtctokenbuilder.BuildTokenWithUid(appId, appCertificate, channelName, uid, rtctokenbuilder.RoleSubscriber, tokenExpirationInSeconds, privilegeExpirationInSeconds)
    if err != nil {
        fmt.Println(err)
    } else {
        fmt.Printf("Token with int uid: %s\\n", result)
    }
}`}
    </CodeBlock>
  </TabItem>
  <TabItem value="java" label="Java">
    <CodeBlock language="java" showLineNumbers>
    {`package io.agora.sample;

import io.agora.media.RtcTokenBuilder2;
import io.agora.media.RtcTokenBuilder2.Role;

public class RtcTokenBuilder2Sample {
    // 获取环境变量 AGORA_APP_ID 的值。请确保你将该变量设为你在声网控制台获取的 App ID
    static String appId = System.getenv("AGORA_APP_ID");
    // 获取环境变量 AGORA_APP_CERTIFICATE 的值。请确保你将该变量设为你在声网控制台获取的 App 证书
    static String appCertificate = System.getenv("AGORA_APP_CERTIFICATE");
    // 将 channelName 替换为需要加入的频道名
    static String channelName = "channelName";
    // 填入你实际的用户 ID
    static int uid = 2082341273;
    // Token 的有效时间，单位秒
    static int tokenExpirationInSeconds = 3600;
    // 所有的权限的有效时间，单位秒
    static int privilegeExpirationInSeconds = 3600;

    public static void main(String[] args) {
        System.out.printf("App Id: %s\\n", appId);
        System.out.printf("App Certificate: %s\\n", appCertificate);
        if (appId == null || appId.isEmpty() || appCertificate == null || appCertificate.isEmpty()) {
            System.out.printf("Need to set environment variable AGORA_APP_ID and AGORA_APP_CERTIFICATE\\n");
            return;
        }
        // 生成 Token
        RtcTokenBuilder2 token = new RtcTokenBuilder2();
        String result = token.buildTokenWithUid(appId, appCertificate, channelName, uid, Role.ROLE_SUBSCRIBER,
                tokenExpirationInSeconds, privilegeExpirationInSeconds);
        System.out.printf("Token with uid: %s\\n", result);
    }
}`}
    </CodeBlock>
  </TabItem>
  <TabItem value="node-js" label="Node.js">
    <CodeBlock language="js" showLineNumbers>
    {`const RtcTokenBuilder = require("../src/RtcTokenBuilder2").RtcTokenBuilder;
const RtcRole = require("../src/RtcTokenBuilder2").Role;

// 获取环境变量 AGORA_APP_ID 的值。请确保你将该变量设为你在声网控制台获取的 App ID
const appId = process.env.AGORA_APP_ID;
// 获取环境变量 AGORA_APP_CERTIFICATE 的值。请确保你将该变量设为你在声网控制台获取的 App 证书
const appCertificate = process.env.AGORA_APP_CERTIFICATE;
// 将 channelName 替换为需要加入的频道名
const channelName = "channelName";
// 填入你实际的用户 ID
const uid = 2882341273;
// 设为具有发流权限
const role = RtcRole.PUBLISHER;
// Token 的有效时间，单位秒
const tokenExpirationInSecond = 3600;
// 所有的权限的有效时间，单位秒
const privilegeExpirationInSecond = 3600;

console.log("App Id:", appId);
console.log("App Certificate:", appCertificate);
if (appId == undefined || appId == "" || appCertificate == undefined || appCertificate == "") {
  console.log("Need to set environment variable AGORA_APP_ID and AGORA_APP_CERTIFICATE");
  process.exit(1);
}

// 生成 Token
const tokenWithUid = RtcTokenBuilder.buildTokenWithUid(appId, appCertificate, channelName, uid, role, tokenExpirationInSecond, privilegeExpirationInSecond);
console.log("Token with int uid:", tokenWithUid);`}
    </CodeBlock>
  </TabItem>
  <TabItem value="php" label="PHP">
    <CodeBlock language="js" showLineNumbers>
    {`<?php
include("../src/RtcTokenBuilder2.php");

// 获取环境变量 AGORA_APP_ID 的值。请确保你将该变量设为你在声网控制台获取的 App ID
$appId = getenv("AGORA_APP_ID");
// 获取环境变量 AGORA_APP_CERTIFICATE 的值。请确保你将该变量设为你在声网控制台获取的 App 证书
$appCertificate = getenv("AGORA_APP_CERTIFICATE");
// 将 channelName 替换为需要加入的频道名
$channelName = "channelName";
// 填入你实际的用户 ID
$uid = 2882341273;
// Token 的有效时间，单位秒
$tokenExpirationInSeconds = 3600;
// 所有的权限的有效时间，单位秒
$privilegeExpirationInSeconds = 3600;

echo "App Id: " . $appId . PHP_EOL;
echo "App Certificate: " . $appCertificate . PHP_EOL;
if ($appId == "" || $appCertificate == "") {
    echo "Need to set environment variable AGORA_APP_ID and AGORA_APP_CERTIFICATE" . PHP_EOL;
    exit;
}
// 生成 Token
$token = RtcTokenBuilder2::buildTokenWithUid($appId, $appCertificate, $channelName, $uid, RtcTokenBuilder2::ROLE_PUBLISHER, $tokenExpirationInSeconds, $privilegeExpirationInSeconds);
echo 'Token with int uid: ' . $token . PHP_EOL;`}
    </CodeBlock>
  </TabItem>
  <TabItem value="python" label="Python">
    <CodeBlock language="python" showLineNumbers>
    {`import os
import sys

sys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(__file__), '..')))

from src.RtcTokenBuilder2 import *


def main():
    # 获取环境变量 AGORA_APP_ID 的值。请确保你将该变量设为你在声网控制台获取的 App ID
    app_id = os.environ.get("AGORA_APP_ID")
    # 获取环境变量 AGORA_APP_CERTIFICATE 的值。请确保你将该变量设为你在声网控制台获取的 App 证书
    app_certificate = os.environ.get("AGORA_APP_CERTIFICATE")
    # 将 channel_name 替换为需要加入的频道名
    channel_name = "channel_name"
    # 填入你实际的用户 ID
    uid = 2882341273
    # Token 的有效时间，单位秒
    token_expiration_in_seconds = 3600
    # 所有的权限的有效时间，单位秒
    privilege_expiration_in_seconds = 3600

    print("App Id: %s" % app_id)
    print("App Certificate: %s" % app_certificate)
    if not app_id or not app_certificate:
        print("Need to set environment variable AGORA_APP_ID and AGORA_APP_CERTIFICATE")
        return
    # 生成 Token
    token = RtcTokenBuilder.build_token_with_uid(app_id, app_certificate, channel_name, uid, Role_Subscriber,
                                                 token_expiration_in_seconds, privilege_expiration_in_seconds)
    print("Token with int uid: {}".format(token))


if __name__ == "__main__":
    main()`}
    </CodeBlock>
  </TabItem>
  <TabItem value="python3" label="Python3">
    <CodeBlock language="python" showLineNumbers>
    {`import os
import sys

sys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(__file__), '..')))

from src.RtcTokenBuilder2 import *


def main():
    # 获取环境变量 AGORA_APP_ID 的值。请确保你将该变量设为你在声网控制台获取的 App ID
    app_id = os.environ.get("AGORA_APP_ID")
    # 获取环境变量 AGORA_APP_CERTIFICATE 的值。请确保你将该变量设为你在声网控制台获取的 App 证书
    app_certificate = os.environ.get("AGORA_APP_CERTIFICATE")
    # 将 channel_name 替换为需要加入的频道名
    channel_name = "channel_name"
    # 填入你实际的用户 ID
    uid = 2882341273
    # Token 的有效时间，单位秒
    token_expiration_in_seconds = 3600
    # 所有的权限的有效时间，单位秒
    privilege_expiration_in_seconds = 3600

    print("App Id: %s" % app_id)
    print("App Certificate: %s" % app_certificate)
    if not app_id or not app_certificate:
        print("Need to set environment variable AGORA_APP_ID and AGORA_APP_CERTIFICATE")
        return

    # 生成 Token
    token = RtcTokenBuilder.build_token_with_uid(app_id, app_certificate, channel_name, uid, Role_Subscriber,
                                                 token_expiration_in_seconds, privilege_expiration_in_seconds)
    print("Token with int uid: {}".format(token))


if __name__ == "__main__":
    main()`}
    </CodeBlock>
  </TabItem>
</Tabs>

## Understand the tech

An authentication token is a dynamic key that is valid for a maximum of 24 hours. On request, a token server returns
an authentication token that is valid to join a specific channel or wildcard channels.

When users attempt to connect to an <Vg k="COMPANY" /> channel, your <Vpl k="CLIENT" /> retrieves a token from the token server in your security infrastructure. Your <Vpl k="CLIENT" /> then sends this token to <Vg k="AGORA_BACKEND" /> for authentication. <Vg k="AGORA_BACKEND" /> validates the token and reads the user and project information stored in the token. A token contains the following information:


-   The [App ID](../reference/manage-agora-account#get-the-app-id) of your <Vg k="COMPANY" /> project

-   The [App certificate](../reference/manage-agora-account#get-the-app-certificate) of your <Vg k="COMPANY" /> project

-   The name of an individual channel, or a wildcard string for multiple channels

-   The user ID of the user to be authenticated (optional)

-   The privilege of the user, either as a publisher or a subscriber

-   The Unix timestamp showing when the token will expire

The following figure shows the call flow you need to implement to create step-up-authentication with <Vg k="COMPANY" /> <Vpd k="NAME"/>:

![token authentication flow](/images/video-sdk/authentication-logic.png)

<ProductWrapper notAllowed="cloud-recording,on-premise-recording">

## Prerequisites

-  Created a cloud platform account that is verified through your GitHub account. The following platforms are
    currently supported:
    - [Render](https://render.com/)
    - [Railway](https://railway.app/)
    - [Heroku](https://www.heroku.com/)

    To integrate a token generator directly into your security infrastructure, see [Token generators](/video-calling/develop/integrate-token-generation).

</ProductWrapper>

<PlatformWrapper platform="windows">
## Project setup

To create the environment necessary to test **secure authentication with tokens** , implement same setup as you done for the [<Vpd  k="SDK" /> quickstart project setup](../get-started/get-started-sdk#project-setup) for <Vpd k="NAME"/>.
</PlatformWrapper>

## Implement the authentication workflow

In the <Vg k="GET_STARTED"/> sample project, the <Vpl k="CLIENT" /> uses an authentication token obtained manually from <Vg k="CONSOLE" /> to join a channel. In a production environment, your <Vpl k="CLIENT" /> retrieves this token from a token server. This page shows you how to:

1.  [Create and run a token server](#create-and-run-a-token-server)

<ProductWrapper notAllowed="on-premise-recording">
2.  [Authenticate using the SDK](#authenticate-using-the-sdk)
</ProductWrapper>

## Create and run a token server

This section shows you how to deploy a token server on a cloud platform.

1. **Start deploying the token server to your cloud platform**

    Click your cloud platform below. The cloud platform retrieves the project code and necessary files from Github,
then takes you to the **Deployment** page.
    -   [Render](https://render.com/deploy?repo=https://github.com/AgoraIO-Community/agora-token-service)
    -   [Railway](https://railway.app/new/template/NKYzQA?referralCode=waRWUT)
    -   [Heroku](https://www.heroku.com/deploy/?template=https://github.com/AgoraIO-Community/agora-token-service)

1. **Fill in the information needed by your cloud platform**

    1.  `Blueprint name`: A unique name for your deployment.

    1.  `Branch name`: The branch of the repo or fork you want to deploy, default is `main`.

    1.  `APP_CERTIFICATE`: The App Certificate obtained from <Link target="_blank" to="{{global.AGORA_CONSOLE_URL}}"><Vg k="CONSOLE" /></Link>.

    1.  `APP_ID`: The [App ID](../reference/manage-agora-account#get-the-app-id) obtained from <Link target="_blank" to="{{global.AGORA_CONSOLE_URL}}"><Vg k="CONSOLE" /></Link>.

    1.  `Github account`: The GitHub account where the cloud platform should clone the token server repository.

    1.  `Repository name`: The name of the cloned repository, the default is `agora-token-service`.

    1.  `Private repository`: Select this option to hide this repository.

2.  **Create your token server**

    Click **Deploy**. The platform configures and builds the token server.

3.  **Test your server**

    1. Click the **URL**.

        You are notified of a URL where your server is deployed. Click the link and open the token server in your browser. Don’t worry if you see `404 page not found` in your browser. Follow the next steps and test your server.

    1. Send a request to the token server using a URL based on the [Token server POST request structure](#token-server-post-request-structure):

        ```sh
        curl --location 'https://agora-token-service-example.up.railway.app/fetchToken' \
        --header 'Content-Type: application/json' \
        --data '{
            "tokenType": "rtc",
            "uid": "13119",
            "role": "publisher",
            "channel": "test"
        }'
        ```

        Your token server returns a JSON object containing an encrypted token:

        ```json
        {
            "token": "ThisIsAnExampleTokenThisIsAnExampleTokenThisIsAnExampleTokenThisIsAnExampleTokenThisIsAnExampleToken"
        }
        ```

<ProductWrapper notAllowed="on-premise-recording">
## Authenticate using the SDK

To retrieve tokens from the token server and use them to authenticate your <Vpl k="CLIENT" /> with <Vg k="AGORA_BACKEND" /> using  <Vpd k="SDK" />:

<ProjectImplement />

## Test the implementation

To test the **Secure authentication with tokens** example:

<ProjectTest />

</ProductWrapper>
<ProductWrapper notAllowed="iot,windows">

<ProjectImplementUIKit />

</ProductWrapper>
## Reference

This section contains information that completes the information in this page, or points you to documentation that explains other aspects to this product.

### Source code for a token server

The token server RESTful web service used in this page is written in Golang using the Gin framework. Want to use the code in your authentication service? [Download](https://github.com/AgoraIO-Community/agora-token-service/releases/latest) the token server source code and binaries for various platforms from Github.

To see how to create a token generator inside your IAM system, see [Integrate a token generator](../develop/integrate-token-generation).

### Token server POST request structure

A token server POST request has the following structure:

Endpoint:

```
/fetchToken
```

Body:

```json
{
    "tokenType": "rtc", // choose rtc for audio/video SDK tokens
    "uid": "0", // change to your user id, for example "333" or "account-name"
    "role": "publisher",  // "publisher" or "subscriber"
    "channel": "example", // channel name, wildcard "*" is available.
    "expire": 3600 // optional: expiration time in seconds (default: 3600)
}
```

URL example: `https://agora-token-service-example.up.railway.app/fetchToken`

Your token server returns a JSON object containing an encrypted token:

```json
{
  "token": "ThisIsAnExampleTokenThisIsAnExampleTokenThisIsAnExampleTokenThisIsAnExampleTokenThisIsAnExampleToken"
}
```

<PlatformWrapper notAllowed={["ios","macos"]}>
### Token server GET request structure

A token server GET request has the following structure:

    ```html
    /rtc/:channelName/:role/:tokentype/:uid/?expiry=expireTime
    ```

-   `:channelName` is the name of the <Vg k="COMPANY" /> channel, or a wildcard for multiple channels that the local
user may join. For example, you use a `Agora*` token to join `AgoraChannel` or `AgoraAwesome`. However, you cannot
use it to join the `AppTest`channel.

    A channel name may contain numbers with both upper and lower case letters. The name length must be less than 64
    characters. Wildcard channels work for tokens that start with `007` and later.

-   `:role` is the user role

    Use `publisher` for publisher, `subscriber` for subscriber.

-   `:tokentype` is the type of token

    <Vg k="AGORA_BACKEND" /> supports both integer user IDs and string user accounts for token generation. To ensure smooth communication, all the users in a channel must use the same type of ID, that is, either the integer `uid`, or a string `userAccount`. Best practice is to use the `uid`.

-   `:uid` is the user ID

    User Id can be any 32-bit unsigned integer. It can be set to 0, if you do not need to authenticate the user based on the user ID.

-   `expireTime` (optional) is the number of seconds after which the token will expire

    By default, a token expires after 24 hours unless a shorter life span is explicitly specified in the token request.
</PlatformWrapper>

### Wildcard tokens

When a user joins an audio or video call, or a live broadcast, <Vg k="AGORA_BACKEND" /> uses a token to authenticate the user. If users need to join multiple channels, or frequently switch between channels, they need to acquire a token from the authentication server each time they join a new channel. In order to avoid frequent retrieval of tokens when switching channels, <Vg k="AGORA_BACKEND" /> enables use of tokens based on channel wildcards. By using wildcard tokens, users can reuse the same token to join different channels. This approach not only speeds up the process of authentication, but also reduces the workload on your token server.

#### Prerequisites

Before generating wildcard tokens, make sure you have deployed the `AccessToken2` server.

<PlatformWrapper platform="web">
To enable use of wildcard tokens in your web client, call `setParameter` to set `USE_NEW_TOKEN` to `true`:

    ```java
    AgoraRTC.setParameter("USE_NEW_TOKEN", true);
    ```
</PlatformWrapper>

#### Generate wildcard token

The generation code of `AccessToken2` provides two `[BuildTokenWithUid]()` methods. You can use `[BuildTokenWithUid]()[1/2]` or `[BuildTokenWithUid]()[2/2]` according to the `[BuildTokenWithUid]()` API reference, and fill in the corresponding parameter information.

When generating a wildcard token, you need to note that the following parameters are different compared to those used to generate a general token:

| Parameter | General Token | Wildcard Token |
|:----------|:--------------|:---------------|
| `uid` | User ID of the user to be authenticated. If there is no need to authenticate the user ID, that is, if clients can join the channel with any uid, set `uid` to `0`. | The user ID of the user to be authenticated. Supports `int` and `string` types for the user ID, but it must not be set to `0`. |
| `channelName` | Channel name, the length should be less than 64 bytes. | Channel name is set as wildcard `*` indicating any channel name. |

After acquiring a wildcard token, users can join any channel with the same user ID and token.

#### Precautions

1. Currently, <Vg k="AGORA_BACKEND" /> supports only the following combinations of channel name and user ID when joining a channel:

    - `uid` set to 0, `channelName` is specified
    - `uid` is specified, `channelName` set to `*`
    
    <Vg k="AGORA_BACKEND" /> does not support setting the `uid` to `0` and `channelName` to `*` at the same time.

1. To prevent unauthorized users from disrupting the order of a channel using leaked wildcard tokens, <Vg k="COMPANY" /> recommends that users who use wildcard tokens set their permissions as a **viewer** and the role as `kRoleSubscriber`.

   If a user using a wildcard token needs to connect to the microphone, best practice is to take the following steps to update the token:

    1. Call `setClientRole` to set the user's role as a host or broadcaster.

    1. When generating a fresh token, specify the channel name and user ID in the `[BuildTokenWithUid]()` method. Set the user permission role to `kRolePublisher`, thereby generating a token with the permission to send streams.

    1. Call `renewToken` to update the token.

1. If the wildcard token expires, you regenerate a new wildcard token on the server and then call `renewToken` to pass in the new token.

<Reference />
