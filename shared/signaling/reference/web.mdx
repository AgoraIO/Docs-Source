<PlatformWrapper platform="web">
The Signaling SDK API Reference lists the description, methods, basic usage, sample code, and return values. It is divided in to the following sections:

* [Setup](#setup)
* [Channels](#channels)
* [Topics](#topics)
* [Messages](#messages)
* [Presence](#presence)
* [Storage](#storage)
* [Lock](#lock)
* [Properties](#properties)

## Setup   

Before initializing a Signaling client instance, import the [Signaling SDK for Web](../../sdks)  into your project.

### Initialization
#### Description

Initialization in Signaling refers to creating and initializing a Signaling client instance. When initializing the instance, you need to pass in parameters including `appId` and `userId`. You can create a project and get the App ID on the Agora console.

<Admonition type="info" title="Information"><ul><li>The initialization step needs to be completed before calling the other Signaling APIs. </li> <li>In order to identifying users and devices, you need to ensure that `userId` is globally unique and remains constant throughout the lifecycle of the user or device. </li></ul></Admonition>

#### Method

You can create and initialize an instance in the following way:

```javascript 
class RTM(
    constructor(
        appId: string,
        userId: string,
        rtmConfig?: {
            token: string,
            encryptionMode: string,
            cipherKey: string,
            salt: Uint8Array,
            useStringUserId: boolean,
            presenceTimeout: number,
            logUpload: boolean,
            logLevel: string,
            cloudProxy: boolean
        }
    );
)
```

|    Parameter     |                        Type                        | Required | Default | Description                                                                           |
| :---------: | :------------------------------------------------: | :------: | :----: | ------------------------------------------------------------------------------- |
|   `appId`   |                       string                       |   Required   |   -    |  The App ID of your Agora project on the Agora console.                                        |
|  `userId`   |                       string                       |   Required   |   -    |  The unique ID to identify a user or device.                                                  |
| `rtmConfig` | `RtmConfig` |   Optional   |   -    | The configuration parameters for initialization, see [`RtmConfig`](#rtmconfig). |

#### Basic Usage

```javascript 
const { RTM } = AgoraRTM;
const rtm = new RTM(
    appId : "myAppId",
    userId : "Tony"
);
```

#### Return Value

A Signaling client instance. Now you can call other Signaling APIs.

### `RTMConfig`

#### Description

`RTMConfig` is used to configure additional properties when you initializing a Signaling client instance. These configuration properties take effect throughout the lifecycle of the Signaling client and affect the behaviors of the Signaling client.

#### Method

You can create a `RTMConfig` instance in the following way:

```javascript 
const { RTMConfig } = AgoraRTM;
```

|       Property       |    Type    | Required | Default  | Description       |
| :---------------: | :--------: | :------: | :-----: | ---------------------------------------- |
| `token` | string | Optional | - | A dynamic key, usually generated by a token server. |
| `encryptionMode` | string | Optional | - | Encryption mode for end-to-end messages. If you do not set this property or set it as `NONE`,  end-to-end encryption is disabled. For details, see [Encryption Modes](#end-to-end-encryption-modes). |
| `cipherKey` | string | Optional | - | The key used for encryption and decryption. You must set this property if you want to enable message encryption. |
| `salt` | Uint8Array | Optional | - | The salt required for encryption. The value must be a 32-byte binary array. You must set this property if you want to enable message encryption.|
| `useStringUserId` | boolean | Optional | `true` | Whether to use string-type user IDs: <ul><li>`true`: Use string-type user IDs. </li><li>`false`: Use number-type user IDs. If you set the property as `false`, SDK automatically converts string-type user IDs to number-type ones. In this case, the `userId` parameter must be a numeric string (for example, "123456"), otherwise initialization fails. </li></ul> |
| `presenceTimeout` | number | Optional | `300` | Presence timeout in seconds, and the value range is [10,300]. |
| `logUpload` | boolean | Optional | `false` | Whether to upload logs to the server: <ul><li>`true`: Enable log upload</li><li><code>false</code >: Disable log upload. </li></ul> |
| `logLevel` | string | Optional | - | Set the output level of SDK log. For details, see [Log output levels](#log-output-levels). |
| `cloudProxy` | boolean | Optional | `false` | Whether to enable the cloud proxy: <ul><li>`true`: Enable. </li><li>`false`: Disable. </li></ul> |

#### Basic Usage

```javascript 
const { RTM, EncryptionMode } = AgoraRTM;
const rtmConfig = {
        token : "yourToken",
        encryptionMode : EncryptionMode.AES_256_GCM,
        slat : yourSalt,
        cipherKey : "yourCipherKey",
        presenceTimeout : 300,
        logUpload : true,
        logLevel : 'debug',
        cloudProxy : false,
        useStringUserId : false
};
const rtm = new RTM( "myAppId", "Tony", rtmConfig);
```

### Event Listeners

#### Description

In Signaling there are seven types of event as follows:

| Event Type | Description |
|:----------------------------:| ------------------------- |
| `message` | Receive message event notifications in subscribed message channels and subscribed topics. |
| `presence` | Receive presence event notifications in subscribed message channels and joined stream channels. |
| `topic` | Receive all topic event notifications in joined stream channels. |
| `storage` | Receive channel metadata event notifications in subscribed message channels and joined stream channels, and the user metadata event notification of the subscribed users. |
| `lock` | Receive lock event notifications in subscribed message channels and joined stream channels. |
| `status` | Receive event notifications when client connection status changes. For details, see [SDK connection state change reason](#reasons-for-the-sdk-connection-state-change). |
| `TokenPrivilegeWillExpire` | Receive event notifications when the client tokens are about to expire. |

#### Add event listeners

You can add event listeners in the following way:

```javascript 
// Add message event listeners
// Message
rtm.addEventListener("message", event => {
    const channelType = event.channelType;      // Which channel type it is, Should be "STREAM" or "MESSAGE" .
    const channelName = event.channelName;      // Which channel does this message come from
    const topic = event.topicName;              // Which Topic does this message come from, it is valid when the channelType is "STREAM".
    const messageType = event.messageType;      // Which message type it is, Should be "sting" or "binary" .
    const customType = event.customType;        // User defined type
    const publisher = event.publisher;          // Message publisher
    const message = event.message;              // Message payload
    const pubTime = event.publishTime;          // Message publisher timestamp
});
// Presence
rtm.addEventListener("presence", event => {
    const action = event.eventType;             // Which action it is ,should be one of 'SNAPSHOT'、'INTERVAL'、'JOIN'、'LEAVE'、'TIMEOUT、'STATE_CHANGED'、'OUT_OF_SERVICE'.
    const channelType = event.channelType;      // Which channel type it is, Should be "STREAM" or "MESSAGE" .
    const channelName = event.channelName;      // Which channel does this event come from
    const publisher = event.publisher;          // Who trigger this event
    const states = event.stateChanged;          // User state payload
    const interval = event.interval;            // Interval payload
    const snapshot = event.snapshot;            // Snapshot payload
});
// Topic
rtm.addEventListener("topic", event => {
    const action = event.evenType;              // Which action it is ,should be one of 'SNAPSHOT'、'JOIN'、'LEAVE'.
    const channelName = event.channelName;      // Which channel does this event come from
    const publisher = event.userId;             // Who trigger this event
    const topicInfos = event.topicInfos;        // Topic information payload
    const totalTopics = event.totalTopics;      // How many topics
});
// Storage
rtm.addEventListener("storage", event => {
    const channelType = event.channelType;      // Which channel type it is, Should be "STREAM" or "MESSAGE" .
    const channelName = event.channelName;      // Which channel does this event come from
    const publisher = event.publisher;          // Who trigger this event
    const storageType = event.storageType;      // Which category the event is, should be 'USER'、'CHANNEL'
    const action = event.eventType;             // Which action it is ,should be one of "SNAPSHOT"、"SET"、"REMOVE"、"UPDATE" or "NONE"
    const data = event.data;                    // 'USER_METADATA' or 'CHANNEL_METADATA' payload
});
// Lock
rtm.addEventListener("lock", event => {
    const channelType = event.channelType;      // Which channel type it is, Should be "STREAM" or "MESSAGE" .
    const channelName = event.channelName;      // Which channel does this event come from
    const publisher = event.publisher;          // Who trigger this event
    const action = event.evenType;              // Which action it is ,should be one of 'SET'、'REMOVED'、'ACQUIRED'、'RELEASED'、'EXPIRED'、'SNAPSHOT'
    const lockName = event.lockName;            // Which lock it effect
    const ttl = event.ttl;                      // The ttl of this lock
    const snapshot = event.snapshot;            // Snapshot payload
});
// Connection State Change
rtm.addEventListener("status", event => {
    const currentState = event.state;                // Which connection state right now
    const changeReason = event.reason;                // Why trigger this event
});
// Token Privilege Will Expire
rtm.addEventListener("TokenPrivilegeWillExpire", (channelName) => {
    const channelName = channelName;            // Which Channel Token Will Expire
});
```

### `login`

#### Description

After creating and initializing a Signaling client instance, you need to perform the `login` operation to login to the Signaling service. With successful login, the client establishes a long link to the Signaling server and allow the client to access Signaling resources.

#### Method

You can call the `login` method in the following way:

```javascript 
rtm.login(): Promise<LoginResponse>;
```

#### Basic Usage

```javascript 
try {
    const result = await rtm.login();
    console.log(result);
} catch (status) {
    console.log(status);
}
```

#### Return Value

If the method call succeeds, `LoginResponse` is returned.

```javascript 
type LoginResponse = {
    timeToken: number  // Reserved property, indicating the timestamp of the successful operation
}
```

If the method call fails, [`ErrorInfo`](#errorinfo) is returned.

### `logout`

#### Description

You can log out of the Signaling system if you don't need to perform any operation.

#### Method

You can call the `logout` method in the following way:

```javascript 
rtm.logout(): Promise<LogoutResponse>;
```

#### Basic Usage

```javascript 
try {
    const result = await rtm.logout();
    console.log(result);
} catch (status) {
    console.log(status);
}
```

#### Return Value

If the method call succeeds, `LogoutResponse` is returned.

```javascript 
type LoginResponse = {
    timeToken: number   // Reserved property, indicating the timestamp of the successful operation
}
```

If the method call fails, [`ErrorInfo`](#errorinfo) is returned.

## Channels

Agora Signaling provides a highly efficient channel management mechanism for data transmission. Any user who subscribes or joins a channel can receive messages and events transmitted within 100 milliseconds. Signaling allows clients to subscribe to hundreds or even thousands of channels. Most Signaling APIs perform actions such as sending, receiving, and encrypting based on channels.

Based on capabilities of Agora, Signaling channels are divided into two types to match different application scenarios:

- **Message Channel**: Follows the industry-standard Pub/Sub (publish/subscribe) mode. You can send and receive messages within the channel by subscribing to a channel, and do not need to create the channel in advance. There is no limit to the number of publishers and subscribers in a channel.

- **Stream Channel**: Follows a concept similar to the observer pattern in the industry, where users need to create and join a channel before sending and receiving messages. You can create different topics in a channel. Each channel can contain up to 1,000 users.

### `subscribe`

#### Description

Signaling provides event notification capabilities for messages, states, and events. By setting up event listeners, you can receive messages and events within subscribed channels. For information on how to add and set up event listeners, see [Event Listeners](#event-listeners).

By calling the `subscribe` method, the client can subscribe to a message channel and start receiving messages and event notifications within the channel. After successfully calling this method, users who subscribe to the channel and enable the presence event listener can receive a `presence` event with the `REMOTE_JOIN` type.

<Admonition type="info" title="Information">This method only applies to the message channel.</Admonition>

#### Method

You can call the `subscribe` method in the following way:

```javascript 
rtm.subscribe(
    channelName: string,
    options?: object
): Promise<SubscribeResponse>;
```

|   Parameter   |  Type  | Required | Default |       Description        |
| :-----------: | :----: | :------: | :-----: | :----------------------: |
| `channelName` | string |   Yes    |    -    |   The channel name.   |
|   `options`   | object | Optional |    -    | Options for subscribing a channel. |

The `options` object includes the following properties:

|    Property    |  Type   | Required | Default |                         Description                          |
| :------------: | :-----: | :------: | :-----: | :----------------------------------------------------------: |
| `withMessage`  | boolean | Optional | `true`  | Whether to subscribe to message event notifications in the channel. |
| `withPresence` | boolean | Optional | `true`  | Whether to subscribe to presence event notifications in the channel. |
| `withMetadata` | boolean | Optional | `false` | Whether to subscribe to storage event notifications in the channel. |
| `withLock`     | boolean | Optional | `false` | Whether to subscribe to lock event notifications in the channel. |

#### Basic usage

```javascript 
const options = {
    withMessage : true,
    withPresence : true,
    withMetadata : false,
    withLock : false
};
try {
    const result = await rtm.subscribe("chat_room", options);
    console.log(result);
} catch (status) {
    console.log(status);
}
```

#### Return value

If the method call succeeds, `SubscribeResponse` is returned.

```javascript 
type SubscribeResponse = {
    timeToken : number               // Reserved property, indicating the timestamp of the successful operation.
    channelName : string             // Channel name.
}
```

If the method call fails, [`ErrorInfo`](#errorinfo) is returned.


### `unsubscribe`

#### Description

If you no longer need to subscribe to a channel, you can call the `unsubscribe` method to cancel your subscription. After successfully unsubscribing from the channel, other users who subscribe to the channel and enable event listeners can receive a `presence` event notification with the `REMOTE_LEAVE` type. For details, see Event Listeners(#event-listeners).

<Admonition type="info" title="Information">This method only applies to the message channel.</Admonition>

#### Method

You can call the `unsubscribe` method in the following way:

```javascript 
rtm.unsubscribe(
    channelName: string
): Promise<UnsubscribeResponse>;
```

|   Parameter   |  Type  | Required | Default |       Description        |
| :-----------: | :----: | :------: | :-----: | :----------------------: |
| `channelName` | string |   Yes    |    -    |   The channel name.   |

#### Basic usage

```javascript 
try {
    const result = await rtm.unsubscribe("chat_room");
    console.log(result);
} catch (status) {
    console.log(status);
}
```

#### Return value

If the method call succeeds, `UnsubscribeResponse` is returned.

```javascript 
type UnsubscribeResponse = {
    timeToken : number       // Reserved property, indicating the timestamp of the successful operation.
    channelName : string     // Channel name.
}
```

If the method call fails, [`ErrorInfo`](#errorinfo) is returned.


### `createStreamChannel`

#### Description

Before using a stream channel, you need to call the `createStreamChannel` method to create an `RTMStreamChannel` instance. After successfully creating the instance, you can call its relevant methods to implement functions, such as joining the channel, leaving the channel, sending messages in a topic, and subscribing to messages in a topic.

<Admonition type="info" title="Information">This method only applies to the stream channel.</Admonition>

#### Method

You can call the `createStreamChannel` method in the following way:

```javascript 
rtm.createStreamChannel(chanelName: string): RTMStreamChannel;
```

|   Parameter   |  Type  | Required | Default |       Description        |
| :-----------: | :----: | :------: | :-----: | :----------------------: |
| `channelName` | string |   Yes    |    -    |   The channel name.   |


#### Basic usage

```javascript 
try {
    const Loc_stChannel = await rtm.createStreamChannel( "Location");
    console.log("Create Stream Channel success!: ");
} catch (status) {
    console.log(status);
}
```

#### Return value

An `RTMStreamChannel` instance.


### `join`

#### Description

After successfully creating a stream channel, you can call the `join` method to join the stream channel. Once you join the channel, you can implement channel-related functions. At this point, users who subscribe to the channel and add event listeners can receive the following event notifications:

- Local users:
  - `presence` event notification with the `SNAPSHOT` type.
  - `topic` event notification with the `SNAPSHOT` type.
- Remote users: `presence` event notification with the `REMOTE_JOIN` type.

<Admonition type="info" title="Information">This method only applies to the stream channel.</Admonition>

#### Method

You can call the `join` method in the following way:

```javascript 
join(options?: {
    token?: string;
    withPresence?: boolean;
    withMetadata?: boolean;
    withLock?: boolean;
}): Promise<JoinChannelResponse>;
```

|   Parameter   |  Type  | Required | Default |       Description        |
| :-----------: | :----: | :------: | :-----: | :----------------------: |
|   `options`   | object | Optional |    -    | Options for joining a channel. |

The `options` object includes the following properties:

|    Property    |  Type   | Required | Default |                         Description                          |
| :------------: | :-----: | :------: | :-----: | :----------------------------------------------------------: |
|    `token`     | string  |   Optional   |   -    | The token used for joining a stream channel, which is currently the same as the RTC token. |
| `withMetadata` | boolean | Optional | `false` | Whether to subscribe to storage event notifications in the channel. |
| `withPresence` | boolean | Optional | `true`  | Whether to subscribe to presence event notifications in the channel. |
| `withLock`     | boolean | Optional | `false` | Whether to subscribe to lock event notifications in the channel. |

<Admonition type="Note" title="Note">The `token` parameter is a required parameter when using an appID with an app certificate. If you're not using an app certificate, `token` can be ommitted when calling this method. </Admonition>

#### Basic usage

```javascript 
const options = {
    token : "yourToken",
    withPresence : true,
    withMetadata : false,
    withLock : false
};
try {
    const result = await stChannel.join(options);
    console.log(result);
} catch (status) {
    console.log(status);
}
```

#### Return value

If the method call succeeds, `JoinChannelResponse` is returned.

```javascript 
type JoinChannelResponse = {
    timeToken : number ,              // Reserved property, indicating the timestamp of the successful operation.
    channelName : string             // Channel name.
}
```

If the method call fails, [`ErrorInfo`](#errorinfo) is returned.


### `leave`

#### Description

If you no longer need to stay in a channel, you can call the `leave` method to leave the channel. After leaving the channel, you can no longer receive any messages, states, or event notifications from this channel. At the same time, you can no longer be the topic publisher or subscriber of all topics. If you want to restore your previous publisher role and subscribing relationship, you need to call `join`, `joinTopic` and `subscribeTopic` methods in this order.

After successfully leaving the channel, remote users in the channel can receive a `presence` event notification with the `REMOTE_LEAVE` type. For details, see [Event Listener](#event-listeners).

<Admonition type="info" title="Information">This method only applies to the stream channel.</Admonition>

#### Method

You can call the `leave` method in the following way:

```javascript 
leave(): Promise<LeaveChannelResponse>;
```

#### Basic usage

```javascript 
try {
    const result = await rtm.leave();
    console.log(result);
} catch (status) {
    console.log(status);
}
```

#### Return value

If the method call succeeds, `LeaveChannelResponse` is returned.

```javascript 
type LeaveChannelResponse = {
    timeToken : number       // Reserved property, indicating the timestamp of the successful operation.
    channelName : string     // Channel name.
}
```
If the method call fails, [`ErrorInfo`](#errorinfo) is returned.


## Topics

Topic is a data stream management mechanism in stream channels. Users can use topics to subscribe to and distribute data streams, as well as notify events in data streams in stream channels.

<Admonition type="info" title="Information">Topics only exist in stream channels. Therefore, before using relevant features, users need to create an `RTMStreamChannel` instance.</Admonition>

### `joinTopic`

#### Description

The purpose of joining a topic is to register as one of the message publishers for the topic, so that the user can send messages in the topic. This operation does not affect whether or not the user becomes a subscriber to the topic.

Currently, Signaling supports a single client joining up to 8 topics in the same stream channel at a time.

<Admonition type="info" title="Information">Before joining a topic, a user need to create an `RTMStreamChannel` instance and call the `join` method to join the stream channel. For details, see <a href= {`/doc/rtm2/${frontMatter.ag_platform}/user-guide/channel/channel-basic`}>Channels</a>.</Admonition>

After successfully joining a topic, users who subscribe to that topic and add event listeners can receive the `topic` event notification with the `REMOTE_JOIN` type. For details, see [Event Listeners](#event-listeners).

#### Method

You can call the `joinTopic` method in the following way:

```javascript 
joinTopic(
    topicName: string,
    options?: { meta?: any }
): Promise<JoinTopicResponse>;
```

|   Parameter   |  Type  | Required | Default |       Description        |
| :-----------: | :----: | :------: | :-----: | :----------------------: |
| `topicName` | string |   Yes    |    -    |   The topic name.   |
|   `options`   | object | Optional |    -    | The reserved property. |

#### Basic usage

```javascript 
try {
    const result = await stChannel.joinTopic( "gesture", options);
    console.log( result);
} catch (status) {
     console.log(status);
}
```

#### Return value

If the method call succeeds, `JoinTopicResponse` is returned.

```javascript 
type JoinTopicResponse = {
    timeToken: number ,  // Reserved property, indicating the timestamp of the successful operation.
    topicName: string    // Topic name.
}
```

If the method call fails, [`ErrorInfo`](#errorinfo) is returned.


### `publishTopicMessage`

#### Description

Call the `publishTopicMessage` method to send messages to a topic. Users who subscribe to this topic and the message publisher in the channel can receive the message within 100 ms. Before calling the `publishTopicMessage` method, users need to join the stream channel, and then register as a message publisher for that topic by calling the `joinTopic` method.

The messages sent by users are encrypted with TLS during transmission, and data link encryption is enabled by default and cannot be disabled. To achieve a higher level of data security, users can also enable client encryption during initialization. For details, see [Setup](#setup).

#### Method

You can call the `publishTopicMessage` method in the following way:

```javascript 
publishTopicMessage(
    topicName: string,
    message: string | Uint8Array,
    options?: {customType?: string;}
): Promise<PublishTopicMessageResponse>;
```

|   Parameter   |       Type        | Required | Default | Description                                                  |
| :-----------: | :---------------: | :------: | :-----: | :----------------------------------------------------------- |
| `topicName` |      string       | Required |    -    | The topic name. |
|   `message`   | string \| Uint8Array | Required |    -    | The message payload. Supports string or Uint8Array type. |
|   `options`   |      object       | Optional |    -    | The message options.                                         |

The `options` object includes the following property:

|  Property   |  Type  | Required | Default | Description                                      |
| :----------: | :----: | :------: | :-----: | :----------------------------------------------- |
| `customType` | string | Optional |    -    | A user-defined field. Only supports string type. |

#### Basic usage

* Example 1: Send string messages to a specified channel.

    ```javascript 
    try {
        const result = await stChannel.publishTopicMessage( "Gesture", JSON.stringify({such: 'object'}) );
        console.log(result);
    } catch (status) {
        console.log(status);
    }
    ```

* Example 2: Send Uint8Array messages to a specified channel.

    ```javascript 
    const str2ab = function(str) {
    var buf = new ArrayBuffer(str.length * 2); // Each character occupies 2 bytes.
    var bufView = new Uint16Array(buf);
    for (var i = 0, strLen = str.length; i < strLen; i++) {
        bufView[i] = str.charCodeAt(i);
    }
    return buf;
    }
    var Message=str2ab('hello world')
    try {
        const result = await stChannel.publishTopicMessage( "Gesture",Message);
        console.log(result);
    } catch (status) {
        console.log(status);
    }
    ```

#### Return value

If the method call succeeds, `PublishTopicMessageResponse` is returned.

```javascript 
type PublishTopicMessageResponse = {
    timeToken: number ,              // Reserved property, indicating the timestamp of the successful operation.
    topicName: string                // Topic name.
}
```

If the method call fails, [`ErrorInfo`](#errorinfo) is returned.


### `leaveTopic`

#### Description

To release resources when you no longer need to publish messages to a topic, you can call the `leaveTopic` method to unregister as a message publisher for that topic. This method does not affect whether or not you subscribe to that topic or any other operations performed by other users on that topic.

After successfully calling this method, users who subscribe to the channel and enable event listeners can receive the `topic` event notification with the `REMOTE_LEAVE` type. For details, see [Event Listeners](#event-listeners).

#### Method

You can call the `leaveTopic` method in the following way:

```javascript 
leaveTopic(topicName: string): Promise<LeaveTopicResponse>;
```

|   Parameter   |       Type        | Required | Default | Description                                                  |
| :-----------: | :---------------: | :------: | :-----: | :----------------------------------------------------------- |
| `topicName` |      string       | Required |    -    | The topic name. |

#### Basic usage

```javascript 
try {
    const result = await stChannel.leaveTopic("gesture");
    console.log(result);
} catch (status) {
     console.log(status);
}
```

#### Return value

If the method call succeeds, `LeaveTopicResponse` is returned.

```javascript 
type LeaveTopicResponse = {
    timeToken: number ,              // Reserved property, indicating the timestamp of the successful operation.
    topicName: string                // Topic name.
}
```

If the method call fails, [`ErrorInfo`](#errorinfo) is returned.


### `subscribeTopic`

#### Description

After joining a channel, you can call the `subscribeTopic` method to subscribe to message publishers of topics in the channel.

`subscribeTopic` is an incremental method. For example, if you call this method for the first time with a subscribing list of `[UserA, UserB]`, and then call it again with a subscribing list of `[UserB, UserC]`, the final successful subscribing result is `[UserA, UserB, UserC]`.

There is no limit to the number of message publishers that can be registered for a single topic in a channel, but a user can only subscribe to a maximum of 50 topics at the same time in the same channel, and a maximum of 64 message publishers in each topic. 

#### Method

You can call the `subscribeTopic` method in the following way:

```javascript 
subscribeTopic(
    topicName: string,
    options?: {
        users?: string[];
    }
): Promise<SubscribeTopicResponse>;
```

|   Parameter   |       Type        | Required | Default | Description                                                  |
| :-----------: | :---------------: | :------: | :-----: | :----------------------------------------------------------- |
| `topicName` |      string       | Required |    -    | The topic name. |
|   `options`   |      object       | Optional |    -    | The subscribing options.                                         |

The `options` object includes the following property:

|  Property   |  Type  | Required | Default | Description                                      |
| :----------: | :----: | :------: | :-----: | :----------------------------------------------- |
| `users` | string[] | Optional |    -    | A list of user IDs of message publishers that you want to subscribe to. If you do not set this property, you can randomly subscribe to up to 64 users by default. |

#### Basic usage

* Example 1: Subscribe to a specified message publisher in a topic.

    ```javascript 
    var UIDs = ["zhangsan","lisi","wangwu"]
    try {
        const result = await rtm.subscribeTopic( "Gesture", { users:UIDs } );
        console.log(result);
    } catch (status) {
        console.log( status);
    }
    ```

* Example 2: Randomly subscribe to 64 message publisher in a topic.

    ```javascript 
    try {
        const result = await stChannel.subscribeTopic("Gesture");
        console.log(result);
    } catch (status) {
        console.log(status);
    }
    ```

#### Return value

If the method call succeeds, `SubscribeTopicResponse` is returned.
```javascript 
type SubscribeTopicResponse = {
    succeedUsers : string[] ,       // A list of users who successfully subscribe to the topic.
    failedUsers : string[],         // A list of users who fail to subscribe to the topic.
    failedDetails : [               // A list of reasons for subscription failure.
        {
            user : string ,         // User ID.
            errorCode : number ,    // Error code.
            reason : string         // Reason for the error.
        },
    ],
    timeToken : number,             // Reserved property, indicating the timestamp of the successful operation.
    topicName : string             // Topic name.
}
```

If the method call fails, [`ErrorInfo`](#errorinfo) is returned.


### `unsubscribeTopic`

#### Description

If you are no longer interested in a topic or no longer need to subscribe to one or more message publishers in the topic, you can call the `unsubscribeTopic` method to unsubscribe from the topic or unsubscribe from specific message publishers in the topic.

#### Method

You can call the `unsubscribeTopic` method in the following way:


```javascript 
unsubscribeTopic(
    topicName: string,
    options?: { users?: string[] }
): Promise<UnsubscribeTopicResponse>;
```

|   Parameter   |       Type        | Required | Default | Description                                                  |
| :-----------: | :---------------: | :------: | :-----: | :----------------------------------------------------------- |
| `topicName` |      string       | Required |    -    | The topic name. |
|   `options`   |      object       | Optional |    -    | The unsubscribing options.                                         |

The `options` object includes the following property:

|  Property   |  Type  | Required | Default | Description                                      |
| :----------: | :----: | :------: | :-----: | :----------------------------------------------- |
| `users` | string[] | Optional |    -    | A list of user IDs of message publishers that you want to unsubscribe from. If you do not set this property, you can unsubscribe from the entire topic. |

#### Basic usage

* Example 1: Unsubscribe from a specified message publisher in a topic.

    ```javascript 
    try {
        const result = await rtm.unsubscribeTopic( "Gesture", { users:["Tony","Bo"] });
        console.log("unsubscribe Topic success: ", result);
    } catch (status) {
        console.log("unsubscribe Topic failed: ", result);
    }
    ```

* Example 2: Randomly unsubscribe from 64 message publisher in a topic.

    ```javascript
    try {
        const result = await rtm.unsubscribeTopic("Gesture");
        console.log("unsubscribe topic success: ", result);
    } catch (status) {
        console.log("unsubscribe topic failed: ", result);
    }
    ```

#### Return value

If the method call succeeds, `UnsubscribeTopicResponse` is returned.

```javascript 
type UnsubscribeTopicResponse = {
    timeToken: number ,              // Reserved property, indicating the timestamp of the successful operation.
}
```

If the method call fails, [`ErrorInfo`](#errorinfo) is returned.


## Messages

Sending and receiving messages is the most basic function of the Signaling service. Any message sent by the Signaling server can be delivered to any online subscribing user within 100 ms. Depending on your business requirements, you can send messages to one user only or broadcast messages to multiple users.

Signaling offers two types of channels: message channels and stream channels. These channel types have the following differences in how messages are transmitted and methods are called:

- **Message Channel**: The real-time channel. Messages are transmitted through the channel, and the channel is highly scalable. Local users can call the `publish` method to send messages in the channel, and remote users can call the `subscribe` method to subscribe to the channel and receive messages.
- **Stream Channel**: The streaming transmission channel. Messages are transmitted through the topic. Users need to join a channel first, and then join a topic. Local users can call the `publish` method to send messages in the topic, and remote users can call the `subscribe` method to subscribe to the topic and receive messages.

This page introduces how to send and receive messages in a Message Channel.

### `publish`

#### Description

You can directly call the `publish` method to send messages to all online users who subscribe to the channel. Even if you do not subscribe to the channel, you can still send messages in the channel.

<Admonition type="info" title="Information">The following practices can effectively improve the reliability of message transmission:<ul><li>The message payload should be within 32 KB; otherwise, the sending will fail.</li><li>The upper limit of the rate at which messages are sent to a single channel is 30 QPS. If the sending rate exceeds the limit, some messages will be discarded. A lower rate is better, as long as the requirements are met.</li><li>Signaling does not guarantee that the order in which all subscribers receive messages is the same as the order in which the sender sends messages. If you want to ensure that messages are strictly ordered, Agora suggests that you customize the message sequence number in the message payload.</li></ul></Admonition>

After successfully calling this method, the SDK triggers a `message` event notification. Users who subscribe to the channel and enabled the event listener can receive this event notification. For details, see [Event Listeners](#event-listeners).

#### Method

You can call the `publish` method in the following way:

```javascript
rtm.publish(
    channelName: string,
    message: string | Uint8Array,
    options?: {customType?: string;}
): Promise<PublishResponse>;
```

|   Parameter   |       Type        | Required | Default | Description                                                  |
| :-----------: | :---------------: | :------: | :-----: | :----------------------------------------------------------- |
|   `message`   | string \| Uint8Array | Required |    -    | The message payload. Supports string or Uint8Array type. |
| `channelName` |      string       | Required |    -    | The channel name. You can only send messages to one channel at a time. |
|   `options`   |      object       | Optional |    -    | The message options.                                         |

The `options` object includes the following property:

|  Property   |  Type  | Required | Default | Description                                      |
| :----------: | :----: | :------: | :-----: | :----------------------------------------------- |
| `customType` | string | Optional |    -    | A user-defined field. Only supports string type. |

#### Basic usage

* Example 1: Send string messages to a specified channel.

    ```javascript 
    try {
        const result = await rtm.publish( 'my_channel', "Hello world" );
        console.log(result);
    } catch (status) {
        console.log(status);
    }
    ```

* Example 2: Send Uint8Array messages to a specified channel.

    ```javascript 
    const str2ab = function(str) {
        var buf = new ArrayBuffer(str.length * 2); // Each character occupies 2 bytes.
        var bufView = new Uint16Array(buf);
        for (var i = 0, strLen = str.length; i < strLen; i++) {
            bufView[i] = str.charCodeAt(i);
        }
        return buf;
    };
    var Message=str2ab('hello world');
    try {
        const result = await rtm.publish('my_channel', Message );
        console.log(result);
    } catch (status) {
        console.log(status);
    }
    ```

<Admonition type="info" title="Information">After successfully calling this method, the SDK triggers a `message` event notification. Users who subscribe to the channel and enable event listener can receive this event notification. For details, see [Event Listeners](#event-listeners).</Admonition>

#### Return value

If the method call succeeds, `PublishResponse` is returned.
```javascript 
type PublishResponse = {
    timeToken: number ,  // Reserved property, indicating the timestamp of the successful operation.
    chanelName : string  // Channel name.
}
```

If the method call fails, [`ErrorInfo`](#errorinfo) is returned.

### Receive

Signaling provides event notifications for messages, states, and event changes. By setting event listeners, you can receive messages and events in subscribed channels.

For information on how to add and set event listeners, see [Event Listeners](#event-listeners).


## Presence

The presence feature provides the ability to monitor user online, offline, and user historical status change. With presence, you can obtain the following information in real-time:

- User joins or leaves the specified channel
- Which users join the specified channel and their temporary user state
- Which channels the specified user has joined or subscribed to
- Custom temporary user status

<Admonition type="info" title="Information">Presence applies to both message channels and stream channels.</Admonition>


### `getOnlineUsers`

#### Description

Call the `getOnlineUsers` method to query user information in real-time such as the number of online users, the list of online users and their temporary user status in the specified channel.

#### Method

You can call the `getOnlineUsers` method in the following way:

```javascript 
rtm.presence.getOnlineUsers(
    channelName: string,
    channelType: string,
    options?: object
): Promise<GetOnlineUsersResponse>;
```


|     Parameter      |  Type  | Required | Default | Description                             |
| :-----------: | :----: | :------: | :----: | :-------------------------------- |
| `channelName` | string |   Required   |   -    | Channel name.                        |
| `channelType` | string |   Required   |   -    | Channel type. For details, see [Channel Types](channel-types). |
|   `options`   | object |   Optional   |   -    | Query options.                    |

`options` contains the following properties:

|       Property       |  Type   | Required | Default  | Description                                                                                 |
| :--------------: | :-----: | :------: | :-----: | ------------------------------------------------------------------------------------- |
| `includedUserId` | boolean |   Optional   | `true`  | Whether the returned result contains the user ID of online users.                                                |
| `includedState`  | boolean |   Optional   | `false` | Whether the returned result contains the temporary user state of online users.                                            |
|      `page`      | string  |   Optional   |    -    | Page number of the returned result. If you do not provide this property, the SDK returns the first page by default. You can check whether there is next page in the `nextPage` property of the returned result. |

#### Basic usage

```javascript 
const options = {
    includeUserId : true ,
    includeState : true,
    page : "yourBookMark"
}
try {
    const result = await rtm.presence.getOnlineUsers( "chat_room", 'MESSAGE', options );
    console.log(result);
} catch (status) {
    console.log(status);
}
```

#### Return Value

If the method call succeeds, a `GetOnlineUsersResponse` is returned.
```javascript 
type GetOnlineUsersResponse = {
    timeToken: number ,  // Reserved property, indicating the timestamp of the successful operation.
    totalOccupancy : number , // Number of the online users in the channel.
    occupants : Array<object> , // List of the online users in the channel and their temporary user state.
    nextPage : string   // Page number of the next page.
}
```

If the method call fails, [`ErrorInfo`](#errorinfo) is returned.


### `getUserChannels`

#### Description

In scenarios such as statistic analytics and debugging, you may need to know all the channels that a specified user has subscribed to or joined. Call the `getUserChannels` method to get the list of channels where the specified user is in real-time.

#### Method

You can call the `getUserChannels` method in the following way:

```javascript 
rtm.presence.getUserChannels(userId: string): Promise<GetUserChannelsResponse>;
```

|   Parameter   |  Type  | Required |       Default        | Description     |
| :------: | :----: | :------: | :-----------------: | :-------- |
| `userId` | string |   Required   | - | User ID. |

#### Basic usage

```javascript 
try {
    const result = await rtm.presence.getUserChannels( "Tony" );
    console.log(result);
} catch (status) {
    console.log(status);
}
```

#### Return value

If the method call succeeds, a `GetUserChannelsResponse` is returned.
```javascript 
type GetUserChannelsResponse = {
    timeToken: number ,              // Reserved property, indicating the timestamp of the successful operation.
    totalChannel : number ,          // Number of the channels that the user has joined or subscribed to.
    channels : Array<object>         // List of the channels including channel name and channel type.
}
```

If the method call fails, [`ErrorInfo`](#errorinfo) is returned.

### `setState`

#### Description

To meet different requirements in different business scenarios for setting user states, Signaling provides the `setState` method to customize the temporary user state. Users can add custom statuses such as scores, game status, location, mood, and hosting status for themselves.

The `setState` method sets temporary user state. It means these user states remains in the channel as long as the user stays subscribed to the channel and stays online, and they disappear when the user leaves the channel or disconnects from Signaling. If you need to restore user states when rejoining a channel or reconnecting, you need to cache the data locally in real-time. If you want to permanently save user states, Agora recommends you use the `setUserMetadata` method of the storage function instead.

If a user modifies the temporary user status, Signaling triggers the `presence` event notification of the `REMOTE_STATE_CHANGED` type in real-time. You can receive the event by subscribing to the channel and configuring the corresponding property.

#### Method

Set the temporary user state in the following way:

```javascript 
rtm.presence.setState(
    channelName: string,
    channelType: string,
    state: object
): Promise<SetStateResponse>;
```

|     Parameter      |  Type  | Required | Default | Description                                                                                                                                        |
| :-----------: | :----: | :------: | :----: | :------------------------------------------------------------------------------------------------------------------------------------------- |
| `channelName` | string |   Required   |   -    | Channel name.  |
| `channelType` | string |   Required   |   -    | Channel type. For details, see [Channel Types](#channel-types). |
|    `state`    | object |   Required   |   -    | A JSON object that consists of key-value pairs. The key must be string type.   |

#### Basic usage

```javascript 
var newState = { "mood":"pumped", "isTyping":false};

try {
    const result = await rtm.Presence.setState("chat_room", "MESSAGE", newState);
    console.log(result);
} catch (status) {
    console.log(status);
}
```

#### Return value

If the method call succeeds, a `SetStateResponse` is returned.
```javascript 
type SetStateResponse = {
    timeToken: number ,  // Reserved property, indicating the timestamp of the successful operation.
}
```

If the method call fails, [`ErrorInfo`](#errorinfo) is returned.


### `getState`

#### Description

To get the temporary user state of a specified user in the channel, you can use the `getState` method.

#### Method

Get the temporary user state in the following way:

```javascript 
rtm.presence.getState(
    userId: string,
    channelName: string,
    channelType: string,
): Promise<GetStateResponse>;
```

|     Parameter      |  Type  | Required | Default | Description                                                                                                                                       |
| :-----------: | :----: | :------: | :----: | :------------------------------------------------------------------------------------------------------------------------------------------ |
|   `userId`    | string |   Required   |   -    | User ID.                                                                                                                                   |
| `channelName` | string |   Required   |   -    | Channel name.                                                                                                                                  |
| `channelType` | string |   Required   |   -    | Channel type. For details, see [Channel Types](channel-types). |

#### Basic usage

```javascript 
try {
    const result = await rtm.presence.getState("Tony", "chat_room", "MESSAGE" );
    const.log(result);
} catch (status) {
    console.log(status);
}
```

#### Return value

If the method call succeeds, `GetStateResponse` is returned.

```javascript 
type GetStateResponse = {
    timeToken: number ,  // Reserved property, indicating the timestamp of the successful operation.
    userId : string ,    // User ID.
    states : object ,    // Key-value pairs of the user states.
    statesCount : number // Numbers of the user states.
}
```
If the method call fails, [`ErrorInfo`](#errorinfo) is returned.


### `removeState`

#### Description

When a temporary user state is no longer needed, you can call the `removeState` method to remove it. When the user state is removed, the user who has subscribed to the channel and enabled the presence event monitoring receives the `presence` notification in the `REMOTE_STATE_CHANGED` type. For details, see [Event Listeners](#event-listeners).

#### Method

You can call the `removeState` method in the following way:

```javascript 
rtm.presence.removeState(
    channelName: string,
    channelType: string,
    options?: {
        states?: string[];
    }
): Promise<RemoveStateResponse>;
```

|     Parameter      |  Type  | Required | Default | Description                                                                                                                                       |
| :-----------: | :----: | :------: | :----: | :------------------------------------------------------------------------------------------------------------------------------------------ |
| `channelName` | string |   Required   |   -    | Channel name. |
| `channelType` | string |   Required   |   -    | Channel type. For details, see [Channel Types](channel-types). |
|   `options`   | object |   Optional   |   -    | The list of keys of the user states that you want to remove. If you do not provide this parameter, all the user states are removed.  |

#### Basic usage

```javascript 
const options = {
    states:["mode","Typing"]
}
try {
    const result = await rtm.Presence.removeState("chat_room", "MESSAGE" , options);
    console.log(result);
} catch (status) {
    console.log(status);
}
```

#### Return value

If the method call succeeds, `RemoveStateResponse` is returned.
```javascript 
type RemoveStateResponse = {
    timeToken: number ,              // Reserved property, indicating the timestamp of the successful operation.
}
```

If the method call fails, [`ErrorInfo`](#errorinfo) is returned.

## Storage

The storage feature provides a dynamic database mechanism that allows developers to dynamically set, store, update, and delete data such as channel metadata and user metadata.

### `setChannelMetadata`

#### Description

The `setChannelMetadata` method sets metadata for a message channel or stream channel. A channel can only have one set of metadata, but each set of metadata can have one or more metadata items. If you call this method multiple times, the SDK retrieves the `key` of the metadata items in turn and apply settings according to the following rules:

- If you set metadata with different `key`, the SDK adds each set of metadata in sequence according to the order of the method calls.
- If you set metadata with the same `key`, the `value` of the last setting overwrites the previous one.

After successfully setting channel metadata, users who subscribe to the channel and enable event listeners can receive the `storage` event notification with the `CHANNEL` type. For details, see [Event Listeners](#event-listeners).

Channel metadata also introduces the version control logic CAS (Compare And Set). This method provides two independent version control fields, and you can set one or more of them according to your actual business scenario:

- Enable version number verification for the entire set of channel metadata by setting the `majorRevision` property in the `options` parameter.
- Enable version number verification for a single metadata item by setting the `revision` property in the `data` parameter.

When setting channel metadata or metadata items, you can control whether to enable version number verification by specifying the revision property:

- If the revision property is set to `-1`, no CAS verification is performed for this method call. If the channel metadata or metadata item already exists, the latest value overwrites the previous one. If the channel metadata or metadata item does not exist, the SDK creates it.
- If the revision property is a positive integer, CAS verification is performed for this method call. If the channel metadata or metadata item already exists, the SDK updates the corresponding value after the version number verification succeeds. If the channel metadata or metadata item does not exist, the SDK returns the error code.

#### Method

You can call the `setChannelMetadata` method in the following way:


```javascript 
rtm.storage.setChannelMetadata(
    channelName: string,
    channelType: string,
    data: Array<object>,
    options?: object
): Promise<SetChannelMetadataResponse>;
```

|     Parameter      |  Type  | Required | Default| Description                             |
| :-----------: | :----: | :------: | :----: | :-------------------------------- |
| `channelName` | string |   Required   |   -    | Channel name.                        |
| `channelType` | string |   Required   |   -    | Channel type. For details, see [Channel Types](channel-types).  |
|    `data`     | Array\<object\> |   Required   |   -    | An array of metadata items. A metadata item is a JSON object that includes predefined properties. You cannot set properties other than predefined ones in this object.                        |
|   `options`   | object |   Optional   |   -    | Options for setting metadata.                   |

`data` contains the following properties:

|  Property  |  Type  | Required |      Default      | Description                                                  |
| :--------: | :----: | :------: | :---------------: | :----------------------------------------------------------- |
|   `key`    | string | Required |         -         | The `key` of the metadata item.                              |
|  `value`   | string | Optional | Empty string `''` | The `value` of the metadata item.                            |
| `revision` | number | Optional |       `-1`        | <li>Returns the real version number in read operations.</li><li>Serves as a version control switch in write operations:</li><ul><li>`-1`: Disable the version verification.</li><li>> `0`: Enable the version verification. Only operations that match the target version number can be performed.</li></ul> |

`options` contains the following properties:

|    Property     |  Type   | Required |      Default      | Description                                                  |
| :-------------: | :-----: | :------: | :---------------: | :----------------------------------------------------------- |
| `majorRevision` | number  | Optional |       `-1`        | A version control switch:<li>`-1`: Disable the version verification.</li><li>> `0`: Enable the version verification. Only operations that match the target version number can be performed.</li> |
|   `lockName`    | string  | Optional | Empty string `''` | The name of the lock. If set, only users who call the `acquireLock` method to acquire the lock can perform operations. |
| `addTimeStamp`  | boolean | Optional |      `false`      | Whether to record the timestamp of the edit.                 |
|   `addUserId`   | boolean | Optional |      `false`      | Whether to record the ID of the editor.                      |

#### Basic usage


```javascript 
const data = [
    {
        key : "Apple",
        value : "100"
        revision : 174298270
    },
    {
        key : "Banana",
        value : "200",
        revision : 174298270
    }
];
const options = {
    majorRevision : 174298270,
    addTimeStamp : true，
    addUserId : true
};
try {
    const result = await rtm.storage.setChannelMetadata( "Chatroom", "MESSAGE", data, options );
    console.log(result);
} catch (status) {
    console.log(status);
}
```

#### Return value

If the method call succeeds, `SetChannelMetadataResponse` is returned.

```javascript 
type SetChannelMetadataResponse = {
    timeToken: number ,              // Reserved property, indicating the timestamp of the successful operation.
    channelName : string ,           // Channel name.
    channelType : string ,           // Channel type.
    totalCount : number              // Number of metadata items.
}
```

If the method call fails, [`ErrorInfo`](#errorinfo) is returned.



### `getChannelMetadata`

#### Description

The `getChannelMetadata` method gets the Metadata of the specified channel.

#### Method

You can call the `getChannelMetadata` method in the following way:

```javascript 
rtm.storage.getChannelMetadata(
    channelName: string,
    channelType: string
): Promise<GetChannelMetadataResponse>;
```

|     Parameter      |  Type  | Required | Default| Description                             |
| :-----------: | :----: | :------: | :----: | :-------------------------------- |
| `channelName` | string |   Required   |   -    | Channel name.                        |
| `channelType` | string |   Required   |   -    | Channel type. For details, see [Channel Types](channel-types).  |

#### Basic usage


```javascript 
try {
    const result = await rtm.storage.getChannelMetadata("Chatroom", "MESSAGE");
    console.log(result);
} catch (status) {
    console.log(status);
}
```

#### Return value

If the method call succeeds, `GetChannelMetadataResponse` is returned.

```javascript 
type GetChannelMetadataResponse = {
    timeToken: number ,                 // Reserved property, indicating the timestamp of the successful operation.
    channelName : string ,              // Channel name.
    channelType : string ,              // Channel type.
    totalCount : number ,               // Number of metadata items.
    majorRevision : number ,            // Version of metadata.
    metadata : Record<string, MetaDataDetail>   // JSON object containing metadata item.
}
```

`MetaDataDetail` contains the following properties:

```javascript 
type MetaDataDetail = {
    value: string ,             // Value of a metadata item.
    revision : number ,         // Version of a metadata item.
    updated : string ,          // Timestamp of the last update.
    authorUid : string ,        // User ID of the last editor.
}
```

If the method call fails, [`ErrorInfo`](#errorinfo) is returned.


### `removeChannelMetadata`

#### Description

Call the `removeChannelMetadata` method to remove channel metadata or metadata items.

When removing channel metadata or metadata items, you can control whether to enable version number verification by specifying the revision property:

- If the revision property is set to `-1`, no CAS verification is performed for this method call. If the channel metadata or metadata item already exists, the SDK removes it. If the channel metadata or metadata item does not exist, the SDK returns the error code.
- If the revision property is a positive integer, CAS verification is performed for this method call. If the channel metadata or metadata item already exists, the SDK removes the corresponding value after the version number verification succeeds. If the channel metadata or metadata item does not exist, the SDK returns the error code.

After successfully removing channel metadata or metadata items, users who subscribe to the channel and enable event listeners can receive the `storage` event notification with the `CHANNEL` type. For details, see Event Listeners(#event-listeners)

#### Method

You can call the `removeChannelMetadata` method in the following way:

```javascript 
rtm.storage.removeChannelMetadata(
    channelName: string,
    channelType: string,
    options?: object
): Promise<RemoveChannelMetadataResponse>;
```

|     Parameter      |  Type  | Required | Default| Description                             |
| :-----------: | :----: | :------: | :----: | :-------------------------------- |
| `channelName` | string |   Required   |   -    | Channel name.                        |
| `channelType` | string |   Required   |   -    | Channel type. For details, see [Channel Types](channel-types).  |
|   `options`   | object |   Optional   |   -    | Options for setting metadata.                   |

`options` contains the following properties:

|    Property     |  Type   | Required |      Default      | Description                                                  |
| :-------------: | :-----: | :------: | :---------------: | :----------------------------------------------------------- |
|    `data`     | Array\<object\> |   Required   |   -    | An array of metadata items. A metadata item is a JSON object that includes predefined properties. You cannot set properties other than predefined ones in this object.                        |
| `majorRevision` | number  | Optional |       `-1`        | A version control switch:<li>`-1`: Disable the version verification.</li><li>> `0`: Enable the version verification. Only operations that match the target version number can be performed.</li> |
|   `lockName`    | string  | Optional | Empty string `''` | The name of the lock. If set, only users who call the `acquireLock` method to acquire the lock can perform operations. |
| `addTimeStamp`  | boolean | Optional |      `false`      | Whether to record the timestamp of the edit.                 |
|   `addUserId`   | boolean | Optional |      `false`      | Whether to record the ID of the editor.                      |

`data` contains the following properties:

|  Property  |  Type  | Required |      Default      | Description                                                  |
| :--------: | :----: | :------: | :---------------: | :----------------------------------------------------------- |
|   `key`    | string | Required |         -         | The `key` of the metadata item.                              |
|  `value`   | string | Optional | Empty string `''` | The `value` of the metadata item.                            |
| `revision` | number | Optional |       `-1`        | <li>Returns the real version number in read operations.</li><li>Serves as a version control switch in write operations:</li><ul><li>`-1`: Disable the version verification.</li><li>> `0`: Enable the version verification. Only operations that match the target version number can be performed.</li></ul> |

#### Basic usage


```javascript 
const data = [
    {
        key : "Apple",
        value : "100"
        revision : 174298270
    }
];
const options = {
    data : data,
    majorRevision : 174298270,
    addTimeStamp : true，
    addUserId : true
};
try {
    const result = await rtm.storage.removeChannelMetadata("Chatroom", "MESSAGE", options);
    console.log(result);
} catch (status) {
    console.log(status);
}
```

#### Return value
If the method call succeeds, `RemoveChannelMetadataResponse` is returned.

```javascript 
type RemoveChannelMetadataResponse = {
    timeToken: number ,      // Reserved property, indicating the timestamp of the successful operation.
    channelName : string ,   // Channel name.
    channelType : string ,   // Channel type.
    totalCount : number      // Number of metadata items.
}
```
If the method call fails, [`ErrorInfo`](#errorinfo) is returned.


### `updateChannelMetadata`

#### Description

The `updateChannelMetadata` method can update existing channel metadata. Each time you call this method, you can update one channel metadata or an array of channel metadata items.

After successfully updating, users who subscribe to the channel and enable event listeners can receive the `storage` event notification with the `CHANNEL` type. For details, see [Event Listeners](#event-listeners).

<Admonition type="info" title="Information">You cannot use this method to update metadata items which do not exist.</Admonition>

#### Method

You can call the `updateChannelMetadata` method in the following way:

```javascript 
rtm.storage.updateChannelMetadata(
    channelName: string,
    channelType: string,
    data: Array<object>,
    options?: object
): Promise<UpdateChannelMetadataResponse>;
```

|     Parameter      |  Type  | Required | Default| Description                             |
| :-----------: | :----: | :------: | :----: | :-------------------------------- |
| `channelName` | string |   Required   |   -    | Channel name.                        |
| `channelType` | string |   Required   |   -    | Channel type. For details, see [Channel Types](channel-types).  |
|    `data`     | Array\<object\> |   Required   |   -    | An array of metadata items. A metadata item is a JSON object that includes predefined properties. You cannot set properties other than predefined ones in this object.                        |
|   `options`   | object |   Optional   |   -    | Options for setting metadata.                   |

`data` contains the following properties:

|  Property  |  Type  | Required |      Default      | Description                                                  |
| :--------: | :----: | :------: | :---------------: | :----------------------------------------------------------- |
|   `key`    | string | Required |         -         | The `key` of the metadata item.                              |
|  `value`   | string | Optional | Empty string `''` | The `value` of the metadata item.                            |
| `revision` | number | Optional |       `-1`        | <li>Returns the real version number in read operations.</li><li>Serves as a version control switch in write operations:</li><ul><li>`-1`: Disable the version verification.</li><li>> `0`: Enable the version verification. Only operations that match the target version number can be performed.</li></ul> |

`options` contains the following properties:

|    Property     |  Type   | Required |      Default      | Description                                                  |
| :-------------: | :-----: | :------: | :---------------: | :----------------------------------------------------------- |
| `majorRevision` | number  | Optional |       `-1`        | A version control switch:<li>`-1`: Disable the version verification.</li><li>> `0`: Enable the version verification. Only operations that match the target version number can be performed.</li> |
|   `lockName`    | string  | Optional | Empty string `''` | The name of the lock. If set, only users who call the `acquireLock` method to acquire the lock can perform operations. |
| `addTimeStamp`  | boolean | Optional |      `false`      | Whether to record the timestamp of the edit.                 |
|   `addUserId`   | boolean | Optional |      `false`      | Whether to record the ID of the editor.                      |

#### Basic usage

```javascript 
const data = [
    {
        key : "Apple",
        value : "120"
        revision : 174298270
    },
    {
        key : "Banana",
        value : "220",
        revision : 174298270
    }
];
const options = {
    majorRevision : 174298270,
    addTimeStamp : true，
    addUserId : true
};
try {
    const result = await rtm.storage.updateChannelMetadata("Chatroom", "MESSAGE", data, options);
    console.log(result);
} catch (status) {
    console.log(status);
}
```

#### Return value
If the method call succeeds, `UpdateChannelMetadataResponse` is returned.

```javascript 
type UpdateChannelMetadataResponse = {
    timeToken: number ,              // Reserved property, indicating the timestamp of the successful operation.
    channelName : string ,           // Channel name.
    channelType : string ,           // Channel type.
    totalCount : number              // Number of metadata items.
}
```
If the method call fails, [`ErrorInfo`](#errorinfo) is returned.


### `setUserMetadata`

#### Description

The `setUserMetadata` method sets metadata for a user. A user can only have one set of metadata, but each set of metadata can have one or more metadata items. If you call this method multiple times, the SDK retrieves the `key` of the metadata items in turn and apply settings according to the following rules:

- If you set metadata with different `key`, the SDK adds each set of metadata in sequence according to the order of the method calls.
- If you set metadata with the same `key`, the `value` of the last setting overwrites the previous one.

After successfully setting user metadata, users who subscribe to the user metadata and enable event listeners can receive the `storage` event notification with the `USER` type. For details, see [Event Listener](#event-listeners).

User metadata also introduces the version control logic CAS (Compare And Set). This method provides two independent version control fields, and you can set one or more of them according to your actual business scenario:

- Enable version number verification for the entire set of user metadata by setting the `majorRevision` property in the `options` parameter.
- Enable version number verification for a single metadata item by setting the `revision` property in the `data` parameter.

When setting user metadata or metadata items, you can control whether to enable version number verification by specifying the revision property:

- If the revision property is set to `-1`, no CAS verification is performed for this method call. If the user metadata or metadata item already exists, the latest value overwrites the previous one. If the user metadata or metadata item does not exist, the SDK creates it.
- If the revision property is a positive integer, CAS verification is performed for this method call. If the user metadata or metadata item already exists, the SDK updates the corresponding value after the version number verification succeeds. If the user metadata or metadata item does not exist, the SDK returns the error code.

#### Method

You can call the `setUserMetadata` method in the following way:

```javascript 
rtm.storage.setUserMetadata(
    data: Array<object>,
    options?: object
): Promise<SetUserMetadataResponse>;
```

|     Parameter      |  Type  | Required | Default| Description                             |
| :-----------: | :----: | :------: | :----: | :-------------------------------- |
|    `data`     | Array\<object\> |   Required   |   -    | An array of metadata items. A metadata item is a JSON object that includes predefined properties. You cannot set properties other than predefined ones in this object.                        |
|   `options`   | object |   Optional   |   -    | Options for setting metadata.                   |

`data` contains the following properties:

|  Property  |  Type  | Required |      Default      | Description                                                  |
| :--------: | :----: | :------: | :---------------: | :----------------------------------------------------------- |
|   `key`    | string | Required |         -         | The `key` of the metadata item.                              |
|  `value`   | string | Optional | Empty string `''` | The `value` of the metadata item.                            |
| `revision` | number | Optional |       `-1`        | <li>Returns the real version number in read operations.</li><li>Serves as a version control switch in write operations:</li><ul><li>`-1`: Disable the version verification.</li><li>> `0`: Enable the version verification. Only operations that match the target version number can be performed.</li></ul> |

`options` contains the following properties:

|    Property     |  Type   | Required |      Default      | Description                                                  |
| :-------------: | :-----: | :------: | :---------------: | :----------------------------------------------------------- |
|    `userId`     | string  |   Optional   | The `userId` of the current user. | The user ID.                                                                                                         |
| `majorRevision` | number  | Optional |       `-1`        | A version control switch:<li>`-1`: Disable the version verification.</li><li>> `0`: Enable the version verification. Only operations that match the target version number can be performed.</li> |
|   `lockName`    | string  | Optional | Empty string `''` | The name of the lock. If set, only users who call the `acquireLock` method to acquire the lock can perform operations. |
| `addTimeStamp`  | boolean | Optional |      `false`      | Whether to record the timestamp of the edit.                 |
|   `addUserId`   | boolean | Optional |      `false`      | Whether to record the ID of the editor.                      |

#### Basic usage


```javascript 
const data = [
    {
        key : "Name",
        value : "Tony"
        revision : 174298270
    },
    {
        key : "Mute",
        value : "true",
        revision : 174298270
    }
];
const options = {
    userId : 'Tony',
    majorRevision : 174298270,
    addTimeStamp : true，
    addUserId : true
};
try {
    const result = await rtm.storage.setUserMetadata(data, options);
    console.log(result);
} catch (status) {
    console.log(status);
}
```

#### Return value

If the method call succeeds, `SetUserMetadataResponse` is returned.

```javascript 
type SetUserMetadataResponse = {
    timeToken: number ,      // Reserved property, indicating the timestamp of the successful operation.
    userId : string ,        // User ID.
    totalCount : number      // Number of metadata items.
}
```
If the method call fails, [`ErrorInfo`](#errorinfo) is returned.


### `getUserMetadata`

#### Description

The `getUserMetadata` method gets the Metadata and User Metadata Item of the specified user.

#### Method

You can call the `getUserMetadata` method in the following way:

```javascript 
getUserMetadata(userId?: string): Promise<GetUserMetadataResponse>;
```
|    Parameter     |  Type   | Required |      Default      | Description                                                  |
| :-------------: | :-----: | :------: | :---------------: | :----------------------------------------------------------- |
|    `userId`     | string  |   Optional   | The `userId` of the current user. | The user ID.                                                                                                         |

#### Basic usage

```javascript 
try {
    const result = await rtm.storage.getUserMetadata();
    console.log(result);
} catch (status) {
    console.log(status);
}
```

#### Return value

If the method call succeeds, `GetChannelMetadataResponse` is returned.

```javascript 
type GetChannelMetadataResponse = {
    timeToken: number ,             // Reserved property, indicating the timestamp of the successful operation.
    userId : string ,               // User ID.
    totalCount : number ,           // Number of metadata items.
    majorRevision : number ,        // Version of metadata.
    metadata : Record<string, MetaDataDetail>   // JSON object containing metadata item.
}
```

`MetaDataDetail` contains the following properties:

```javascript 
type MetaDataDetail = {
    value: string ,                // Value of a metadata item.
    revision : number ,            // Version of a metadata item.
    updated : string ,             // Timestamp of the last update.
    authorUid : string ,           // User ID of the last editor.
}
```

If the method call fails, [`ErrorInfo`](#errorinfo) is returned.


### `removeUserMetadata`

#### Description

Call the `removeUserMetadata` method to remove user metadata or metadata items.

After successfully removing user metadata or metadata items, users who subscribe to the user metadata and enable event listeners can receive the `storage` event notification with the `USER` type. For details, see [Event Listeners](#event-listeners).

#### Method

You can call the `removeUserMetadata` method in the following way:


```javascript 
rtm.storage.removeUserMetadata(
    options?: object
): Promise<RemoveUserMetadataResponse>;
```

|     Parameter      |  Type  | Required | Default| Description                             |
| :-----------: | :----: | :------: | :----: | :-------------------------------- |
|   `options`   | object |   Optional   |   -    | Options for setting metadata.                   |

`options` contains the following properties:

|    Property     |  Type   | Required |      Default      | Description                                                  |
| :-------------: | :-----: | :------: | :---------------: | :----------------------------------------------------------- |
|    `userId`     | string  |   Optional   | The `userId` of the current user. | The user ID.                                                                                                         |
|    `data`     | Array\<object\> |   Required   |   -    | An array of metadata items. A metadata item is a JSON object that includes predefined properties. You cannot set properties other than predefined ones in this object.                        |
| `majorRevision` | number  | Optional |       `-1`        | A version control switch:<li>`-1`: Disable the version verification.</li><li>> `0`: Enable the version verification. Only operations that match the target version number can be performed.</li> |
|   `lockName`    | string  | Optional | Empty string `''` | The name of the lock. If set, only users who call the `acquireLock` method to acquire the lock can perform operations. |
| `addTimeStamp`  | boolean | Optional |      `false`      | Whether to record the timestamp of the edit.                 |
|   `addUserId`   | boolean | Optional |      `false`      | Whether to record the ID of the editor.                      |

`data` contains the following properties:

|  Property  |  Type  | Required |      Default      | Description                                                  |
| :--------: | :----: | :------: | :---------------: | :----------------------------------------------------------- |
|   `key`    | string | Required |         -         | The `key` of the metadata item.                              |
|  `value`   | string | Optional | Empty string `''` | The `value` of the metadata item.                            |
| `revision` | number | Optional |       `-1`        | <li>Returns the real version number in read operations.</li><li>Serves as a version control switch in write operations:</li><ul><li>`-1`: Disable the version verification.</li><li>> `0`: Enable the version verification. Only operations that match the target version number can be performed.</li></ul> |

#### Basic usage


```javascript 
const data = [
    {
        key : "Mute",
        value : "true"
        revision : 174298270
    }
];
const options = {
    userId: "tony",
    data : data,
    majorRevision : 174298270,
    addTimeStamp : true，
    addUserId : true
};
try {
    const result = await rtm.storage.removeUserMetadata(options);
    console.log(result);
} catch (status) {
    console.log(status);
}
```

#### Return value
If the method call succeeds, `RemoveUserMetadataResponse` is returned.

```javascript 
type RemoveUserMetadataResponse = {
    timeToken: number ,              // Reserved property, indicating the timestamp of the successful operation.
    userId : string ,                // User ID.
    totalCount : number              // Number of metadata items.
}
```
If the method call fails, [`ErrorInfo`](#errorinfo) is returned.


### `updateUserMetadata`

#### Description

The `updateUserMetadata` method can update existing user metadata. Each time you call this method, you can update one user metadata or an array of user metadata items.

After successfully updating, users who subscribe to the user metadata and enable event listeners can receive the `storage` event notification with the `USER` type. For details, see [Event Listeners](#event-listeners).

<Admonition type="info" title="Information">You cannot use this method to update metadata items which do not exist.</Admonition>

#### Method

You can call the `updateUserMetadata` method in the following way:

```javascript 
rtm.storage.updateUserMetadata(
    data: Array<object>,
    options?: object
): Promise<UpdateUserMetadataResponse>;
```

|     Parameter      |  Type  | Required | Default| Description                             |
| :-----------: | :----: | :------: | :----: | :-------------------------------- |
|    `data`     | Array\<object\> |   Required   |   -    | An array of metadata items. A metadata item is a JSON object that includes predefined properties. You cannot set properties other than predefined ones in this object.                        |
|   `options`   | object |   Optional   |   -    | Options for setting metadata.                   |

`data` contains the following properties:

|  Property  |  Type  | Required |      Default      | Description                                                  |
| :--------: | :----: | :------: | :---------------: | :----------------------------------------------------------- |
|   `key`    | string | Required |         -         | The `key` of the metadata item.                              |
|  `value`   | string | Optional | Empty string `''` | The `value` of the metadata item.                            |
| `revision` | number | Optional |       `-1`        | <li>Returns the real version number in read operations.</li><li>Serves as a version control switch in write operations:</li><ul><li>`-1`: Disable the version verification.</li><li>> `0`: Enable the version verification. Only operations that match the target version number can be performed.</li></ul> |

`options` contains the following properties:

|    Property     |  Type   | Required |      Default      | Description                                                  |
| :-------------: | :-----: | :------: | :---------------: | :----------------------------------------------------------- |
|    `userId`     | string  |   Optional   | The `userId` of the current user. | The user ID.                                                                                                         |
| `majorRevision` | number  | Optional |       `-1`        | A version control switch:<li>`-1`: Disable the version verification.</li><li>> `0`: Enable the version verification. Only operations that match the target version number can be performed.</li> |
|   `lockName`    | string  | Optional | Empty string `''` | The name of the lock. If set, only users who call the `acquireLock` method to acquire the lock can perform operations. |
| `addTimeStamp`  | boolean | Optional |      `false`      | Whether to record the timestamp of the edit.                 |
|   `addUserId`   | boolean | Optional |      `false`      | Whether to record the ID of the editor.                      |

#### Basic usage


```javascript 

const data = [
    {
        key : "Name",
        value : "Tony"
        revision : 174298270
    },
    {
        key : "Mute",
        value : "true",
        revision : 174298270
    }
];
const options = {
    userId : 'Tony',
    majorRevision : 174298270,
    addTimeStamp : true，
    addUserId : true
};
try {
    const result = await rtm.storage.removeUserMetadata(data, options);
    console.log(result);
} catch (status) {
    console.log(status);
}
```

#### Return value

If the method call succeeds, `UpdateUserMetadataResponse` is returned.

```javascript 
type UpdateUserMetadataResponse = {
    timeToken: number ,  // Reserved property, indicating the timestamp of the successful operation.
    userId : string ,    // User ID.
    totalCount : number  // Number of metadata items.
}
```
If the method call fails, [`ErrorInfo`](#errorinfo) is returned.

### `subscribeUserMetadata`

#### Description

The `subscribeUserMetadata` method can subscribe to metadata for a specified user. After successfully subscribing and enabling event listeners, you can receive the `storage` event notification with the `USER` type when the metadata for that user changes. For details, see [Event Listeners](#event-listeners).

#### Method

You can call the `subscribeUserMetadata` method in the following way:

```javascript 
subscribeUserMetadata(userId: string): Promise<SubscribeUserMetaResponse>;
```

|    Parameter     |  Type   | Required |      Default      | Description                                                  |
| :-------------: | :-----: | :------: | :---------------: | :----------------------------------------------------------- |
|    `userId`     | string  |   Optional   | The `userId` of the current user. | The user ID.                                                                                                         |

#### Basic usage


```javascript 
try {
    const result = await rtm.storage.subscribeUserMetadata("Tony");
    console.log(result);
} catch (status) {
    console.log(status);
}
```

#### Return value
If the method call succeeds, `SubscribeUserMetaResponse` is returned.

```javascript 
type SubscribeUserMetaResponse = {
    timeToken: number ,  // Reserved property, indicating the timestamp of the successful operation.
    userId : string ,    // User ID.
}
```

### `unsubscribeUserMetadata`

#### Description

If you do not need to receive notifications of changes to a user metadata, call the `unsubscribeUserMetadata` method to unsubscribe.

#### Method

You can call the `unsubscribeUserMetadata` method in the following way:

```javascript 
rtm.storage.unsubscribeUserMetadata(userId: string): Promise<UnsubscribeUserMetaResponse>;
```

|    Parameter     |  Type   | Required |      Default      | Description                                                  |
| :-------------: | :-----: | :------: | :---------------: | :----------------------------------------------------------- |
|    `userId`     | string  |   Optional   | The `userId` of the current user. | The user ID.                                                                                                         |

#### Basic usage

```javascript 
try {
    const result = await rtm.storage.unsubscribeUserMetadata("Tony");
    console.log("result");
} catch (status) {
    console.log(status);
}
```
#### Return value

If the method call succeeds, `UnsubscribeUserMetaResponse` is returned.

```javascript 
type UnsubscribeUserMetaResponse = {
    timeToken: number ,  // Reserved property, indicating the timestamp of the successful operation.
    userId : string ,    // User ID.
}
```

## Lock

A critical resource can only be used by one process at a time. If a critical resource is shared between different processes, each process needs to adopt a mutually exclusive method to prevent mutual interference. Signaling provides a full set of lock solutions. By controlling different processes in a distributed system, you can solve the competition problem when users access shared resources.

<Admonition type="tip" title="Prompt">The client is able to set, remove, and revoke locks. We recommend that you control the permissions of the these operations on the client side based on your business needs. </Admonition>

### `setLock`

#### Description

You need to configure the lock name, time to live (TTL) and other parameters by calling the `setLock` method. If the configuration succeeds, all users in the channel receive the `lock` event notifications of the `SET` type. For details, see [Event listeners](#event-listeners).

#### Method

You can call the `setLock` method in the following way:

```javascript 
rtm.lock.setLock(
    channelName: string,
    channelType: string,
    lockName: string,
    options?: {
        ttl?: number;
    }
): Promise<SetLockResponse>;
```

|     Parameter      |  Type  | Required | Default| Description                             |
| :-----------: | :----: | :------: | :----: | :-------------------------------- |
| `channelName` | string |   Required   |   -    | Channel name.                        |
| `channelType` | string |   Required   |   -    | Channel type. For details, see [Channel Types](channel-types).  |
|  `lockName`   | string |   Required   |   -    | Lock name.                        |
|   `options`   | object |   Optional   |   -    | Options for setting locks.                   |

`options` contains the following properties:

| Property  |  Type  | Required | Default|           Description        |
| :---: | :----: | :------: | :----: | :----------------------------------------------------------------------------------------------- |
| `ttl` | number |   Optional   |  `10`  | Time to live in seconds of the lock, and the value range is [10,300]. When the user who owns the lock goes offline, if the user returns to the channel within the time they can still use the lock; otherwise, the lock is released and the users who listen for the `onlockevent` event receives the `locktypereleased` event. |

#### Basic usage

```javascript 
try {
    const result = await rtm.Lock.setLock(
        channel:"my_channel",
        channelType:"STREAM",
        lockName: "my_lock",
        { ttl: 30 }
    );
    console.log(result);
} catch (status) {
 console.log(status);
}
```

#### Return Value

If the method call succeeds, `SetLockResponse` is returned.
```javascript 
type SetLockResponse = {
    timeToken: number ,              // Reserved property, indicating the timestamp of the successful operation.
    channelName : string ,           // Channel name.
    channelType : string ,           // Channel type.
    lockName : string                // Lock name.
}
```

If the method call fails, [`ErrorInfo`](#errorinfo) is returned.

### `acquireLock`

#### Description

After setting a lock, you can call the `acquireLock` method on the client to acquire the right to own the lock. When you acquire the lock, other users in the channel receive the `lock` event of the `ACQUIRED` type. For details, see <a href="../toc-configuration/configuration#eventlisteners">Event Listener</a>.

#### Method

You can call the `acquireLock` method in the following way:

```javascript 
rtm.lock.acquireLock(
    channelName: string,
    channelType: string,
    lockName: string,
    options?: { retry?: boolean }
): Promise<AcquireLockResponse>;
```

|      Parameter     |  Type  | Required | Default| Description                             |
| :-----------: | :----: | :------: | :----: | :-------------------------------- |
| `channelName` | string |   Required   |   -    | Channel name.                        |
| `channelType` | string |   Required   |   -    | Channel type. For details, see [Channel Types](channel-types).  |
|  `lockName`   | string |   Required   |   -    | Lock name.                        |
|   `options`   | object |   Optional   |   -    | Options for setting locks.    |

`options` contains the following properties:

|  Property   |  Type   | Required | Default |                             Description                            |
| :-----: | :-----: | :------: | :-----: | :---------------------------------------------------------- |
| `retry` | boolean |   Optional   | `false` | If the lock acquisition fails, whether to retry until the acquisition succeeds or the user leaves the channel.  |

#### Basic usage

```javascript 
try {
    const result = await rtm.Lock.acquireLock(
        "chat_room",
        "STREAM",
        "my_lock",
        {retry:false}
    );
    console.log(result);
} catch (status) {
    console.log(status);
}
```

#### Return value

If the method call succeeds, `AcquireLockResponse` is returned.

```javascript 
type AcquireLockResponse = {
    timeToken: number ,              // Reserved property, indicating the timestamp of the successful operation.
    channelName : string ,           // Channel name.
    channelType : string ,           // Channel type.
    lockName : string                // Lock name.
}
```
If the method call fails, [`ErrorInfo`](#errorinfo) is returned.

### `releaseLock`

#### Description

When a user no longer needs to own a lock, the user can call the `releaseLock` method on the client side to release the lock. When the lock is released, other users in the channel receive the `lock` event of `RELEASED` type. For details, see [Event Listeners](#event-listeners).

At this time, if other users want to acquire the lock, they can call the `acquireLock` method on the client side to compete. New users acquiring locks have the same contention priority as the users who set the `retry` property to automatically retry to acquire locks.

#### Method

You can call the `releaseLock` method in the following way:

```javascript 
rtm.lock.releaseLock(
    channelName: string,
    channelType: string,
    lockName: string
): Promise<ReleaseLockResponse>;
```

|     Property      |  Type  | Required | Default| Description                                                                                                         |
| :-----------: | :----: | :------: | :----: | :------------------------------------------------------------------------------------------------------------ |
| `channelName` | string |   Required   |   -    | Channel name.                                                                                                    |
| `channelType` | string |   Required   |   -    | Channel type. For details, see [Channel Types](channel-types).  |
|  `lockName`   | string |   Required   |   -    | Lock name.        |


#### Basic usage

```javascript 
try {
    const result = await rtm.lock.releaseLock(
        "chat_room",
        "STREAM", "my_lock"
    );
    console.log(result);
} catch (status) {
    console.log(status);
}
```

#### Return value

If the method call succeeds, `ReleaseLockResponse` is returned.
```javascript 
type ReleaseLockResponse = {
    timeToken: number ,      // Reserved property, indicating the timestamp of the successful operation.
    channelName : string ,   // Channel name.
    channelType : string ,   // Channel type.
    lockName : string        // Lock name.
}
```
If the method call fails, [`ErrorInfo`](#errorinfo) is returned.


### `revokeLock`

#### Description

You may need to take back a lock owned by another user and allow the other users to acquire the lock. You can call the `revokeLock` method to revoke the lock. When the lock is revoked, all users in the channel receive the `lock` event of the `RELEASED` type. For details, see [Event Listeners](#event-listeners).

At this time, if other users want to acquire the lock, they can call the `acquireLock` method on the client side to compete. New users acquiring locks have the same contention priority as the users who set the `retry` property to automatically retry to acquire locks.

#### Method

You can call the `revokeLock` method in the following way:

```javascript 
rtm.lock.revokeLock(
    channelName: string,
    channelType: string,
    lockName: string,
    owner: string
): Promise<RevokeLockResponse>;
```

|     Property      |  Type  | Required | Default| Description                             |
| :-----------: | :----: | :------: | :----: | :-------------------------------- |
| `channelName` | string |   Required   |   -    | Channel name.                        |
| `channelType` | string |   Required   |   -    | Channel type. For details, see [Channel Types](channel-types).  |
|  `lockName`   | string |   Required   |   -    | Lock name.                        |
|    `owner`    | string |   Required   |   -    | User ID of the lock owner.     |


#### Basic usage

```javascript 
try {
    const result = await rtm.lock.revokeLockLock(
        "chat_room",
        "STREAM",
        "my_lock",
        "Tony"
    );
    console.log(result);
} catch (status) {
    console.log(status);
}
```

#### Return value

If the method call succeeds, `RevokeLockResponse` is returned.

```javascript 
type RevokeLockResponse = {
    timeToken: number ,      // Reserved property, indicating the timestamp of the successful operation.
    channelName : string ,   // Channel name.
    channelType : string ,   // Channel type.
    lockName : string        // Lock name.
}
```
If the method call fails, [`ErrorInfo`](#errorinfo) is returned.


### `getLock`

#### Description

If you want to query the lock information such as lock total number, lock name, and lock user, time to live, you can call the `getLock` method on the client.

#### Method

You can call the `getLock` method in the following way:

```javascript 
rtm.lock.getLock(
    channelName: string,
    channelType: string
): Promise<GetLockResponse>;
```

|     Property      |  Type  | Required | Default| Description                                                                                                         |
| :-----------: | :----: | :------: | :----: | :------------------------------------------------------------------------------------------------------------ |
| `channelName` | string |   Required   |   -    | Channel name.                                                                                                    |
| `channelType` | string |   Required   |   -    | Channel type. For details, see [Channel Types](channel-types).  |


#### Basic usage

```javascript 
try {
    const result = await rtm.lock.getLock("chat_room","STREAM");
    console.log(result);
} catch (status) {
    console.log(status);
}
```

#### Return value

If the method call succeeds, `GetLockResponse` is returned.

```javascript 
type GetLockResponse = {
    timeToken: number ,              // Reserved property, indicating the timestamp of the successful operation.
    channelName : string ,           // Channel name.
    channelType : string ,           // Channel type.
    totalLocks : string,             // Total lock number.
    lockDetails : [{
        lockName: string,           // Lock name.
        owner: string,              // Lock owner.
        ttl: number                 // Time to live in seconds of the lock.
    }]
}
```
If the method call fails, [`ErrorInfo`](#errorinfo) is returned.

### `removeLock`

#### Description

If you no longer need a lock, you can remove the lock by calling the `removeLock` method. When the lock is successfully removed, all the users in the channel receive the `lock` event notification in the `REMOVED` type. For details, see [Event Listeners](#event-listeners).

#### Method

You can call the `removeLock` method in the following way:

```javascript 
rtm.lock.removeLock(
    channelName: string,
    channelType: string,
    lockName: string
): Promise<RemoveLockResponse>;
```

|     Property      |  Type  | Required | Default| Description                             |
| :-----------: | :----: | :------: | :----: | :-------------------------------- |
| `channelName` | string |   Required   |   -    | Channel name.                        |
| `channelType` | string |   Required   |   -    | Channel type. For details, see [Channel Types](channel-types).  |
|  `lockName`   | string |   Required   |   -    | Lock name.                        |

#### Basic usage

```javascript 
try {
    const result = await rtm.Lock.removeLockLock("chat_room","STREAM", "my_lock");
    console.log(result);
} catch (status) {
    console.log(status);
}
```

#### Return value

If the method call succeeds, `RemoveLockResponse` is returned.

```javascript 
type RemoveLockResponse = {
    timeToken: number ,              // Reserved property, indicating the timestamp of the successful operation.
    channelName : string ,           // Channel name.
    channelType : string ,           // Channel type.
    lockName : string,               // Lock name.
}
```
If the method call fails, [`ErrorInfo`](#errorinfo) is returned.



## Properties

### Channel Types

|       Value      | Description                                                |
| :----------: | ---------------------------------------------------------- |
|    `MESSAGE`  | Message channel.                               |
|    `STREAM`  | Stream channel.                             |


### Reasons for the SDK Connection State Change

|       Value      | Description                                                |
| :----------: | ---------------------------------------------------------- |
|    `CONNECTING`  | The SDK is connecting with the Signaling system.           |
|    `LOGIN_SUCCESS`  | The SDK logged in the Signaling system successfully.                   |
|    `REJECTED_BY_SERVER`  | The SDK is rejected by the server.      |
|    `LOST`  | The SDK lost the connection with the Signaling system.     |
|    `INTERRUPTED`  | The connection was interrupted.           |
|    `LOGOUT`  | The SDK logged out of the Signaling system.                       |
|    ``  | The SDK is banned by the server.              |
|    `SAME_UID_LOGIN`  | The same user ID was used to join the same channel on different devices.   |
|    `TOKEN_EXPIRED`  | The used token expired. You need to request a new token from your server.  |


### SDK Connection States

|       Value      | Description                                                |
| :----------: | ---------------------------------------------------------- |
|    `DISCONNECTED`  | The SDK has disconnected with the server.                              |
|    `CONNECTING`  | The SDK disconnected with the server.                                |
|    `CONNECTED`  | The SDK has connected with the server.                              |
|    `RECONNECTING`  | The connection is lost. The SDK is reconnecting with the server.                       |
|    `FAILED`  | The SDK failed to connect with the server.           |


### End-to-End Encryption Modes

|       Value      | Description                                                |
| :----------: | ---------------------------------------------------------- |
|   `NONE`  |         No encryption.                    |
|   `AES_128_GCM`    |      AES-128-GCM mode.     |
|   `AES_256_GCM`    |      AES-256-GCM mode.      |


### Lock Event Types

|       Value      | Description                                                |
| :----------: | ---------------------------------------------------------- |
|   `SNAPSHOT`  |        The snapshot of the lock when the user joined the channel.        |
|   `SET`    |    The lock is set. |
|   `REMOVED`  |      he lock is removed.      |
|   `ACQUIRED`    |    The lock is acquired. |
|   `RELEASED`  |      The lock is released.       |
|   `EXPIRED`    |    The lock expired. |


### Log Output Levels

|       Value      | Description                                                |
| :----------: | ---------------------------------------------------------- |
|   `none`  |        No log.                    |
|   `info`    |      Output the log at the `error`, `warn`, or `info` level. Agora recommends you set to this value.     |
|   `warn`    |      Output the log at the `error` or `warn` level.        |
|   `error`    |    Output the log at the `error` level.      |
|   `debug`    |      Output the log at all levels.      |

### Message Types

|       Value      | Description                                                |
| :----------: | ---------------------------------------------------------- |
|    `BINARY`  | Binary type.                                |
|    `STRING`  | String type.                                |

### Presence Event Types

|       Value      | Description                                                |
| :----------: | ---------------------------------------------------------- |
|   `SNAPSHOT`  |   When users joined a channel for the first time, they received a snapshot of the channel pushed by the server.                   |
|   `INTERVAL`    |      When users in the channel reach the limit, the event notifications are sent at intervals rather than in real-time.      |
|   `REMOTE_JOIN`    |      A remote user joined the channel.      |
|   `REMOTE_LEAVE`  |        A remote user left the channel.                   |
|   `REMOTE_TIMEOUT`    |      A remote user's connection timed out.      |
|   `REMOTE_STATE_CHANGED`    |    A remote user's temporary state changed.      |
|   `ERROR_OUT_OF_SERVICE`    |    The user did not enable presence when joining the channel.      |

### Storage Event Types

|       Value      | Description                                                |
| :----------: | ---------------------------------------------------------- |
|   `USER`  |        User metadata event.         |
|   `CHANNEL`    |      Channel metadata event. |

### Topic Event Types

|       Value      | Description                                                |
| :----------: | ---------------------------------------------------------- |
|   `SNAPSHOT`  |      The snapshot of the topic when the user joined the channel.                  |
|   `REMOTE_JOIN`    |      A remote user joined the channel.      |
|   `REMOTE_LEAVE`    |       A remote user left the channel.      |


## Troubleshooting

Refer to the following information for troubleshooting API calls.

### ErrorInfo

If an API call fails, the SDK reports the error code and error description through the `errorCode` and `reason` attributes of `ErrorInfo`.

```javascript
type ErrorInfo = {
    error: boolean;                     // Whether an error occurs.
    operation: string;                  // Operation type of this method call.
    errorCode: number;                  // Error code.
    reason: string;                     // Reason for the error.
}
```

### Error codes table

Refer to the following error codes table to identify and troubleshoot the problem:

| Error code| Error description| Cause and solution |
| :------: | :-----------------------------------------------------------------: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `0` | <code>RTM_ERROR_OK</code> | Correct call |
| `-2` | <code>RTM_ERROR_INVALID_ARGUMENT</code> | Invalid argument: <br/> - Check if the parameter type is correct<br/> - Check if the parameter is out of range |
| `-12` | <code>RTM_ERROR_TOO_OFTEN</code> | API call QPS exceeded limit. See <a href="/en/signaling/reference/limitations">API usage limits</a> for details: <br/> - Improve business logic and reduce API calls frequency. <br/> - Contact us for technical support.  |
| `-10001` | <code>RTM_ERROR_NOT_INITIALIZED</code> | SDK not initialized. Please initialize the RTM instance before performing other operations. |
| `-10002` | <code>RTM_ERROR_NOT_LOGIN</code> | The user calls the API after not logging in to the RTM system, disconnecting for timeout, or actively logging out. Please log in to the RTM system first. |
| `-10003` | <code>RTM_ERROR_INVALID_APP_ID</code> | Invalid App ID: <br/> - Check if the App ID is wrong. <br/> - Check whether the App ID has activated the RTM service.  |
| `-10005` | <code>RTM_ERROR_INVALID_TOKEN</code> | Invalid Token: <br/> - The token is invalid, check whether the Token Provider generates an RTM Token.  |
| `-10006` | <code>RTM_ERROR_INVALID_USER_ID</code> | Invalid User ID: <br/> - Check if username is empty. <br/> - Check if the username contains illegal characters.  |
| `-10008` | <code>RTM_ERROR_INVALID_CHANNEL_NAME</code> | Invalid channel name: <br/> - Check if the channel name is empty. <br/> - Check if the channel name contains illegal characters.  |
| `-10009` | <code>RTM_ERROR_TOKEN_EXPIRED</code> | Token expired. You need to call `renewToken` to reacquire the Token. |
| `-10011` | <code>RTM_ERROR_LOGIN_TIMEOUT</code> | Login timeout. You need to check whether the current network is stable and switch to a stable network environment. |
| `-10012` | <code>RTM_ERROR_LOGIN_REJECTED</code> | SDK login rejected by the server: <br/> - Check whether the App ID has activated the RTM service. <br/> - Check if Token or `userId` is banned.   |
| `-10013` | <code>RTM_ERROR_LOGIN_ABORTED</code> | SDK login interrupted due to unknown problem: <br/> - Check whether the current network is stable and switch to a stable network environment. <br/> - The current `userId` is logged in at other end.  |
| `-11001` | <code>RTM_ERROR_CHANNEL_NOT_JOINED</code> | The user has not joined the channel: <br/> - The user is not online, offline or has not joined the channel<br/> - Check for typos in `userId`.  |
| `-11002` | <code>RTM_ERROR_CHANNEL_NOT_SUBSCRIBED</code> | The user has not subscribed to the channel: <br/> - The user is not online, offline or has not joined the channel<br/> - Check for typos in `userId`.  |
| `-11003` | <code>RTM_ERROR_CHANNEL_EXCEED_TOPIC_USER_LIMITATION</code> | The number of subscribers to this topic exceeds the limit. |
| `-11005` | <code>RTM_ERROR_CHANNEL_INSTANCE_EXCEED_LIMITATION</code> | The number of created or subscribed channels exceeds the limit. See <a href="/en/signaling/reference/limitations">API usage limits</a> for details. |
| `-11007` | <code>RTM_ERROR_CHANNEL_JOIN_FAILED</code> | Failed to join this channel: <br/> - Check whether the number of joined channels exceeds the limit. <br/> - Check if the channel name is illegal. <br/> - Check if the network is disconnected.  |
| `-11008` | <code>RTM_ERROR_CHANNEL_INVALID_TOPIC_NAME</code> | Invalid topic name: <br/> - Check whether the topic name contains illegal characters. <br/> - Check if the Topic name is empty.  |
| `-11009` | <code>RTM_ERROR_CHANNEL_INVALID_MESSAGE</code> | Invalid message. Check whether the message type is legal, RTM only supports `string`, `Uint8Array` type messages. |
| `-11010` | <code>RTM_ERROR_CHANNEL_MESSAGE_LENGTH_EXCEED_LIMITATION</code> | Message length exceeded limit. Check whether the message payload size exceeds the limit: <br/> - Message Channel single message package is less than 32 KB. <br/> - Stream Channel single message package is less than 1 KB.  |
| `-11011` | <code>RTM_ERROR_CHANNEL_INVALID_USER_LIST</code> | Invalid user list: <br/> - Check if the user list is empty<br/> - Check if the user list contains illegal item.  |
| `-11013` | <code>RTM_ERROR_CHANNEL_TOPIC_NOT_SUBSCRIBED</code> | The topic is not subscribed. |
| `-11014` | <code>RTM_ERROR_CHANNEL_EXCEED_TOPIC_LIMITATION</code> | The number of topics exceeds the limit. |
| `-11015` | <code>RTM_ERROR_CHANNEL_JOIN_TOPIC_FAILED</code> | Failed to join this topic. Check whether the number of added topics exceeds the limit. |
| `-11016` | <code>RTM_ERROR_CHANNEL_TOPIC_NOT_JOINED</code> | The topic has not been joined. To send a message without joining the Topic, you need to join the Topic first. |
| `-11017` | <code>RTM_ERROR_CHANNEL_TOPIC_NOT_EXIST</code> | The topic does not exist. Check whether the topic name is wrong. |
| `-11019` | <code>RTM_ERROR_CHANNEL_SUBSCRIBE_TIMEOUT</code> | Channel subscription timed out. Check for broken connections. |
| `-11021` | <code>RTM_ERROR_CHANNEL_SUBSCRIBE_FAILED</code> | Channel subscription failed. Check if the number of subscribed channels exceeds the limit. |
| `-11022` | <code>RTM_ERROR_CHANNEL_UNSUBSCRIBE_FAILED</code> | Failed to unsubscribe from the channel. Check for broken connections. |
| `-11023` | <code>RTM_ERROR_CHANNEL_ENCRYPT_MESSAGE_FAILED</code> | Message encryption failed: <br/> - Check whether the `cipherKey` field is valid. <br/> - Check that the `salt` field is valid. <br/> - Check if `encryptionMode` mode matches `cipherKey`, `salt`.  |
| `-11024` | <code>RTM_ERROR_CHANNEL_PUBLISH_MESSAGE_FAILED</code> | Message publishing failed. Check for broken connections. |
| `-11026` | <code>RTM_ERROR_CHANNEL_PUBLISH_MESSAGE_TIMEOUT</code> | Message publishing timed out. Check for broken connections. |
| `-11028` | <code>RTM_ERROR_CHANNEL_LEAVE_FAILED</code> | Failed to leave the channel. Check for broken connections. |
| `-11029` | <code>RTM_ERROR_CHANNEL_CUSTOM_TYPE_LENGTH_OVERFLOW</code> | Custom type length overflow. The length of the `customType` field needs to be within 32 characters. |
| `-11030` | <code>RTM_ERROR_CHANNEL_INVALID_CUSTOM_TYPE</code> | `customType` field is invalid. Check the `customType` field for illegal characters. |
| `-12001` | <code>RTM_ERROR_STORAGE_OPERATION_FAILED</code> | Storage operation failed. |
| `-12002` | <code>RTM_ERROR_STORAGE_METADATA_ITEM_EXCEED_LIMITATION</code> | The number of Storage Metadata Items exceeds the limit. |
| `-12003` | <code>RTM_ERROR_STORAGE_INVALID_METADATA_ITEM</code>     | Invalid Metadata Item。                                                                                                                                                                                   |
| `-12004` | <code>RTM_ERROR_STORAGE_INVALID_ARGUMENT</code> | Invalid argument. |
| `-12005` | <code>RTM_ERROR_STORAGE_INVALID_REVISION</code> | Invalid Revision parameter. |
| `-12006` | <code>RTM_ERROR_STORAGE_METADATA_LENGTH_OVERFLOW	</code> | Metadata length overflow. |
| `-12007` | <code>RTM_ERROR_STORAGE_INVALID_LOCK_NAME</code> | Invalid Lock name. |
| `-12008` | <code>RTM_ERROR_STORAGE_LOCK_NOT_ACQUIRED</code> | The Lock was not acquired. |
| `-12009` | <code>RTM_ERROR_STORAGE_INVALID_KEY</code> | Invalid Metadata key. |
| `-12010` | <code>RTM_ERROR_STORAGE_INVALID_VALUE	</code> | Invalid Metadata value. |
| `-12011` | <code>RTM_ERROR_STORAGE_KEY_LENGTH_OVERFLOW</code> | Metadata key length overflow. |
| `-12012` | <code>RTM_ERROR_STORAGE_VALUE_LENGTH_OVERFLOW</code> | Metadata value length overflow. |
| `-12014` | <code>RTM_ERROR_STORAGE_OUTDATED_REVISION</code> | Outdated Revision parameter. |
| `-12015` | <code>RTM_ERROR_STORAGE_NOT_SUBSCRIBE</code> | This channel is not subscribed. |
| `-12017` | <code>RTM_ERROR_STORAGE_SUBSCRIBE_USER_EXCEED_LIMITATION</code> | The number of subscriber Metadata exceeds the limit. |
| `-12018` | <code>RTM_ERROR_STORAGE_OPERATION_TIMEOUT</code> | Storage operation timed out. |
| `-12019` | <code>RTM_ERROR_STORAGE_NOT_AVAILABLE</code> | The Storage service is not available. |
| `-13001` | <code>RTM_ERROR_PRESENCE_NOT_CONNECTED</code> | The user is not connected to the system. |
| `-13002` | <code>RTM_ERROR_PRESENCE_NOT_WRITABLE</code> | Presence Service is unavailable. |
| `-13003` | <code>RTM_ERROR_PRESENCE_INVALID_ARGUMENT</code> | Invalid argument. |
| `-13004` | <code>RTM_ERROR_PRESENCE_CACHED_TOO_MANY_STATES</code> | The temporary user state cached before joining the channel exceeds the limit. See <a href="/en/signaling/reference/limitations">API usage limits</a> for details. |
| `-13005` | <code>RTM_ERROR_PRESENCE_STATE_COUNT_OVERFLOW</code> | The number of temporary user state key/value pairs exceeds the limit. See <a href="/en/signaling/reference/limitations">API usage limits</a> for details. |
| `-13006` | <code>RTM_ERROR_PRESENCE_INVALID_STATE_KEY</code> | Invalid state key. |
| `-13007` | <code>RTM_ERROR_PRESENCE_INVALID_STATE_VALUE</code> | Invalid state value. |
| `-13008` | <code>RTM_ERROR_PRESENCE_STATE_KEY_SIZE_OVERFLOW</code> | Presence key length overflow. |
| `-13009` | <code>RTM_ERROR_PRESENCE_STATE_VALUE_SIZE_OVERFLOW</code> | presence value overflow |
| `-13011` | <code>RTM_ERROR_PRESENCE_USER_NOT_EXIST</code> | The user does not exist. |
| `-13012` | <code>RTM_ERROR_PRESENCE_OPERATION_TIMEOUT</code> | Presence operation timed out. |
| `-13013` | <code>RTM_ERROR_PRESENCE_OPERATION_FAILED</code> | Presence operation failed. |
| `-14001` | <code>RTM_ERROR_LOCK_OPERATION_FAILED</code> | Lock operation failed. |
| `-14002` | <code>RTM_ERROR_LOCK_OPERATION_TIMEOUT</code> | Lock operation timed out. |
| `-14003` | <code>RTM_ERROR_LOCK_OPERATION_PERFORMING</code> | Lock operation in progress. |
| `-14004` | <code>RTM_ERROR_LOCK_ALREADY_EXIST</code> | Lock already exists. |
| `-14005` | <code>RTM_ERROR_LOCK_INVALID_NAME</code> | Invalid Lock name. |
| `-14006` | <code>RTM_ERROR_LOCK_NOT_ACQUIRED</code> | The Lock was not acquired. |
| `-14007` | <code>RTM_ERROR_LOCK_ACQUIRE_FAILED</code> | Failed to acquire the Lock. |
| `-14008` | <code>RTM_ERROR_LOCK_NOT_EXIST</code> | The Lock does not exist. |
| `-14009` | <code>RTM_ERROR_LOCK_NOT_AVAILABLE</code> | Lock service is not available. |


</PlatformWrapper>
