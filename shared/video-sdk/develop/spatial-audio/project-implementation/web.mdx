<PlatformWrapper platform="web">

### Update the user interface

In a real-word application, you report your local spatial position to a server in your environment and receive positions of remote users in the channel from your server. In this simple example, you use a single button to set the spatial position of a remote user.

To add the button to the UI, in `index.html`, add the following code after `<button type="button" id="leave">Leave</button>`:

```html
<button type="button" id="updateRemotePosition">Update Remote User Position</button>
```

### Handle the system logic

1. **Declare the variables you need**

    You create an instance of `spatialAudioExtension` to implement audio effects. To initialize the extension, specify `assetsPath` that contains the  `Wasm` and `JS` files.
    
    To keep track of `SpatialAudioProcessor`s that you create for each remote user, you use a `Map` object. Add the following lines to your `main.js` file after the `import` statements:

    ```javascript
    const spatialAudioExtension = new SpatialAudioExtension({
        assetsPath: "./node_modules/agora-extension-spatial-audio/external/",
    });
    const processors = new Map();
    ```

1. **Register the spatial audio extension**

    To register the `spatialAudioExtension` instance with <Vg k="ENGINE" />, add the following function to `main.js`:

    ```javascript
    async function setupSpatial() {
        // Register the extension
        AgoraRTC.registerExtensions([spatialAudioExtension]);
    }
    ```
    To execute this code at startup, add the following after `startBasicCall();` in `main.js`:

    ```javascript
    setupSpatial();
    ```

### Implement spatial audio effects

1. **Update position of the local user**

    To update spatial position of the local user, add the following code to `setupSpatial()` after you register the extension:

    ```javascript
    const mockLocalUserNewPosition = {
        // In a production app, the position can be generated by 
        // dragging the local user's avatar in a 3D scene.
        position: [1, 1, 1], // Coordinates in the world coordinate system
        forward: [1, 0, 0], // The unit vector of the front axis
        right: [0, 1, 0], // The unit vector of the right axis
        up: [0, 0, 1], // The unit vector of the vertical axis
    };

    spatialAudioExtension.updateSelfPosition(
        mockLocalUserNewPosition.position,
        mockLocalUserNewPosition.forward,
        mockLocalUserNewPosition.right,
        mockLocalUserNewPosition.up
    );
    ```

1. **Set up spatial audio processors for remote users**

    When a remote user joins the channel, you create a `SpatialAudioProcessor` and inject it into the user's audio track using the `pipe` method. To do this, in `agoraEngine.on("user-published"` replace the code inside the `if (mediaType == "audio") {...}` block with the following:

    ```javascript
    // Create a  new SpatialAudioProcessor for the remote user
    const processor = spatialAudioExtension.createProcessor();
    // Add the processor to the Map for future use
    processors.set(user.uid.toString(), processor);

    // Inject the SpatialAudioProcessor into the audio track
    const track = user.audioTrack;
    track.pipe(processor).pipe(track.processorDestination);

    // Play the remote audio track.
    track.play();
    channelParameters.remoteAudioTrack = track;
    ```

1. **Update position of a remote user**

    In a real world application, you receive notification of change in a remote user's position through your server. You then update the spatial position of the remote user in the corresponding `SpatialAudioProcessor`. In this simple example, you change the position of a remote user when the local user presses a button. To do this, add the following function to `main.js`:

    ```javascript
    document.getElementById("updateRemotePosition").onclick = async function () {
        // Retrieve the SpatialAudioProcessor for this user
        const processor = processors.get(channelParameters.remoteUid);

        // Update remote position
        processor.updateRemotePosition({
            position: [10, 1, 1], 
            forward: [1, 0, 0] 
        });
    }
    ```

</PlatformWrapper>