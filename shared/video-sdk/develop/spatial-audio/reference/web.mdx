<PlatformWrapper platform="web">

### Supported audio routes

The following table summarizes true two-channel playback support for different audio routes.

| Audio routing | True two-channel playback support |
|:----|:--------|
| Wired headset | Supported |
| Bluetooth earphones |	Supported when the microphone is not in use |
| Speaker | Not supported |


### API reference

This section provides the API reference for the spatial audio extension for web.

#### createProcessor

```javascript
createProcessor(): SpatialAudioProcessor;
```

Create a `SpatialAudioProcessor` instance.


#### updateSelfPosition

```javascript
public updateSelfPosition(position: position, forward: forward, right: right, up: up): SpatialAudioErrorCode
```

Update the local user's spatial location.

After successfully calling this method, the SDK will update the spatial sound effects parameters according to the relative position changes of the local user, all remote users, and the local audio player (if any).

**Parameter**

| Parameter | Description |
| :------ | :--------------------|
| position | The coordinates in the world coordinate system. This parameter is an array of length 3, and the three values represent the front, right, and top coordinate values in sequence. |
| forward | The unit vector of the front axis in the world coordinate system. This parameter is an array of length 3, and the three values represent the front, right, and top coordinate values in sequence. |
| right | The unit vector on the right axis of the world coordinate system. This parameter is an array of length 3, and the three values represent the front, right, and top coordinate values in sequence. |
| up | The unit vector of the axis in the world coordinate system. This parameter is an array of length 3, and the three values represent the front, right, and top coordinate values in sequence. |

**Returns**

See SpatialAudioErrorCode for details.

**Sample code**

```javascript
const mockLocalUserNewPosition = {
    // For example, mockLocalUserNewPosition can be produced by dragging the local user's avatar to walk in a 3D scene
    position: [1, 1, 1],
    forward: [1, 0, 0],
    right: [0, 1, 0],
    up: [0, 0, 1],
};

extension.updateSelfPosition(
    mockLocalUserNewPosition.position,
    mockLocalUserNewPosition.forward,
    mockLocalUserNewPosition.right,
    mockLocalUserNewPosition.up,
);
```

#### clearRemotePositions

```javascript
public clearRemotePositions(): SpatialAudioErrorCode
```

Delete the spatial location information of all remote users and local audio players.

After this method is successfully called, the spatial audio effects of all remote users and the local audio player will be eliminated, but the local user can still hear the sounds of the remote user and the local audio player.

After leaving the channel, in order to avoid wasting computing resources, you can also call this method to delete the spatial location information of all remote users and local audio players.

**Returns**

See SpatialAudioErrorCode for details.

#### updateSpatialBlur

```javascript
public updateSpatialBlur(enable: boolean): void
```

Updated sound blurring settings.

After successfully calling this method, the audio blurring settings of the remote user or local audio player will be updated.

**Parameter**

| Parameter | Description |
| :------ | :--------------------|
| enable | Whether to enable sound blurring:<ul><li>true: Turn on blurring.</li><li>false: (default) Turn off blurring.</li></ul>|


#### updateSpatialAirAbsorb

```javascript
public updateSpatialAirAbsorb(enable: boolean): void
```

Updated settings for airborne simulations.

After a successful call to this method, the airborne simulation settings for that remote user or local audio player are updated.

**Parameter**

| Parameter | Description |
| :------ | :--------------------|
| enable | Whether to enable air propagation simulation, that is, to simulate the energy propagation effect when sound is propagated in the air.<ul><li>true: (default) Turns on airborne simulation.</li><li>false: Turn off airborne simulation.</li></ul>

#### updatePlayerPositionInfo

```javascript
public updatePlayerPositionInfo(info: RemoteVoicePositionInfo): SpatialAudioErrorCode;
```

Updates the spatial position of the specified local audio player.

After successfully calling this method, the SDK will update the spatial sound effect parameters according to the relative position change between the local user and the player.

**Parameter**

| Parameter | Description |
| :------ | :--------------------|
| info | The spatial location information of the player. See RemoteVoicePositionInfo for details. |

**Returns**

See SpatialAudioErrorCode for details .

**Sample code**

```javascript
const mockLocalPlayerNewPosition = {
    position: [1, 1, 1],
    forward: [1, 0, 0],
};
processor.updatePlayerPositionInfo(mockLocalPlayerNewPosition);
```

#### updateRemotePosition

```javascript
public updateRemotePosition(info: RemoteVoicePositionInfo): SpatialAudioErrorCode;
```

Update the spatial location information of the specified remote user.

After successfully calling this method, the SDK will calculate the spatial sound effect parameters based on the relative position of the local user and the remote user.
This method needs to be called after `join`.

**Parameter**

| Parameter | Description |
| :------ | :--------------------|
| info | Spatial location information of the remote user. See  RemoteVoicePositionInfo for details. |

**Returns**

See  SpatialAudioErrorCode for details .

**Sample code**

```javascript
const processors = new Map();
client.on("user-published", async (user, mediaType) => {
    await client.subscribe(user, mediaType);
    console.log("subscribe success");
    if (mediaType === "audio") {
        const processor = extension.createProcessor();
        processors.set(user.uid, processor);
        const track = user.audioTrack;
        track.pipe(processor).pipe(track.processorDestination);
        track.play();
    }
});

// The following code mocks the case of receiving the remote user's position change message from your server
yourOwnEventHandler.on("updatePosition", (uid, data) => {
    const processor = processors.get(uid);
    processor.updateRemotePosition({
        position: data.position,
        forward: data.forward,
    });
});
```

#### removeRemotePosition

```javascript
public removeRemotePosition(): SpatialAudioErrorCode
```

Delete the spatial location information of the specified remote user (or local audio player).
After successfully calling this method, the spatial audio effect of the specified remote user (or local audio player) will be eliminated, but the local user can still hear the specified remote user (or local audio player).

After leaving the channel, in order to avoid wasting computing resources, you can also call this method to delete the spatial location information of the specified remote user (or local audio player).

**Returns**

See SpatialAudioErrorCode for details .

**Sample code**

```javascript
yourOwnEventHandler.on("removePosition", uid => {
    const processor = processors.get(uid);
    processor.removeRemotePosition();
});
```

#### setZones

```javascript
public setZones(set: ZoneSet): SpatialAudioErrorCode
```

Set the sound insulation area.

In the virtual interactive scene, you can use this method to set the sound insulation area and its sound attenuation coefficient. When the sound source (which can be the user or the media player) and the listener belong to the inside and outside of the sound insulation area, they will experience the attenuation effect of sound similar to the real environment when it encounters a building partition

| Sound source | listener | Sound attenuation factor |
|:----|:----|:------------------------|
| Inside Sound Insulation Area A | Sound Insulation Zone A Outside | Subject to the setting of setZones |
| Inside Sound Insulation Area A | Inside Sound Insulation Area A |<ul><li>`forceSet` The setting  in updateSpatialAttenuation  is  true:  `updateSpatialAttenuation` subject to the setting of . If it is not called  `updateSpatialAttenuation`, the default sound attenuation coefficient of the SDK is 0.5, that is, the attenuation of the simulated sound in the real environment.</li><li> `forceSet` The setting  in `updateSpatialAttenuation`  is  false:  setZones subject to the setting of .</li></ul> |
| Inside Sound Insulation Area A | Inside Sound Insulation Zone B | The listener cannot hear the source |
| not in any soundproof area | not in any soundproof area | Subject to `updateSpatialAttenuation` the settings. If it is not called  `updateSpatialAttenuation`, the default sound attenuation coefficient of the SDK is 0.5, that is, the attenuation of the simulated sound in the real environment. |

**Note:** If this method is called multiple times, the sound insulation area set last time shall prevail.

**Parameter**

| Parameter | Description |
| :------ | :--------------------|
| set | Setting of sound insulation area. The parameter is  ZoneParams an array of objects. See  ZoneParams for details. |

**Returns**

See SpatialAudioErrorCode for details .


#### updateSpatialAttenuation

```javascript
public updateSpatialAttenuation(factor: number, forceSet: boolean): SpatialAudioErrorCode
```

Update the sound attenuation effect of the far end user or media player.

**Parameter**

| Parameter | Description |
| `factor` | The sound attenuation coefficient of the remote user or media player, the value range is [0,1], the default value is 0.5. in:<ul><li>0: Broadcast mode, that is, the volume and timbre are not attenuated with distance, and the volume and timbre heard by local users will not change regardless of distance.</li><li>(0,0.5): Weak attenuation mode, that is, the volume and timbre are only weakly attenuated during the propagation process, and the sound can travel farther than the real environment.</li><li>0.5: Simulate the attenuation of the volume in the real environment, the effect is equivalent to not setting  factor parameters.</li><li>(0.5,1]: Strong decay mode (default value is 1), that is, the volume and timbre decay rapidly during the propagation process.|
| `forceSet` | Whether to force the sound attenuation effect of the remote user or media player:</li><li>true: Force the use  factor of the set sound attenuation effect. At this time   , the sound insulation zone attenuation coefficient ( ) set  through setZonesattenuation  does not take effect on the remote user or media player.</li><li>false: Does not force the use  factor of the sound attenuation effect set in the following two cases.</li><li>If the sound source and the listener belong to the inside and outside of the sound isolation zone, the sound attenuation effect is determined by the  setZones  setting  attenuation.</li><li>If the sound source and the listener are in the same sound insulation area or outside the same sound insulation area, the sound attenuation effect is determined by this method  factor.</li></ul>

**Returns**

See SpatialAudioErrorCode for details .

</PlatformWrapper>