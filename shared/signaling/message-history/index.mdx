import Setup from '@docs/shared/common/project-setup/index.mdx';
import Implement from '@docs/shared/signaling/message-history/implementation/index.mdx';

<PlatformWrapper notAllowed="flutter, unity">

The <Vg k="SIG" /> message history feature allows you to store messages when publishing them to a channel. For example, if a user joins a channel midway through a conversation, you can retrieve messages that were published before the user joined. You can configure the message retention period for each project, ranging from 1 day to permanent storage.

When a message is published, it is stored using the channel name and the message timestamp. You can use this information to retrieve historical messages.

<Admonition type="info"> 
The historical message feature is currently available for User Channels and Message Channels, but not for Stream Channels. 
</Admonition>

## Prerequisites

Before implementing this feature, ensure that you have:

* Integrated the <Vpd k="SDK" /> in your project, and implemented the framework functionality from the [SDK quickstart](../get-started/sdk-quickstart) page.
* Enabled the message history feature by contacting [support@agora.io](mailto:support@agora.io). You can request a storage duration of 1, 7, 30, 90, or 365 days, or opt for permanent storage.

    <Admonition type="info">
    Changes to storage duration only affect future messages.
    </Admonition>

## Implement message history

This section shows how to store and retrieve messages from history.

<Implement />

The following use-cases show how to specify the `start` and `end` parameters to retrieve messages in a specific range:

#### Retrieve before a start timestamp

| Parameter | Behavior |
|----------|----------|
| `start`  | Returns messages sent before the specified timestamp. The timestamp itself is excluded. |

```
Timeline:
[Older messages] ------------ start timestamp ------------ [Newer messages]
[             ←-- n messages]
```

#### Retrieve messages up to an end timestamp

| Parameter | Behavior |
|----------|----------|
| `end`    | Returns the n most recent messages sent up to and including the specified timestamp. |

```
Timeline:
[Older messages] ------------ end timestamp ------------ [Newer messages]
                                       [  ←-- n messages]
```

#### Retrieve messages between two timestamps

| Parameter | Behavior |
|----------|----------|
| `start`  | Returns messages sent before this timestamp (excluded). |
| `end`    | Returns messages sent up to and including this timestamp. |

```
Timeline:
[Older messages] ---- end timestamp ------------ start timestamp ---- [Newer messages]
                               [ ←-- n messages]
```

</PlatformWrapper>

<PlatformWrapper platform="flutter, unity">
This feature is not yet available for <Vpl k="NAME" />.
</PlatformWrapper>
