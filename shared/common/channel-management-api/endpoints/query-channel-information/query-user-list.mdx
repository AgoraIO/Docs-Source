import Authorization from '@docs/shared/common/channel-management-api/authorization.mdx';
import CodeBlock from '@theme/CodeBlock';
import MultiCodeBlock, { CodeGroup, CodeItem } from '@app/mdx-components/MultiCodeBlock';
import RestAPILayout from '@site/src/components/rest-api/RestAPILayout';
import LeftColumn from '@site/src/components/rest-api/LeftColumn';
import RightColumn, { Section } from '@site/src/components/rest-api/RightColumn';
import ParameterList, { Parameter } from '@site/src/components/rest-api/ParameterList';
import PathParameter from '@site/src/components/rest-api/PathParameter';
import { Tabs, TabItem } from '@site/src/components/rest-api/Tabs';

<RestAPILayout>

<LeftColumn
  title={frontMatter.title}
  method="GET"
  endpoint="https://api.agora.io/dev/v1/channel/user/{appid}/{channelName}"
>

This method gets the list of all users in a specified channel. For more information, see [User list](#user-list).
### Request

**Path parameters**

Pass the following path parameters in the request URL:

  <PathParameter name="appid" type="string" required={true}>
    The App ID of the project. You can get it through one of the following methods:
    <ul>
      <li>Copy from the <Link to="{{Global.AGORA_CONSOLE_URL}}"><Vg k="CONSOLE" /></Link></li>
      <li> Call the [Get all projects](../../agora-console-rest-api#get-all-projects) API, and read the value of the `vendor_key` field in the response body.</li>
    </ul>
  </PathParameter>
  <PathParameter name="channelName" type="string" required={true}>
    The channel name. 
  </PathParameter>
  <PathParameter name="hosts_only" type="string" required={false}>
    If you fill in this parameter, only the host list in the live broadcast use-case will be returned.
  </PathParameter>

**Request header**

<Authorization/>

### Response

If the status code is `200`, the request succeeds, and the response body includes the following parameters:

<ParameterList title="OK">
  <Parameter name="success" type="boolean" required={true}>
    The status of the request:
    <ul>
      <li>``true``: The request was successful.</li>
      <li>``false``: Reserved for future use.</li>
    </ul>
  </Parameter>
  <Parameter name="data" type="object" required={true}>
    User information, including the following fields:
    <Parameter name="channel_exist" type="boolean" required={true}>
      Indicates whether the specified channel exists:
      <ul>
        <li>``true``: The channel exists.</li>
        <li>``false``: The channel does not exist.</li>
      </ul>
      <strong>Note:</strong> If ``channel_exist`` is ``false``, all other fields are not returned.
    </Parameter>
    <Parameter name="mode" type="number" required={true}>
      The channel profile:
      <ul>
        <li>``1``: The ``COMMUNICATION`` profile.</li>
        <li>``2``: The ``LIVE_BROADCASTING`` profile.</li>
      </ul>
    </Parameter>
    <Parameter name="total" type="number" required={false}>
      The total number of users in the channel. This field is returned only when ``mode`` is ``1``.
    </Parameter>
    <Parameter name="users" type="array" required={false}>
      The list of user IDs in the channel. This field is returned only when ``mode`` is ``1``.
    </Parameter>
    <Parameter name="broadcasters" type="array" required={false}>
      The list of user IDs of all hosts in the channel. This field is returned only when ``mode`` is ``2``.
    </Parameter>
    <Parameter name="audience" type="array" required={false}>
      The list of user IDs of the first 10,000 audience members in the channel. This field is returned only when ``mode`` is ``2`` and the ``hosts_only`` parameter is not specified.
    </Parameter>
    <Parameter name="audience_total" type="number" required={false}>
      The total number of audience members in the channel. This field is returned only when ``mode`` is ``2`` and the ``hosts_only`` parameter is not specified.
    </Parameter>
  </Parameter>
</ParameterList>

If the status code is not `200`, the request fails. See the `message` field in the response body for the reason for this failure. For details about possible response status codes, see [Response status codes](../../response-status-code).

## Reference

This section contains content that completes the information on this page, or points you to documentation that explains other aspects to this product.

### User list

The list differs based on the channel profile as follows:

- For the `COMMUNICATION` profile, this API returns the list of all users in the channel.
- For the `LIVE_BROADCASTING` profile, this API returns the list of all hosts and audience members in the channel.

<Admonition type="info" title="Note"><ul><li>Users in a channel must use the same channel profile; otherwise, the query results may be inaccurate.</li><li>You can synchronize the online channel statistics either by calling this API or by calling the [Query user status API](query-user-status). This API requires a lower call frequency and has a higher query efficiency. Therefore, Agora recommends using this API to query online channel statistics.</li></ul></Admonition>

</LeftColumn>
<RightColumn>
<Section title="Authorization">
The endpoint requires [RESTful authentication](/video-calling/channel-management-api/restful-authentication).
</Section>
<Section title="Request example">
  <Tabs groupId="code-examples">
    <TabItem value="curl" label="curl" default>
    ```bash
    curl --request GET \
      --url http://api.sd-rtn.com/dev/v1/channel/user/appid/channelName/hosts_only \
      --header 'Accept: application/json' \
      --header 'Authorization: '
    ```
    </TabItem>
    <TabItem value="python" label="Python" default>
    ```python
    import http.client

    conn = http.client.HTTPConnection("api.sd-rtn.com")

    headers = {
        'Authorization': "",
        'Accept': "application/json"
    }

    conn.request("GET", "/dev/v1/channel/user/appid/channelName/hosts_only", headers=headers)

    res = conn.getresponse()
    data = res.read()

    print(data.decode("utf-8"))
    ```
    </TabItem>
    <TabItem value="node" label="Node.js" default>
    ```js
    const fetch = require('node-fetch');

    const url = 'http://api.sd-rtn.com/dev/v1/channel/user/appid/channelName/hosts_only';
    const options = {method: 'GET', headers: {Authorization: '', Accept: 'application/json'}};

    try {
      const response = await fetch(url, options);
      const data = await response.json();
      console.log(data);
    } catch (error) {
      console.error(error);
    }
    ```
    </TabItem>
  </Tabs>

</Section>
<Section title="Response example">
**In `COMMUNICATION` profile**

```json
{
  "success": true,
  "data": {
    "channel_exist": true,
    "mode": 1,
    "total": 1,
    "users": [
      906218805
    ]
  }
}
```

**In `LIVE_BROADCASTING` profile**

```bash
{
    "success": true,
    "data": {
        "channel_exist": true,
        "mode": 2,
        "broadcasters": [
            2206227541,
            2845863044
        ],
        "audience": [
            906219905
        ],
        "audience_total": 1
    }
}
```
</Section>
</RightColumn>

</RestAPILayout>
