<PlatformWrapper platform="unity">

This section shows how to use the Chat SDK to implement peer-to-peer messaging into your game, step-by-step.

### 1. Add namespaces

In Unity Editor, select the **Project** tab, select **Assets** > **Scripts**, and double-click the `TestCode.cs` file.

At the top lines of the `TestCode.cs` file, add the following:

```csharp
using ChatSDK;
using ChatSDK.MessageBody;
```

### 2. Initiate the SDK

In the `InitSDK` method, add the following to initialize the SDK:

```csharp
// In this sample project, initiate the SDK using the App Key of 41117440#383391.
Options options = new Options(APPKEY);
options.UsingHttpsOnly = true;
SDKClient.Instance.InitWithOptions(options);
```

### 3. Sign up an account

At the end of the `SignUpAction` method, add the following to add the sign-up logic:

```csharp
StartCoroutine(RegisterAgoraAccount(Username.text, Password.text, (error) =>
{
    if (error != null) {
        AddLogToLogText(error);
    }
    else {
        AddLogToLogText("register succeed");
    }
}));
```

### 4. Log in to an account

At the end of the `SignInAction` method, add the following to add the login logic:

```csharp
StartCoroutine(FetchAgoraToken(Username.text, Password.text, 
    (agornToken) => {
        SDKClient.Instance.LoginWithAgoraToken(username: Username.text, agornToken, handle: new CallBack(
            onSuccess: () => {
                AddLogToLogText("sign in sdk succeed");
            },
            onError: (code, desc) => {
                AddLogToLogText($"sign in sdk failed, code: {code}, desc: {desc}");
            }
        ));
    }, 
    (error) => {
        AddLogToLogText(error);
    }
));
```

### 5. Send messages

At the end of the `SendMessageAction` method, add the following to add the creating and sending logics for messages:

```csharp
Message msg = Message.CreateTextSendMessage(SignChatId.text, MessageContent.text);
SDKClient.Instance.ChatManager.SendMessage(ref msg, new CallBack(
  onSuccess: () => {
    AddLogToLogText($"send message succeed, receiver: {SignChatId.text},  message: {MessageContent.text}");
  },
  onError:(code, desc) => {
    AddLogToLogText($"send message failed, code: {code}, desc: {desc}");
  }         
));
```

### 6. Receive messages

To add the receiving logic for messages, refer to the following steps:

1. Declare and inherit the `IChatManagerDelegate` class. The sample code is as follows:

```csharp
public class TestCode : MonoBehaviour, IChatManagerDelegate
```

2. Add the following callbacks to the `TestCode` class:

```csharp
public void OnMessagesReceived(List<Message> messages)
    {
        foreach (Message msg in messages) {
            if (msg.Body.Type == MessageBodyType.TXT)
            {
                TextBody txtBody = msg.Body as TextBody;
                AddLogToLogText($"received text message: {txtBody.Text}, from: {msg.From}");
            }
            else if (msg.Body.Type == MessageBodyType.IMAGE)
            {
                ImageBody imageBody = msg.Body as ImageBody;
                AddLogToLogText($"received image message, from: {msg.From}");
            }
            else if (msg.Body.Type == MessageBodyType.VIDEO) {
                VideoBody videoBody = msg.Body as VideoBody;
                AddLogToLogText($"received video message, from: {msg.From}");
            }
            else if (msg.Body.Type == MessageBodyType.VOICE)
            {
                VoiceBody voiceBody = msg.Body as VoiceBody;
                AddLogToLogText($"received voice message, from: {msg.From}");
            }
            else if (msg.Body.Type == MessageBodyType.LOCATION)
            {
                LocationBody localBody = msg.Body as LocationBody;
                AddLogToLogText($"received location message, from: {msg.From}");
            }
            else if (msg.Body.Type == MessageBodyType.FILE)
            {
                FileBody fileBody = msg.Body as FileBody;
                AddLogToLogText($"received file message, from: {msg.From}");
            }
        }
    }
    public void OnCmdMessagesReceived(List<Message> messages)
    {
    }
    public void OnMessagesRead(List<Message> messages)
    {
    }
    public void OnMessagesDelivered(List<Message> messages)
    {
    }
    public void OnMessagesRecalled(List<Message> messages)
    {
    }
    public void OnReadAckForGroupMessageUpdated()
    {
    }
    public void OnGroupMessageRead(List<GroupReadAck> list)
    {
    }
    public void OnConversationsUpdate()
    {
    }
    public void OnConversationRead(string from, string to)
    {
    }
```

3. In the `AddChatDelegate` method, add the following:

```csharp
// Add the listener for the `TestCode` object
SDKClient.Instance.ChatManager.AddChatManagerDelegate(this);
```

4. In the `RemoveChatDelegate` method, add the following:

```csharp
// Remove the listener when the object is released
SDKClient.Instance.ChatManager.RemoveChatManagerDelegate(this);
```

### 7. Log out of the account

In the `SignOutAction` method, add the following:

```csharp
SDKClient.Instance.Logout(true, handle: new CallBack(
  onSuccess: () => {
      AddLogToLogText("sign out sdk succeed");
  },
  onError: (code, desc) => {
      AddLogToLogText($"sign out sdk failed, code: {code}, desc: {desc}");
  }
));
```

</PlatformWrapper>