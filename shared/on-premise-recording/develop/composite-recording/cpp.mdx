<PlatformWrapper platform="linux-cpp">
To implement composite recording mode in your C++ app, follow these steps:

1. Initialize the recorder with [`enableMix`](/on-premise-recording/api-references/agora-media-rtc-recorder#initialize) set to `true`.
2. Subscribe to the audio and video streams of the users you want to record.
3. Join the channel with [`joinChannel`](/on-premise-recording/api-references/agora-media-rtc-recorder#joinchannel).
4. After joining the channel, configure the recording:
   - Use [`setRecorderConfig`](/on-premise-recording/api-references/agora-media-rtc-recorder#setrecorderconfig) to set video resolution, bitrate, and storage path.
   - Optionally, apply watermarks with [`enableAndUpdateVideoWatermarks`](/on-premise-recording/api-references/agora-media-rtc-recorder#enableandupdatevideowatermarks).
   - Define the video layout with [`setVideoMixingLayout`](/on-premise-recording/api-references/agora-media-rtc-recorder#setvideomixinglayout).
5. Start and stop recording by calling:
   - [`startRecording`](/on-premise-recording/api-references/agora-media-rtc-recorder#startrecording)
   - [`stopRecording`](/on-premise-recording/api-references/agora-media-rtc-recorder#stoprecording)

Refer to the following code to implement these steps:

```cpp
// Initialize the recorder in composite recording mode
recorder->initialize(service, true);

// Subscribe to all audio and video streams
recorder->subscribeAllAudio();
recorder->subscribeAllVideo();

// Join the channel
recorder->joinChannel(config.token.c_str(), config.ChannelName.c_str(), config.UserId.c_str());

// Set recording configuration
recorder->setRecorderConfig(recorder_config);

// Apply watermarks (optional)
recorder->enableAndUpdateVideoWatermarks(watermarks, config.waterMarks.size());

// Set the video mixing layout
recorder->setVideoMixingLayout(layout);

// Start recording
recorder->startRecording();

// ...

// Stop recording
recorder->stopRecording();
```

</PlatformWrapper>