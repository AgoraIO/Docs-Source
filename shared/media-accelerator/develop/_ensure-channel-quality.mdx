import * as data from '@site/data/variables';
import Introduction from '@docs/shared/video-sdk/common/channel_quality_intro.mdx';
import Prerequisites from '@docs/shared/common/prerequities.mdx';
import ProjectSetup from '@docs/shared/media-accelerator/develop/ensure-channel-quality/project-setup/index.mdx';
import ProjectImplement from '@docs/shared/media-accelerator/develop/ensure-channel-quality/project-implementation/index.mdx';
import ProjectTest from '@docs/shared/media-accelerator/develop/ensure-channel-quality/project-test/index.mdx';
import Reference from '@docs/shared/media-accelerator/develop/ensure-channel-quality/reference/index.mdx';

<Introduction />

This page shows you how to use <Vpd k="SDK"/> features to account for these factors and ensure optimal audio and video quality in your {props.PRODUCT} <Vpl k="CLIENT" />.

## Understand the tech

<Vpd k="SDK"/> provides the following features to deal with channel quality issues:

- **Choose an audio codec to optimize bit rate and quality**

  In audio and video streaming, the choice of an encoding algorithms affects both quality and bit rate. Your goal is to lower the required bit rate while maintaining the quality at the desired level. <Vpd k="SDK" /> offers the following built-in audio codecs to choose from:

  - Opus
  - G722
  - G711A (PCMU) 
  - G711U (PCMU) 

  You also specify the sampling rate and the number of channels, depending on your audio quality requirements. If your <Vpl k="CLIENT"/> needs a custom encoding algorithm, you disable use of a built-in codec and implement your own. 

- **Adjust target bit rate in real time**

  In order to increase data transmission and avoid network congestion, <Vpd k="SDK"/> will suggest developers to adjust the sending bit rate in real time according to changes in network bandwidth conditions.

  Developers can call the agora_rtc_set_bwe_param (C API) method or setBweParam (Java API) method to configure BWE (BandWidth Estimation) before joining the RTC channel according to their actual bandwidth and bit rate needs, and set the minimum, maximum, and starting value.

  You must call (C API) method or (Java API) method to configure BWE (BandWidth Estimation) before calling (C agora_rtc_join_channelAPI) or joinChannel(Java API) to join the channel , otherwise the call is invalid.agora_rtc_set_bwe_paramsetBweParam

  During bit stream transmission, when the network bandwidth changes, the SDK will trigger a on_target_bitrate_changed(C API) callback or onTargetBitrateChanged(Java API) callback to prompt the application to adjust the sending bit rate in real time. The bit rate returned by the callback is the maximum recommended encoding bit rate of the video encoder.

  See different definition levels of a webcam (Link to reference section)
  
  According to the configuration in the above table, the minimum value can be set to 400 kbps, and the maximum value can be set to 4200 kbps. The initial value is the initial callback value of bandwidth detection, the actual setting is between the minimum value and the maximum value, generally set to the code rate of normal encoding. If the initial encoding file is the SD file in the above table, the initial value can be set to 500 kbps.

  The sender will continue to detect the available bandwidth, and notify the application of the current available bandwidth through a on_target_bitrate_changed callback . The application code needs to follow the code rate to avoid sending at an excessive code rate, causing problems such as freezes.

  The sample code is as follows:

  ```java
  // Add Code here
  ```

  - **onTargetBitrateChanged**

    Encoder code rate update notification callback. You can use this callback to remind the app to update the encoder bit rate.

- **Change audio and video streaming status**

  After the user successfully connects to the Connection and starts audio and video streaming, he can suspend sending streams to the specified Connection or all Connections, or suspend receiving streams from the specified Connection or all Connections, so as to flexibly adjust the transmission status of audio and video streams.

- **Log files** 

  <Vpd k="SDK"/> provides configuration options that you use to customize the location, content and size of log files containing key data of <Vpd k="SDK"/> operation. When you set up logging, <Vpd k="SDK"/> writes information messages, warnings, and errors regarding activities such as initialization, configuration, connection and disconnection to log files. Log files are useful in detecting and resolving channel quality issues.

The following figure shows the workflow you need to implement to ensure channel quality in your <Vpl k="CLIENT"/>:

![Ensure Channel Quality](/images/common/ensure-channel-quality.png)

## Prerequisites

In order to follow this procedure you must have:

* Implemented the [<Vg k="GET_STARTED"/>](../get-started/get-started-sdk) project for <Vpd k="NAME"/>.

<Prerequisites/>

## Project setup

To create the environment necessary to implement channel quality best practices into your <Vpl k="CLIENT" />, open the [<Vg k="GET_STARTED"/>](../get-started/get-started-sdk) for <Vpd k="NAME"/> project you created previously.

<ProjectSetup />

## Implement best practice to optimize channel quality

This section shows you how to integrate channel quality optimization features of <Vpd k="SDK" /> into your <Vpl k="CLIENT" />, step by step.

<ProjectImplement />

## Test your implementation

To ensure that you have implemented channel quality features into your <Vpl k="CLIENT" />:

1. [Generate a temporary token](../reference/manage-agora-account#generate-a-temporary-token) in <Vg k="CONSOLE" /> .

2. In your browser, navigate to the <Link target="_blank" to="https://webdemo.agora.io/dualStream/index.html"><Vg k="COMPANY" /> dual stream web demo</Link> and update _App ID_, _Channel_, and _Token_ with the values for your temporary token, then click **Join**.

<ProjectTest />

## Reference

This section contains information that completes the information in this page, or points you to documentation that explains other aspects to this product.

Different definition levels of a webcam:

| gear	| resolution	| frame rate	| Bit rate range (kbps) | 
|---|---|---|---| 
| SD	| L1: 640*360	| 15 | 400 ~ 800 |
| hd	| L2: 1280*720	| 15	| 1130 ~ 2260 | 
| ultra hd	| L3: 1920*1080	| 15	| 1130 ~ 4160 | 

<Reference />