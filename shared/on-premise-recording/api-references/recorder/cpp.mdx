## IAgoraMediaRtcRecorder

| API | Description |
|---|---|
|[`initialize`](#initialize-recorder) | Initializes the recorder instance. |
|[`joinChannel`](#joinchannel) | Joins an Agora RTC channel. |
|[`leaveChannel`](#leavechannel) | Leaves the Agora RTC channel. |
|[`enableEncryption`](#enableencryption) | Enables or disables the built-in encryption feature. |
|[`subscribeAllAudio`](#subscribeallaudio) | Subscribes to and records the audio of all remote users in the channel. |
|[`subscribeAllVideo`](#subscribeallvideo) | Subscribes to the video of all remote users in the channel. |
|[`unsubscribeAllAudio`](#unsubscribeallaudio) | Stops subscribing to the audio of all remote users in the channel. |
|[`unsubscribeAllVideo`](#unsubscribeallvideo) | Stops subscribing to the video of all remote users in the channel. |
|[`subscribeAudio`](#subscribeaudio) | Subscribes to and records the audio of a specified remote user in the channel. |
|[`unsubscribeAudio`](#unsubscribeaudio) | Stops subscribing to the audio of a specified remote user in the channel. |
|[`subscribeVideo`](#subscribevideo) | Subscribes to the video of a specified remote user in the channel. |
|[`unsubscribeVideo`](#unsubscribevideo) | Stops subscribing to the video of a specified remote user in the channel. |
|[`setAudioVolumeIndicationParameters`](#setaudiovolumeindicationparameters) | Sets the interval for the [`onAudioVolumeIndication`](#onaudiovolumeindication) callback. |
|[`setVideoMixingLayout`](#setvideomixinglayout) | Sets the layout for mixed video streams. |
|[`setRecorderConfig`](#setrecorderconfig) | Sets the configuration for the recorder instance. |
|[`enableAndUpdateVideoWatermarks`](#enableandupdatevideowatermarks) | Adds watermarks to video streams. |
|[`disableVideoWatermarks`](#disablevideowatermarks) | Disables video watermarks. |
|[`startRecording`](#startrecording) | Starts recording. |
|[`stopRecording`](#stoprecording) | Stops recording. |
|[`startSingleRecordingByUid`](#startsinglerecordingbyuid) | Starts recording based on the user ID. |
|[`stopSingleRecordingByUid`](#stopsinglerecordingbyuid) | Stops recording for the specified user ID. |
|[`setRecorderConfigByUid`](#setrecorderconfigbyuid) | Sets the recording configuration based on the user ID. |
|[`enableAndUpdateVideoWatermarksByUid`](#enableandupdatevideowatermarksbyuid) | Adds watermarks to the video stream of the specified user. |
|[`disableVideoWatermarksByUid`](#disablevideowatermarksbyuid) | Disables watermarks for the video stream of the specified user. |
|[`registerRecorderEventHandle`](#registerrecordereventhandle) | Registers the recorder event handler. |
|[`unregisterRecorderEventHandle`](#unregisterrecordereventhandle) | Unregisters the recorder event handler. |
|[`setGlobalLocalAccessPoint`](#setgloballocalaccesspoint) | Sets the global local access point address in local AP mode. |
|[`renewToken`](#renewtoken) | Renews the Token. |
|[`enableRecorderVideoFrameCapture`](#enablerecordervideoframecapture) | Enables and configures video frame capture for the recorder. |

### initialize recorder

```cpp
virtual int initialize(base::IAgoraService* agora_service, bool enable_mix = true, bool recordEncodedOnly = false) = 0;
```

Initializes the recorder instance.

<Admonition type="caution" title="Note">
- The `recordEncodedOnly` parameter is only valid when `enable_mix` is set to `false`.
- If you set `recordEncodedOnly` to `true`, the watermark feature cannot be used during recording.
</Admonition>

#### Parameters

| Parameter          | Data type                | Description  |
|--------------------|--------------------------|--------------|
| `agora_service`    | `base::IAgoraService*`   | The Agora service object. Make sure it is initialized. See [`IAgoraService`](#iagoraservice).                              |
| `enable_mix`       | `bool`                   | Whether to enable composite recording:<br/>- `true` (default): Enable composite recording.<br/>- `false`: Enable individual stream recording.                                                   |
| `recordEncodedOnly`| `bool`                   | Whether to record only encoded video:<br/>- `true`: Received video will not be decoded and will be recorded in encoded format. Only H264 and H265 are supported.<br/>- `false` (default): Received video will be decoded and re-encoded. |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.  

### joinChannel

```cpp
virtual int joinChannel(const char* token,const char* channelId,const char* userId) = 0;
```

Joins an Agora RTC channel.

#### Parameters

| Parameter   | Data type     | Description           |
|-------------|---------------|-----------------------|
| `token`     | `const char*` | The App ID or Token used for authentication.    |
| `channelId` | `const char*` | Channel name. Must be a string of no more than 64 bytes. Supported characters include:<br/>- All lowercase letters: a to z<br/>- All uppercase letters: A to Z<br/>- All numeric digits: 0 to 9<br/>- Space character<br/>- Punctuation and other symbols, including: `!`,`#`,`$`,`%`,`&`,`(`,`)`,`+`, `-`,`:`,`;`,`<`,`=`,`>`,`.`,`?`,`@`,`[`,`]`,`^`,`_`,`{`,`}`,`~`,`,`,`\|`      |
| `userId`    | `const char*` | The local user ID. If not specified or set to `null`, the SDK automatically assigns a user ID.            |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.  


### leaveChannel

```cpp
virtual int leaveChannel() = 0;
```

Leaves the Agora RTC channel.

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.  



### enableEncryption

```cpp
virtual int enableEncryption(bool enabled, const EncryptionConfig& config) = 0;
```

Enables or disables the built-in encryption feature.

In high-security scenarios, call this method before joining a channel.

All users in the same channel must use the same encryption mode and key. Once all users leave the channel, the encryption key is automatically cleared.

#### Parameters

| Parameter  | Data type                  | Description                                                                 |
|------------|----------------------------|-----------------------------------------------------------------------------|
| `enabled`  | `bool`                     | Whether to enable built-in encryption:<br/>- `true`: Enable.<br/>- `false` (default): Disable. |
| `config`   | `const EncryptionConfig&`  | The encryption configuration. See [`EncryptionConfig`](#encryptionconfig). |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.  



### subscribeAllAudio

```cpp
virtual int subscribeAllAudio() = 0;
```

Subscribes to and records the audio of all remote users in the channel.

This method also automatically subscribes to the audio of users who later join the channel.

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.  



### subscribeAllVideo

```cpp
virtual int subscribeAllVideo(const agora::rtc::VideoSubscriptionOptions& subscriptionOptions) = 0;
```

Subscribes to the video of all remote users in the channel.

This method also automatically subscribes to the video of users who later join the channel.

#### Parameters

| Parameter             | Data type                                     | Description                                                                 |
|-----------------------|-----------------------------------------------|-----------------------------------------------------------------------------|
| `subscriptionOptions` | `const agora::rtc::VideoSubscriptionOptions&` | Video subscription options. See [`VideoSubscriptionOptions`](#videosubscriptionoptions). |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.  



### unsubscribeAllAudio

```cpp
virtual int unsubscribeAllAudio() = 0;
```

Stops subscribing to the audio of all remote users in the channel.

Unless you explicitly call [`subscribeAudio`](#subscribeaudio) or [`subscribeAllAudio`](#subscribeallaudio), this method also stops subscribing to the audio of users who later join the channel.

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.  

### unsubscribeAllVideo

```cpp
virtual int unsubscribeAllVideo() = 0;
```

Stops subscribing to the video of all remote users in the channel.

After calling this method, the SDK stops subscribing to the video streams of all current remote users. Unless you explicitly call [`subscribeVideo`](#subscribevideo) or [`subscribeAllVideo`](#subscribeallvideo), this method also stops subscribing to the video of users who later join the channel.

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.  

### subscribeAudio

```cpp
virtual int subscribeAudio(user_id_t userId) = 0;
```

Subscribes to and records the audio of a specified remote user in the channel.

#### Parameters

| Parameter | Data type    | Description                                                           |
|-----------|--------------|-----------------------------------------------------------------------|
| `userId`  | `user_id_t`  | The user ID of the remote user whose audio you want to subscribe to.  |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.  
  - -2 (`ERR_INVALID_ARGUMENT`): The user does not exist or `userId` is invalid.  



### unsubscribeAudio

```cpp
virtual int unsubscribeAudio(user_id_t userId) = 0;
```

Stops subscribing to the audio of a specified remote user in the channel.

#### Parameters

| Parameter | Data type    | Description                                                              |
|-----------|--------------|--------------------------------------------------------------------------|
| `userId`  | `user_id_t`  | The user ID of the remote user whose audio you want to stop subscribing to. |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.  
  - -2 (`ERR_INVALID_ARGUMENT`): The user does not exist or `userId` is invalid.  



### subscribeVideo

```cpp
virtual int subscribeVideo(user_id_t userId, const VideoSubscriptionOptions& subscriptionOptions) = 0;
```

Subscribes to the video of a specified remote user in the channel.

#### Parameters

| Parameter             | Data type                        | Description                                                                                                                                           |
|-----------------------|----------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------|
| `userId`              | `user_id_t`                      | The user ID of the remote user whose video you want to subscribe to.                                                                                  |
| `subscriptionOptions` | `const VideoSubscriptionOptions&`| Video subscription options, such as subscribing to encoded video only or low-bitrate video. See [`VideoSubscriptionOptions`](#videosubscriptionoptions). |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.  
  - -2 (`ERR_INVALID_ARGUMENT`): The user does not exist or `userId` is invalid.  



### unsubscribeVideo

```cpp
virtual int unsubscribeVideo(user_id_t userId) = 0;
```

Stops subscribing to the video of a specified remote user in the channel.

#### Parameters

| Parameter | Data type    | Description                                                              |
|-----------|--------------|--------------------------------------------------------------------------|
| `userId`  | `user_id_t`  | The user ID of the remote user whose video you want to stop subscribing to. |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.  
  - -2 (`ERR_INVALID_ARGUMENT`): The user does not exist or `userId` is invalid.  

### setAudioVolumeIndicationParameters

```cpp
virtual int setAudioVolumeIndicationParameters(int intervalInMS) = 0;
```

Sets the interval for the [`onAudioVolumeIndication`](#onaudiovolumeindication) callback.

#### Parameters

| Parameter      | Data type | Description                                                                 |
|----------------|-----------|-----------------------------------------------------------------------------|
| `intervalInMS` | `int`     | The time interval between two volume callbacks, in milliseconds (default is 500 ms).<br/>- ≤ 10: Disables the volume indication callback.<br/>- > 10: Sets the interval between callbacks. |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.  



### setVideoMixingLayout

```cpp
virtual int setVideoMixingLayout(const VideoMixingLayout& layout) = 0;
```

Sets the layout for mixed video streams.

#### Parameters

| Parameter | Data type                 | Description                                                                 |
|-----------|---------------------------|-----------------------------------------------------------------------------|
| `layout`  | `const VideoMixingLayout&` | The layout configuration for mixed video streams. See [`VideoMixingLayout`](#videomixinglayout). |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.  



### setRecorderConfig

```cpp
virtual int setRecorderConfig(const media::MediaRecorderConfiguration& config) = 0;
```

Sets the configuration for the recorder instance.

#### Parameters

| Parameter | Data type                               | Description                                                                 |
|-----------|-----------------------------------------|-----------------------------------------------------------------------------|
| `config`  | `const media::MediaRecorderConfiguration&` | The configuration for the recorder instance. See [`MediaRecorderConfiguration`](#mediarecorderconfiguration). |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.  



### enableAndUpdateVideoWatermarks

```cpp
virtual int enableAndUpdateVideoWatermarks(WatermarkConfig* watermark_configs, int num) = 0;
```

Adds watermarks to video streams.

#### Parameters

| Parameter           | Data type         | Description                                                                 |
|---------------------|-------------------|-----------------------------------------------------------------------------|
| `watermark_configs` | `WatermarkConfig*` | Array of watermark configurations. See [`WatermarkConfig`](#watermarkconfig). |
| `num`               | `int`             | Number of watermark configurations.                                         |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.  



### disableVideoWatermarks

```cpp
virtual int disableVideoWatermarks() = 0;
```

Disables video watermarks.

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.  

### startRecording

```cpp
virtual int startRecording() = 0;
```

Starts recording.

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.  



### stopRecording

```cpp
virtual int stopRecording() = 0;
```

Stops recording.

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.  



### startSingleRecordingByUid

```cpp
virtual int startSingleRecordingByUid(user_id_t userId) = 0;
```

Starts recording based on the user ID.

#### Parameters

| Parameter | Data type   | Description                       |
|-----------|-------------|-----------------------------------|
| `userId`  | `user_id_t` | User ID of the user to start recording. |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.  



### stopSingleRecordingByUid

```cpp
virtual int stopSingleRecordingByUid(user_id_t userId) = 0;
```

Stops recording for the specified user ID.

#### Parameters

| Parameter | Data type   | Description                       |
|-----------|-------------|-----------------------------------|
| `userId`  | `user_id_t` | User ID of the user to stop recording. |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.  



### setRecorderConfigByUid

```cpp
virtual int setRecorderConfigByUid(const media::MediaRecorderConfiguration& config, user_id_t userId) = 0;
```

Sets the recording configuration based on the user ID.

#### Parameters

| Parameter | Data type                                  | Description                                                                 |
|-----------|--------------------------------------------|-----------------------------------------------------------------------------|
| `config`  | `const media::MediaRecorderConfiguration&` | The configuration for the recorder instance. See [`MediaRecorderConfiguration`](#mediarecorderconfiguration). |
| `userId`  | `user_id_t`                                | User ID to apply the recording configuration to.                            |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.  

### enableAndUpdateVideoWatermarksByUid

```cpp
virtual int enableAndUpdateVideoWatermarksByUid(WatermarkConfig* watermark_configs, int num, user_id_t userId) = 0;
```

Adds watermarks to the video stream of the specified user.

#### Parameters

| Parameter           | Data type        | Description                                                                 |
|---------------------|-----------------|-----------------------------------------------------------------------------|
| `watermark_configs` | `WatermarkConfig*` | Array of watermark configurations. See [`WatermarkConfig`](#watermarkconfig). |
| `num`               | `int`           | Number of watermark configurations.                                         |
| `userId`            | `user_id_t`     | User ID of the video stream to which you want to add watermarks.            |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.  



### disableVideoWatermarksByUid

```cpp
virtual int disableVideoWatermarksByUid(user_id_t userId) = 0;
```

Disables watermarks for the video stream of the specified user.

#### Parameters

| Parameter | Data type   | Description                                                              |
|-----------|-------------|--------------------------------------------------------------------------|
| `userId`  | `user_id_t` | User ID of the video stream for which you want to disable watermarks.    |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.  



### registerRecorderEventHandle

```cpp
virtual int registerRecorderEventHandle(IAgoraMediaRtcRecorderEventHandler* handler) = 0;
```

Registers the recorder event handler.

#### Parameters

| Parameter | Data type                              | Description                                                                 |
|-----------|----------------------------------------|-----------------------------------------------------------------------------|
| `handler` | `IAgoraMediaRtcRecorderEventHandler*`  | The recorder event handler. See [`IAgoraMediaRtcRecorderEventHandler`](#iagoramediartcrecordereventhandler). |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.  



### unregisterRecorderEventHandle

```cpp
virtual int unregisterRecorderEventHandle(IAgoraMediaRtcRecorderEventHandler* handler) = 0;
```

Unregisters the recorder event handler.

#### Parameters

| Parameter | Data type                              | Description                                                                 |
|-----------|----------------------------------------|-----------------------------------------------------------------------------|
| `handler` | `IAgoraMediaRtcRecorderEventHandler*`  | The recorder event handler. See [`IAgoraMediaRtcRecorderEventHandler`](#iagoramediartcrecordereventhandler). |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.  

### setGlobalLocalAccessPoint

```cpp
virtual int setGlobalLocalAccessPoint(const LocalAccessPointConfiguration& config) = 0;
```

Sets the global local access point address in local AP mode.

Call this method before joining a channel to configure the global local access point address when using local AP mode (which also uses a local proxy). This method affects all recorder instances in the same process and only needs to be called once.

#### Parameters

| Parameter | Data type                           | Description                                                                 |
|-----------|-------------------------------------|-----------------------------------------------------------------------------|
| `config`  | `const LocalAccessPointConfiguration&` | Local access point configuration. See [`LocalAccessPointConfiguration`](#localaccesspointconfiguration). |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.  



### renewToken

```cpp
virtual int renewToken(const char* token) = 0;
```

Renews the Token.

The Token expires after a certain period. You must generate a new Token on your server and call this method to renew it in any of the following cases, or the SDK will disconnect from the channel:
- The [`onError`](#onerror) callback reports error code `ERR_TOKEN_EXPIRED(109)`.
- The [`onTokenPrivilegeWillExpire`](#ontokenprivilegewillexpire) callback is triggered.
- The [`onTokenPrivilegeDidExpire`](#ontokenprivilegedidexpire) callback is triggered.

#### Parameters

| Parameter | Data type   | Description                     |
|-----------|-------------|---------------------------------|
| `token`   | `const char*` | Pointer to the new Token. |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.  



### enableRecorderVideoFrameCapture

```cpp
virtual int enableRecorderVideoFrameCapture(bool enable, const RecorderVideoFrameCaptureConfig& config) = 0;
```

Enables and configures video frame capture for the recorder.

#### Parameters

| Parameter | Data type                          | Description                                                                 |
|-----------|------------------------------------|-----------------------------------------------------------------------------|
| `enable`  | `bool`                             | Whether to enable video frame capture: - `true`: Enable. - `false`: Disable. |
| `config`  | `const RecorderVideoFrameCaptureConfig&` | Video frame capture configuration. See [`RecorderVideoFrameCaptureConfig`](#recordervideoframecaptureconfig). |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.  
