import * as data from '@site/data/variables';
import Prerequites from '@docs/shared/common/prerequities.mdx';
import ProjectSetup from '@docs/shared/video-sdk/develop/real-time-transcription/project-setup/index.mdx';
import ProjectImplement from '@docs/shared/video-sdk/develop/real-time-transcription/project-implementation/index.mdx';
import ProjectTest from '@docs/shared/video-sdk/develop/real-time-transcription/project-test/index.mdx';
import Reference from '@docs/shared/video-sdk/develop/real-time-transcription/reference/index.mdx'; import {
  PlatformWrapper
} from '../../../../src/mdx-components/PlatformWrapper';


Real-Time Transcription takes the audio content of a host's media stream and transcribes it into written words in real time. This page explains how to start and stop speech recognition in your <Vpl k="CLIENT" />, then download and present the transcript.

## Understand the tech

To start transcription in real time, you send an `HTTP` request to the <Vg k="AGORA_BACKEND" />  through your business server. Real-Time Transcription provides the following modes:

* Transcribe speech in real time, then stream this data to the channel.
* Transcribe speech in real time, store the text in the `WebVTT` format, and upload the file to third-party cloud storage.

In order to use the RESTful API to transcribe speech, take the following steps:

1. Call `acquire`: Request a `builderToken` for transcription. Each `buildToken` is valid for 5 minutes.
1. Call `start`: Begin the transcription task. You must call `start` within five minutes of receiving the `builderToken`.
1. Call `query`: Check the task status.
1. Call `stop`: Stop the transcription task.

The following figure shows the workflow to integrate the real-time transcription functionality into your <Vpl k="CLIENT" />:

![Real-Time Transcription](/images/video-sdk/real-time-transcription.svg)

## Prerequisites

In order to follow this procedure you must have:

* Implemented <Link to="../get-started/get-started-sdk">Get Started with <Vpd k="NAME"/></Link>
* Enabled Real-Time Transcription for your project. Contact sales@agora.io
* Activated a [supported cloud storage service](#supported-third-party-cloud-storage-services) to record and store Real-Time Transcription videos and texts


## Project setup

To create the environment necessary to play media files in your <Vpl k="CLIENT" />, open the project you created in <Link to="../get-started/get-started-sdk">Get Started with <Vpd k="NAME"/></Link>.

<ProjectSetup />

## Implement Real-Time Transcription in your <Vpl k="CLIENT" />

This section shows how to create a user interface, handle the system logic, and manage a transcription task in your <Vpl k="CLIENT" />, step-by-step.

**Caution:** The code provided in this section is for demonstration purposes only. <Vg k="COMPANY" /> does not recommend hardcoding the customer secret in the <Vpl k="CLIENT" />. Best practice is to [Implement a business server](#implement-a-business-server) to manage your Real-Time Transcription tasks.

<ProjectImplement />

## Test your implementation

To ensure that you have implemented Real-Time Transcription features into your <Vpl k="CLIENT" />:

1. [Generate a temporary token](../reference/manage-agora-account#generate-a-temporary-token) in <Vg k="CONSOLE" />.

2. In your browser, navigate to the <Link target="_blank" to="{{Global.DEMO_BASIC_VIDEO_CALL_URL}}"><Vg k="COMPANY" /> web demo</Link> and update _App ID_, _Channel_, and _Token_ with the values for your temporary token, then click **Join**.

<ProjectTest />


## Reference

This section contains information that completes the information in this page, or points you to documentation that explains other aspects to this product.

### REST API reference

Refer to the Real-Time Transcription [REST API documentation](https://documenter.getpostman.com/view/26273535/2s93JtRPzX) for parameter details. Click **Run in Postman** to import the API collection for testing and to obtain sample code for your platform.

### Implement a business server

Implementing a business server (API Server) for managing your Real-Time Transcription tasks provides the following benefits:

* Improved security as your `apiKey`, `apiSecret`, `builderToken`, and `taskId`, are not exposed to the client.
* Token processing is securely handled on the API Server.
* Avoid splicing complex request body strings on the client side to reduce the probability of errors.
* Implement additional functionality on the API Server, such as billing for the use of Real-Time transcription, and checking the privileges, and payment status of the user.
* If the REST API is updated, you do not need to update the client.

The following figure shows how the API Server acts as a bridge between your client and the <Vg k="COMPANY"/> real-time transcription API Server:

![Real-Time Transcription API Server](/images/video-sdk/real-time-transcription-server.svg)



### Synchronizing real-time transcription files with cloud recording

The `m3u8+vtt` file generated by real-time transcription, and the `m3u8+ts` file generated by [Cloud Recording](..\..\..\cloud-recording\overview/product-overview.mdx) are two independent files. The time stamp references of the media files are different, and not synchronized. The cloud recording time stamp starts at 0, and `m3u8+vtt` uses the system time stamp. Furthermore, if either process starts abnormally, it may cause the playback of media files generated by the two services to be out of sync.

Post-processing ensures synchronization of subtitles and recorded audio. It enables you to associate the `m3u8+ts` file generated by cloud recording with the `m3u8+vtt` file generated by real-time transcription.

<Vg k="COMPANY" /> provides a post-processing script that enables you to synchronize the two files.

#### Prerequisites

To run the post-processing script, make sure that:

* Python 3.0 or higher is installed on your system.
* [`ffmpeg`](https://ffmpeg.org/download.html) and `ffplay` are installed. 

#### Run the post-processing script

To set up the post-processing script, take the following steps:

1. [Download](https://github.com/AgoraIO/Docs-Source/files/10931258/add_webvtt.zip) the project.

1. Unzip the project into a folder.

1. To see help options, run the following command:

   ```shell
   python3 insert_subtitle.py -h
   ```

1. Run the script by executing the following command:

   ```shell
   python3 insert_subtitle.py --av  audio_dir/audio_ts.m3u8  --subtitle  subtitle_dir/subtitle.m3u8 --output  output_dir/  --overwrite 
   ```

   If the directory, where the `ffmpeg/ffprob` command-line program is installed is not in the system path, use `–ffmpeg_path` to specify the path.

1. Start the HTTP server by running the following command:

   ```shell
   python3 -m http.server --bind 127.0.0.1 -d output_dir
   ```

1. To play the file in your browser, enter the following URL: 
   
   ```
   http://127.0.0.1:8000/player_demo.html
   ```

### List of supported languages

| Language                         | Code*  | 
| -------------------------------- | ----- |
| Chinese (Cantonese, Traditional) | zh-HK |
| Indonesian (Indonesia)           | id-ID |
| Arabic (Jordan)                  | ar-JO |
| Arabic (Egyptian)                | ar-EG |
| Arabic (Saudi Arabia)            | ar-SA |
| Arabic (United Arab Emirates)    | ar-AE |
| Chinese (Taiwanese Putonghua)    | zh-TW |
| English(US)                      | en-US |
| English (India)                  | en-IN |
| Hindi (India)                    | hi-IN |
| Korean (South Korea)             | ko-KR |
| Japanese (Japan)                 | ja-JP |
| German (Germany)                 | de-DE |
| Spanish (Spain)                  | es-ES |
| French (French)                  | fr-FR |
| Italian (Italy)                  | it-IT |
| Chinese (Mandarin, Simplified)   | zh-CN |
| Portuguese (Portugal)            | pt-PT |

*Use Code in request body of Start API

### Supported third-party cloud storage services

The following third-party cloud storage service providers are supported:

* [Alibaba Cloud](https://www.alibabacloud.com/product/oss)
* [Amazon S3](https://aws.amazon.com/s3/?nc1=h_ls)
* [Baidu AI Cloud](https://intl.cloud.baidu.com/product/bos.html)
* [Google Cloud](https://cloud.google.com/storage)
* [Huawei Cloud](https://www.huaweicloud.com/intl/en-us/product/obs.html)
* [Kingsoft Cloud](https://en.ksyun.com/nv/product/KS3.html)
* [Microsoft Azure](https://azure.microsoft.com/en-us/services/storage/blobs/)
* [Qiniu Cloud](https://www.qiniu.com/en/products/kodo)
* [Tencent Cloud](https://intl.cloud.tencent.com/product/cos)

<Reference />