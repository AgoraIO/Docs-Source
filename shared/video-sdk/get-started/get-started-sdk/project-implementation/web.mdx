
<PlatformWrapper platform="web">

Best practice is to separate the <Vpd k="NAME" /> workflows from your UI implementation. The <Vpd  k="SDK" />
  sample project implements <Vpd k="PRODUCT" /> logic in the
  [AgoraManager](https://github.com/AgoraIO/video-sdk-samples-js/blob/vsdk-v1/src/agora_manager/agora_manager.js) component.
  This encapsulates the `RTCEngine` instance and core functionality as illustrated by the excerpts below:

### Implement the channel logic

The following figure shows the <Vpd k="PRODUCT" /> API call sequence.

<ProductWrapper product="video-calling">
![Interface](/images/video-sdk/video-call-logic-web.png)
</ProductWrapper>
<ProductWrapper product={["interactive-live-streaming", "broadcast-streaming"]}>
![Interface](/images/video-sdk/ils-call-logic-web.svg)
</ProductWrapper>

To implement this logic, you need to take the following steps:

1. **Import the <Vpd k="SDK" /> classes and interfaces**:

    ``` javascript
    import AgoraRTC from "agora-rtc-sdk-ng";
    import config from "./config.json";
    ```

1.  Create an instance of the <Vg k="ENGINE" />. Call <Link target="_blank" to="{{global.API_REF_WEB_ROOT}}/interfaces/iagorartc.html#createclient">AgoraRTC.createClient</Link>.

    ``` javascript
    const AgoraRTCManager = async (eventsCallback) => {
        let agoraEngine = null;

        // Set up the signaling engine with the provided App ID, UID, and configuration
        const setupAgoraEngine = async () => {
            agoraEngine = new AgoraRTC.createClient({ mode: "rtc", codec: "vp9" });
        };

        await setupAgoraEngine();

        const getAgoraEngine = () => {
            return agoraEngine;
        };
    };
    ```

1.  To connect to a <Vpd k="PRODUCT" /> channel:

    1. Call <Link target="_blank" to="{{global.API_REF_WEB_ROOT}}/interfaces/iagorartcclient.html#join">join</Link> and pass the App ID, user ID, token, and channel name.
    1.  Call   <Link target="_blank" to="{{global.API_REF_WEB_ROOT}}/interfaces/iagorartc.html#createmicrophoneaudiotrack">createMicrophoneAudioTrack</Link> to create a audio track.
    1.  Call   <Link target="_blank" to="{{global.API_REF_WEB_ROOT}}/interfaces/iagorartc.html#createcameravideotrack">createCameraVideoTrack</Link> to create a video track.
    1.  Publish audio and video tracks in the channel by calling   <Link target="_blank" to="{{global.API_REF_WEB_ROOT}}/interfaces/iagorartcclient.html#publish">publish</Link>.

    ``` javascript
    const join = async (localPlayerContainer, channelParameters) => {
        await agoraEngine.join(
        config.appId,
        config.channelName,
        config.token,
        config.uid
        );
        // Create a local audio track from the audio sampled by a microphone.
        channelParameters.localAudioTrack =
        await AgoraRTC.createMicrophoneAudioTrack();
        // Create a local video track from the video captured by a camera.
        channelParameters.localVideoTrack = await AgoraRTC.createCameraVideoTrack();
        // Append the local video container to the page body.
        document.body.append(localPlayerContainer);
        // Publish the local audio and video tracks in the channel.
        await getAgoraEngine().publish([
        channelParameters.localAudioTrack,
        channelParameters.localVideoTrack,
        ]);
        // Play the local video track.
        channelParameters.localVideoTrack.play(localPlayerContainer);
    };
    ```

1.  When a remote user joins the channel, this <Vpl k="CLIENT" />:

    1.  Listens for a `client.on("user-published")` event which returns a   <Link target="_blank" to="{{global.API_REF_WEB_ROOT}}/interfaces/iagorartcremoteuser.html">IAgoraRTCRemoteUser</Link> object and a string. The string is used to indicate the type of track which can be either `audio` or `video`.
    1.  Retrieves the remote audio or audio/video track using the   <Link target="_blank" to="{{global.API_REF_WEB_ROOT}}/interfaces/iagorartcremoteuser.html">IAgoraRTCRemoteUser</Link> object.
    1.  Play the retrieved tracks by calling  <Link target="_blank" to="{{global.API_REF_WEB_ROOT}}/interfaces/iremoteaudiotrack.html#play">play</Link>.

To implement this logic in your <Vpl k="CLIENT" />, add the following code after `await setupAgoraEngine();`:

<ProductWrapper product="video-calling">
    ``` javascript
    // Event Listeners
    agoraEngine.on("user-published", async (user, mediaType) => {
        // Subscribe to the remote user when the SDK triggers the "user-published" event.
        await agoraEngine.subscribe(user, mediaType);
        console.log("subscribe success");
        eventsCallback("user-published", user, mediaType)
    });

    // Listen for the "user-unpublished" event.
    agoraEngine.on("user-unpublished", (user) => {
        console.log(user.uid + "has left the channel");
    });
    ```

The `eventsCallback` callback can be used by the UI to handle all events. The sample project uses the following callback:

    ``` javascript
    const handleVSDKEvents = (eventName, ...args) => {
        switch (eventName) {
        case "user-published":
            if (args[1] == "video") {
            // Retrieve the remote video track.
            channelParameters.remoteVideoTrack = args[0].videoTrack;
            // Retrieve the remote audio track.
            channelParameters.remoteAudioTrack = args[0].audioTrack;
            // Save the remote user id for reuse.
            channelParameters.remoteUid = args[0].uid.toString();
            // Specify the ID of the DIV container. You can use the uid of the remote user.
            remotePlayerContainer.id = args[0].uid.toString();
            channelParameters.remoteUid = args[0].uid.toString();
            remotePlayerContainer.textContent =
                "Remote user " + args[0].uid.toString();
            // Append the remote container to the page body.
            document.body.append(remotePlayerContainer);
            // Play the remote video track.
            channelParameters.remoteVideoTrack.play(remotePlayerContainer);
            }
            // Subscribe and play the remote audio track If the remote user publishes the audio track only.
            if (args[1] == "audio") {
            // Get the RemoteAudioTrack object in the AgoraRTCRemoteUser object.
            channelParameters.remoteAudioTrack = args[0].audioTrack;
            // Play the remote audio track. No need to pass any DOM element.
            channelParameters.remoteAudioTrack.play();
            }
        }
    };
    ```
</ProductWrapper>

</PlatformWrapper>
