import Source from './csharp.mdx'

<PlatformWrapper platform="unity">

### Implement the user interface

To implement call quality features in your <Vpl k="CLIENT" />, you need the following elements in the user interface:

* Two buttons, one to switch video quality and the other one to test your audio and video devices.

* A label to display last-mile network quality.

* Two dropdowns to show the available audio and video devices.

To add these elements to the UI, take the following steps:

    1. Right-click **Canvas**, then click **UI** > **Button - TextMeshPro**. A button appears in the **Scene** Canvas.

    1. In **Inspector**, rename **Button** to `videoQuality`, then change the following coordinates:

        * **Pos X** - 350
        * **Pos Y** - 172
        
    1. Select the **Text (TMP)** sub-item under **videoQuality** in the **Inspector**. Then, change the `Text` setting to `Low Video Quality`

    1. Repeat the same procedure and create a button called `testDevices`, then change the following coordinates:

        * **Pos X** - 162
        * **Pos Y** - -172
        * **Width** - 210

    1. Select the **Text(TMP)** sub-item of **testDevices** in the **Inspector**. Then, change the **Text** setting to `Start device testing`.

    1. Right-click **Canvas**, then click **UI** > **Text - TextMeshPro**. A label appears in the **Scene** Canvas.

    1. In **Inspector**, rename **Text(TMP)** to **networkStatus**, then set the **Pos Y** coordinate to `160`.

    1. Right-click **Canvas**, then click **UI** > **Dropdown - TextMeshPro**. A dropdown appears in the **Scene** Canvas.

    1. In **Inspector**, rename **Dropdown** to `audioDevices`. Then, change the following coordinates:

        * **Pos X** - -184
        * **Pos Y** - -172
    
    1. Repeat the same procedure and add one more dropdown called `videoDevices`. Then, change the following coordinates in the **Inspector**:
    
        * **Pos X** - -23
        * **Pos Y** - -172

### Handle the system logic

1. **Add the required libraries**

    To reference the UI elements and access Win32 API in your ample code, in your script file, add the following to the list of namespaces:
    
    ```csharp
    using TMPro;
    using System.Runtime.InteropServices;
    using System;
    ```

1. **Define variables to manage test state and workflow**

    In your script file, add the following declarations to `NewBehaviourScript`:

    ```csharp
    private TMP_Text networkStatus; // A label to display the network quality.
    private TMP_Text videoQualityBtnText; // For changing the button text programmatically.
    private bool highQuality = false; // For switching between high and low video quality.
    private IAudioDeviceManager _audioDeviceManager;  // To manage audio devices.
    private IVideoDeviceManager _videoDeviceManager; // To manage video devices.
    private DeviceInfo[] _audioRecordingDeviceInfos; // Represent information about audio recording devices.
    private DeviceInfo[] _audioPlaybackDeviceInfos; // Represent information about audio playback devices.
    private DeviceInfo[] _videoDeviceInfos; // Represent information about video devices.
    private TMP_Dropdown videoDevices; // To access the video devices dropdown.
    private TMP_Dropdown audioDevices; // To access the audio devices dropdown.
    private bool isTestRunning = false; // To track the device test state.
    ```

1. **Update the network status indication in the UI**

    To show the network quality result visually to the user, in your script file, add the following to `NewBehaviourScript`:

    ```csharp
    private void updateNetworkStatus(int quality)
    {  
        if (quality > 0 && quality < 3) 
        {
            networkStatus.text = "Network Quality: Perfect";
            networkStatus.color = Color.green;
        }
        else if (quality <= 4) 
        {
            networkStatus.text = "Network Quality: Good";
            networkStatus.color = Color.yellow;
        }
        else if (quality <= 6) 
        {
            networkStatus.text = "Network Quality: Poor";
            networkStatus.color = Color.red;
        }
        else 
        {
            networkStatus.color = Color.white;
        }
    }
    ```

    To programmatically access the UI elements, add the following at the end of `SetupUI`:

    ```csharp
    // Access the video quality button.
    go = GameObject.Find("videoQuality");
    // Access the label of the video quality button.
    videoQualityBtnText = go.GetComponentInChildren<TextMeshProUGUI>(true);
    // Change the video quality button text and font size.
    videoQualityBtnText.text = "Low Video Quality";
    videoQualityBtnText.fontSize = 14;
    // Set an event listener on the video quality button.
    go.GetComponent<Button>().onClick.AddListener(setStreamQuality);
    // Access the network quality label.
    networkStatus = GameObject.Find("networkStatus").GetComponent<TextMeshProUGUI>();
    // Change the label text and size.
    networkStatus.text  = "Network Quality:";
    networkStatus.fontSize = 14;
    go = GameObject.Find("testDevices");
    go.GetComponent<Button>().onClick.AddListener(testAudioAndVideoDevice);
    TMP_Text testBtnText = go.GetComponentInChildren<TextMeshProUGUI>(true);
    testBtnText.fontSize = 14;  
    ```

### Implement features to ensure quality

<Source />

</PlatformWrapper>
