<PlatformWrapper platform="android">

### Metadata API

Use the following metadata API to implement your <Vpd k="PRODUCT" /> solution:

**Class `RtmMetadataItem`**

**Description**

Creates an `RtmMetadataItem` instance.

**Basic Use**

```java
RtmMetadataItem item1 = new RtmMetadataItem("mode", "emo");
```

**Response**

Returns a `RtmMetadataItem` instance, The `RtmMetadataItem` is a basic unit item of user metadata and channel metadata, it contains the following properties:

| Property Name                     | Type     | Description                                                         |
| --------------------------------- | -------- | ------------------------------------------------------------------- |
| `void setKey(String key)`         | function | Set key for current `RtmMetadataItem`                               |
| `String getKey()`                 | function | Get key for current `RtmMetadataItem`                               |
| `void setValue(String value)`     | function | Set value for current `RtmMetadataItem`                             |
| `String getValue()`               | function | Get value for current `RtmMetadataItem`                             |
| `void setRevision(long revision)` | function | Set revision for current `RtmMetadataItem`                          |
| `long getRevision()`              | function | Get revision  for current `RtmMetadataItem`                         |
| `long getLastUpdateTs()`          | function | Get updated time for current `RtmMetadataItem`                      |
| `String getAuthorUserId()`        | function | Get the uid of who update this record for current `RtmMetadataItem` |

#### User Metadata

#### Get User Metadata

**Description**

Gets all `RtmMetadataItem`s of a specified user.

**Method**

```java
void getUserMetadata(String userId, ResultCallback<RtmMetadata> resultCallback)
```

| Parameter        | Type     | Required | Default | Description             |
|:----------------:|:--------:|:--------:|:-------:|:-----------------------:|
| `userId`         | String   | yes      |         | Unique user identifier. |
| `resultCallback` | function | yes      |         | callback function       |

**Basic Use**

```java
mRtmClient.getUserMetadata("Tony", new ResultCallback<RtmMetadata>(){
    @Override
    public void onSuccess(RtmMetadata userMetadata){
        // process success result!
    }
    @Override
    public void onFailure(int errorInfo){
        // process failure result!
    }   
});
```

**Response**

Returns  a type `RtmMetadata`   for the specific `uid` which contains the following properties:

| Property Name   | Type                     | Description                                                                                                                     |
|:---------------:|:------------------------:|:------------------------------------------------------------------------------------------------------------------------------- |
| `items`         | `List<RtmMetadataItem>` | `RtmMetadataItem` type array which contains a single Key-Value metadata for user |
| `majorRevision` | number                   | The major revision for this user metadata                                                                                       |

#### Set User Metadata

**Description**

Sets the local user’s metadata.

**Method**

```java
void setLocalUserMetadata(List<RtmMetadataItem> items, RtmMetadataOptions options, ResultCallback<Void> resultCallback)
```

| Property Name    | Type                     | Description                                                                                                                    |
|:----------------:|:------------------------:|:------------------------------------------------------------------------------------------------------------------------------ |
| `items`          | `List<RtmMetadataItem>` | `RtmMetadataItem` type list which contains a single Key-Value metadata for user |
| `options`        | `RtmMetadataOptions`     | Optional properties for current user Metadata                        |
| `resultCallback` | function                 | callback function                                                                                                              |

The `RtmMetadataOptions` is a set of optional properties for operations, it contains the following properties:

| Property Name        | Type   | Description                                                                                                                         |
| -------------------- | ------ | ----------------------------------------------------------------------------------------------------------------------------------- |
| `majorRevision`      | number | Revision control parameters. when the `majorRevision` you supplied is same as the one in the storage, this operation will succeed. |
| `enableRecordTs`     | bool   | When set to `true`, the final `RtmMetadataItem` will record the update time automatically                                   |
| `enableRecordUserId` | bool   | When set to `true`, the final `RtmMetadataItem` will record who updated this item automatically                          |

**Basic Use**

```java
RtmMetadataItem item1 = new RtmMetadataItem("mode", "emo");
RtmMetadataItem item2 = new RtmMetadataItem("gender", "male");
ArrayList<RtmMetadataItem> metadata = new ArrayList<RtmMetadataItem>();
metadata.add(item1);
metadata.add(item2);
RtmMetadataOptions options = new RtmMetadataOptions(-1, ture, false);
mRtmClient.setLocalUserMetadata(metadata, options, new ResultCallback<Void>() {
    @Override
    public void onSuccess(Void unused) {
        visualLog_CALLBACK( "setLocalUserMetadata onSuccess");
    }

    @Override
    public void onFailure(ErrorInfo errorInfo) {
        visualLog_CALLBACK( "setLocalUserMetadata onFailure, error: " + errorInfo.toString());
    }
});
```

**Response**

None


#### Add User Metadata

**Description**

Adds metadata items to local user’s metadata.

**Method**

```javascript
void addLocalUserMetadata(List<RtmMetadataItem> items, RtmMetadataOptions options, ResultCallback<Void> resultCallback);
```

| Property Name    | Type                      | Description                                                                                                                     |
|:----------------:|:-------------------------:|:------------------------------------------------------------------------------------------------------------------------------- |
| `items`          | `List<RtmMetadataItem>` | `RtmMetadataItem` type array which contains a single Key-Value metadata for user |
| `options`        | `RtmMetadataOptions`      | Optional properties for current user Metadata                           |
| `resultCallback` | function                  | callback function                                                                                                               |

**Basic Use**

```java
RtmMetadataItem item1 = new RtmMetadataItem("mode", "emo");
RtmMetadataItem item2 = new RtmMetadataItem("gender", "male");
ArrayList<RtmMetadataItem> metadata = new ArrayList<RtmMetadataItem>();
metadata.add(item1);
metadata.add(item2);
RtmMetadataOptions options = new RtmMetadataOptions(-1, ture, false);
mRtmClient.addLocalUserMetadata(metadata, options, new ResultCallback<Void>() {
    @Override
    public void onSuccess(Void unused) {
        visualLog_CALLBACK( "addLocalUserMetadata onSuccess");
    }

    @Override
    public void onFailure(ErrorInfo errorInfo) {
        visualLog_CALLBACK( "addLocalUserMetadata onFailure, error: " + errorInfo.toString());
    }
});
```

**Response**

None

This operation will add new metadata items for the current user. It reports errors if the key of the new `RtmMetadataItem` already exists in user metadata.

#### Clear User Metadata

**Description**

Deletes all the local user’s metadata items.

Method

```java
void clearLocalUserMetadata(RtmMetadataOptions options, ResultCallback<Void> resultCallback)
```

| Property Name    | Type                 | Description                                                                                         |
|:----------------:|:--------------------:|:--------------------------------------------------------------------------------------------------- |
| `options`        | `RtmMetadataOptions` | Optional properties for current user Metadata |
| `resultCallback` | function             | callback function                                                                                   |

**Basic Use**

```java
RtmMetadataOptions options = new RtmMetadataOptions(-1, ture, false);
mRtmClient.clearLocalUserMetadata(options, new ResultCallback<Void>() {
    @Override
    public void onSuccess(Void unused) {
        visualLog_CALLBACK( "clearLocalUserMetadata onSuccess");
    }

    @Override
    public void onFailure(ErrorInfo errorInfo) {
        visualLog_CALLBACK( "clearLocalUserMetadata onFailure, error: " + errorInfo.toString());
    }
});
```

**Response**

None


#### Update User Metadata

**Description**

Updates the local user’s metadata items.

Method

```java
void updateLocalUserMetadata(List<RtmMetadataItem> items, RtmMetadataOptions options, ResultCallback<Void> resultCallback)
```

| Property Name    | Type                     | Description                                                                                                                     |
|:----------------:|:------------------------:|:------------------------------------------------------------------------------------------------------------------------------- |
| `items`          | `List<RtmMetadataItem>` | `RtmMetadataItem` type array which contains a single Key-Value metadata for user |
| `options`        | `RtmMetadataOptions`     | Optional properties for current user Metadata                           |
| `resultCallback` | function                 | callback function                                                                                                               |

**Basic Use**

```java
RtmMetadataItem item1 = new RtmMetadataItem("mode", "emo");
RtmMetadataItem item2 = new RtmMetadataItem("gender", "male");
ArrayList<RtmMetadataItem> metadata = new ArrayList<RtmMetadataItem>();
metadata.add(item1);
metadata.add(item2);
RtmMetadataOptions options = new RtmMetadataOptions(-1, ture, false);
mRtmClient.updateLocalUserMetadata(metadata, options, new ResultCallback<Void>() {
    @Override
    public void onSuccess(Void unused) {
        visualLog_CALLBACK( "updateLocalUserMetadata onSuccess");
    }

    @Override
    public void onFailure(ErrorInfo errorInfo) {
        visualLog_CALLBACK( "updateLocalUserMetadata onFailure, error: " + errorInfo.toString());
    }
});
```

**Response**

None

This operation is only valid for updating existing metadata items or it will report errors.

#### Delete User Metadata

**Description**

Deletes the local user’s metadata items.

**Method**

```java
void deleteLocalUserMetadata(List<RtmMetadataItem> items, RtmMetadataOptions options, ResultCallback<Void> resultCallback)
```

| Property Name    | Type                      | Description                                                                                                                     |
|:----------------:|:-------------------------:|:------------------------------------------------------------------------------------------------------------------------------- |
| `items`          | `List<RtmMetadataItem>` | `RtmMetadataItem` type array which contains a single Key-Value metadata for user |
| `options`        | `RtmMetadataOptions`      | Optional properties for current user Metadata                           |
| `resultCallback` | function                  | callback function                                                                                                               |

**Basic Use**

```java
RtmMetadataItem item1 = new RtmMetadataItem("mode", "");
RtmMetadataItem item2 = new RtmMetadataItem("gender", "");
ArrayList<RtmMetadataItem> metadata = new ArrayList<RtmMetadataItem>();
metadata.add(item1);
metadata.add(item2);
RtmMetadataOptions options = new RtmMetadataOptions(-1, ture, false);
mRtmClient.deleteLocalUserMetadata(metadata, options, new ResultCallback<Void>() {
    @Override
    public void onSuccess(Void unused) {
        visualLog_CALLBACK( "deleteLocalUserMetadata onSuccess");
    }

    @Override
    public void onFailure(ErrorInfo errorInfo) {
        visualLog_CALLBACK( "deleteLocalUserMetadata onFailure, error: " + errorInfo.toString());
    }
});
```

**Response**

None

#### Subscribe User Metadata

**Description**

Subscribe to user metadata update events for s specific user.

**Method**

```java
void subscribeUserMetadata(String userId, ResultCallback<Void> resultCallback);
```

| Parameter        | Type     | Required | Default | Description             |
|:----------------:|:--------:|:--------:|:-------:|:-----------------------:|
| `userId`         | String   | yes      |         | Unique user identifier. |
| `resultCallback` | function | yes      |         | callback function       |

**Basic Use**

```java
mRtmClient.subscribeUserMetadata("Tony", new ResultCallback<Void>() {
    @Override
    public void onSuccess(Void unused) {
        visualLog_CALLBACK( "subscribeUserMetadata onSuccess");
    }

    @Override
    public void onFailure(ErrorInfo errorInfo) {
        visualLog_CALLBACK( "subscribeUserMetadata onFailure, error: " + errorInfo.toString());
    }
});
```

**Response**

None

#### Unsubscribe User Metadata

**Description**

Unsubscribe to user metadata update events for a specific user.

**Method**

```java
void unsubscribeUserMetadata(String userId, ResultCallback<Void> resultCallback)
```

| Parameter        | Type     | Required | Default | Description             |
|:----------------:|:--------:|:--------:|:-------:|:-----------------------:|
| `userId`         | String   | yes      |         | Unique user identifier. |
| `resultCallback` | function | yes     |         | callback function       |

**Basic Use**

```java
mRtmClient.unsubscribeUserMetadata("Tony", new ResultCallback<Void>() {
    @Override
    public void onSuccess(Void unused) {
        visualLog_CALLBACK( "unsubscribeUserMetadata onSuccess");
    }

    @Override
    public void onFailure(ErrorInfo errorInfo) {
        visualLog_CALLBACK( "unsubscribeUserMetadata onFailure, error: " + errorInfo.toString());
    }
});
```

**Response**

None

#### User Metadata Event

**Description**

This event occurs when a user's metadata is updated using `Add`, `Set`, `Clear`, `Update`, or `Delete` functions. You need to implement this procedure yourself, to handle metadata events for user's you have subscribed to.

**Method**

```java
void onUserMetadataUpdated(String userId, RtmMetadata data)
```

**Basic Use**

```java
class RtmClientListener implements RtmClientListener {
  //..
  @Override
  public void onUserMetadataUpdated(String userId, RtmMetadata data) {
      visualLog_CALLBACK("onUserMetadataUpdated, userId: " + userId);
      for (RtmMetadataItem item: data.items) {
          visualLog("Item key: " + item.getKey() + ", value: " + item.getValue()
                  + ", revision: " + item.getRevision() + ", ts: " + item.getLastUpdateTs()
                  + ", uid: " + item.getAuthorUserId());
      }
  }
  //..
}

rtmClient = RtmClient.createInstance(context, appId, new RtmClientListener());
```

**Response**

When this event occurs, you receive a uid that indicates the user whose metadata has changed, and an `RtmMetadata` object for the user which contains the following properties:

| Property Name   | Type                       | Description                                                                      |
|:---------------:|:--------------------------:| -------------------------------------------------------------------------------- |
| `items`         | Array( `RtmMetadataItem` ) | `RtmMetadataItem` type array which contains a single Key-Value metadata for user |
| `majorRevision` | number                     | The major revision for this user metadata                                        |

The returned object contains the complete data of the current user, `Add`/`Set`/`Clear`/`Update`/`Delete` operations all trigger this event.

#### Channel Metadata

#### Set Channel Metadata

**Description**

Set the metadata of the channel.

**Method**

```java
void setChannelMetadata(List<RtmMetadataItem> items, RtmMetadataOptions options, ResultCallback<Void> resultCallback)
```

| Property Name    | Type                    | Description                                                                                                                        |
|:----------------:|:-----------------------:|:---------------------------------------------------------------------------------------------------------------------------------- |
| `items`          | `List<RtmMetadataItem>` | `RtmMetadataItem` type array which contains a single Key-Value metadata for channel |
| `options`        | `RtmMetadataOptions`    | Optional properties for current channel Metadata                        |
| `resultCallback` | function                | callback function                                                                                                                  |

The `RtmMetadataOptions` is a set of optional properties for operations; it contains the following properties:

| Property Name        | Type   | Description                                                                                                                         |
| -------------------- | ------ | ----------------------------------------------------------------------------------------------------------------------------------- |
| `majorRevision`      | number | Revision control parameters. When the `majorRevision` is the same as the one in the storage, this operation will succeed. |
| `enableRecordTs`     | bool   | When set to `true`, the final  `RtmMetadataItem` will record the update time, automatically                                  |
| `enableRecordUserId` | bool   | When set to `true`, the final `RtmMetadataItem` will record who updated this item, automatically                          |

**Basic Use**

```java
RtmMetadataItem item1 = new RtmMetadataItem("Announcement", "Welcome to RTM");
RtmMetadataItem item2 = new RtmMetadataItem("Channel_type", "Public");
ArrayList<RtmMetadataItem> metadata = new ArrayList<RtmMetadataItem>();
metadata.add(item1);
metadata.add(item2);
RtmMetadataOptions options = new RtmMetadataOptions(-1, ture, false);
mRtmChannel.setChannelMetadata(metadata, options, new ResultCallback<Void>() {
    @Override
    public void onSuccess(Void unused) {
        visualLog_CALLBACK( "setChannelMetadata onSuccess");
    }

    @Override
    public void onFailure(ErrorInfo errorInfo) {
        visualLog_CALLBACK( "setChannelMetadata onFailure, error: " + errorInfo.toString());
    }
});
```

**Response**

None

#### Add Channel Metadata

**Description**

Adds new metadata items to the channel.

**Method**

```java
void addChannelMetadata(List<RtmMetadataItem> items, RtmMetadataOptions options, ResultCallback<Void> resultCallback)
```

| Property Name    | Type                      | Description                                                                                                                        |
|:----------------:|:-------------------------:|:---------------------------------------------------------------------------------------------------------------------------------- |
| `items`          | `List<(RtmMetadataItem>` | `RtmMetadataItem` type array which contains a single Key-Value metadata for channel |
| `options`        | `RtmMetadataOptions`      | Optional properties for current channel Metadata,                              |
| `resultCallback` | function                  | callback function                                                                                                                  |

**Basic Use**

```java
RtmMetadataItem item1 = new RtmMetadataItem("Announcement", "Welcome to RTM");
RtmMetadataItem item2 = new RtmMetadataItem("Channel_type", "Public");
ArrayList<RtmMetadataItem> metadata = new ArrayList<RtmMetadataItem>();
metadata.add(item1);
metadata.add(item2);
RtmMetadataOptions options = new RtmMetadataOptions(-1, ture, false);
mRtmChannel.addChannelMetadata(metadata, options, new ResultCallback<Void>() {
    @Override
    public void onSuccess(Void unused) {
        visualLog_CALLBACK( "addChannelMetadata onSuccess");
    }

    @Override
    public void onFailure(ErrorInfo errorInfo) {
        visualLog_CALLBACK( "addChannelMetadata onFailure, error: " + errorInfo.toString());
    }
});
```

**Response**

None

This operation adds new metadata items for the current channel. It will report an error if the key of the new `RtmMetadataItem` already exists in the channel metadata.

#### Clear Channel Metadata

**Description**

Deletes all metadata items of the channel.

**Method**

```java
clearChannelMetadata(RtmMetadataOptions options, ResultCallback<Void> resultCallback)
```

| Property Name    | Type                 | Description                                                                                            |
|:----------------:|:--------------------:|:------------------------------------------------------------------------------------------------------ |
| `options`        | `RtmMetadataOptions` | Optional properties for current channel Metadata |
| `resultCallback` | function             | callback function                                                                                      |

**Basic Use**

```java
RtmMetadataOptions options = new RtmMetadataOptions(-1, ture, false);
mRtmChannel.clearChannelMetadata(metadata, options, new ResultCallback<Void>() {
    @Override
    public void onSuccess(Void unused) {
        visualLog_CALLBACK( "clearChannelMetadata onSuccess");
    }

    @Override
    public void onFailure(ErrorInfo errorInfo) {
        visualLog_CALLBACK( "clearChannelMetadata onFailure, error: " + errorInfo.toString());
    }
});
```

**Response**

None

#### Update Channel Metadata

**Description**

Updates metadata items of the channel.

**Method**

```java
updateChannelMetadata(List<RtmMetadataItem> items, RtmMetadataOptions options, ResultCallback<Void> resultCallback)
```

| Property Name    | Type                     | Description                                                                                                                        |
|:----------------:|:------------------------:|:---------------------------------------------------------------------------------------------------------------------------------- |
| `items`          | `List<RtmMetadataItem>` | `RtmMetadataItem` type array which contains a single Key-Value metadata for channel |
| `options`        | `RtmMetadataOptions`     | Optional properties for current channel Metadata                             |
| `resultCallback` | function                 | callback function                                                                                                                  |

**Basic Use**

```java
RtmMetadataItem item1 = new RtmMetadataItem("Announcement", "Welcome to RTM");
RtmMetadataItem item2 = new RtmMetadataItem("Channel_type", "Public");
ArrayList<RtmMetadataItem> metadata = new ArrayList<RtmMetadataItem>();
metadata.add(item1);
metadata.add(item2);
RtmMetadataOptions options = new RtmMetadataOptions(-1, ture, false);
mRtmChannel.updateChannelMetadata(metadata, options, new ResultCallback<Void>() {
    @Override
    public void onSuccess(Void unused) {
        visualLog_CALLBACK( "updateChannelMetadata onSuccess");
    }

    @Override
    public void onFailure(ErrorInfo errorInfo) {
        visualLog_CALLBACK( "updateChannelMetadata onFailure, error: " + errorInfo.toString());
    }
});
```

**Response**

None

This operation is only valid for updating existing metadata items or it will report errors.

#### Delete Channel Metadata

**Description**

Deletes metadata items of the channel.

**Method**

```java
void deleteChannelMetadata(List<RtmMetadataItem> items, RtmMetadataOptions options, ResultCallback<Void> resultCallback)
```

| Property Name    | Type                    | Description                                                                                                                        |
|:----------------:|:-----------------------:|:---------------------------------------------------------------------------------------------------------------------------------- |
| `items`          | `List<RtmMetadataItem>` | `RtmMetadataItem` type array which contains a single Key-Value metadata for channel |
| `options`        | `RtmMetadataOptions`    | Optional properties for current channel Metadata                             |
| `resultCallback` | function                | callback function                                                                                                                  |

**Basic Use**

```java
RtmMetadataItem item1 = new RtmMetadataItem("Announcement", "");
RtmMetadataItem item2 = new RtmMetadataItem("Channel_type", "");
ArrayList<RtmMetadataItem> metadata = new ArrayList<RtmMetadataItem>();
metadata.add(item1);
metadata.add(item2);
RtmMetadataOptions options = new RtmMetadataOptions(-1, ture, false);
mRtmChannel.deleteChannelMetadata(metadata, options, new ResultCallback<Void>() {
    @Override
    public void onSuccess(Void unused) {
        visualLog_CALLBACK( "deleteChannelMetadata onSuccess");
    }

    @Override
    public void onFailure(ErrorInfo errorInfo) {
        visualLog_CALLBACK( "deleteChannelMetadata onFailure, error: " + errorInfo.toString());
    }
});
```

**Response**

None


#### Get Channel Metadata

**Description**

Gets all metadata items of the channel.

**Method**

```javascript
getChannelMetadata(ResultCallback<RtmMetadata> resultCallback)
```

| Parameter        | Type     | Required | Default | Description       |
|:----------------:|:--------:|:--------:|:-------:|:-----------------:|
| `resultCallback` | function | yes      |         | callback function |

**Basic Use**

```java
mRtmChannel.getChannelMetadata( new ResultCallback<RtmMetadata>(){
    @Override
    public void onSuccess(RtmMetadata channelMetadata){
        // process success result!
    }
    @Override
    public void onFailure(int errorInfo){
        // process failure result!
    }   
});
```

**Response**

Returns a type `RtmMetadata` for the specific `channel` which contains the following properties:

| Property Name   | Type                      | Description                                                                                                                         |
| --------------- | ------------------------- | ----------------------------------------------------------------------------------------------------------------------------------- |
| `items`         | `List<RtmMetadataItem>` | `RtmMetadataItem` type array which contains a single Key-Value metadata for channel |
| `majorRevision` | number                    | The major revision for this channel metadata                                                                                        |

#### Channel Metadata Update Event

When you join a channel, you automatically start listening to the channel metadata update event.

**Description**

It occurs when channel's metadata is updated, You need to implement this procedure yourself.

**Method**

```javascript
void onMetadataUpdated(RtmMetadata data)
```

**Basic Use**

```java
private RtmChannelListener rtmChannelListener = new RtmChannelListener(){

  @Override
  public void onMetadataUpdated(RtmMetadata data) {
      visualLog_CALLBACK("onMetadataUpdated");
      for (RtmMetadataItem item: data.items) {
          visualLog( "Item key: " + item.getKey() + ", value: " + item.getValue()
                  + ", revision: " + item.getRevision() + ", ts: " + item.getLastUpdateTs()
                  + ", userId: " + item.getAuthorUserId());
      }
  }
};

RtmChannel rtmChannel = mRtmClient.createChannel(channelId.toString(), rtmChannelListener);
```

**Response**

When this event  occurs, you receive a `RtmMetadata` object for the specific channel which contains the following properties:

| Property Name   | Type                      | Description                                                                         |
|:---------------:|:-------------------------:| ----------------------------------------------------------------------------------- |
| `items`         | `List<RtmMetadataItem>` | `RtmMetadataItem` type array which contains a single Key-Value metadata for channel |
| `majorRevision` | number                    | The major revision for this channel metadata                                        |

The returned object contains the complete data of the current channel, `Add`/`Set`/`Clear`/`Update`/`Delete` operations all trigger this event.

</PlatformWrapper>