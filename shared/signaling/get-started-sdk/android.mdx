<PlatformWrapper platform="android">
        
## Project setup

Follow these steps to create the environment necessary to add Signaling into your app.

### Create an Android project

Use Android Studio to [create an Android project](https://developer.android.com/studio/projects/create-project).

1.  Select the Project Template as **Empty Activity**.

1.  Enter `signaling_quickstart` as the project **Name**.

1.  Enter `com.example.signaling_quickstart` as the **Package name**.

1.  Select **Language** as **Java**.

### Add permissions

Add the following permissions in the `AndroidManifest.xml` file.

``` xml
<uses-permission android:name="android.permission.INTERNET" />
<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
<uses-permission android:name="android.permission.ACCESS_WIFI_STATE" />
```

If your app targets Android 6.0 or higher, you need to dynamically apply for the above permissions, see [Request app permissions](https://developer.android.com/training/permissions/requesting) for details.

If your app targets Android 10 or higher, refer to [Privacy changes in Android 10](https://developer.android.com/about/versions/10/privacy/changes).


### Integrate the SDK

Integrate the Agora <Vg k="MESS" /> Android SDK into your project with Maven Central. For more integration methods, see [Other approaches to integrate the SDK](#other-approaches-to-integrate-the-sdk).

1. To add the Maven Central dependency, in `/Gradle Scripts/build.gradle(Project: <projectname>)`, add the following lines:

    ```json
    buildscript {
        repositories {
            …
            mavenCentral()
        }
        …
    }

    allprojects {
        repositories {
            …
            mavenCentral()
        }
    }
    ```

1. To integrate the <Vg k="COMPANY" /> <Vg k="MESS_SDK" /> into your Android project, in `/Gradle Scripts/build.gradle(Module: <projectname>.app)`, add the following under `dependencies`:

    ```groovy
    dependencies {
        // For <version>, fill in a specific SDK version number. For example, 1.6.3.203
        // Get the latest version number through the release notes.
        implementation 'io.agora.rtm:rtm-special-sdk:<version>'
    }
    ```

## Implement Signaling

This section shows how to use the Agora <Vg k="MESS_SDK" /> to implement <Vg k="MESS" /> into your app step by step.

### Implement the UI and resource files

To help you quickly implement Agora <Vg k="SIG" /> functionality in your <Vpl k="CLIENT" />, this section shows you how to build a simple UI that enables your users to:

-   Log in to and log out of Agora <Vg k="SIG" />

-   Join and leave a channel

-   Send and receive peer-to-peer or channel messages

-   Monitor changes in the connection state of the user

    1.  Open the `app/res/layout/activity_main.xml` file in Android Studio, and replace the contents of the file with the following:

        ``` xml
        <?xml version="1.0" encoding="utf-8"?>
        <RelativeLayout
            xmlns:android="http://schemas.android.com/apk/res/android"
            xmlns:tools="http://schemas.android.com/tools"
            android:layout_width="match_parent"
            android:layout_height="match_parent"
            android:padding="5dp"
            tools:context=".MainActivity">

            <EditText
                android:id="@+id/uid"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_alignBottom="@id/login_button"
                android:layout_alignParentStart="true"
                android:layout_toStartOf="@id/login_button"
                android:autofillHints=""
                android:layout_marginEnd="5dp"
                android:hint="@string/uid"
                android:inputType="text" />

            <Button
                android:id="@+id/login_button"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:onClick="onClickLogin"
                android:text="@string/login_button"
                android:layout_toStartOf="@id/logout_button"
                android:layout_marginEnd="5dp"/>

            <Button
                android:id="@+id/logout_button"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:onClick="onClickLogout"
                android:text="@string/logout_button"
                android:layout_alignParentEnd="true"
                />

            <EditText
                android:id="@+id/channel_name"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_below="@id/login_button"
                android:layout_alignParentStart="true"
                android:layout_toStartOf="@id/join_button"
                android:layout_marginEnd="5dp"
                android:autofillHints=""
                android:hint="@string/channel_name"
                android:inputType="text" />

            <Button
                android:id="@+id/join_button"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_below="@id/login_button"
                android:layout_alignStart="@id/login_button"
                android:layout_toStartOf="@id/leave_button"
                android:onClick="onClickJoin"
                android:text="@string/join_button" />

            <Button
                android:id="@+id/leave_button"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_below="@id/login_button"
                android:layout_marginStart="5dp"
                android:layout_alignParentEnd="true"
                android:onClick="onClickLeave"
                android:text="@string/leave_button" />

            <EditText
                android:id="@+id/msg_box"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_below="@id/join_button"
                android:autofillHints=""
                android:hint="@string/msg"
                android:inputType="textPersonName"
                android:singleLine="false" />

            <Button
                android:id="@+id/send_channel_msg_button"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_below="@id/msg_box"
                android:layout_alignParentStart="true"
                android:onClick="onClickSendChannelMsg"
                android:text="@string/send_channel_msg_button" />

            <Button
                android:id="@+id/send_peer_msg_button"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_below="@id/send_channel_msg_button"
                android:layout_alignParentStart="true"
                android:layout_marginEnd="5dp"
                android:onClick="onClickSendPeerMsg"
                android:text="@string/send_peer_msg_button" />

            <EditText
                android:id="@+id/peer_name"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_below="@id/send_channel_msg_button"
                android:layout_alignParentEnd="true"
                android:layout_toEndOf="@id/send_peer_msg_button"
                android:autofillHints=""
                android:hint="@string/peer_name"
                android:inputType="text" />

            <ScrollView
                android:id="@+id/messagesScrollView"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_below="@id/peer_name"
                android:layout_alignParentBottom="true"
                android:layout_marginTop="10dp"
                android:fillViewport="true"
                android:scrollbars="vertical"
                android:background="#ECE5DD" >

                <TextView
                    android:id="@+id/message_history"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content" />
            </ScrollView>

        </RelativeLayout>
        ```

    1.  To define strings used in the layout, open the `app/res/values/strings.xml` file and replace the contents of the file with the following:

        ``` xml
        <resources>
            <string name="app_name">signaling_quickstart</string>
            <string name="login_button">Login</string>
            <string name="logout_button">Logout</string>
            <string name="join_button">Join</string>
            <string name="leave_button">Leave</string>
            <string name="send_peer_msg_button">Send Message to User</string>
            <string name="send_channel_msg_button">Send Message to Channel</string>
            <string name="uid">Enter your uid</string>
            <string name="msg">Enter your message</string>
            <string name="channel_name">Channel name</string>
            <string name="peer_name">User ID</string>
            <string name="app_id">Your App ID</string>
            <string name="token">Your Token</string>
        </resources>
        ```

You need to update the following strings:

- Update the value of `app_id` with the App ID of your project.

- Update the value of `token` with the authentication token you obtained. To learn how to obtain an authentication token, see [Secure authentication with tokens](../develop/authentication-workflow).

### Implement the logic of sending and receiving messages

Open the `app/java/com.example.signaling_quickstart/MainActivity.java` file and replace the contents of the file with the following:

    ``` java
    package com.example.signaling_quickstart;

    import androidx.appcompat.app.AppCompatActivity;

    import android.os.Bundle;
    import android.view.View;
    import android.widget.EditText;
    import android.widget.TextView;
    import android.widget.Toast;

    import java.util.List;
    import java.util.Map;

    import io.agora.rtm.ErrorInfo;
    import io.agora.rtm.ResultCallback;
    import io.agora.rtm.RtmChannel;
    import io.agora.rtm.RtmChannelAttribute;
    import io.agora.rtm.RtmChannelListener;
    import io.agora.rtm.RtmChannelMember;
    import io.agora.rtm.RtmClient;
    import io.agora.rtm.RtmClientListener;
    import io.agora.rtm.RtmMessage;
    import io.agora.rtm.RtmMetadata;
    import io.agora.rtm.SendMessageOptions;

    public class MainActivity extends AppCompatActivity {

        // EditText objects to read input
        private EditText et_uid;
        private EditText et_channel_name;
        private EditText et_message_content;
        private EditText et_peer_id;

        private TextView message_history; // TextView to show messages in the UI

        private String AppID; // Agora App ID
        private String uid; // Signaling uid
        private String channel_name; // Signaling channel name

        private RtmClient mRtmClient; // Signaling client instance
        private RtmChannel mRtmChannel; // Signaling channel instance

        private String peer_id; // Signaling user ID of the message receiver
        private String message_content; // Message text

        @Override
        protected void onCreate(Bundle savedInstanceState) {
            super.onCreate(savedInstanceState);
            setContentView(R.layout.activity_main);

            // Initialize the Signaling client
            try {
                AppID = getBaseContext().getString(R.string.app_id);
                // Initialize the Signaling client
                mRtmClient = RtmClient.createInstance(getBaseContext(), AppID,
                        new RtmClientListener() {
                            @Override
                            public void onConnectionStateChanged(int state, int reason) {
                                String text = "Connection state changed to " + state + " Reason: " + reason;
                                writeToMessageHistory(text);
                            }

                            @Override
                            public void onTokenExpired() {
                            }

                            @Override
                            public void onTokenPrivilegeWillExpire() {
                            }

                            @Override
                            public void onPeersOnlineStatusChanged(Map<String, Integer> map) {
                            }

                            @Override
                            public void onUserMetadataUpdated(String s, RtmMetadata rtmMetadata) {

                            }

                            @Override
                            public void onMessageReceived(RtmMessage rtmMessage, String peerId) {
                                String text = "Message from " + peerId + ": " + rtmMessage.getText();
                                writeToMessageHistory(text);
                            }
                        });

            } catch (Exception e) {
                throw new RuntimeException("Signaling initialization failed!");
            }
        }

        // Login to Signaling
        public void onClickLogin(View v) {
            et_uid = findViewById(R.id.uid);
            uid = et_uid.getText().toString();

            String token = getBaseContext().getString(R.string.token);

            // Log in to Signaling
            mRtmClient.login(token, uid, new ResultCallback<Void>() {
                @Override
                public void onSuccess(Void responseInfo) {
                    writeToMessageHistory("Logged in");
                }

                @Override
                public void onFailure(ErrorInfo errorInfo) {
                    CharSequence text = "User: " + uid + " failed to log in to Signaling!" + errorInfo.toString();
                    int duration = Toast.LENGTH_SHORT;
                    runOnUiThread(() -> {
                        Toast toast = Toast.makeText(getApplicationContext(), text, duration);
                        toast.show();
                    });
                }
            });
        }

        // Join the Signaling channel
        public void onClickJoin(View v) {
            et_channel_name = findViewById(R.id.channel_name);
            channel_name = et_channel_name.getText().toString();
            // Create a channel listener
            RtmChannelListener mRtmChannelListener = new RtmChannelListener() {
                @Override
                public void onMemberCountUpdated(int i) {
                }

                @Override
                public void onAttributesUpdated(List<RtmChannelAttribute> list) {
                }

                @Override
                public void onMessageReceived(RtmMessage message, RtmChannelMember fromMember) {
                    String text = message.getText();
                    String fromUser = fromMember.getUserId();
                    String message_text = "Channel message from " + fromUser + ": " + text;
                    writeToMessageHistory(message_text);
                }

                @Override
                public void onMemberJoined(RtmChannelMember member) {
                }

                @Override
                public void onMemberLeft(RtmChannelMember member) {
                }

                @Override
                public void onMetadataUpdated(RtmMetadata rtmMetadata) {
                    
                }
            };

            try {
                // Create an Signaling channel
                mRtmChannel = mRtmClient.createChannel(channel_name, mRtmChannelListener);
            } catch (RuntimeException e) {

            }
            // Join the Signaling channel
            mRtmChannel.join(new ResultCallback<Void>() {
                @Override
                public void onSuccess(Void responseInfo) {
                    writeToMessageHistory("Joined channel " + channel_name);
                }

                @Override
                public void onFailure(ErrorInfo errorInfo) {
                    CharSequence text = "User: " + uid + " failed to join the channel!" + errorInfo.toString();
                    int duration = Toast.LENGTH_SHORT;
                    runOnUiThread(() -> {
                        Toast toast = Toast.makeText(getApplicationContext(), text, duration);
                        toast.show();
                    });
                }
            });
        }   

        public void onClickLogout(View v) {
            // Log out of Signaling
            mRtmClient.logout(new ResultCallback<Void>() {
                @Override
                public void onSuccess(Void unused) {
                    writeToMessageHistory("Logged out");
                }

                @Override
                public void onFailure(ErrorInfo errorInfo) {
                }
            });
        }

        public void onClickLeave(View v) {
            // Leave the Signaling channel
            mRtmChannel.leave(new ResultCallback<Void>() {
                @Override
                public void onSuccess(Void unused) {
                    writeToMessageHistory("Left the channel");
                }

                @Override
                public void onFailure(ErrorInfo errorInfo) {

                }
            });
        }

        // Send a peer-to-peer message
        public void onClickSendPeerMsg(View v) {
            et_message_content = findViewById(R.id.msg_box);
            message_content = et_message_content.getText().toString();

            et_peer_id = findViewById(R.id.peer_name);
            peer_id = et_peer_id.getText().toString();

            // Create Signaling message instance
            final RtmMessage message = mRtmClient.createMessage();
            message.setText(message_content);

            SendMessageOptions option = new SendMessageOptions();

            // Send message to peer
            mRtmClient.sendMessageToPeer(peer_id, message, option, new ResultCallback<Void>() {

                @Override
                public void onSuccess(Void aVoid) {
                    String text = "Message sent to " + peer_id + "： " + message.getText();
                    writeToMessageHistory(text);
                }

                @Override
                public void onFailure(ErrorInfo errorInfo) {
                    String text = "Failed to send message to " + peer_id + " Error ： " + errorInfo;
                    writeToMessageHistory(text);
                }
            });
        }

        // Send a channel message
        public void onClickSendChannelMsg(View v) {
            et_message_content = findViewById(R.id.msg_box);
            message_content = et_message_content.getText().toString();

            // Create Signaling message instance
            RtmMessage message = mRtmClient.createMessage();
            message.setText(message_content);

            // Send message to channel
            mRtmChannel.sendMessage(message, new ResultCallback<Void>() {
                @Override
                public void onSuccess(Void aVoid) {
                    String text = "Message sent to channel " + mRtmChannel.getId() + " : " + message.getText();
                    writeToMessageHistory(text);
                }

                @Override
                public void onFailure(ErrorInfo errorInfo) {
                    String text = "Failed to send message to channel " + mRtmChannel.getId() + " Error: " + errorInfo;
                    writeToMessageHistory(text);
                }
            });
        }

        // Write messages to the TextView
        public void writeToMessageHistory(String record) {
            runOnUiThread(() -> {
                message_history = findViewById(R.id.message_history);
                message_history.append(record + "\n");
            });
        }
    }
    ```

## Test your app

Build the project in Android Studio, and run it on an emulator or a physical mobile device. You see the following UI on your test device:

![App screen shot](/images/signaling/signaling-quickstart-android.png)

The quickstart project enables you to:

- Log in to and log out of Agora <Vg k="SIG" />.

- Join and leave a channel.

- Send and receive peer-to-peer or channel messages.

- See the changes in the connection state of the user and changes in the channel state.


## Considerations

-   The Agora <Vg k="MESS_SDK" /> supports creating multiple <Link to="{{Global.SIG_SDK_API_ANDROID}}/classio_1_1agora_1_1rtm_1_1_rtm_client.html">RtmClient</Link> instances that are independent of each other.

-   To send and receive peer-to-peer or channel messages, ensure that you have successfully logged in to Agora <Vg k="SIG" />. You receive the <Link to="{{Global.SIG_SDK_API_ANDROID}}/interfaceio_1_1agora_1_1rtm_1_1_result_callback.html#a7206b30500655c4a73d146acf50cb6f5">onSuccess</Link> callback upon a successful log in.

-   To use any of the channel features, you must first call the <Link to="{{Global.SIG_SDK_API_ANDROID}}/classio_1_1agora_1_1rtm_1_1_rtm_client.html#a95ebbd1a1d902572b444fef7853f335a">createChannel</Link> method to create a channel instance.

-   You can create multiple channel instances for each <Link to="{{Global.SIG_SDK_API_ANDROID}}/classio_1_1agora_1_1rtm_1_1_rtm_client.html">RtmClient</Link> instance, but you can only join a maximum of 20 channels at the same time. The `channelId` parameter needs to be channel-specific.

-   When you leave a channel and do not want to join it again, you can call the <Link to="{{Global.SIG_SDK_API_ANDROID}}/classio_1_1agora_1_1rtm_1_1_rtm_channel.html#a725d008cb19f44496948ee8f1826deaf">release</Link> method to release all resources used by the channel instance.

-   You cannot reuse a received <Link to="{{Global.SIG_SDK_API_ANDROID}}/classio_1_1agora_1_1rtm_1_1_rtm_message.html">RtmMessage</Link> instance.


## See also

### Sample project

Agora also provides an open-source [sample project](https://github.com/AgoraIO/RTM/tree/master/Agora-RTM-Tutorial-Android) on GitHub for your reference.

### Other approaches to integrate the SDK

[Downloads](../reference/downloads) shows you alternative ways to add <Vg k="MESS_SDK" /> in your project.

</PlatformWrapper>
