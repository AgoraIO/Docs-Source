To implement the call quality features, take the following steps:

1. **Import <Vpd k="SDK" /> classes**

    The following lines import the necessary <Vg k="VSDK" /> classes and interfaces into the project:

    ```swift
    import SwiftUI
    import AgoraRtcKit
    ```

1. **Enable the user to test the network**

    The following method starts the last mile probe test to check network conditions:

    ```swift
    func startProbeTest() {
        // Configure a LastmileProbeConfig instance.
        let config = AgoraLastmileProbeConfig()
        // Probe the uplink network quality.
        config.probeUplink = true
        // Probe the downlink network quality.
        config.probeDownlink = true
        // The expected uplink bitrate (bps). The value range is [100000,5000000].
        config.expectedUplinkBitrate = 100000
        // The expected downlink bitrate (bps). The value range is [100000,5000000].
        config.expectedDownlinkBitrate = 100000

        agoraEngine.startLastmileProbeTest(config)
    }
    ```

1. **Implement best practice for app initiation**

    The `CallQualityView` struct displays the video feeds of all participants in a channel, along with their call quality statistics such as the following:

    * _receivedBitrate_: The bitrate (Kbps) of the remote video received since the last count.
    * _width_: The width (pixels) of the video.
    * _height_: The height (pixels) of the video.
    * _receivedFrameRate_: The frame rate (Kbps) received since the last count.
    * _frameLossRate_: The packet loss rate (%) of the remote video.
    * _packetLossRate_: The packet loss rate (%) of the remote video after using the anti-packet-loss technology.
    * _captureFrameWidth_: The width (px) for capturing the local video stream.
    * _captureFrameHeight_: The height (px) for capturing the local video stream.
    * _captureFrameRate_: The frame rate (fps) for capturing the local video stream.
    * _encodedFrameWidth_: The width of the encoded video (px).
    * _encodedFrameHeight_: The height of the encoded video (px).
    * _encoderOutputFrameRate_: The output frame rate (fps) of the local video encoder.
    * _sentFrameRate_: The actual frame rate (fps) while sending the local video stream. This value does not include the frame rate for resending the video after packet loss.
    * _sentBitrate_: The actual bitrate (Kbps) while sending the local video stream. This value does not include the bitrate for resending the video after packet loss.
    * _txPacketLossRate_: The video packet loss rate (%) from the local client to the Agora server before applying the anti-packet loss strategies.

    ``` swift
    struct CallQualityView: View {
        /// The Agora SDK manager for call quality.
        @ObservedObject var agoraManager = CallQualityManager(
            appId: DocsAppConfig.shared.appId, role: .broadcaster
        )

        var body: some View {
            ScrollView {
                VStack {
                    ForEach(Array(agoraManager.allUsers), id: \.self) { uid in
                        AgoraVideoCanvasView(manager: agoraManager, uid: uid)
                            .aspectRatio(contentMode: .fit).cornerRadius(10)
                            .overlay(alignment: .topLeading) {
                                Text(agoraManager.callQualities[uid] ?? "no data").padding(4)
                                    .background {
                                        #if os(iOS)
                                        VisualEffectView(effect: UIBlurEffect(style: .systemMaterial))
                                            .cornerRadius(10).blur(radius: 1).opacity(0.75)
                                        #endif
                                    }.padding(4)
                            }
                    }
                }.padding(20)
            }.onAppear {
                await agoraManager.joinChannel(DocsAppConfig.shared.channel)
            }.onDisappear {
                agoraManager.leaveChannel()
            }
        }

        init(channelId: String) {
            DocsAppConfig.shared.channel = channelId
        }
        static let docPath = getFolderName(from: #file)
        static let docTitle = LocalizedStringKey("ensure-channel-quality-title")
    }
    ```

1. **Listen to <Vg k="ENGINE" /> events to receive network quality statistics.**

    The `CallQualityManager` class holds the following event handlers to get quality statistics of local and remote users:

    * `onLastmileProbeResult`: Receives detailed probe test results.
    * `onLocalVideoStats`: Receives stats about the local video.
    * `remoteVideoStats`: Receives stats about the remote video.

    ```swift
    public func rtcEngine(_ engine: AgoraRtcEngineKit, lastmileProbeTest result: AgoraLastmileProbeResult) {
        engine.stopLastmileProbeTest()
        // The result object contains the detailed test results that help you
        // manage call quality. For example, the downlink jitter"
        print("downlink jitter: \(result.downlinkReport.jitter)")
    }

    /** Updates the call quality statistics for a remote user.

     - Parameters:
       - engine: The Agora SDK engine.
       - stats: The remote video statistics.
    */
    public func rtcEngine(_ engine: AgoraRtcEngineKit, remoteVideoStats stats: AgoraRtcRemoteVideoStats) {
        self.callQualities[stats.uid] = """
        Received Bitrate = \(stats.receivedBitrate)
        Frame = \(stats.width)x\(stats.height), \(stats.receivedFrameRate)fps
        Frame Loss Rate = \(stats.frameLossRate)
        Packet Loss Rate = \(stats.packetLossRate)
        """
    }

    /** Updates the call quality statistics for the local user.

     - Parameters:
       - engine: The Agora SDK engine.
       - stats: The local video statistics.
       - sourceType: The type of video source.
    */
    public func rtcEngine(
        _ engine: AgoraRtcEngineKit, localVideoStats stats: AgoraRtcLocalVideoStats,
        sourceType: AgoraVideoSourceType
    ) {
        self.callQualities[self.localUserId] = """
        Captured Frame = \(stats.captureFrameWidth)x\(stats.captureFrameHeight), \(stats.captureFrameRate)fps
        Encoded Frame = \(stats.encodedFrameWidth)x\(stats.encodedFrameHeight), \(stats.encoderOutputFrameRate)fps
        Sent Data = \(stats.sentFrameRate)fps, bitrate: \(stats.sentBitrate)
        Packet Loss Rate = \(stats.txPacketLossRate)
        """
    }
    ```
