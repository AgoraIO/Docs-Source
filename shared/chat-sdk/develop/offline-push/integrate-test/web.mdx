<PlatformWrapper platform="web">

To optimize the user experience when dealing with a large number of push notifications, Chat SDK provides fine-grained settings for push notifications and do not disturb mode at the app and conversation levels.

**Push notifications**

| Setting      | Description    | App   | One-to-one and group chat conversations   |
| :------- | :----- | :----- | :----- |
|  `ALL`  | Receive push notifications for all offline messages. | ✓ | ✓ |
|  `AT`  | Only receive push notifications for mentions. <br/> This parameter is recommended for group chats. If a user wants to mention one or more users, they need to pass `"em_at_list": [ "user1", "user2" ... ]` to the `ext` field when creating a message; if they want to mention everyone, they need to pass `"em_at_list": "all"` to this field. | ✓ | ✓ |
|  `NONE`    | Do not receive push notifications for offline messages. | ✓      | ✓ |

The push notification setting at the conversation level takes precedence over the setting at the app level. For conversations where push notifications are not configured, the app setting is used by default.

For example, suppose the push notifications are set to `AT` for the app and to `ALL` for a given conversation. The user will receive all push notifications from that conversation, but for all other conversations, they will only receive push notifications for mentions.

**Do Not Disturb**

After you have completed SDK initialization and successfully logged into the app, you can enable offline push for the app and various types of conversations, as well as turning off push by setting the Do Not Disturb mode.

You can specify the DND time and duration at the app level, and Chat will not send offline push notifications during these two periods. If both the DND time and DND duration are set, the DND mode will take effect for the sum of the two.

The following table describes the Do Not Disturb time settings:

| Setting      |   Description    |    App   | One-to-one and group chat conversations   |
| :--------| :----- | :------------------- | :----- |
| `startTime & endTime` | The time period for triggering offline push notifications every day is in the format of `H:MH:M`, using the 24-hour system and accurate to the minute. For example, `8:30`-`10:0`, the range of hours and minutes in the start time and end time is `[0,23]` and `[0,59]`, respectively. The setting of the Do Not Disturb time period is as follows: <ul><li>After the start time and end time are set, the Do Not Disturb mode is triggered every day. For example, if the time period is set to `8:0`-`10:0`, the Do Not Disturb mode is effective from 8:00 to 10:00 every day. If you set the start time to `8:0` and the end time to `12:0` at 11:00, the Do Not Disturb mode is effective from 11:00 to 12:00 on the same day, and from 8:00 to 12:00 every day thereafter. </li> <li> If the start time and end time are the same, the Do Not Disturb mode is effective all day. However, if it is set to `0:0`-`0:0`, the Do Not Disturb mode is turned off. </li> <li>If the end time is earlier than the start time, the Do Not Disturb mode takes effect from the start time of each day to the end time of the next day. For example, if the start time is `10:0` and the end time is `8:0`, the Do Not Disturb mode takes effect from 10:00 on the same day to 8:00 on the next day. </li> <li>Currently, the Do Not Disturb mode is only supported in a specified time period each day. Multiple Do Not Disturb time periods are not supported. The new setting will override the previous setting. </li> <li>If both this parameter and `duration` are set, the Do Not Disturb mode takes effect in both time periods on the same day. For example, if `startTime & endTime` is set to `8:0`-`10:0` at 8:00 AM and `duration` is set to 240 minutes (4 hours), the app will be in Do Not Disturb mode from 8:00-12:00 on the same day and from 8:00-10:0 every day thereafter. </li> </ul>| ✓ | ✗ |
|  `duration`  | The duration of the Do Not Disturb mode, in minutes. The value range of the Do Not Disturb duration is `[0,10080]`, `0` means that the parameter is invalid, and `10080` means that the Do Not Disturb mode lasts for 7 days. <br/> Unlike the setting of the Do Not Disturb time, which takes effect every day, this parameter is valid once. It takes effect immediately after setting. For example, if the app-level `duration` is set to 240 minutes (4 hours) at 8:00 am, the app will be in Do Not Disturb mode from 8:00 to 12:00 on the same day. <br/> - If both this parameter and `startTime & endTime` are set, the Do Not Disturb mode will take effect in both time periods on the same day. For example, if the app-level `startTime & endTime` is set to 8:00-10:00 at 8:00 AM, and the Do Not Disturb duration is set to 240 minutes (4 hours), the app will be in Do Not Disturb mode from 8:00 to 12:00 and from 8:00 to 10:00 every day thereafter. | ✓      | ✓ |

If you need to push messages to specific users during the do not disturb period or the effective time, you need to set [forced push](#forced-push).

For the app and all conversations in the app, the Do Not Disturb mode setting takes precedence over the push notification setting. For example, suppose you specify a Do Not Disturb time period at the app level and set push notifications for a specified conversation to `ALL` . The app enters the Do Not Disturb mode during the specified time period, and you will not receive any push notifications.

Alternatively, suppose a conversation is assigned a quiet time period, and the app does not have any quiet settings and its push notifications are set to `ALL`. During the specified quiet time, you will not receive any push notifications from this conversation, while push notifications from all other conversations remain unchanged.

### Set up push notifications for the app

Call `setSilentModeForAll` to set app-level push notifications. Configure the push notification and do not disturb settings by specifying the `paramType` field, as shown in the following code example:

```javascript
/**
  options // Push notification configuration options.
	options: {
    paramType: 0, // Push notification method.
    remindType: 'ALL' // Can be set to `ALL`, `AT` or `NONE`.
  }
  options: {
    paramType: 1, // Do not disturb duration.
    duration: 7200000 // Do not disturb duration, in milliseconds.
  }
  options: {
    paramType: 2, // Do not disturb time period.
    startTime: {
    	hours: 8, // The number of hours in the start time of the do not disturb period.
    	minutes: 0 // The number of minutes in the start time of the do not disturb period.
    }，
    endTime: {
    	hours: 12, // The number of hours in the end time of the do not disturb period.
    	minutes: 0 // The number of minutes in the end time of the do not disturb period.
    }
  }
*/
const params = {
  options: {
    paramType: 0,
    remindType: "ALL",
  },
};
connection.setSilentModeForAll(params);
```

### Get the push notification settings of the app

Call `getSilentModeForAll` to get the push notification settings of the app. The sample code is as follows:

```javascript
connection.getSilentModeForAll();
```

### Set push notifications for a single conversation

Call `setSilentModeForConversation` to configure the push notification settings for a specified conversation. The sample code is as follows:

```javascript
/**
	const params = {
    conversationId: 'conversationId', // Conversation ID: For single chat, it is the other party's user ID; for group chat, it is the group ID.
    type: 'singleChat', // Conversation type: singleChat (single chat), groupChat (group chat).
    options: {
      paramType: 0, // Push notification settings.
      remindType: 'ALL' // Can be set to `ALL`, `AT` or `NONE`.
    }
  }

	const params = {
    conversationId: 'conversationId',
    type: 'groupChat',
    options: {
      paramType: 1, // Do not disturb duration.
      duration: 7200000 // Do not disturb duration, in milliseconds.
    }
  }

  const params = {
    conversationId: 'conversationId',
    type: 'chatRoom',
    options: {
      paramType: 2, // Do not disturb time period.
      startTime: {
        hours: 8, // The number of hours in the start time of the do not disturb period.
        minutes: 0 // The number of minutes in the start time of the do not disturb period.
      }，
      endTime: {
        hours: 12, // The number of hours in the end time of the do not disturb period.
        minutes: 0 // The number of minutes in the end time of the do not disturb period.
      }
    }
  }
*/
const params = {
  conversationId: "conversationId",
  type: "groupChat",
  options: {
    paramType: 0,
    remindType: "ALL",
  },
};
connection.setSilentModeForConversation(params);
```

### Get push notification settings for a single conversation

Call `getSilentModeForConversation` to get the push notification settings for a single conversation. The sample code is as follows:

```javascript
const params = {
  conversationId :  " conversationId " , // Conversation ID: For single chat, it is the other party's user ID; for group chat, it is the group ID.
  type :  " singleChat " , // Session type: singleChat is a single chat, groupChat is a group chat.
};
connection.getSilentModeForConversation(params);
```

### Get push notification settings for multiple conversations

1. You can get push notification settings for up to 20 conversations at a time.
1. If the conversation uses app settings or its push notification settings have expired, the returned dictionary does not contain this conversation.

Call `getSilentModeForConversations` to get the push notification settings for multiple conversations. The sample code is as follows :

```javascript
const params = {
  conversationList: [
    {
      id :  " conversationId " , // Conversation ID: For single chat, it is the other party's user ID; for group chat, it is the group ID.
      type :  " singleChat " , // Session type: singleChat is a single chat, groupChat is a group chat.
    },
    {
      id: "conversationId",
      type: "groupChat",
    },
  ],
};
connection.getSilentModeForConversations(params);
```

### Clear push notification settings for a single conversation

Call `clearRemindTypeForConversation` to clear the push notification type settings for a specified conversation. After clearing, this conversation will use the app's settings by default. The sample code is as follows:

```javascript
const params = {
  conversationId :  " conversationId " , // Conversation ID: For single chat, it is the other party's user ID; for group chat, it is the group ID.
  type :  " groupChat " , // Session type: singleChat is a single chat, groupChat is a group chat.
};
connection.clearRemindTypeForConversation(params);
```

### Set push translation

Push notifications work with the translation feature. If a user enables the automatic translation feature and sends a message, the SDK will send both the original message and the translated message.

As a recipient, the user can set the preferred language for push notifications they want to receive when offline. If the language of the translated message matches their preferred language, the translated message is displayed in the push notification; otherwise, the original message is displayed.

Call `setPushPerformLanguage` to set the preferred language for push notifications. The sample code is as follows:

```javascript
// Set the preferred language for push notifications.
const params = {
  language: "EU",
};
connection.setPushPerformLanguage(params);

// Get the preferred language for push notifications.
connection.getPushPerformLanguage();
```

### Set the push template

The default push template is mainly used when the default configuration provided by the server does not meet your needs. It allows you to set the global push title and push content. For example, the default settings provided by the server are push titles and content in English. If you need to use push titles and content in another language, you can set the push template in the corresponding language.

#### Use the default push template

To use the default template, create a default push template in Agora Console or [ call the RESTful interface ] ( ./agora_chat_restful_push#set-up-push-templates ). The template name is ` default ` . After setting, the default template is automatically used when pushing messages. You do not need to enter the template name when creating messages.

Follow the steps below to create a default push template in the Agora console:

1. Log in to the Agora console ( https://console.agora.io/ ) and click Project Management in the left navigation bar .
2. On the Project Management page , click Config in the Action column for the project that has IM enabled .
3. On the Edit Project page , in the Features area , click Enable / Config for Chat .
4. On the project configuration page, select ** Features ** > ** Push Template ** , click ** Add Push Template ** , and configure the fields in the pop-up dialog box, as shown in the following figure.

![push_add_template](/images/chat/push_add_template.png)

5. Set ** Template Name ** to ** default ** , then set the ** Title ** and ** Content ** parameters, and click ** OK ** .

| Parameter       | Type | Description | Required |
| :--------- | :----- | :----- | :----- |
|  ** Template Name **    | String   | Push template name. The default template is ** default ** .        | Yes |
|  ** Title **      | Array | Push title. Can be set in the following ways: <ul><li>Enter a fixed push title. </li><li>Use built-in variables and enter `{$fromNickname}, {$msg}`. </li ><li>Set custom variables through the value array. The field format is: ** {0} {1} {2} ... {n} ** . </li></ul><br/>If the default template is used, the first two settings do not need to pass in this parameter when creating a message. The server automatically obtains it. The third setting method needs to be passed in through the extended field.   | Yes |
|  ** Content **    | Array | Push content. Can be set in the following ways: <ul><li>Enter fixed push content. </li><li>Use variables and enter `{$fromNickname}, {$msg}`. </li><li>Set custom variables through the value array. The field format is: ** {0} {1} {2} ... {n} ** . </li></ul><br/>If the default template is used, the first two settings do not require parameters to be passed in when creating a message. The server automatically obtains them. The third setting method needs to be passed in through the extended field. | Yes |

#### Use custom push template

The steps to use a custom push template are as follows:

1. If you use a custom push template, you need to create a custom push template in the Agora console or [ Call RESTful API] (./agora_chat_restful_push#set-up-push-templates). For a description of the parameters in the ** Add Push Template ** dialog box, see [ Use the default push template ] ( #Use the default push template ) . When using a custom template, regardless of how the ** Title ** and ** Content ** parameters are set, they must be passed in through the extended fields when creating a message.

2. When creating a message , you need to pass in the template name, push title, and push content by using the extended fields. The push title and content in the notification bar use the formats in the template respectively.

```javascript
// The following takes text messages as an example. The setting methods for other types of messages are the same.

const sendTextMsg = () => {
  let option: AgoraChat.CreateTextMsgParameters = {
    chatType: chatType,
    type: "txt",
    to : targetUserId,
    msg: msgContent,
    ext: {
      em_push_template: {
        name :  " templateName " , // Set the push template name.
        title_args : [ " titleValue1 " ], // Set the value array of the push title in the template. If the push title specified in the template is placeholder data, you can customize the title here; if the specified title is a fixed value, the title will be a fixed value when using this template.
        content_args : [ " contentValue1 " ], // Set the value array of the pushed content in the template. If the template content specified in the template is placeholder data, you can customize the content here; if the specified content is a fixed value, the content will be a fixed value when the template is used.
      },
    },
  };
  let msg = AC.message.create(option);
  connection.send(msg);
};
```

The JSON structure of the push template is as follows:

```json
"em_push_template":{
        "name":"test6",
        "title_args":[
            "test1"
        ],
        "content_args":[
            `${fromNickname}`,
            `${msg}`
        ]
}
```

### Forced push

After setting up forced push, the user will ignore the recipient's do not disturb setting when sending messages, and the message will be pushed to the recipient normally regardless of whether it is in the do not disturb time period.

```javascript
// The following takes text messages as an example. The setting methods for other types of messages are the same.
const sendTextMsg = () => {
  let option: AgoraChat.CreateTextMsgParameters = {
    chatType: chatType,
    type: "txt",
    to : targetUserId,
    msg: msgContent,
    ext: {
      // Set whether to force push. This field is a built-in field with the following values: `YES`: forced push; (default) `NO`: non-forced push.
      em_force_notification: "YES"
    },
  };
  let msg = AC.message.create(option);
  connection.send(msg);
};
```

### Send a silent message

Sending silent messages means that the sender sets the message not to be pushed when sending the message. That is, when the user is offline, the IM service will not push message notifications to the user's device through the push service. Therefore, the user will not receive message push notifications. When the user is online again, he will receive all the messages during the offline period.

Both silent message sending and do not disturb mode do not push messages. The difference is that silent message sending is set by the sender when sending the message, while do not disturb mode is set by the receiver not to receive push notifications within a specified time period.

```javascript
// The following takes text messages as an example. The setting methods for other types of messages are the same.
const sendTextMsg = () => {
  let option: AgoraChat.CreateTextMsgParameters = {
    chatType: chatType,
    type: "txt",
    to : targetUserId,
    msg: msgContent,
    ext: {
      // Set whether to send silent messages. This field is a built-in field with the following values: `YES`: send silent messages; (default) `NO`: push the message.
      em_ignore_notification: "NO"
    },
  };
  let msg = AC.message.create(option);
  connection.send(msg);
};
```

</PlatformWrapper>