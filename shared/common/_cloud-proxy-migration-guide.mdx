import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

Agora has updated IP whitelist configuration to enhance security and simplify management. This guide helps you update your cloud proxy settings to avoid service interruptions. Following are the key changes:

* **Reduced IP ranges**: Narrower network segments improve security
* **Single IP addressing**: Cloud machines now use single-point IPs
* **Updated subnet masks**: Physical machines now use /28 instead of /26
* **New access point IP list**: Introduced in SDK 3.4.0 for improved high availability

<Admonition type="info" title="Implementation notes">
* All IP addresses and network ranges have been technically verified.
* Update your firewall rules according to the specified timeline.
* Continue using your current configuration if you must configure before the new delivery dates.
* Test your configuration thoroughly using the [validation steps](../reference/cloud-proxy-allowed-ips#validation-and-testing).
</Admonition>

## Summary of changes
Following are the key changes:

- Access Point IPs have been updated with additional regional support
- Some Signaling service IPs have been replaced or expanded
- All media service network segments remain the same
- Port configurations remain unchanged

## Whitelist migration

The following tables provide the essential information needed to migrate your Cloud Proxy configurations to the new network architecture. Each table outlines:

- **Service type**: The Agora service you want to access
- **Current IP addresses**: Your existing setup that needs to be updated
- **New IP addresses**: The specific IP addresses, ports, and network segments to implement
- **Protocol**: The supported transport protocol(s) used to connect to the service 
- **Port**: The network port number used for establishing the connection 
- **Required action**: The specific changes needed for each component

Use these tables to identify the configurations applicable to your regions and SDK versions. 

<Admonition type="info" >
When adding IP addresses:
- If you use cloud proxy with [Restricted media zones](../advanced-features/geofencing), add only the IP addresses dedicated to your specified region.
- If you do not restrict media zones, add all IP addresses to ensure connectivity.
</Admonition>

### Force UDP mode

#### North America

| Service type | Current IP addresses | New IP addresses | Protocol | Port | Action required |
|--------------|----------------------|------------------|----------|------|----------------|
| Signaling Service | `184.72.16.87`, `35.168.106.53` | `106.14.12.130`, `118.190.148.38`, `184.72.16.87`, `35.168.106.53`, `35.156.231.150`, `15.237.134.178`, `54.178.26.110`, `52.221.23.86`, `13.230.60.35`, `15.206.47.129`, `13.127.149.196`, `13.209.247.137`, `13.124.182.235`, `23.98.43.152`, `107.155.14.132`, `69.28.51.142` | UDP | `8443` | Add new IPs to existing configuration |
| Media Service | `128.14.195.192/28`, `128.14.245.16/28`, `128.14.72.80/28`, `128.14.200.208/28` | `128.14.195.192/28`, `128.14.245.16/28`, `128.14.72.80/28`, `128.14.200.208/28` | UDP | `4590-4600`, `8001-8010` | No change required |

#### Europe

| Service type | Current IP addresses | New IP addresses | Protocol | Port | Action required |
|--------------|----------------------|------------------|----------|------|----------------|
| Signaling Service | `35.156.231.150`, `15.237.134.178` | `106.14.12.130`, `118.190.148.38`, `184.72.16.87`, `35.168.106.53`, `35.156.231.150`, `15.237.134.178`, `54.178.26.110`, `52.221.23.86`, `13.230.60.35`, `15.206.47.129`, `13.127.149.196`, `13.209.247.137`, `13.124.182.235`, `23.98.43.152`, `107.155.14.132`, `69.28.51.142` | UDP | `8443` | Add new IPs to existing configuration |
| Media Service     | `104.166.160.208/28`, `23.236.110.32/28`, `104.166.142.134`, `104.166.161.4`  | `104.166.160.208/28`, `23.236.110.32/28`, `104.166.142.134`, `104.166.161.4` | UDP | `4590-4600`, `8001-8010` | No change required |

#### Asia, excluding Mainland China

| Service type | Current IP addresses | New IP addresses | Protocol | Port | Action required |
|--------------|----------------------|------------------|----------|------|----------------|
| Signaling Service | `54.178.26.110`, `52.221.23.86`, `13.230.60.35` | `106.14.12.130`, `118.190.148.38`, `184.72.16.87`, `35.168.106.53`, `35.156.231.150`, `15.237.134.178`, `54.178.26.110`, `52.221.23.86`, `13.230.60.35`, `15.206.47.129`, `13.127.149.196`, `13.209.247.137`, `13.124.182.235`, `23.98.43.152`, `107.155.14.132`, `69.28.51.142` | UDP | `8443` | Add new IPs to existing configuration |
| Media Service     | `128.1.186.240/28`, `129.227.73.32/28`, `103.193.127.208/28` | `128.1.186.240/28`, `129.227.73.32/28`, `103.193.127.208/28` | UDP | `4590-4600`, `8001-8010` | No change required |

#### Japan

| Service type | Current IP addresses | New IP addresses | Protocol | Port | Action required |
|--------------|----------------------|------------------|----------|------|----------------|
| Signaling Service | `54.178.26.110`, `52.221.23.86`, `13.230.60.35` | `106.14.12.130`, `118.190.148.38`, `184.72.16.87`, `35.168.106.53`, `35.156.231.150`, `15.237.134.178`, `54.178.26.110`, `52.221.23.86`, `13.230.60.35`, `15.206.47.129`, `13.127.149.196`, `13.209.247.137`, `13.124.182.235`, `23.98.43.152`, `107.155.14.132`, `69.28.51.142` | UDP | `8443` | Add new IPs to existing configuration |
| Media Service     | `129.227.113.112/28`, `129.227.55.96/28`, `122.10.153.74`, `129.227.234.123` | `129.227.113.112/28`, `129.227.55.96/28`, `122.10.153.74`, `129.227.234.123` | UDP | `4590-4600`, `8001-8010` | No change required |

#### India

| Service type | Current IP addresses | New IP addresses | Protocol | Port | Action required |
|--------------|----------------------|------------------|----------|------|----------------|
| Signaling Service | `15.206.47.129`, `13.127.149.196` | `106.14.12.130`, `118.190.148.38`, `184.72.16.87`, `35.168.106.53`, `35.156.231.150`, `15.237.134.178`, `54.178.26.110`, `52.221.23.86`, `13.230.60.35`, `15.206.47.129`, `13.127.149.196`, `13.209.247.137`, `13.124.182.235`, `23.98.43.152`, `107.155.14.132`, `69.28.51.142` | UDP | `8443` | Add new IPs to existing configuration |
| Media Service     | `129.227.217.128/28`, `129.227.108.208/28`, `128.1.105.112/28` | `129.227.217.128/28`, `129.227.108.208/28`, `128.1.105.112/28` | UDP | `4590-4600`, `8001-8010` | No change required |

#### Mainland China

| Service type | Current IP addresses | New IP addresses | Protocol | Port | Action required |
|--------------|----------------------|------------------|----------|------|----------------|
| Signaling Service | `106.14.12.130`, `118.190.148.38` | `106.14.12.130`, `118.190.148.38` | UDP | `8443` | No change required |
| Media Service     | `14.29.38.144/28`, `27.45.161.144/28`, `183.232.200.144/28`, `115.238.206.0/28`, `106.3.209.0/28`, `112.13.216.0/28`, `219.153.111.128/28`, `221.178.42.0/28`, `113.207.12.0/28` | `14.29.38.144/28`, `27.45.161.144/28`, `183.232.200.144/28`, `115.238.206.0/28`, `106.3.209.0/28`, `112.13.216.0/28`, `219.153.111.128/28`, `221.178.42.0/28`, `113.207.12.0/28` | UDP | `4590-4600`, `8001-8010` | No change required |


### Force TCP mode

#### North America

| Service type | Current IP addresses | New IP addresses | Protocol | Port | Action required |
|--------------|----------------------|------------------|----------|------|----------------|
| Signaling Service | `52.54.85.111`, `184.72.18.217` | `101.132.108.165`, `123.56.235.221`, `52.54.85.111`, `184.72.18.217`, `52.28.239.238`, `3.9.120.239`, `13.250.89.184`, `18.176.162.64`, `168.138.214.216`, `20.193.241.143`, `3.109.116.108`, `3.36.161.253`, `15.164.88.208`, `164.52.43.58`, `54.205.123.178`, `50.18.20.222` | TCP | `443` | Add new IPs to existing configuration |
| Media Service     | `128.14.195.192/28`, `128.14.245.16/28`, `128.14.72.80/28`, `128.14.200.208/28` | `128.14.195.192/28`, `128.14.245.16/28`, `128.14.72.80/28`, `128.14.200.208/28` | TCP | `443` | No change required |

#### Europe

| Service type | Current IP addresses | New IP addresses | Protocol | Port | Action required |
|--------------|----------------------|------------------|----------|------|----------------|
| Signaling Service | `52.28.239.238`, `3.9.120.239` | `101.132.108.165`, `123.56.235.221`, `52.54.85.111`, `184.72.18.217`, `52.28.239.238`, `3.9.120.239`, `13.250.89.184`, `18.176.162.64`, `168.138.214.216`, `20.193.241.143`, `3.109.116.108`, `3.36.161.253`, `15.164.88.208`, `164.52.43.58`, `54.205.123.178`, `50.18.20.222` | TCP | `443` | Add new IPs to existing configuration |
| Media Service     | `104.166.160.208/28`, `23.236.110.32/28`, `104.166.142.134`, `104.166.161.4` | `104.166.160.208/28`, `23.236.110.32/28`, `104.166.142.134`, `104.166.161.4` | TCP | `443` | No change required |

#### Asia, excluding Mainland China

| Service type | Current IP addresses | New IP addresses | Protocol | Port | Action required |
|--------------|----------------------|------------------|----------|------|----------------|
| Signaling Service | `13.250.89.184`, `18.176.162.64` | `101.132.108.165`, `123.56.235.221`, `52.54.85.111`, `184.72.18.217`, `52.28.239.238`, `3.9.120.239`, `13.250.89.184`, `18.176.162.64`, `168.138.214.216`, `20.193.241.143`, `3.109.116.108`, `3.36.161.253`, `15.164.88.208`, `164.52.43.58`, `54.205.123.178`, `50.18.20.222` | TCP | `443` | Add new IPs to existing configuration |
| Media Service     | `128.1.186.240/28`, `129.227.73.32/28`, `103.193.127.208/28` | `128.1.186.240/28`, `129.227.73.32/28`, `103.193.127.208/28` | TCP | `443` | No change required |

#### Japan

| Service type | Current IP addresses | New IP addresses | Protocol | Port | Action required |
|--------------|----------------------|------------------|----------|------|----------------|
| Signaling Service | `168.138.214.216`, `18.176.162.64` | `101.132.108.165`, `123.56.235.221`, `52.54.85.111`, `184.72.18.217`, `52.28.239.238`, `3.9.120.239`, `13.250.89.184`, `18.176.162.64`, `168.138.214.216`, `20.193.241.143`, `3.109.116.108`, `3.36.161.253`, `15.164.88.208`, `164.52.43.58`, `54.205.123.178`, `50.18.20.222` | TCP | `443` | Add new IPs to existing configuration |
| Media Service     | `129.227.113.112/28`, `129.227.55.96/28`, `122.10.153.74`, `129.227.234.123` | `129.227.113.112/28`, `129.227.55.96/28`, `122.10.153.74`, `129.227.234.123` | TCP | `443` | No change required |

#### India

| Service type | Current IP addresses | New IP addresses | Protocol | Port | Action required |
|--------------|----------------------|------------------|----------|------|----------------|
| Signaling Service | `3.109.116.108`, `20.193.241.143` | `101.132.108.165`, `123.56.235.221`, `52.54.85.111`, `184.72.18.217`, `52.28.239.238`, `3.9.120.239`, `13.250.89.184`, `18.176.162.64`, `168.138.214.216`, `20.193.241.143`, `3.109.116.108`, `3.36.161.253`, `15.164.88.208`, `164.52.43.58`, `54.205.123.178`, `50.18.20.222` | TCP | `443` | Add new IPs to existing configuration |
| Media Service     | `129.227.217.128/28`, `129.227.108.208/28`, `128.1.105.112/28` | `129.227.217.128/28`, `129.227.108.208/28`, `128.1.105.112/28` | TCP | `443` | No change required |

#### Mainland China

| Service type | Current IP addresses | New IP addresses | Protocol | Port | Action required |
|--------------|----------------------|------------------|----------|------|----------------|
| Signaling Service | `101.132.108.165`, `123.56.235.221` | `101.132.108.165`, `123.56.235.221` | TCP | `443` | Add new IPs to existing configuration |
| Media Service     | `14.29.38.144/28`, `27.45.161.144/28`, `183.232.200.144/28`, `115.238.206.0/28`, `106.3.209.0/28`, `112.13.216.0/28`, `219.153.111.128/28`, `221.178.42.0/28`, `113.207.12.0/28` | `14.29.38.144/28`, `27.45.161.144/28`, `183.232.200.144/28`, `115.238.206.0/28`, `106.3.209.0/28`, `112.13.216.0/28`, `219.153.111.128/28`, `221.178.42.0/28`, `113.207.12.0/28` | TCP | `443` | No change required |

### Web RTC Cloud Proxy

#### North America

| Service type | Current IP addresses | New IP addresses | Protocol | Port | Action required |
|--------------|----------------------|------------------|----------|------|----------------|
| Signaling Service | *Not previously specified* | `47.252.17.251`, `170.106.135.177` | UDP/TCP | `443` | Add new IPs |
| Media Service     | *Not previously specified* | `128.14.195.192/28`, `128.14.245.16/28`, `128.14.72.80/28`, `128.14.200.208/28` | UDP/TCP | `443` | Add new network segments |

#### Europe

| Service type | Current IP addresses | New IP addresses | Protocol | Port | Action required |
|--------------|----------------------|------------------|----------|------|----------------|
| Signaling Service | *Not previously specified* | `47.254.149.145`, `162.62.220.8` | UDP/TCP | `443` | Add new IPs |
| Media Service     | *Not previously specified* | `104.166.160.208/28`, `23.236.110.32/28`, `148.153.25.149`, `148.153.25.148`, `148.153.25.147`, `148.153.25.146`, `148.153.25.184`, `148.153.93.18`, `148.153.93.19`, `148.153.93.24`, `148.153.93.25`, `148.153.93.27` | UDP/TCP | `443` | Add new network segments and IPs |

#### India

| Service type | Current IP addresses | New IP addresses | Protocol | Port | Action required |
|--------------|----------------------|------------------|----------|------|----------------|
| Signaling Service | *Not previously specified* | `147.139.34.215`, `129.226.26.104` | UDP/TCP | `443` | Add new IPs |
| Media Service     | *Not previously specified* | `129.227.217.128/28`, `129.227.108.208/28`, `128.1.105.112/28` | UDP/TCP | `443` | Add new network segments |

#### Japan

| Service type | Current IP addresses | New IP addresses | Protocol | Port | Action required |
|--------------|----------------------|------------------|----------|------|----------------|
| Signaling Service | *Not previously specified* | `47.245.7.250`, `43.128.248.97` | UDP/TCP | `443` | Add new IPs |
| Media Service     | *Not previously specified* | `129.227.113.112/28`, `129.227.55.96/28`, `164.52.24.41`, `164.52.6.29`, `164.52.24.44`, `164.52.24.43`, `103.101.125.21`, `103.101.125.26`, `103.101.125.20`, `103.101.125.22`, `122.10.153.90` | UDP/TCP | `443` | Add new network segments and IPs |

#### Asia, excluding Mainland China

| Service type | Current IP addresses | New IP addresses | Protocol | Port | Action required |
|--------------|----------------------|------------------|----------|------|----------------|
| Signaling Service | *Not previously specified* | `161.117.177.218`, `104.250.52.195` | UDP/TCP | `443` | Add new IPs |
| Media Service     | *Not previously specified* | `128.1.186.240/28`, `129.227.73.32/28`, `103.193.127.208/28` | UDP/TCP | `443` | Add new network segments |

#### Mainland China

| Service type | Current IP addresses | New IP addresses | Protocol | Port | Action required |
|--------------|----------------------|------------------|----------|------|----------------|
| Signaling Service | *Not previously specified* | `139.196.42.124`, `123.56.57.206` | UDP/TCP | `443` | Add new IPs |
| Media Service     | *Not previously specified* | `14.29.38.144/28`, `27.45.161.144/28`, `183.232.200.144/28`, `115.238.206.0/28`, `106.3.209.0/28`, `112.13.216.0/28`, `219.153.111.128/28`, `221.178.42.0/28`, `113.207.12.0/28` | UDP/TCP | `443` | Add new network segments |

### Web Signaling Cloud Proxy

#### North America

| Service type | Current IP addresses | New IP addresses | Protocol | Port | Action required |
|--------------|----------------------|------------------|----------|------|----------------|
| Signaling and AP Service | *Not previously specified* | `35.169.70.181`, `107.155.14.132`, `52.52.84.170` | UDP/TCP | `443` | Add new IPs |
| Media Service     | *Not previously specified* | `128.14.195.192/28`, `128.14.245.16/28`, `128.14.72.80/28`, `128.14.200.208/28` | UDP/TCP | `443` | Add new network segments |


#### Europe

| Service type | Current IP addresses | New IP addresses | Protocol | Port | Action required |
|--------------|----------------------|------------------|----------|------|----------------|
| Signaling and AP Service | *Not previously specified* |  `128.1.78.146`, `35.178.208.187` | UDP/TCP | `443` | Add new IPs |
| Media Service     | *Not previously specified* | `104.166.160.208/28`, `23.236.110.32/28`, `104.166.142.134`, `104.166.161.4` | UDP/TCP | `443` | Add new network segments |

#### India

| Service type | Current IP addresses | New IP addresses | Protocol | Port | Action required |
|--------------|----------------------|------------------|----------|------|----------------|
| Signaling and AP Service | *Not previously specified* |  `129.227.98.170`, `129.154.38.143` | UDP/TCP | `443` | Add new IPs |
| Media Service     | *Not previously specified* |  `129.227.217.128/28`, `129.227.108.208/28`, `128.1.105.112/28` | UDP/TCP | `443` | Add new network segments |

#### Japan

| Service type | Current IP addresses | New IP addresses | Protocol | Port | Action required |
|--------------|----------------------|------------------|----------|------|----------------|
| Signaling and AP Service | *Not previously specified* | `52.68.71.190`, `168.138.222.84`  | UDP/TCP | `443` | Add new IPs |
| Media Service     | *Not previously specified* | `129.227.113.112/28`, `129.227.55.96/28`, `122.10.153.74`, `129.227.234.123` | UDP/TCP | `443` | Add new network segments |

#### Asia, excluding Mainland China

| Service type | Current IP addresses | New IP addresses | Protocol | Port | Action required |
|--------------|----------------------|------------------|----------|------|----------------|
| Signaling and AP Service - Asia | *Not previously specified* | `47.74.211.17`, `52.221.23.86`  | UDP/TCP | `443` | Add new IPs |
| Signaling and AP Service - Hongkong | *Not previously specified* | `23.98.43.152`, `47.244.4.122`  | UDP/TCP | `443` | Add new IPs |
| Signaling and AP Service - Korea | *Not previously specified* | `164.52.43.59`, `13.124.182.235` | UDP/TCP | `443` | Add new IPs |
| Media Service     | *Not previously specified* | `128.1.186.240/28`, `129.227.73.32/28`, `103.193.127.208/28` | UDP/TCP | `443` | Add new network segments |

#### Mainland China

| Service type | Current IP addresses | New IP addresses | Protocol | Port | Action required |
|--------------|----------------------|------------------|----------|------|----------------|
| Signaling and AP Service | *Not previously specified* | `52.80.192.229`, `47.96.234.219`  | UDP/TCP | `443` | Add new IPs |
| Media Service     | *Not previously specified* | `14.29.38.144/28`, `27.45.161.144/28`, `183.232.200.144/28`, `115.238.206.0/28`, `106.3.209.0/28`, `112.13.216.0/28`, `219.153.111.128/28`, `221.178.42.0/28`, `113.207.12.0/28` | UDP/TCP | `443` | Add new network segments |

## Implementation and validation 
Follow this three-phase approach to successfully migrate your Cloud Proxy configuration without service disruption.

### Pre-migration testing
Before making any changes, establish a baseline and verify your current environment using these steps.

1. **Identify SDK version**
   
   Use your SDK's version identification API to determine your current version.

2. **Validate current configuration**
   - Test connectivity using your existing configuration
   - Record baseline performance metrics (latency, packet loss, jitter)
   - Document current firewall rules for rollback purposes

### Implement migration 
Once you've completed testing, follow these steps to implement the new Cloud Proxy configuration.

1. **Use a phased approach**
   - Begin with non-production environments
   - Update firewall rules based on your region and SDK version 
   - Adhere to the region-specific timelines in the configuration tables

2. **Update configurations by SDK version**
   - **SDK 3.2.0-3.4.0**: Implement UDP Cloud Proxy whitelist with `/28` subnet masks
   - **SDK 3.4.0+**: Implement new Access Point IP list and network segments
   - **Web SDK**: Configure both Media and Signal proxy settings based on your specific version

### Post-migration validation
After implementing the changes, verify your new configuration and monitor performance.

1. **Test connectivity**
   
   Configure your client to use UDP Cloud Proxy mode and enable network quality testing.

2. **Monitor performance**
   - Compare latency, packet loss, and jitter against baseline measurements
   - Watch for any connection failures or degraded service quality
   - Test connections from all targeted geographic regions

3. **Prepare fallback strategy**
   - Maintain complete documentation of original configuration
   - Create rollback procedures for quickly reverting changes if needed
   - Keep support contact information readily available

### Get support

For implementation assistance, contact [support@agora.io](mailto:support@agora.io) with your specific SDK version and region requirements.
