<PlatformWrapper platform="android">
import CodeBlock from '@theme/CodeBlock';

A complete code sample that implements the basic features of <Vpd k="NAME" /> is presented here for your reference. Copy the code into your project to understand the basic functions. 

To use the sample code, copy the following lines into the `/app/src/main/java/com/example/<projectname>/MainActivity.java` file and replace `<projectname>` in `package com.example.<projectname>` with the name of your project.

<details>
<summary>Complete sample code for <Vpd k="PRODUCT" /></summary>

<CodeBlock language="java" showLineNumbers>
{`// Replace the package path with the path of your real project.
package com.example.<projectname>;

import android.content.pm.ActivityInfo;
import android.os.Bundle;
import android.view.View;
import android.widget.EditText;
import android.widget.TextView;
import android.widget.Toast;

import androidx.appcompat.app.AppCompatActivity;

import io.agora.rtm.ErrorInfo;
import io.agora.rtm.LockEvent;
import io.agora.rtm.MessageEvent;
import io.agora.rtm.PresenceEvent;
import io.agora.rtm.PublishOptions;
import io.agora.rtm.ResultCallback;
import io.agora.rtm.RtmClient;
import io.agora.rtm.RtmConfig;
import io.agora.rtm.RtmConstants;
import io.agora.rtm.RtmEventListener;
import io.agora.rtm.RtmMessage;
import io.agora.rtm.StorageEvent;
import io.agora.rtm.SubscribeOptions;
import io.agora.rtm.TopicEvent;


public class MainActivity extends AppCompatActivity {
    private EditText etUserId;
    private EditText etChannelName;
    private EditText etMessageContent;

    // The user ID of the publisher
    private String mUserId;
    // The channel name of the message channel
    private String mChannelName;

    // The RTM client instance
    private RtmClient mRtmClient;
    // The TextView to show the messages that you send
    private TextView mMessageHistory;

    // Add the event listener
    private RtmEventListener eventListener = new RtmEventListener() {
        @Override
        public void onMessageEvent(MessageEvent event) {
            String text = "Message received from " + event.getPublisherId() + " Message: " + event.getMessage().getData() + "\n";
            writeToMessageHistory(text);
        }

        @Override
        public void onPresenceEvent(PresenceEvent event) {
            String text = "receive presence event, user: " + event.getPublisherId() + " event: " + event.getEventType() + "\n";
            writeToMessageHistory(text);
        }

        @Override
        public void onConnectionStateChanged(String mChannelName, RtmConstants.RtmConnectionState state, RtmConstants.RtmConnectionChangeReason reason) {
            String text = "Connection state changed to " + state + ", Reason: " + reason + "\n";
            writeToMessageHistory(text);
        }
    };

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        setRequestedOrientation(ActivityInfo.SCREEN_ORIENTATION_PORTRAIT);
    }

    @Override
    protected void onResume() {
        super.onResume();
    }

    @Override
    protected void onDestroy() {
        super.onDestroy();
    }

    public void onClickLogin(View v)
    {
        try {
            etUserId = (EditText) findViewById(R.id.uid);
            mUserId = etUserId.getText().toString();
            if (mUserId == null || mUserId.isEmpty()) {
                showToast("invalid userId");
                return;
            }
            RtmConfig config = new RtmConfig.Builder(getBaseContext().getString(R.string.app_id), mUserId)
                    .eventListener(eventListener)
                    .build();
            mRtmClient = RtmClient.create(config);
        } catch (Exception e) {
            showToast("create rtm client is null");
        }

        if (mRtmClient == null) {
            showToast("rtm client is null");
            return;
        }

        // Log in the RTM server
        String token =getBaseContext().getString(R.string.token);
        mRtmClient.login(token, new ResultCallback<Void>() {
            @Override
            public void onSuccess(Void responseInfo) {
                writeToMessageHistory("Successfully logged in to Signaling!\n");
            }

            @Override
            public void onFailure(ErrorInfo errorInfo) {
                CharSequence text = "User: " + mUserId + " Failed to log in to Signaling!" + errorInfo.toString();
                int duration = Toast.LENGTH_SHORT;
                runOnUiThread(new Runnable() {
                    public void run() {
                        Toast toast = Toast.makeText(getApplicationContext(), text, duration);
                        toast.show();
                    }
                });
            }
        });
    }

    public void onClickSubscribe(View v)
    {
        if (mRtmClient == null) {
            showToast("rtm client is null");
            return;
        }

        // Subscribe to a channel
        etChannelName = (EditText) findViewById(R.id.channel_name);
        mChannelName = etChannelName.getText().toString();

        SubscribeOptions options = new SubscribeOptions();
        options.setWithMessage(true);
        mRtmClient.subscribe(mChannelName, options, new ResultCallback<Void>() {
            @Override
            public void onSuccess(Void responseInfo) {
                writeToMessageHistory("Successfully subscribe to the channel!\n");
            }

            @Override
            public void onFailure(ErrorInfo errorInfo) {
                writeToMessageHistory("Fail to subscribe to the channel!\n");
            }
        });
    }

    public void onClickLogout(View v)
    {
        if (mRtmClient == null) {
            showToast("rtm client is null");
        }
        // Log out from the RTM server
        mRtmClient.logout(new ResultCallback<Void>() {
            @Override
            public void onSuccess(Void responseInfo) {
                writeToMessageHistory("Successfully log out from the channel!\n");
            }

            @Override
            public void onFailure(ErrorInfo errorInfo) {
                writeToMessageHistory("Fail to log out from the channel!\n");
            }
        });
    }

    public void onClickUnsubscribe(View v)
    {
        if (mRtmClient == null) {
            showToast("rtm client is null");
            return;
        }
        // Unsubscribe from a channel
        etChannelName = (EditText) findViewById(R.id.channel_name);
        mChannelName = etChannelName.getText().toString();
        mRtmClient.unsubscribe(mChannelName, new ResultCallback<Void>() {
            @Override
            public void onSuccess(Void responseInfo) {
                writeToMessageHistory("Successfully unsubscribe from the channel!\n");
            }

            @Override
            public void onFailure(ErrorInfo errorInfo) {
                writeToMessageHistory("Fail to unsubscribe from the channel!\n");
            }
        });
    }

    public void onClickSendChannelMsg(View v)
    {
        etMessageContent = findViewById(R.id.msg_box);
        String message = etMessageContent.getText().toString();

        // Publish a message
        etChannelName = (EditText) findViewById(R.id.channel_name);
        mChannelName = etChannelName.getText().toString();
        PublishOptions options = new PublishOptions();
        options.setCustomType("");
        mRtmClient.publish(mChannelName, message, options, new ResultCallback<Void>() {
            @Override
            public void onSuccess(Void responseInfo) {
                String text = "Message sent to channel " + mChannelName + " : " + message + "\n";
                writeToMessageHistory(text);
            }

            @Override
            public void onFailure(ErrorInfo errorInfo) {
                String text = "Message fails to send to channel " + mChannelName + " Error: " + errorInfo + "\n";
                writeToMessageHistory(text);
            }
        });
    }

    // Write message history to TextView
    public void writeToMessageHistory(String record)
    {
        mMessageHistory = findViewById(R.id.message_history);
        mMessageHistory.append(record);
    }

    private void showToast(String text) {
        Toast.makeText(this, text, Toast.LENGTH_SHORT).show();
    }
}`}
</CodeBlock>
</details>

<Admonition title="Information" type="info">In the `appId` and `token` fields, enter the corresponding values you obtained from <Vg k="CONSOLE"/>. Use the same `channelName` you filled in when generating the temporary token.</Admonition>

Follow the implementation steps to understand the core API calls in the sample code.
 
### Import Agora classes

Import the relevant Agora classes and interfaces:

```java
import io.agora.rtm.ErrorInfo;
import io.agora.rtm.LockEvent;
import io.agora.rtm.MessageEvent;
import io.agora.rtm.PresenceEvent;
import io.agora.rtm.PublishOptions;
import io.agora.rtm.ResultCallback;
import io.agora.rtm.RtmClient;
import io.agora.rtm.RtmConfig;
import io.agora.rtm.RtmConstants;
import io.agora.rtm.RtmEventListener;
import io.agora.rtm.RtmMessage;
import io.agora.rtm.StorageEvent;
import io.agora.rtm.SubscribeOptions;
import io.agora.rtm.TopicEvent;
```

### Initialize the Signaling engine

Before calling any <Vg k="SIG" /> SDK API, initialize an `RtmClient` object instance.

```java
String appId = getBaseContext().getString(R.string.app_id);
RtmConfig config = new RtmConfig.Builder(appId, mUserId)
    .eventListener(eventListener)
    .build();
mRtmClient = RtmClient.create(config);
```

### Add an event listener

The event listener helps you implement the processing logic in response to Signaling events. Use the following code to handle event notifications or display received messages:

```java
private RtmEventListener eventListener = new RtmEventListener() {
    @Override
    public void onMessageEvent(MessageEvent event) {
        String text = "Message received from " + event.getPublisherId() + " Message: " + event.getMessage().getData() + "\n";
        writeToMessageHistory(text);
    }

    @Override
    public void onPresenceEvent(PresenceEvent event) {
        String text = "receive presence event, user: " + event.getPublisherId() + " event: " + event.getEventType() + "\n";
        writeToMessageHistory(text);
    }

    @Override
    public void onConnectionStateChanged(String mChannelName, RtmConstants.RtmConnectionState state, RtmConstants.RtmConnectionChangeReason reason) {
        String text = "Connection state changed to " + state + ", Reason: " + reason + "\n";
        writeToMessageHistory(text);
    }
};
```

### Log in to Signaling

To establish a connection with the Signaling server, call `login`. 

```java
String token =getBaseContext().getString(R.string.token);
mRtmClient.login(token, new ResultCallback<Void>() {
    @Override
    public void onSuccess(Void responseInfo) {
        writeToMessageHistory("Successfully logged in to Signaling!\n");
    }

    @Override
    public void onFailure(ErrorInfo errorInfo) {
        CharSequence text = "User: " + mUserId + " Failed to log in to Signaling!" + errorInfo.toString();
        int duration = Toast.LENGTH_SHORT;
        runOnUiThread(new Runnable() {
            public void run() {
                Toast toast = Toast.makeText(getApplicationContext(), text, duration);
                toast.show();
            }
        });
    }
});
```

### Send and receive messages

After calling publishthe method to send a message to the Message Channel, RTM will distribute the message to all subscribers of the channel. The following code demonstrates how to send a string type message. Add this code snippet to the program:

<Admonition>
You need to string serialize the message payload before calling publishthe method to send the message.
</Admonition>

```java
// Paste the following code snippet below "Publish a message" comment
etMessageContent = findViewById(R.id.msg_box);
String message = etMessageContent.getText().toString();
etChannelName = (EditText) findViewById(R.id.channel_name);
mChannelName = etChannelName.getText().toString();
PublishOptions options = new PublishOptions();
options.setCustomType("");
mRtmClient.publish(mChannelName, message, options, new ResultCallback<Void>() {
    @Override
    public void onSuccess(Void responseInfo) {
        String text = "Message sent to channel " + mChannelName + " : " + message + "\n";
        writeToMessageHistory(text);
    }

    @Override
    public void onFailure(ErrorInfo errorInfo) {
        String text = "Message fails to send to channel " + mChannelName + " Error: " + errorInfo + "\n";
        writeToMessageHistory(text);
    }
});
```

Call subscribethe method to subscribe to this channel to receive messages from this channel. Add the following code to your program:

```java
// Paste the following code snippet below "Subscribe to a channel" comment
etChannelName = (EditText) findViewById(R.id.channel_name);
mChannelName = etChannelName.getText().toString();
SubscribeOptions options = new SubscribeOptions();
options.setWithMessage(true);
mRtmClient.subscribe(mChannelName, options, new ResultCallback<Void>() {
    @Override
    public void onSuccess(Void responseInfo) {
        writeToMessageHistory("Successfully subscribe to the channel!\n");
    }

    @Override
    public void onFailure(ErrorInfo errorInfo) {
        writeToMessageHistory("Fail to subscribe to the channel!\n");
    }
});
```

If you no longer need to send and receive messages in this channel, you can call unsubscribethe method to unsubscribe from this channel. Add the following code to your program:

```java
// Paste the following code snippet below "Unsubscribe from a channel" comment
etChannelName = (EditText) findViewById(R.id.channel_name);
mChannelName = etChannelName.getText().toString();
mRtmClient.unsubscribe(mChannelName, new ResultCallback<Void>() {
    @Override
    public void onSuccess(Void responseInfo) {
        writeToMessageHistory("Successfully unsubscribe from the channel!\n");
    }

    @Override
    public void onFailure(ErrorInfo errorInfo) {
        writeToMessageHistory("Fail to unsubscribe from the channel!\n");
    }
});
```

For more information about sending and receiving messages, view Messages .

### Log out of Signaling

```java
mRtmClient.logout(new ResultCallback<Void>() {
    @Override
    public void onSuccess(Void responseInfo) {
        writeToMessageHistory("Successfully log out from the channel!\n");
    }

    @Override
    public void onFailure(ErrorInfo errorInfo) {
        writeToMessageHistory("Fail to log out from the channel!\n");
    }
});
```

</PlatformWrapper>