<PlatformWrapper platform="unity">
### Implement the user interface

For a basic <Vpl k="NAME" /> <Vpl k="CLIENT" />, you need:

* A button to join a channel

* A button to leave a channel

To implement this user interface, in your Unity project:

1. Right-click **Sample Scene**, then click **Game Object** > **UI** > **Button**. A button appears in the **Scene** Canvas.

    If you canâ€™t see the button clearly, in Unity, zoom out and rotate the scene.

2. In **Inspector**, rename **Button** to **Leave**, then change the following coordinates:

    * **Pos X** - 350
    * **Pos Y** - -172

3. Select the **Text** sub-item of **Leave**, and in **Inspector**, change **Text** to *Leave*.

4. Use the same procedure to create a button called **Join** with a **Text** sub-item where its **Text** says *Join*.

5. To shift **Join** to the left of the Canvas, in **Inspector** change the following coordinates:

    * Pos X - -350
    * Pos Y - -172

You can access these buttons programmatically to implement the <Vpd k="NAME" /> workflow.

### Handle the system logic

Import the necessary .NET libraries, set up your <Vpl k="CLIENT" /> to run on Android, and request permissions for the microphone.

1. **Create a new script to hold the system logic**

    To create a new script, in your <Vpl k="CLIENT" />:

    1. Open **Assets** > **Agora-Unity-RTC-SDK** > **Code**.

    2. Right-click **Code** and click **Create** > **C# Script**.

    3. In **Assets**, rename `NewBehaviourScript` to `JoinChannelAudio`.

2. **Import the <Vpl k="NAME" /> libraries**

    1. Click `JoinChannelAudio` on the **Canvas** and `Open` in the **Inspector** to open the script in your default text editor.

    2. Add the following code after `using UnityEngine;`:
    ``` csharp
    using UnityEngine.UI;
    using UnityEngine.Android;
    ```
3. **Manage Android permissions**

    1. Add the following lines before `Start`:
    ``` csharp
    private ArrayList permissionList = new ArrayList() { Permission.Microphone };
    ```

    2. To check if permissions are granted, add the following code after `Update`:
    ``` csharp
    private void CheckPermissions() {
        foreach (string permission in permissionList)
        {
            if (!Permission.HasUserAuthorizedPermission(permission))
            {
                Permission.RequestUserPermission(permission);
            }
        }
    }
    ```

4. **Bind your script to the Canvas**

    In `Assets/Agora-Unity-RTC-SDK/Code, drag and drop `JoinChannelAudio.cs` on **Canvas** to the **Hierarchy**.

    Click **Inspector**, you see that `JoinChannelAudio.cs` is added to **Canvas**.

### Implement the <Vpd k="PRODUCT" /> logic

The following figure shows the API call sequence of implementing  <Vpd k="PRODUCT" />.

    ![image](/images/voice-sdk/voice-call-logic-unity.svg)

To implement this logic, take the following steps:

1. **Import the <Vg k="VSDK"/> library**

    In `Assets/Agora-RTC-Plugin/Agora-Unity-RTC-SDK/Code/JoinChannelAudio.cs`, add the following library after `using UnityEngine.UI;`:
    ``` csharp
    using Agora.Rtc;
    ```

2. **Declare the variables that you use to create and join a channel**

    Add the following lines in `JoinChannelAudio : MonoBehaviour{}`:
    ``` csharp
    // Fill in your app ID.
    private string _appID= "";
    // Fill in your channel name.
    private string _channelName = "";
    // Fill in the temporary token you obtained from Agora Console.
    private string _token = "";
    internal IRtcEngine RtcEngine;
    ```

3. **Setup <Vg k="ENGINE"/>**

    To call a method to initialize <Vg k="ENGINE"/> when the <Vpl k="CLIENT" /> is launched, add the following after `CheckPermissions`:
    ``` csharp
    private void SetupVoiceSDKEngine()
    {
        // Create an RtcEngine instance.
        RtcEngine = Agora.Rtc.RtcEngine.CreateAgoraRtcEngine();
        RtcEngineContext context = new RtcEngineContext(_appID, 0, true,
        CHANNEL_PROFILE_TYPE.CHANNEL_PROFILE_LIVE_BROADCASTING,
        AUDIO_SCENARIO_TYPE.AUDIO_SCENARIO_DEFAULT);
        // Initialize RtcEngine.
        RtcEngine.Initialize(context);
    }
    ```

4. **Handle and respond to <Vg k="ENGINE"/> events**

    To register the callbacks, add the following lines after `SetupVoiceSDKEngine`:
    ``` csharp
    private void InitEventHandler()
    {
        // Creates a UserEventHandler instance.
        UserEventHandler handler = new UserEventHandler(this);
        RtcEngine.InitEventHandler(handler);
    }

    //
    internal class UserEventHandler : IRtcEngineEventHandler
    {
        private readonly JoinChannelAudio _audioSample;

        internal UserEventHandler(JoinChannelAudio audioSample)
        {
            _audioSample = audioSample;
        }

        // This callback is triggered when the local user joins the channel.
        public override void OnJoinChannelSuccess(RtcConnection connection, int elapsed)
        {
        }
    }
    ```

5. **Reference the UI elements from SampleScene**

    Add the reference code before `SetupVoiceSDKEngine`:
    ``` csharp
    private void SetupUI()
    {
        GameObject go = GameObject.Find(*Leave*);
        go.GetComponent<Button>().onClick.AddListener(Leave);
        go = GameObject.Find("Join");
        go.GetComponent<Button>().onClick.AddListener(Join);
    }
    ```

6. **Join a channel to start <Vpl k="ENGINE" />**

    When the local user clicks the `Join` button, you call `Join()`. This method securely connects the local user to a channel using the authentication token. Add the following lines after `InitEventHandler`:
    ``` csharp
    public void Join()
    {
        // Enables the audio module.
        RtcEngine.EnableAudio();
        // Sets the user role ad broadcaster.
        RtcEngine.SetClientRole(CLIENT_ROLE_TYPE.CLIENT_ROLE_BROADCASTER);
        // Joins a channel.
        RtcEngine.JoinChannel(_token, _channelName);
    }
    ```

7. **Leave the channel when a user ends the call**

    When a user clicks **Leave**, you call `Leave()` to exit the channel. Add the following lines after `Join`:
    ``` csharp
    public void Leave()
    {
        // Leaves the channel.
        RtcEngine.LeaveChannel();
        // Disable the audio modules.
        RtcEngine.DisableAudio();
    }
    ```

### Start and stop your <Vpl k="CLIENT" />

In this implementation, you initiate and remove  <Vg k="ENGINE" /> when the app opens and closes. The local user joins and leaves a channel using the same  <Vg k="ENGINE" /> instance. In order to send audio streams to  <Vg k="COMPANY" />, you need to ensure that the local user gives permission to access the microphone on the local device. To implement this functionality:

1. **Check that the application has the correct permissions to start**

    For Android, call `CheckPermissions` and check that the permissions are granted. Replace `Update` with the following code:
    ``` csharp
    void Update()
    {
        CheckPermissions();
    }
    ```

2. **Start <Vpd k="PRODUCT" />**

    Replace `Start` with the following code:
    ``` csharp
    void Start()
    {
        SetupVoiceSDKEngine();
        InitEventHandler();
        SetupUI();
    }
    ```

3. **Clean up the resources used by your <Vpl k="CLIENT" />**

    When a user closes the <Vpl k="CLIENT" />, use `OnApplicationQuit` to clean up the resources you created in `SetupVoiceSDKEngine`. Add the following code after `Update`:
    ``` csharp
    void OnApplicationQuit()
    {
        if (RtcEngine != null)
        {
            Leave();
            RtcEngine.Dispose();
            RtcEngine = null;
        }
    }
    ```

</PlatformWrapper>