import CodeBlock from '@theme/CodeBlock';

1. **Integrate the subtitle processing toolkit**

    Copy the [`conversational-ai-api`](https://github.com/AgoraIO-Community/Conversational-AI-Demo/tree/main/Web/Scenes/VoiceAgent/src/conversational-ai-api) file to your project and import the toolkit before calling its API. Refer to [Toolkit Structure](#toolkit-structure) to understand the role of each file.

1. **Create a toolkit instance**

    Create configuration objects for the <Vg k="VSDK"/> and Chat SDK instances, and then initialize the toolkit instance.

    <CodeBlock language="tsx" showLineNumbers>
    {`// Create configuration objects for RTC and RTM instances
    ConversationalAIAPI.init({
        rtcEngine,
        rtmEngine,
    })

    // Get the API instance (singleton)
    const conversationalAIAPI = ConversationalAIAPI.getInstance()`}
    </CodeBlock>

1. **Register events**

    Call the `addHandler` method to register and implement agent-related event callbacks.

    <CodeBlock language="tsx" showLineNumbers>
    {`// Listen for agent state changes
    conversationalAIAPI.on(EConversationalAIAPIEvents.AGENT_STATE_CHANGED, onAgentStateChanged)
    // Listen for agent performance metrics
    conversationalAIAPI.on(EConversationalAIAPIEvents.AGENT_METRICS, onAgentMetricsChanged)
    // Listen for agent error events
    conversationalAIAPI.on(EConversationalAIAPIEvents.AGENT_ERROR, onAgentError)`}
    </CodeBlock>


1. **Subscribe to the channel**
    Agent-related events are delivered through Chat messages. Before starting an agent session, call `subscribeMessage` to receive these events:

    <CodeBlock language="ts" showLineNumbers>
    {`conversationalAIAPI.subscribeMessage(channel_name)`}
    </CodeBlock>


1. **Agent joins the channel**

    To create a conversational agent interface, make a `POST` request and configure the following parameters:

    | Parameter                         | Required | Description                                    |
    | --------------------------------- | -------- | ---------------------------------------------- |
    | `advanced_features.enable_rtm`    | Yes      | Enables the Chat service. |
    | `parameters.data_channel`         | Yes      | Sets the data transmission channel to `"rtm"`. |
    | `parameters.enable_metrics`       | Optional | Enables agent performance metrics.             |
    | `parameters.enable_error_message` | Optional | Enables agent error event reporting.           |

    After a successful request, the agent joins the specified <Vg k="VSDK"/> channel and is ready to interact with the user.

1. **Unsubscribe from the channel**

    After each agent session ends, unsubscribe from channel messages to release resources associated with callback events:

    <CodeBlock language="tsx" showLineNumbers>
    {`conversationalAIAPI.unsubscribeMessage(channel_name)`}
    </CodeBlock>

1. **Release resources**

    At the end of each call, use the `destroy` method to clean up the cache.

    <CodeBlock language="ts" showLineNumbers>
    {`conversationalAIAPI.destroy()`}
    </CodeBlock>

