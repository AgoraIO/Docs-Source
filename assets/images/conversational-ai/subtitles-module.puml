@startuml
!include agora_skin.iuml

box "App"
participant "<size:40><&tablet>" as APP
end box

box "AI Toolkit\n(Subtitle Processor)"
participant "<size:40><&layers>" as MOD
end box

box "Video/Chat SDK"
participant "<size:40><&cloud>" as SDK
end box

box "Conversational AI Engine"
participant "<size:40><&robot>" as AI
end box

group Initialization
APP -> SDK: 1. Create Video and Chat SDK instances
APP -> SDK: 2. Log in to chat server
APP -> MOD: 3. Create subtitle module (set renderMode: Word/Text)
APP -> MOD: 4. Register subtitle callback (addHandler)
end

group Join Call
APP -> SDK: 6. Join Video SDK channel
APP -> SDK: 7. Subscribe to message channel (subscribeMessage)
APP -> AI: 8. Create agent via Restful API (Post)
APP <-> AI: 9. Agent joins and starts interaction
end

group Transcription
SDK -> MOD: 10. Receive raw subtitle data (onTranscriptionUpdated)
MOD -> MOD: 11. Parse subtitle data
MOD -> APP: 12. onTranscriptionUpdated(AGENT)
APP -> APP: 13. Update UI with agent subtitles
MOD -> APP: 14. onTranscriptionUpdated(USER)
APP -> APP: 15. Update UI with user subtitles
end group

group End call
APP -> SDK: 16. Leave Video SDK channel
APP -> SDK: 17. Unsubscribe from channel messages
APP -> MOD: 18. Destroy subtitle module (destroy)
end

@enduml
