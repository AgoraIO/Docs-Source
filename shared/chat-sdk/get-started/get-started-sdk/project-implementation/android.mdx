<PlatformWrapper platform="android">

When a user opens the app, you initialize the . When the user taps a button, the app joins or leaves a channel. When another user joins the same channel, their video and audio is rendered in the app. This simple workflow enables you to concentrate on implementing Agora features and not UX bells and whistles.

This section shows how to use the Video SDK to implement Video Calling into your app, step-by-step.

This section shows how to use the <Vpd k="SDK"/> to implement <Vpd k="PRODUCT"/> in your app, step by step.

### Create the UI

In the quick start <Vpl k="CLIENT"/>, you create a simple UI that consists of the following elements:

* A `Button` to join or leave a chat.
* An `EditText` box to specify the recipient username.
* An `EditText` box to type the text message.
* A `Button` to send the typed message.
* A scrollable layout to display sent and received messages.

To add the UI framework to your <Vpl k="NAME"/> project, open `app/res/layout/activity_main.xml` and replace the content with the following:

   ```xml
    <?xml version="1.0" encoding="utf-8"?>
    <RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:layout_margin="0dp"
        android:background="#ECE5DD">

        <Button
            android:id="@+id/btn_join_leave"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_alignParentEnd="true"
            android:layout_alignParentTop="true"
            android:layout_margin="5dp"
            android:onClick="joinLeave"
            android:text="Join" />

        <EditText
            android:id="@+id/et_to_chat_name"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_alignBottom="@id/btn_join_leave"
            android:layout_alignTop="@id/btn_join_leave"
            android:layout_toStartOf="@id/btn_join_leave"
            android:layout_margin="5dp"
            android:padding="5dp"
            android:background="#FFFFFF"
            android:hint="Enter recepient username" />

        <ScrollView
            android:id="@+id/scrollView"
            android:layout_width="match_parent"
            android:layout_height="match_parent"
            android:layout_above="@id/btn_send_message"
            android:layout_below="@id/et_to_chat_name"
            android:background="#ECE5DD">

            <LinearLayout
                android:id="@+id/messageList"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="vertical">
            </LinearLayout>
        </ScrollView>

        <EditText
            android:id="@+id/et_msg_content"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_toStartOf="@id/btn_send_message"
            android:layout_alignBottom="@id/btn_send_message"
            android:layout_margin="5dp"
            android:padding="5dp"
            android:background="#FFFFFF"
            android:hint="Message" />

        <Button
            android:id="@+id/btn_send_message"
            android:layout_width="50dp"
            android:layout_margin="5dp"
            android:layout_height="wrap_content"
            android:layout_alignParentEnd="true"
            android:layout_alignParentBottom="true"
            android:onClick="sendMessage"
            android:text=">>" />
    </RelativeLayout>
   ```

You see errors in your IDE. This is because this layout refers to methods that you create later.

### Handle the system logic

Import the necessary Android classes and and add a method to show status updates.

1.  **Import the Android classes**

    In `/app/java/com.example.<projectname>/MainActivity`, add the following lines after `package com.example.<project name>`:

    ```java
    import android.widget.Button;
    import android.widget.EditText;
    import android.widget.LinearLayout;
    import android.widget.TextView;
    import android.view.View;
    import android.widget.Toast;
    import android.graphics.Color;
    import android.view.Gravity;
    import android.view.inputmethod.InputMethodManager;
    ```
   
1.  **Log events and show status updates to your users**

    In `/app/java/com.example.<projectname>/MainActivity`, add the following lines before `onCreate`.

    ``` javascript
    private void showLog(String content) {
        // Show a toast message
        runOnUiThread(() ->
                Toast.makeText(getApplicationContext(), content, Toast.LENGTH_SHORT).show());
        Log.d("AgoraChatQuickstart", content);
    }
    ```

### Implement sending and receiving messages

The following figure shows the API call sequence of implementing  <Vpd k="PRODUCT" />.

![image](/images/chat/chat-call-logic-android.svg)

To enable your <Vpl k="CLIENT" /> to send and receive messages, take the following steps:

1. Define global variables.  
In `app/java/io.agora.agorachatquickstart/MainActivity`, before adding the following lines after `AppCompatActivity {`, ensure you delete the `onCreate` function created by default.

   ```java
   // Replaces <Your username>, <Your token>, and <Your AppKey> with your own App Key, user ID, and user token generated in Agora Console.
   private static final String USERNAME = "<Your username>";
   private static final String TOKEN = "<Your token>";
   private static final String APP_KEY = "<Your AppKey>";
   
   @Override
   protected void onCreate(Bundle savedInstanceState) {
       super.onCreate(savedInstanceState);
       setContentView(R.layout.activity_main);
       initView();
       initSDK();
       initListener();
   }
   ```
   
3. Initialize the view and the app.  
In `app/java/io.agora.agorachatquickstart/MainActivity`, add the following lines after the `onCreate` function: 

   ```java
   // Initializes the view.
   private void initView() {
       ((TextView)findViewById(R.id.tv_log)).setMovementMethod(new ScrollingMovementMethod());
   }
   // Initializes the SDK.
   private void initSDK() {
       ChatOptions options = new ChatOptions();
       // Gets your App Key from Agora Console.
       if(TextUtils.isEmpty(APP_KEY)) {
           Toast.makeText(MainActivity.this, "You should set your AppKey first!", Toast.LENGTH_SHORT).show();
           return;
       }
       // Sets your App Key to options.
       options.setAppKey(APP_KEY);
       // Initializes the Agora Chat SDK.
       ChatClient.getInstance().init(this, options);
       // Makes the Agora Chat SDK debuggable.
       ChatClient.getInstance().setDebugMode(true);
       // Shows the current user.
       ((TextView)findViewById(R.id.tv_username)).setText("Current user: "+USERNAME);
   }
   ```

4. Add event callbacks.  
In `app/java/io.agora.agorachatquickstart/MainActivity`, add the following lines after the `initSDK` function:

   ```java
   private void initListener() {
       // Adds message event callbacks.
       ChatClient.getInstance().chatManager().addMessageListener(messages -> {
           for(ChatMessage message : messages) {
               StringBuilder builder = new StringBuilder();
               builder.append("Receive a ").append(message.getType().name())
                       .append(" message from: ").append(message.getFrom());
               if(message.getType() == ChatMessage.Type.TXT) {
                   builder.append(" content:")
                           .append(((TextMessageBody)message.getBody()).getMessage());
               }
               showLog(builder.toString(), false);
           }
       });
       // Adds connection event callbacks.
       ChatClient.getInstance().addConnectionListener(new ConnectionListener() {
           @Override
           public void onConnected() {
               showLog("onConnected",false);
           }

          @Override
          public void onDisconnected(int error) {
              showLog("onDisconnected: "+error,false);
          }

          @Override
          public void onLogout(int errorCode) {
              showLog("User needs to log out: "+errorCode, false);
              ChatClient.getInstance().logout(false, null);
          }
          // This callback occurs when the token expires. When the callback is triggered, the app client must get a new token from the app server and logs in to the app again.
          @Override
          public void onTokenExpired() {
              showLog("ConnectionListener onTokenExpired", true);
          }
          // This callback occurs when the token is about to expire. 
          @Override
          public void onTokenWillExpire() {
              showLog("ConnectionListener onTokenWillExpire", true);
          }
      });
   }
   ```

5. Log in to the app.  
To implement this logic, in `app/java/io.agora.agorachatquickstart/MainActivity`, add the following lines after the `initListener` function:

   ```java
   // Logs in with a token.
   public void signInWithToken(View view) {
       loginToAgora();
   }

   private void loginToAgora() {
       if(TextUtils.isEmpty(USERNAME) || TextUtils.isEmpty(TOKEN)) {
           showLog("Username or token is empty!", true);
           return;
       }
       ChatClient.getInstance().loginWithAgoraToken(USERNAME, TOKEN, new CallBack() {
           @Override
           public void onSuccess() {
               showLog("Sign in success!", true);
           }

           @Override
           public void onError(int code, String error) {
               showLog(error, true);
           }
       });
   }
   
   // Logs out.
   public void signOut(View view) {
       if(ChatClient.getInstance().isLoggedInBefore()) {
           ChatClient.getInstance().logout(true, new CallBack() {
               @Override
               public void onSuccess() {
                   showLog("Sign out success!", true);
               }

               @Override
               public void onError(int code, String error) {
                   showLog(error, true);
               }
           });
       }else {
           showLog("You were not logged in", false);
       }
   }
   ```

6. Start a chat.  
To enable the function of sending messages, add the following lines after the `signOut` function:

   ```java
   // Sends the first message.
   public void sendFirstMessage(View view) {
       String toSendName = ((EditText)findViewById(R.id.et_to_chat_name)).getText().toString().trim();
       String content = ((EditText)findViewById(R.id.et_msg_content)).getText().toString().trim();
       // Creates a text message.
       ChatMessage message = ChatMessage.createTextSendMessage(content, toSendName);
       // Sets the message callback before sending the message.
       message.setMessageStatusCallback(new CallBack() {
           @Override
           public void onSuccess() {
               showLog("Send message success!", true);
           }

           @Override
           public void onError(int code, String error) {
               showLog(error, true);
           }
       });

       // Sends the message.
       ChatClient.getInstance().chatManager().sendMessage(message);
   }
   ```

7. Show logs.  
To show logs, add the following lines after the `sendFirstMessage` function:

   ```java
   // Shows logs.
   private void showLog(String content, boolean showToast) {
       if(TextUtils.isEmpty(content)) {
           return;
       }
       runOnUiThread(()-> {
           if(showToast) {
               Toast.makeText(this, content, Toast.LENGTH_SHORT).show();
           }
           TextView tv_log = findViewById(R.id.tv_log);
           String preContent = tv_log.getText().toString().trim();
           StringBuilder builder = new StringBuilder();
           builder.append(new SimpleDateFormat("yyyy-MM-dd HH:mm:ss", Locale.getDefault()).format(new Date()))
                   .append(" ").append(content).append("\n").append(preContent);
           tv_log.setText(builder);
       });
   }
   ```

</PlatformWrapper>
