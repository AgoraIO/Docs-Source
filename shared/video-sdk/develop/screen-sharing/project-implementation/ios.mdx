<PlatformWrapper platform="ios">

This section introduces how to implement <Vg k="SCR_SHR" /> in your project. The API call sequence is shown in the figure below:

![Screen Share Process](/images/screen-sharing/tmp_screen-sharing-ios-process.jpg)

### Set up the audio scenario

Call the `setAudioScenario` method and set the audio scenario to `AgoraAudioScenarioGameStreaming` (high-quality scenario) to improve the success rate of capturing system audio during <Vg k="SCR_SHR" />.

### Enable screen capture

1. Call `startScreenCapture` to start screen capture and set the parameters according to your application scenario:

    - `captureVideo`: Whether to capture system video during <Vg k="SCR_SHR" />.
    - `captureAudio`: Whether to capture system audio during <Vg k="SCR_SHR" />.
    - `captureSignalVolume`: Collected system volume.
    - `dimensions`: Resolution of video encoding.
    - `frameRate`: Video encoding frame rate (fps).
    - `bitrate`: Video encoding bit rate (Kbps).
    - `contentHint`: Content type of <Vg k="SCR_SHR" /> video.

    ``` swift
    // Setting parameters for screen capture
    private lazy var screenParams: AgoraScreenCaptureParameters2 = {
            let params = AgoraScreenCaptureParameters2()
            params.captureVideo = true
            params.captureAudio = true
            let audioParams = AgoraScreenAudioParameters()
            // Setting the captured system volume
            audioParams.captureSignalVolume = 50
            params.audioParams = audioParams
            let videoParams = AgoraScreenVideoParameters()
            // Setting the resolution of the shared screen
            videoParams.dimensions = screenShareVideoDimension()
            // Setting the video encoding frame rate
            videoParams.frameRate = .fps15
            // Setting the video encoding bitrate
            videoParams.bitrate = AgoraVideoBitrateStandard
            params.videoParams = videoParams
            return params
        }()
    // Enable screen capture
    agoraKit.startScreenCapture(screenParams)
    ```

1. Combine this with a manual action by the user to make the app turn on <Vg k="SCR_SHR" />. There are two ways to do this:

    - Method 1: Prompt the user to long press the **screen recording** button in the **Control Center** on iOS and choose to use the extension you created to start recording.
    - Method 2: Use Apple's new [RPSystemBroadcastPickerView](https://developer.apple.com/documentation/replaykit/rpsystembroadcastpickerview) in iOS 12.0 to make the "Enable Screen Sharing" button pop up on the App interface, prompting the user to click the button to start recording. The sample code is as follows:

        ``` swift
        let frame = CGRect(x: 0, y:0, width: 60, height: 60)
        systemBroadcastPicker = RPSystemBroadcastPickerView(frame: frame)
        systemBroadcastPicker?.showsMicrophoneButton = false
        systemBroadcastPicker?.autoresizingMask = [.flexibleTopMargin, .flexibleRightMargin]
        // Get the Bundle Identifier of the main application
        let bundleId = Bundle.main.bundleIdentifier ?? ""
        // Set the Extension Name
        systemBroadcastPicker?.preferredExtension = "\(bundleId).Agora-ScreenShare-Extension"
        ```

    `RPSystemBroadcastPickerView` has some usage limitations and may become invalid in subsequent versions of iOS. Therefore, please use Mode 2 as appropriate.

### Publish a <Vg k="SCR_SHR" /> video stream in a channel

After joining the channel, call `updateChannelWithMediaOptions` to publish the captured <Vg k="SCR_SHR" /> video stream as follows:

    ``` swift
    // Define the behavior of rtcEngine when performing screen video capture (state is capturing, sourceType is screen)
    func rtcEngine(_ engine: AgoraRtcEngineKit, localVideoStateChangedOf state: AgoraVideoLocalState, error: AgoraLocalVideoStreamError, sourceType: AgoraVideoSourceType) {
        switch (state, sourceType) {
        case (.capturing, .screen):
            // Post screen captured videos in the channel
            option.publishScreenCaptureVideo = true
            // Post screen captured videos in the channel
            option.publishScreenCaptureAudio = true
            // Avoid release of camera-captured video
            option.publishCameraTrack = false
            // Update the channel settings with the options set above
            agoraKit.updateChannel(with: option)

        default: break
        }
    }
    ```

### (Optional) Set up a <Vg k="SCR_SHR" /> scene

Call the `setScreenCaptureScenario` method to set the <Vg k="SCR_SHR" /> scenario, and set the `scenarioType` to any one of the following according to the actual usage scenario:
    - AgoraScreenScenarioDocument(1): Document scene
    - AgoraScreenScenarioGaming(2): Game scene
    - AgoraScreenScenarioVideo(3): Video scene
    - AgoraScreenScenarioRDC(4): Remote control scene

The sample code is as below:

    ``` swift
    agoraKit.setScreenCaptureScenario(.video)
    ```

### (Optional) Update <Vg k="SCR_SHR" />

If you want to update the <Vg k="SCR_SHR" /> parameters, call `updateScreenCapture` to modify the parameters. For example: video encoding resolution, frame rate, bit rate.

    ``` swift
    agoraKit.updateScreenCapture(screenParams)
    ```

### Stop <Vg k="SCR_SHR" />

Call `stopScreenCapture` to stop <Vg k="SCR_SHR" /> within the channel. The sample code is as follows:

    ``` swift
    agoraKit.stopScreenCapture()
    //  Stop posting screen captured videos in the channel
    option.publishScreenCaptureVideo = false
    //  Stop posting screen captured audio in the channel
    option.publishScreenCaptureAudio = false
    // Post camera captured videos in the channel
    option.publishCameraTrack = true
    agoraKit.updateChannel(with: option)
    ```

</PlatformWrapper>