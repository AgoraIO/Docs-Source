<PlatformWrapper platform="web">

## v2.1.1

v2.1.1 was released on June 15, 2023.

This is the first release of the Signaling SDK for Web 2.x.
This release marks that Agora's real-time messaging product RTM have entered a new era, which bring innovations to users in terms of functional coverage, performance improvement, and experience optimization.

- Functional variety: The 2.x version covers more business scenarios by introducing functional modules such as channels, messages, topics, presence, storage, and locks. This enables you to focus more on your own business innovation.

- Performance improvement: In the 2.x version, we implemented a restructured technical architecture and achieved enhanced performance through optimized network connections. Our long-term real-time network access capabilities ensure high service quality, characterized by low latency, high reliability, extensive concurrency, and robust extensibility.

- Experience optimization: We have revamped and streamlined our APIs to support the widely adopted Async/Await programming model in the industry. Additionally, we have enriched our documentation, including user guides and API references, with extensive sample code to provide developers with comprehensive resources. These improvements significantly reduce the effort required to understand and integrate our SDKs, ultimately enhancing development efficiency.

#### New features

The core functional modules provided by this version are as follows:

<Admonition type="caution" title="Caution">
Please note that as RTM 2.1.1-beta is currently in the Public Beta stage, certain specific functionalities may be subject to future changes aimed at improving the overall user experience.
</Admonition>

##### Initial configuration

The initial configuration of the RTM Client involves pre-defining or configuring key parameters that influence its subsequent behaviors. Additionally, it offers functions such as login and logout. The core competencies of the RTM Client are as follows:

- `new RTM`: Create an instance of RTM Client and perform the initial configuration as follows:
   - `appId`: Set the App ID to enable communication between apps with the same ID while isolating apps with different IDs
   - `userId`: Set the user ID to distinguish users or devices.
     - `rtmConfig`:
     - `token`: Set the token for user authentication.
     - `encryptionMode`: Specify the end-to-end encryption mode.
     - `cipherKey`: Set the encryption key for end-to-end encryption.
     - `salt`: Set the salt for end-to-end encryption.
     - `heartbeatInterval`: Define the interval for end-to-end heartbeat keep-alive.
     - `logUpload`: Configure whether to enable log upload.
     - `logFilter`: Set the level for log filtering.
     - `cloudProxy`: Configure whether to enable cloud proxy.
     - `useStringUserId`: Specify whether to use a string type user ID.
- Event handling: implement event notification for the events such as `OnMessageEvent`, `OnPresenceEvent`, `OnStorageEvent`, `OnTopicEvent`, `OnLockEvent`, `OnConnectionStateChange`, `OnTokenPrivilegeWillExpire`.
- `LoginAsync`: Log into the RTM service.
- `LogoutAsync`: Log out of the RTM service.

##### Channel

In the RTM real-time network, channels serve as a mechanism for managing data transmission. When a user subscribes to or joins a channel, they can receive messages and events transmitted within the channel with a latency of up to 100 ms. RTM enables clients to subscribe to hundreds or even thousands of channels. Most RTM APIs perform operations such as sending, receiving, and encrypting data on a channel basis.

RTM comprises two types of channel, message channel and stream channel, each offering distinct core capabilities as follows:

- Message channel:
     - `SubscribeAsync`: Subscribe to the specified message channel and receive messages and event notifications in the channel.
     - `UnsubscribeAsync`: Unsubscribe from the specified message channel and stop receiving messages and event notifications in the channel.

- Stream channel:
     - `CreateStreamChannel`: Create a stream channel instance and then call relevant APIs.
     - `JoinAsync`: Join the stream channel and receive messages and event notifications in the channel.
     - `LeaveAsync`: Leave the stream channel and stop receiving messages and event notifications in the channel.


- `SubscribeAsync`, `UnsubscribeAsync`, `JoinAsync`, `LeaveAsync` methods trigger the `OnPresenceEvent` event notification. Other users in the channel receive corresponding `Join` and `Leave` event notifications.
- When calling `SubscribeAsync` and `JoinAsync` to subscribe or join a channel, you can choose whether to configure` withMessage`, `withPresence`, `withMetadata`, `withLock` and other parameters to enable or disable the monitoring of the corresponding event. To enable the monitoring, you also need to register the corresponding event listener to receive corresponding event notifications.

##### Message

The basis of RTM is the ability to send messages. You can send messages to channels anytime, anywhere, and the messages will be delivered within 100 milliseconds. RTM supports message payloads both of string type and binary type .

Call `PublishAsync` to send a message to the specified message channel. Calling `PublishAsync` triggers the `OnMessageEvent` event notification. If you want to receive messages in the channel, You need to set `withMessage`as `true` when calling `SubscribeAsync`, register the event handler for the `OnMessageEvent` event.

##### Topic

In stream channels, topics serve as a data flow management mechanism. This feature allows you to subscribe to, distribute, and notify events related to data streams within stream channels. By leveraging topics effectively, you can significantly reduce business complexity and enhance development efficiency. The main functions of topics are as follows:

- `JoinTopicAsync`: Register as the publisher of this topic, to gain the ability to send messages.
- `PublishTopicMessageAsync`: Send a message to the topic in the stream channel.
- `LeaveTopicAsync`: Unregister as the message publisher of this topic.
- `SubscribeTopicAsync`: Subscribe to one or more message publishers of the topic in this channel.
- `UnsubscribeTopicAsync`: Unsubscribe from this topic or unsubscribe from one or more message publishers in this topic.

Register (`JoinTopicAsync`) or unregister (`LeaveTopicAsync`) as a message publisher triggers `OnTopicEvent` event notification that's sent to other users in the channel.

<Admonition type="caution" title="Note">Topics exist only in stream channels, not in message channels. </Admonition>

##### Presence

Presence provides the ability to monitor the online status and temporary status changes of users. With presence, you can obtain real-time information as follows:

- Get the list of online users in a channel.
- Get the list of channels that an online user joins.
- Dynamically monitor user joining or leaving a channel.
- Dynamically monitor changes of the temporary status of online users.

The following features can be used in both message channels and stream channels:

- `WhoNowAsync`: Get real-time information about the number of online users, the list of online users, and their temporary status in a specified channel.
- `WhereNowAsync`: Get real-time information about the list of channels in which a specific user joins.
- `SetStateAsync`: Set the temporary status of a user in a specified channel.
- `GetStateAsync`: Get the temporary status of a user in a specified channel.
- `RemoveStateAsync`: Remove the temporary status of a user in a specific channel.

In addition, presence also provides event notification capabilities through `OnPresenceEvent`. Events such as users joining, leaving, offline, setting user state, and removing user state are sent as notifications to other users in the channel in real-time (Announce Mode) or at regular intervals (Interval Mode). Presence greatly simplifies the implementation of synchronization logic related to user online and offline status and state changes. This feature help make your business more stable, real-time, and reliable.

##### Storage

The storage feature provides a dynamic database mechanism that allows developers to dynamically set, store, update, and delete channel metadata and user metadata. It also listens to the events generated by changes of channel metadata or user metadata.

###### Channel metadata

- `SetChannelMetadataAsync`: Set the channel metadata or channel metadata item for a specified channel.
- `GetChannelMetadataAsync`: Retrieve the channel metadata and channel metadata item for a specified channel.
- `RemoveChannelMetadataAsync`: Delete the channel metadata or channel metadata item for a specified channel.
- `UpdateChannelMetadataAsync`: Update the existing channel metadata or channel metadata item for a specified channel.

Setting, deleting, and updating channel metadata triggers the event notification `OnStorageEvent`. This feature can greatly optimize your business logic and provide an excellent user experience. Currently, the event notification `OnStorageEvent` carries the complete information of the current channel metadata. We will optimize it in future versions to provide incremental update capabilities.

Channel metadata also introduces the ability to control locks. When calling APIs to set, delete, or update channel metadata, if the `lockName` parameter is set, lock verification is enabled. In this case, only the owners of the lock can call the corresponding methods successfully.

###### User metadata

- `SetUserMetadataAsync`: Set the user metadata or user metadata item for a specified user.
- `GetUserMetadataAsync`: Retrieve the user metadata and user metadata item for a specified user.
- `RemoveUserMetadataAsync`: Delete the user metadata or user metadata item for a specified user.
- `UpdateUserMetadataAsync`: Update the existing user metadata or user metadata item for a specified user.
- `SubscribeUserMetadataAsync`: Subscribe to event notifications for changes in user metadata or user metadata item for a specified user.
- `UnsubscribeUserMetadataAsync`: Unsubscribe from event notifications for changes in user metadata or user metadata item for a specified user.

Setting, deleting, and updating user metadata trigger the event notification `OnStorageEvent`. Other users subscribed to this user metadata receives the event notifications. This feature can greatly optimize your business logic and provide an excellent user experience. Currently, the event notification `OnStorageEvent` carries the complete information of the current user metadata. We will optimize it in future versions to provide incremental update capabilities.

###### Compare And Set (CAS) Control

Both channel metadata and user metadata introduce the CAS version control logic, which provides two independent version control fields that you can use according to your business scenario:

- By using the `majorRevision` property in `RtmMetadata` class, you can enable version number verification for the metadata array.
- By using the `revision` property in the `MetadataItem` class within `RtmMetadata`, you can enable version number verification for each metadata item array.

When setting, deleting, or updating channel metadata or user metadata, you can control whether to enable revision verification by using the `majorRevision` or `revision` property. The logic is as follows:

- If `majorRevision` or `revision` is set as `-1`, the CAS validation is not enabled for this call. If the metadata or metadata item already exists, it will be overwritten by the latest value. If the metadata or metadata item does not exist, a new metadata or metadata item will be created.
- If `majorRevision` or `revision` is set as a positive Uint64 integer, the CAS validation is enabled for this call. If the metadata or metadata item already exists, the value will be updated after successful version number validation. If the metadata or metadata item does not exist, the SDK will return an error code.

##### Lock

A critical resource can only be used by one process at a time. If different processes share a critical resource, they need to adopt a mutually exclusive approach to prevent interference. RTM offers a comprehensive set of lock solutions and process control in distributed systems, enabling you to effectively manage competition among users accessing shared resources. Lock provides the following capabilities:

- `SetLockAsync`: Set a lock for a specified channel.
- `AcquireLockAsync`: Acquire a specified lock in a specified channel.
- `ReleaseLockAsync`: Release a specified lock in a specified channel.
- `RevokeLockAsync`: Revoke the ownership of a specific user for a lock in a specified channel to release the lock.
- `GetLocksAsync`: Retrieves the details of all locks in a specified channel.
- `RemoveLockAsync`: Delete a specified lock in a specified channel.

</PlatformWrapper>