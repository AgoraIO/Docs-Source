import Authorization from '@docs/shared/media-gateway/reference/rest-api/authorization.mdx';
import CodeBlock from '@theme/CodeBlock';
import PostmanLink from '@docs/shared/media-gateway/reference/rest-api/postman-link.mdx';
import RestAPILayout from '@site/src/components/rest-api/RestAPILayout'; 
import LeftColumn from '@site/src/components/rest-api/LeftColumn'; 
import RightColumn, { Section } from '@site/src/components/rest-api/RightColumn'; 
import ParameterList, { Parameter } from '@site/src/components/rest-api/ParameterList'; 
import PathParameter from '@site/src/components/rest-api/PathParameter'; 
import { Tabs, TabItem } from '@site/src/components/rest-api/Tabs';

<RestAPILayout>

  <LeftColumn
    title={frontMatter.title}
    method="PATCH"
    endpoint="https://api.agora.io/:region/v1/projects/:appId/rtls/ingress/stream-templates/:templateId"
  >

This method updates a flow configuration template.

<Admonition type="info" title="Note"><ul><li>This interface can only be called if the flow configuration template already exists.</li><li>Modifications to a flow configuration template will only take effect after the stream is re-pushed. Considering the synchronization delay between the gateway and the database, wait 3 minutes after calling this interface before re-pushing the stream.</li></ul></Admonition>

### Request

**Path parameters**

<PathParameter name="appId" type="string" required={true}>
  The app ID provided by <Vg k="COMPANY"/> to each developer. After creating a project in <Vg k="CONSOLE"/>, you can get an app ID. The app ID is a unique identifier for a project.
</PathParameter>
<PathParameter name="region" type="string" required={true}>
  Create an area for pushing the streaming key. <Vg k="COMPANY"/> supports creation of stream keys by region. Currently, the following regions are supported: 
  <ul>
    <li><code>na</code>: North America</li>
    <li><code>eu</code>: Europe</li>
    <li><code>ap</code>: Asia, except mainland China</li>
    <li><code>cn</code>: Mainland China</li>
  </ul>
  <Admonition type="caution" title="Important">
    Make sure that: 
    <ul>
      <li>The <code>region</code> value is the same as for the input source stream.</li>
      <li>The domain names for setting the <code>region</code> parameter and streaming are the same.</li>
      <li>The <code>region</code> value is in lowercase.</li>
    </ul>
  </Admonition>
</PathParameter>
<PathParameter name="templateId" type="string" required={true}>
  The flow configuration template ID. The value can only include the following characters: <code>a-z</code>, <code>A-Z</code>, <code>0-9</code>, and the length cannot exceed 12 bytes. 
  
  The value of the flow configuration template ID can be set according to your business use-case. For example:
  <ul>
    <li><code>"720p"</code> and <code>"1080p"</code> for different target resolutions.</li>
    <li><code>"gameA"</code> and <code>"gameB"</code> for different game use cases.</li>
  </ul>
</PathParameter>

**Headers**

<ParameterList title="HEADER" required={true}>
  <Parameter name="X-Request-ID" type="string" required={true}>
    The UUID (Universally Unique Identifier) of the request. After passing in this field, the <Vg k="COMPANY"/> server will return this field in the response header. It is recommended to assign `X-Request-ID` a value. If no value is assigned, the <Vg k="COMPANY"/> server will automatically generate a UUID and pass it in.
  </Parameter>
  <Parameter name="Authorization" type="string" required={true}>
  <Authorization/>
  </Parameter>
</ParameterList>

**Request body**

The request body consists of a JSON Object type `settings` and includes the following fields:

<ParameterList title="BODY" required={false}>
  <Parameter name="transcoding" type="object" required={false}>
    Audio and video transcoding parameter configuration.
    <Parameter name="video" type="object" required={false}>
      Video transcoding parameters.
      <Parameter name="enabled" type="boolean" required={false}>
        Whether to enable video transcoding. Disabled by default.
      </Parameter>
      <Parameter name="mode" type="string" required={false}>
        The transcoding mode.
        <ul>
          <li><code>force</code> (default): Force transcoding.</li>
          <li><code>adaptive</code>: Adaptive transcoding.</li>
        </ul>
      </Parameter>
      <Parameter name="codec" type="string" required={false}>
        The codec format for transcoding. Supported values: <code>H.264</code> (default) and <code>VP8</code>.
      </Parameter>
      <Parameter name="width" type="number" required={false}>
        The width in the encoding resolution (0 to 1920). If <code>0</code>, follows source stream width.
      </Parameter>
      <Parameter name="height" type="number" required={false}>
        The height in the encoding resolution (0 to 1920). If <code>0</code>, follows source stream height.
      </Parameter>
      <Parameter name="fps" type="number" required={false}>
        The video encoding frame rate (0 to 60). If <code>0</code>, follows source stream frame rate.
      </Parameter>
      <Parameter name="simulcastStream" type="object" required={false}>
        Video stream configuration for low-quality stream.
        <Parameter name="width" type="number" required={false}>
          The width of the video stream (0 to 1920). Must be less than <code>video.width</code>. Defaults to <code>video.width / 2</code>.
        </Parameter>
        <Parameter name="height" type="number" required={false}>
          The height of the video stream (0 to 1920). Must be less than <code>video.height</code>. Defaults to <code>video.height / 2</code>.
        </Parameter>
        <Parameter name="fps" type="number" required={false}>
          The frame rate of the video stream (0 to 60). Must be ≤ <code>video.fps</code>. Defaults to 15.
        </Parameter>
        <Parameter name="bitrate" type="number" required={false}>
          The bitrate of the low-quality video stream (in Kbps). Must be less than <code>video.bitrate</code>. Defaults automatically.
        </Parameter>
      </Parameter>
      <Parameter name="bitrate" type="number" required={false}>
        Video encoding bitrate in Kbps. If <code>simulcastStream</code> is enabled, must be greater than <code>simulcastStream.bitrate</code>. Defaults automatically. For more information, see [video profiles](#video-profiles).
      </Parameter>
    </Parameter>
    <Parameter name="audio" type="object" required={false}>
      Audio transcoding parameters.
      <Parameter name="enabled" type="boolean" required={false}>
        Whether to enable audio transcoding. Enabled by default.
      </Parameter>
      <Parameter name="profile" type="number" required={false}>
        Encoded audio profile. Default is <code>0</code> (48 KHz, music encoding, mono, max 64 Kbps). Contact support for other profiles.
      </Parameter>
      <Parameter name="bitrate" type="number" required={false}>
        Encoding bitrate in Kbps (64-320). Defaults based on <code>profile</code>.
      </Parameter>
    </Parameter>
  </Parameter>
  <Parameter name="jitterBuffer" type="object" required={false}>
    Network jitter buffer (effective only when video transcoding is enabled).
    <Parameter name="size" type="number" required={false}>
      Maximum length in ms. Default: 500 ms (adds delay to reduce lag caused by network jitter).
    </Parameter>
    <Parameter name="maxSize" type="number" required={false}>
      Maximum length in ms. Default: 1000 ms. Must be greater than <code>jitterBuffer.size</code>. If exceeded, acceleration is enabled.
    </Parameter>
  </Parameter>
</ParameterList>

<Admonition type="info" title="Note"><ul><li>To ensure a successful request, do not set the required fields to `null` or leave them empty.</li><li>The parameters supported for the update are the following: `transcoding.video`, `transcoding.audio`, and `jitterBuffer`. This means that, for example, if you only want to update the `fps` field of `transcoding.video`, you need to pass in the entire `transcoding.video` field with the modified `fps` field and other fields unchanged.</li><li>`transcoding.video`, `transcoding.audio`, and `jitterBuffer` are independent of each other. If only `transcoding.video` is passed in, then only its parameters will be updated and the parameters of `transcoding.audio` and `jitterBuffer` will not be affected.</li></ul></Admonition>


### Response

**Headers**

<ParameterList title="HEADER" required={true}>
  <Parameter name="X-Request-ID" type="string" required={true}>
  The UUID (Universally Unique Identifier) of the request. The value is in its `X-Request-ID` header. If a request error occurs, print the value in the log to troubleshoot the problem. A `401 (Unauthorized)` response status code means that there is no such field in the response header.
  </Parameter>
</ParameterList>
**Response body**

If the status code is `200`, the request succeeds, and the response body includes the following parameters:

<ParameterList title="BODY" required={true}>
  <Parameter name="status" type="string" required={true}>
    The status of this request. <code>success</code> means the request succeeds.
  </Parameter>
</ParameterList>
If the status code is not `200`, the request fails. See the `message` field in the response body for the reason for this failure. For details about possible response status codes, see [Response status codes](../../response-status-codes).


<PostmanLink />

## Reference

This section contains content that completes the information on this page, or points you to documentation that explains other aspects to this product.

### Video profiles

<table><thead><tr><th>Resolution (width × height, px)</th><th>Frame rate (fps)</th><th>Bitrate (Kbps)</th></tr></thead><tbody><tr><td>640 × 360</td><td>15</td><td>680</td></tr><tr><td>640 × 360</td><td>30</td><td>1030</td></tr><tr><td>848 × 480</td><td>15</td><td>920</td></tr><tr><td>848 × 480</td><td>30</td><td>1400</td></tr><tr><td>960 × 540</td><td>15</td><td>1100</td></tr><tr><td>960 × 540</td><td>30</td><td>1670</td></tr><tr><td>1280 × 720</td><td>15</td><td>1600</td></tr><tr><td>1280 × 720</td><td>30</td><td>2400</td></tr><tr><td>1920 × 1080</td><td>15</td><td>2500</td></tr><tr><td>1920 × 1080</td><td>30</td><td>3780</td></tr><tr><td>1920 × 1080</td><td>60</td><td>5730</td></tr></tbody></table>


</LeftColumn>
<RightColumn>
<Section title="Authorization">
The endpoint requires [RESTful Authentication](/media-gateway/reference/restful-authentication#implement-basic-http-authentication).
</Section>
<Section title="Request example">
  <Tabs groupId="code-examples">
    <TabItem value="cURL" label="cURL" default>
    ```shell
    curl --location -g --request PUT 'https://api.agora.io/{{region}}/v1/projects/{{appId}}/rtls/ingress/stream-templates/{{templateId}}' \
    --data '
    {
        "settings": {
            "transcoding": {
                "video": {
                    "enabled": true,
                    "codec": "H.264",
                    "width": 1280,
                    "height": 720,
                    "fps": 24,
                    "bitrate": 2200,
                    "simulcastStream": {
                        "width": 960,
                        "height": 540,
                        "fps": 24,
                        "bitrate": 1670
                    }
                }
            }
        }
    }'
    ```
    </TabItem>
    <TabItem value="node" label="Node" default>
    ```js
    const url = `https://api.agora.io/${region}/v1/projects/${appId}/rtls/ingress/stream-templates/${templateId}`;

    const data = {
        settings: {
            transcoding: {
                video: {
                    enabled: true,
                    codec: "H.264",
                    width: 1280,
                    height: 720,
                    fps: 24,
                    bitrate: 2200,
                    simulcastStream: {
                        width: 960,
                        height: 540,
                        fps: 24,
                        bitrate: 1670
                    }
                }
            }
        }
    };

    fetch(url, {
        method: "PUT",
        headers: {
            "Content-Type": "application/json",
            "Accept": "application/json",
            "Authorization": "Basic <Base64EncodedCredentials>"
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => console.log("Success:", data))
    .catch(error => console.error("Error:", error));

    ```
    </TabItem>
    <TabItem value="python" label="Python" default>
    ```python
    url = f"https://api.agora.io/{region}/v1/projects/{appId}/rtls/ingress/stream-templates/{templateId}"

    headers = {
        "Content-Type": "application/json",
        "Accept": "application/json",
        "Authorization": "Basic <Base64EncodedCredentials>"
    }

    data = {
        "settings": {
            "transcoding": {
                "video": {
                    "enabled": True,
                    "codec": "H.264",
                    "width": 1280,
                    "height": 720,
                    "fps": 24,
                    "bitrate": 2200,
                    "simulcastStream": {
                        "width": 960,
                        "height": 540,
                        "fps": 24,
                        "bitrate": 1670
                    }
                }
            }
        }
    }

    response = requests.put(url, headers=headers, data=json.dumps(data))

    print(response.status_code, response.json())

    ```
    </TabItem>
  </Tabs>
</Section>
<Section title="Response example">
```json
{
  "status": "success"
}
```
</Section>
</RightColumn>
</RestAPILayout>
