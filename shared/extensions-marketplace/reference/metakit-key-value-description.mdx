import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import NotAvailable from '@docs/shared/common/not-available.mdx'

<PlatformWrapper platform="[android,ios,macos]">

<PlatformWrapper platform="android">
To implement the capabilities of the `MetaKit` plugin, use the <Link to="{{global.API_REF_ANDROID_ROOT}}/class_irtcengine.html#api_irtcengine_setextensionproperty">setExtensionProperty</Link> method provided by Agora SDK v4.x. Pass in the specified `key` and `value` as follows:
</PlatformWrapper>

<PlatformWrapper platform="[ios,macos]">
To implement the capabilities of the `MetaKit` plugin, use the <Link to="{{Global.API_REF_IOS_ROOT_RTC_KIT}}/setextensionpropertywithvendor(_:extension:extensioninfo:key:value:)">setExtensionPropertyWithVendor</Link> method provided by Agora SDK v4.x. Pass in the specified `key` and `value` as follows:
</PlatformWrapper>

- `key`: Corresponds to different interfaces of MetaKit plugins.
- `value`: Encapsulates some or all of the interface parameters in JSON format.

This guide explains how to use different key-value pairs to implement the MetaKit plugin's virtual human, Animoji, lighting effects, and 360 background function modules.

## Basic Functions

<PlatformWrapper platform="android">

This section covers how to implement the basic functions of the MetaKit plugin, such as initialization, loading scene resources, enabling texture requests, switching texture scene modes, and avatars. Once you have implemented the basic functions, you can explore the specific functional modules.

</PlatformWrapper>

<PlatformWrapper platform="ios">

This section covers how to implement the basic functions of the MetaKit plugin, such as initialization, loading scene resources, and adding scene views. Once you have implemented the basic functions, you can explore the specific functional modules.

</PlatformWrapper>

<PlatformWrapper platform="android">

### Setting up the Android Activity Context

- `key`: `setActivityContext`
- `value`: Object. Contains the following fields:
  - `activityContext`: String. The address of the activity context.

</PlatformWrapper>

### Initialize the Engine

- `key`: `initialize`
- `value`: `{}`

### Load Scene Resources

- `key`: `loadScene`
- `value`: Object. Contains the following fields:
  - `sceneInfo`: Object. Contains the following fields:
    - `scenePath`: String. The path of the scene asset package, e.g., `"/sdcard/metaAssets/15"`.
  - `extraCustomInfo`: Object. Contains the following fields:
    - `sceneIndex`: Int. The index of the scene, currently only supports `0`.

<PlatformWrapper platform="android">

### Enable Texture Request

Request a texture and render the specified scene content on the texture. This includes virtual humans, Animoji, lighting effects, and 360 backgrounds.

- `key`: `requestTexture`
- `value`: Object. Contains the following fields:
  - `index`: Int. Texture index, currently only supports `0`.
  - `enable`: Boolean. Whether to enable the texture request. `true`: Enable; `false`: Disable (default).
  - `config`: Object. Contains the following fields:
    - `width`: Int. The width of the view (px). Set this to the current camera acquisition resolution, the width and height of the screen layout, or a common resolution like 720 × 1280.
    - `height`: Int. The height of the view (px). Set this to the current camera acquisition resolution, the width and height of the screen layout, or a common resolution like 720 × 1280.
    - `extraInfo`: Object. Contains the following fields:
      - `sceneIndex`: (optional) Int. Scene index, currently only supports `0`.
      - `avatarMode`: (optional) Int. Scene mode. `0`: Avatar (default); `1`: Animoji; `2`: Light or background.
      - `avatar`: (optional) String. Avatar or Animoji image. If `avatarMode` is `0` (avatar), set to `girl` or `huamulan` (default is `girl`); if `avatarMode` is `1` (Animoji), set to `dog`, `girlhead`, or `arkit` (default is `dog`).

<Admonition type="info" title="Information">
The `requestTexture` and [`addSceneView`](#adding-a-scene-view) methods can both be used to render a specified scene on `TextureView`. Agora recommends using `requestTexture` for better rendering performance and lower latency. Here are the differences:
  - `requestTexture` does not require passing the render target `TextureView` to the MetaKit plugin; it automatically generates and sends back texture data. `addSceneView` requires manual creation and management of `TextureView`.
  - With `requestTexture`, the obtained texture is directly rendered, previewed, encoded by the SDK, and transmitted to the remote end. `addSceneView` requires an additional call to [`enableSceneVideo`](#enable-scene-view-capture) to enable scene screen capture.
  - `requestTexture` supports a single view; `addSceneView` supports multiple views.
  - For scene mode or avatar switching, use `requestTexture` to request textures and [`switchTextureAvatarMode`](#switch-texture-scene) for scene switching. Use `addSceneView` to add scene views and [`switchAvatarMode`](#switch-view-scene) to complete scene switching.
  - To release scene resources, use `requestTexture` and set `enable` to `false` to stop texture requests. If you added a scene view using `addSceneView`, use [`removeSceneView`](#remove-the-scene-view) to remove it.
</Admonition>

### Switch Texture Scene

After enabling texture requests, switch the scene mode of the texture view or the virtual human or Animoji image in the scene.

- `key`: `switchTextureAvatarMode`
- `value`: Object. Contains the following fields:
  - `index`: Int. Texture index, currently only supports `0`.
  - `mode`: (optional) Int. Scene mode to switch to. `0`: Avatar; `1`: Animoji; `2`: Video capture screen.
  - `avatar`: (optional) String. Avatar or Animoji to switch to. If `avatarMode` is `0` (avatar), set to `girl` or `huamulan`; if `avatarMode` is `1` (Animoji), set to `dog`, `girlhead`, or `arkit`.

</PlatformWrapper>

### Adding a Scene View

Add a MetaKit scene to a native `view` and render the specified scene content. This includes virtual people, Animoji, lighting effects, and 360 backgrounds.

<Admonition type="caution" title="Caution">
<PlatformWrapper platform="android">
- Supports adding up to 8 scene views.
- Currently, only lighting and background effects for video capture are supported. To enable `backgroundEffect`, `avatarMode` must be set to `2`.
</PlatformWrapper>
<PlatformWrapper platform="ios">
- Supports adding up to 7 scene views.
- Currently, only lighting and background effects for video capture are supported. To enable `backgroundEffect`, `avatarMode` must be set to `2`.
</PlatformWrapper>
</Admonition>

- `key`: `addSceneView`
- `value`: Object. Contains the following fields:
  - `view`: Int64. The address handle of the view.
  - `config`: Object. Contains the following fields:
    - `width`: (optional) Int. The width of the view (px). Defaults to full screen if not specified.
    - `height`: (optional) Int. The height of the view (px). Defaults to full screen if not specified.
    - `extraInfo`: Object. Contains the following fields:
      - `sceneIndex`: Int. Scene index, currently only supports `0`.
      - `avatarMode`: (optional) Int. Scene mode. `0`: (default) avatar; `1`: Animoji; `2`: video capture screen.
      - `avatar`: (optional) String. Avatar or Animoji image. If `avatarMode` is `0` (avatar), set to `girl` or `huamulan` (default is `girl`). If `avatarMode` is `1` (Animoji), set to `dog`, `girlhead`, or `arkit` (default is `dog`).
      - `backgroundEffect`: (optional) Boolean. Enables lighting effects and 360 background functions. `true`: Enable; `false`: (default) Disable.

### Switch View Scene

After adding a scene view, you can switch the scene mode or the virtual human or Animoji image in the scene.

- `key`: `switchAvatarMode`
- `value`: Object. Contains the following fields:
  - `viewAddress`: Int64. The address handle of the view.
  - `mode`: (optional) Int. Specifies the scene mode to switch to. `0`: avatar; `1`: Animoji; `2`: video capture screen.
  - `avatar`: (optional) String. Specifies the avatar or Animoji to switch to. If `avatarMode` is `0` (avatar), set to `girl` or `huamulan`. If `avatarMode` is `1` (Animoji), set to `dog`, `girlhead`, or `arkit`.

### Enable Scene View Capture

<PlatformWrapper platform="android">

After enabling scene view capture, call <Link to="{{Global.API_REF_ANDROID_ROOT}}/class_irtcengine.html#api_irtcengine_joinchannel2">joinChannel</Link> to join the channel and publish the scene view's video stream.

</PlatformWrapper>
<PlatformWrapper platform="ios">

After enabling scene view capture, call <Link target="_blank" to="{{Global.API_REF_IOS_ROOT_RTC_ENGINE_KIT}}/joinchannel(bytoken:channelid:uid:mediaoptions:joinsuccess:)">joinChannel</Link> to join the channel and publish the scene view's video stream.

</PlatformWrapper>

- `key`: `enableSceneVideo`
- `value`: Object. Contains the following fields:\
  - `view`: Int64. The address handle of the view.
  - `enable`: (optional) Boolean. Enables scene view capture. `true`: Enable; `false`: (default) Disable.

### Remove the Scene View

Remove the MetaKit scene view from `view`.

- `key`: `removeSceneView`
- `value`: Object. Contains the following fields:
  - `view`: Int64. The address handle of the view.

### Unload Scene Resources

- `key`: `unloadScene`
- `value`: `{}`

### Destroy the Engine

- `key`: `destroy`
- `value`: `{}`

## Virtual Human

<PlatformWrapper platform="android">

The MetaKit plugin allows you to switch the image, viewpoint, face, and outfit of the avatar. To experience the avatar-related functions, you need to set `avatarMode` to `0` when [enabling texture request](#Enabling texture request) or [adding scene view](#Adding scene view).

</PlatformWrapper>

<PlatformWrapper platform="ios">

The MetaKit plugin allows you to switch the image, viewpoint, face, and outfit of the avatar. To experience the avatar-related functions, you need to set `avatarMode` to `0` when [adding a scene view](#Adding a scene view).

</PlatformWrapper>

<Admonition type="info" title="Information">
In addition to the existing avatars in the `girl` and `huamulan` plugins, the Agora MetaKit plugin provides an open art ecosystem and supports **one-click import** of avatar models made according to Agora's art standards, providing users with more flexible creation and integration options. [Contact Agora Technical Support](mailto:extensions.marketplace@agora.io) to use this feature.
</Admonition>

### Switch Virtual Human Perspective

- `key`: `setCamera`
- `value`: Object. Contains the following fields:
    - `viewMode`: Int. The avatar camera view. `0`: show the avatar's full body; `1`: (default) focus on the avatar's upper body; `2`: focus on the avatar's face.

### Virtual Human Face Pinching

The MetaKit plug-in provides a set of face-shaping resources for virtual images.

<Admonition type="caution" title="Caution">
Currently only the `girl` avatar supports face pinching.
</Admonition>

- `key`: `updateFace`
- `value`: Object. Contains the following fields:
    - `key`: String. Resource ID, such as `MC_updown_1` (upward bend of the mouth corner) and `MC_updown_2` (downward bend of the mouth corner). See [Face pinching resources](../reference/face-pinching-resources) for details.
    - `value`: Int. Adjustment range, range is [0, 100], default value is 50. Supports passing in multiple sets of face-pinching resource IDs (`key`) and corresponding adjustment ranges (`value`) to achieve the final face-pinching effect. The example of setting `MC_updown_1` and `MC_updown_2` to 100 respectively is as follows:

    ![Mouse down](/images/extensions-marketplace/virtual-human-mouse-down.png)

### Avatar Dress Up

The MetaKit plugin provides a set of dressing resources for avatars.

<Admonition type="caution" title="Caution">
Currently only the `girl` avatar supports changing clothes.
</Admonition>

- `key`: `updateDress`
- `value`: Object. Contains the following fields:
    - `id`: Int[]. An Int array consisting of resource IDs of multiple dressing parts. Supports dressing operations on multiple **parts** such as hair, tops, jackets, pants, etc., and each part provides multiple dressing **resources** to choose from, that is, each **part** corresponds to multiple dressing **resource IDs**. It should be noted that **only one resource can be specified for each part at a time**. See [Dressing resources](./reference/dress-up-resources) for details.
    
    The recommended set combinations are as follows:

    1. **Set 1**

        ```json
          // The following resource IDs correspond to the dressing parts [hair, eyebrows, blush, headdress, top coat, pants, shoes]
          "id": [10001, 10101, 10401, 10801, 12101, 14101, 15001]
        ```
        <img src="https://web-cdn.agora.io/doc-cms/uploads/1708415768849-dress1.png" alt="Avatar dress up tab1" />
    2. **Set 2**

        ```json
          // The following resource IDs correspond to the dressing parts [hair, eyebrows, blush, coat, gloves, pants, shoes]
          "id": [10002, 10102, 10402, 12102, 12501, 14102, 15002]
        ```
        <img src="https://web-cdn.agora.io/doc-cms/uploads/1708415915330-dress2.png" alt="Avatar dress up tab2" />

## Animoji

<PlatformWrapper platform="android">

The MetaKit plugin allows you to switch the image of Animoji. To experience Animoji related functions, you need to set `avatarMode` to `1` when [enabling texture request](#Enabling texture request) or [adding scene view](#Adding scene view).

</PlatformWrapper>

<PlatformWrapper platform="ios">

The MetaKit plugin allows you to switch the image of Animoji. To experience Animoji related functions, you need to set `avatarMode` to `1` when [adding a scene view](#Adding a scene view).

</PlatformWrapper>

<Admonition type="info" title="Information">
In addition to the existing Animoji in the three plugins of `dog`, `girlhead` and `arkit`, the Agora MetaKit plugin provides an open art ecosystem and supports **one-click import** of Animoji images made according to Agora's art standards, providing users with more flexible creation and integration options. [Contact Agora Technical Support](mailto:extensions.marketplace@agora.io) to use this feature.
</Admonition>

### Adjust the rendering level

The MetaKit plugin provides three rendering levels: low, medium, and high. You can choose the corresponding rendering level according to the device performance to achieve the best match between device performance and rendering effect.

<Admonition type="caution" title="Caution">
Currently, only the `dog` Animoji image supports adjusting the rendering level.
</Admonition>

- `key`: `setRenderQuality`
- `value`: Object. Contains the following fields:
    - `general`: Int. `0`: low configuration; `1`: (default) medium configuration; `2`: high configuration.

## Lighting Effects

<PlatformWrapper platform="android">

The MetaKit plugin provides lighting effects such as 3D lighting, screen ripples, aurora effects, and portrait edge flames, and supports fine-tuning the color, intensity, range and other parameters of the lighting effects. To experience the lighting effects related functions, you need to set `avatarMode` to `2` when [enabling texture requests](#Enabling texture requests) or set `backgroundEffect` to `true` when [adding a scene view](#Adding a scene view).

</PlatformWrapper>

<PlatformWrapper platform="ios">

The MetaKit plugin provides lighting effects such as 3D lighting, screen ripples, aurora effects, and portrait edge flames, and supports fine-tuning the color, intensity, range and other parameters of the lighting effects. To experience the lighting effect related functions, you need to set `backgroundEffect` to `true` when [adding a scene view](#adding a scene view).

</PlatformWrapper>

### Set special effect material

- `key`: `setEffectVideo`
- `value`: Object. Contains the following fields:
    - `id`: Int. Special effect material ID.
    - `enable`: Boolean. Whether to enable the special effect. `true`: Enable; `false`: Disable.
    - `param`: (optional) Object. Each special effect material ID corresponds to a set of configuration parameters, which allows you to fine-tune the color, intensity, range, etc. of the lighting effect. If you do not fill in the parameters, the default parameter configuration will be used.

The mapping relationship between special effect material ID and configuration parameters is as follows:

| ID    | Effect                | Parameters                                                                                                                                                                                                                                                                                                                                                                      |
|-------|-----------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `1001`| 3D Lighting           | - `color` (Int64): lighting color. When passing the parameter, the hexadecimal color needs to be converted to an Int64 value. For example, for red, the hexadecimal color is #FF0000, and the converted Int64 value is 16711680.<br/>- `intensity` (Float): Light intensity. The recommended value range is [1.0, 2.0]. The default value is 1.6.<br/>- `scale` (Float): Lighting scale. The recommended range is [0.3, 0.6]. The default value is 0.4. |
| `1002`| Screen ripples        | - `color` (Int64): ripple color. When passing parameters, the hexadecimal color needs to be converted to an Int64 value. For example, for red, the hexadecimal color is #FF0000, and the converted Int64 value is 16711680.<br/>- `speed` (Float): Fluctuation speed. The recommended value range is [-0.2, 0.2]. The default value is -0.12.<br/>- `scale` (Float): Ripple size. The recommended value range is [3.0, 6.0]. The default value is 4.0. |
| `1003`| Aurora                | - `color` (Int64): Aurora color. When passing parameters, the hexadecimal color needs to be converted to an Int64 value. For example, for red, the hexadecimal color is #FF0000, and the converted Int64 value is 16711680.<br/>- `intensity` (Float): Aurora intensity. The recommended value range is [0.8, 1.5]. The default value is 1.0.                                                 |
| `2001`| Portrait edge flame   | - `color` (Int64): Flame color. When passing parameters, the hexadecimal color needs to be converted to an Int64 value. For example, for red, the hexadecimal color is #FF0000, and the converted Int64 value is 16711680.<br/>- `intensity` (Float): Flame intensity. The recommended value range is [0.2, 1.5]. The default value is 0.2.                                                   |
| `3001`| Ambient lighting set  | N/A                                                                                                                                                                                                                                                                                                                                                                             |
| `3002`| Advertising lights    | - `startColor` (Int64): The initial color of the advertising light. When passing parameters, the hexadecimal color needs to be converted to an Int64 value. For example, for red, the hexadecimal color is #FF0000, and the converted Int64 value is 16711680.<br/>- `endColor` (Int64): The end color of the advertising light. When passing parameters, you need to convert the hexadecimal color into an Int64 value. After configuring the starting color, a gradient effect from the initial color to the ending color will be created.<br/>- `size` (Float): The size of the advertisement light texture. The recommended value range is [8, 15]. The default value is 10.<br/>- `intensity` (Float): Advertising light intensity. The recommended value range is [100, 1000], and the default value is 1000.<br/>- `range` (Float): The distance of the advertising light. The recommended range is [10, 40]. The default value is 15.|


## 360 Background

<PlatformWrapper platform="android">

The MetaKit plugin allows you to enable 360-degree panoramic background mode, customize background replacement resources, and enable the gyroscope function to enhance the interactivity and immersion of the scene background. To experience 360 ​​background related functions, you need to set `avatarMode` to `2` when [enabling texture request](#Enabling texture request) or set `backgroundEffect` to `true` when [adding scene view](#Adding scene view).

</PlatformWrapper>

<PlatformWrapper platform="ios">

The MetaKit plugin allows you to enable 360-degree panoramic background mode, customize background replacement resources, and enable the gyroscope function to enhance the interactivity and immersion of the scene background. To experience 360-degree background related functions, you need to set `backgroundEffect` to `true` when [adding a scene view](#adding a scene view).

</PlatformWrapper>

### Set the replacement resource for the 360 ​​background

After successful setting, you can observe that the video background is replaced with the specified resource, and you can experience the panoramic effect by rotating the phone.

- `key`: `setBGVideo`
- `value`: Object. Contains the following fields:
    - `mode`: String. Set to `tex360`, which means 360 degree panoramic background.
    - `param`:
        - `path`: String. Specifies the URL or local path of the background resource.
        - `rotation`: (optional) Int. Rotation angle, default value is 0.

### Enable background gyroscope

The gyroscope function is only supported after successfully [setting up a 360-degree panoramic background](#Setting up replacement resources for a 360 background). Enabling the gyroscope function can further enhance the interactivity and immersion of the background.

- `key`: `setCameraGyro`
- `value`: Object. Contains the following fields:
    - `state`: Boolean. Background gyroscope function status. `on`: enabled; `off`: (default) disabled.

</PlatformWrapper>

<PlatformWrapper notAllowed="[android, ios, macos]">
<NotAvailable />
</PlatformWrapper>
