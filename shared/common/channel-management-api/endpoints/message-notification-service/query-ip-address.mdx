import Authorization from '@docs/shared/common/channel-management-api/authorization.mdx';
import CodeBlock from '@theme/CodeBlock';
import MultiCodeBlock, { CodeGroup, CodeItem } from '@app/mdx-components/MultiCodeBlock';
import RestAPILayout from '@site/src/components/rest-api/RestAPILayout';
import LeftColumn from '@site/src/components/rest-api/LeftColumn';
import RightColumn, { Section } from '@site/src/components/rest-api/RightColumn';
import ParameterList, { Parameter } from '@site/src/components/rest-api/ParameterList';
import PathParameter from '@site/src/components/rest-api/PathParameter';
import { Tabs, TabItem } from '@site/src/components/rest-api/Tabs';

<RestAPILayout>

### Prototype

<LeftColumn
  title={frontMatter.title}
  method="GET"
  endpoint="https://api.agora.io/v2/ncs/ip"
>

When using Agora real-time audio and video, you can use the <Vg k="NCS_LONG" /> service to receive channel events.

After activating the service, when a channel event occurs, the <Vg k="NCS_LONG" /> server will deliver the event notification to your message receiving server.

If your server is behind a firewall, you need to call the IP address query API to retrieve the IP addresses of <Vg k="NCS_LONG" /> and configure your firewall to trust all these IP addresses.

Agora occasionally adjusts the <Vg k="NCS_LONG" /> IP addresses. Best practice is to call this endpoint at least every 24 hours and automatically update the firewall configuration.

### Request

**Request header**

<Authorization/>

### Response parameters

If the status code is `200`, the request succeeds, and the response body includes the following parameters:

<ParameterList title="Response Parameters" required={true}>
  <Parameter name="data" type="object" required={true}>
    <Parameter name="service" type="object" required={true}>
      <Parameter name="hosts" type="object" required={true}>
        <Parameter name="primaryIP" type="string" required={true}>
          The IP address of the <Vg k="NCS_LONG" /> server.
          <strong>Note:</strong> When you receive a response, you must add the IP address (or list of IP addresses) from this field to the whitelist.
        </Parameter>
      </Parameter>
    </Parameter>
  </Parameter>
</ParameterList>

If the status code is not `200`, the request fails. See the `message` field in the response body for the reason for this failure. For details about possible response status codes, see [Response status codes](../../response-status-code).

</LeftColumn>
<RightColumn>
<Section title="Authorization">
The endpoint requires [RESTful authentication](/video-calling/channel-management-api/restful-authentication).
</Section>
<Section title="Request example">
<Tabs groupId="code-examples">
    <TabItem value="curl" label="curl" default>
    ```bash
    curl --request GET \
      --url http://api.sd-rtn.com/v2/ncs/ip \
      --header 'Accept: application/json' \
      --header 'Authorization: '
    ```
    </TabItem>
    <TabItem value="python" label="Python" default>
    ```python
    import http.client

    conn = http.client.HTTPConnection("api.sd-rtn.com")

    headers = {
        'Authorization': "",
        'Accept': "application/json"
    }

    conn.request("GET", "/v2/ncs/ip", headers=headers)

    res = conn.getresponse()
    data = res.read()

    print(data.decode("utf-8"))
    ```
    </TabItem>
    <TabItem value="node" label="Node.js" default>
    ```js
    const fetch = require('node-fetch');

    const url = 'http://api.sd-rtn.com/v2/ncs/ip';
    const options = {method: 'GET', headers: {Authorization: '', Accept: 'application/json'}};

    try {
      const response = await fetch(url, options);
      const data = await response.json();
      console.log(data);
    } catch (error) {
      console.error(error);
    }
    ```
    </TabItem>
  </Tabs>
</Section>
<Section title="Response example">
```json
{
  "data": {
    "service": {
      "hosts": [
        {
          "primaryIP": "xxx.xxx.xxx.xxx"
        },
        {
          "primaryIP": "xxx.xxx.xxx.xxx"
        }
      ]
    }
  }
}
```
</Section>
</RightColumn>
</RestAPILayout>
