<PlatformWrapper platform="web">

1.  **Retrieve a token from the server**

    Use a GET request to retrieve an authentication token for a specific channel from the token server.

        ``` javascript
        // Fetches the RTC token for stream channels
        async function fetchToken(uid, channelName) {
            if (config.serverUrl !== "") {
            try {
                const res = await fetch(
                config.proxyUrl +
                    config.serverUrl +
                    "/rtc/" +
                    channelName +
                    "/" +
                    role +
                    "/uid/" +
                    uid +
                    "/?expiry=" +
                    config.tokenExpiryTime,
                {
                    headers: {
                    "X-Requested-With": "XMLHttpRequest",
                    },
                }
                );
                const data = await res.text();
                const json = await JSON.parse(data);
                console.log("RTC token fetched from server: ", json.rtcToken);
                return json.rtcToken;
            } catch (err) {
                console.log(err);
            }
            } else {
            return config.token;
            }
        }
        ```
1.  **Join a channel using the token**:

    ``` javascript
    const joinWithToken = async (localPlayerContainer, channelParameters) => {
        const token = await fetchToken(config.uid, config.channelName);
        await agoraManager
        .getAgoraEngine()
        .join(config.appId, config.channelName, token, config.uid);
        // Create a local audio track from the audio sampled by a microphone.
        channelParameters.localAudioTrack =
        await AgoraRTC.createMicrophoneAudioTrack();
        // Create a local video track from the video captured by a camera.
        channelParameters.localVideoTrack = await AgoraRTC.createCameraVideoTrack();
        // Append the local video container to the page body.
        document.body.append(localPlayerContainer);
        // Publish the local audio and video tracks in the channel.
        await agoraManager
        .getAgoraEngine()
        .publish([
            channelParameters.localAudioTrack,
            channelParameters.localVideoTrack,
        ]);
        // Play the local video track.
        channelParameters.localVideoTrack.play(localPlayerContainer);
    };
    ```

7.  **Handle the event triggered by <Vg k="AGORA_BACKEND" /> when the token is about to expire**

    A token expires after the `ExpireTime` specified in the call to the token server or after 24 hours, if the time is not specified. The `onTokenPrivilegeWillExpire` event receives a callback when the current token is about to expire so that a fresh token may be retrieved and used.

    ``` javascript
    // When token-privilege-will-expire occurs, fetch a new token from the server and call renewToken to renew the token.
    agoraManager.getAgoraEngine().on("token-privilege-will-expire", async function ()
    {
        options.token = await fetchToken(config.uid, config.channelName);
        await agoraManager.getAgoraEngine().renewToken(options.token);
    });
    ```
</PlatformWrapper>
