
<PlatformWrapper platform="android">

Follow the steps below to add built-in media stream encryption functionality to your <Vpl k="CLIENT" /> :

1. Generate a key and salt on your server.

    - Execute the following command on your swerver to randomly generate a String-type, 32-byte key via OpenSSL:
    ```shell
    # Randomly generate a String type, 32-byte key
    openssl rand -hex 32
    dba643c8ba6b6dc738df43d9fd624293b4b12d87a60f518253bd10ba98c48453
    ```
    - Execute the following command on your swerver to randomly generate a Base64 encoded, 32-byte salt using OpenSSL:
    ```shell
    # Randomly generate a Base64 encoded, 32-byte salt
    openssl rand -base64 32
    X5w9T+50kzxVOnkJKiY/lUk82/bES2kATOt3vBuGEDw=
    ```
1. Implement client-side logic:

    1. Obtain the String key and Base64-encoded salt from the server.

    1. Convert salt from Base64 to uint8_t.

    1. Before joining the channel, call `enableEncryption` to set the `AES_128_GCM2` or `AES_256_GCM2` encryption mode, and pass the key and salt into the SDK.

<Admonition type="caution" title="note" style="background-color:pink">
- All users within the same channel must use the same encryption mode, key, and salt. Otherwise, undefined behaviors such as black screens or audio loss may occur.
- To ensure security, Agora recommends using a new key and salt each time you enable media stream encryption
</Admonition>

The following sample code shows how this logic is implemented:
```java
import java.util.Base64;
import io.agora.rtc2.RtcEngine;
import io.agora.rtc2.internal.EncryptionConfig;

class Example
{
    public bool enableEncryption(RtcEngine engine) {
        if(engine == null)
            return false;
        // Obtain the Base64 encoded salt from the server
        String encryptionKdfSaltBase64 = Server.getEncryptionKdfSaltBase64();
        // Obtain the String type key from the server
        String encryptionSecret = Server.getEncryptionSecret();
        if(encryptionKdfSaltBase64 == null || encryptionSecret == null)
            return false;

        // Convert the Base64 encoded salt into uint8_t
        byte[] encryptionKdfSalt = Base64.getDecoder().decode(encryptionKdfSaltBase64);
        // Create an instance of EncryptionConfig
        EncryptionConfig config = new EncryptionConfig();
        // Set the encryption mode to AES_128_GCM2
        config.encryptionMode = EncryptionConfig.EncryptionMode.AES_128_GCM2;
        config.encryptionKey = encryptionSecret;
        // Copy the encryption KDF salt into the configuration
        System.arraycopy(encryptionKdfSalt, 0, config.encryptionKdfSalt, 0, config.encryptionKdfSalt.length);
        // Enable encryption with the configuration
        int result = engine.enableEncryption(true, config);
        // Return true if result is 0, meaning success
        return (result == 0);
    }
}
```
</PlatformWrapper>