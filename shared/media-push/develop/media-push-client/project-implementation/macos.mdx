<PlatformWrapper platform="macos">

### Streaming with transcoding

You can refer to the following API call sequence diagram and steps to implement streaming with transcoding:


![](https://web-cdn.agora.io/docs-files/1638787350788)


1. Refer to [Start Interactive Live Video Streaming](start_live_ios) or [Start Interactive Live Audio Streaming](start_live_audio_ios) to implement the basic audio and video interaction.

2. Call `startRtmpStreamWithTranscoding` and pass in the address of the Media Push and the transcoding configuration to start pushing transcoded streams to a CDN address.


   <div class="alert note"><ul>
   <li>The transcoding configuration includes the audio and video profile of the output transcoded streams, video layout of the hosts, watermarks, and media metadata. The audio and video profile includes audio bitrate, video bitrate, audio codec, and video codec. The media metadata includes SEI. See <a href="./API%20Reference/oc/Classes/AgoraLiveTranscoding.html">AgoraLiveTranscoding</a>. In scenarios where there is streaming with transcoding, the <code>transcodingUsers</code> field in the transcoding configuration are required. You can customize or use default values for the remaining fields in the configuration.</li>
   <li>For live audio scenarios, leave the video-related fields in the transcoding configuration empty.</li>
   <li>If you need to push streams to multiple addresses, call <code>start</code> multiple times.</li>
   <li>If you have already started a live stream at one address, pushing another live stream to that address is not supported.</li>
   <li>After each call to <code>start</code>, make sure to wait until you receive the <code>rtmpStreamingChangedToState</code> callback reporting the streaming state as <code>RUNNING(2)</code> before performing any other actions. If you receive another streaming state, see <a href="./cdn_streaming_error">Exception Handling for Media Push</a>.</li>
   </ul></div>



3. You can call `updateRtmpTranscoding` to dynamically update the transcoding configuration according to a scenario change, such as adjusting the number of hosts or the video layout of the hosts. After the transcoding configuration is updated successfully, the SDK triggers the `rtcEngineTranscodingUpdated` callback.


4. Call `stopRtmpStream` and pass in the CDN address to stop the current live streaming.


   <div class="alert note"><ul>
   <li>If you need to stop the live streaming at multiple addresses, call <code>stop</code> multiple times and pass in the corresponding CDN addresses.</li>
   <li>After stopping the streaming, you can receive the <code>rtmpStreamingChangedToState</code> callback reporting the streaming state as <code>IDLE(0)</code>. If you receive another streaming state, see <a href="./cdn_streaming_error">Exception Handling for Media Push</a>.</li>
   </ul></div>


### Streaming without transcoding

You can refer to the following API call sequence diagram and steps to implement streaming without transcoding:

![](https://web-cdn.agora.io/docs-files/1638787343486)


1. Refer to [Start Interactive Live Video Streaming](start_live_ios) or [Start Interactive Live Audio Streaming](start_live_audio_ios) to implement the basic audio and video interaction. The `uid` parameter in the `joinChannelByToken` method cannot be empty or 0; otherwise, the hosts in the channel cannot push any media streams to CDN.

2. Call `startRtmpStreamWithoutTranscoding` and pass in the address of the Media Push to start pushing non-transcoded streams to a CDN address.


   <div class="alert note"><ul>
   <li>If you need to push streams to multiple addresses, call <code>start</code> multiple times.</li>
   <li>If you have already started a live stream at one address, pushing another live stream to that address is not supported.</li>
   <li>After each call to <code>start</code>, make sure to wait until you receive the <code>rtmpStreamingChangedToState</code> callback reporting the streaming state as <code>RUNNING(2)</code> before performing any other actions. If you receive another streaming state, see <a href="./cdn_streaming_error">Exception Handling for Media Push</a>.</li>
   </ul></div>


3. Call `stopRtmpStream` and pass in the CDN address to stop the current live streaming.


   <div class="alert note"><ul>
   <li>If you need to stop the live streaming at multiple addresses, call <code>stop</code> multiple times and pass in the corresponding CDN addresses.</li>
   <li>After stopping the streaming, you can receive the <code>rtmpStreamingChangedToState</code> callback reporting the streaming state as <code>IDLE(0)</code>. If you receive another streaming state, see <a href="./cdn_streaming_error">Exception Handling for Media Push</a>.</li>
   </ul></div>


### Sample code

To show the code logic for starting the streaming, dynamically updating the transcoding configuration, and retrying the stream push in case of an exception, Agora provides an open-source sample project on GitHub, see [RTMPStreaming (iOS)](https://github.com/AgoraIO/API-Examples/tree/master/iOS/APIExample/Examples/Advanced/RTMPStreaming) or [RTMPStreaming (macOS)](https://github.com/AgoraIO/API-Examples/tree/master/macOS/APIExample/Examples/Advanced/RTMPStreaming).

</PlatformWrapper>