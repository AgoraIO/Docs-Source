<PlatformWrapper platform="web">

### Message delivery receipts

To send a message delivery receipt, take the following steps:

1. The message sender sets `delivery` in `options` as `true` when initializing the `connection` object.

   ```javascript
   const conn = new websdk.connection({
     appKey: "your appKey",
     delivery: true,
   });
   ```

2. Once the recipient receives the message, the SDK triggers `onDeliveredMessage` on the message sender's client, notifying that the message has been delivered to the recipient.
    ```javascript
   conn.addEventHandler("customEvent", {
     onReceivedMessage: function (message) {}, // Received a receipt for message delivery to the server.
     onDeliveredMessage: function (message) {}, // Received a receipt for message delivery to the client.
    });
    ```

### Conversation and message read receipts

In both one-to-one chats and group chats, you can use message read receipts to notify the message sender that the message has been read. To minimize the method call for message read receipts, the SDK also supports conversation read receipts in one-to-one chats. 

#### One-to-one chat

The one-to-one chats support both conversation read receipts and message read receipts. We recommend you use both types of read receipts together to reduce the number of message read receipts:

- If several messages are received when the chat page is not opened yet, send a conversation read receipt when the chat page is opened.
- If a message is received on an open chat page, send a message read receipt.

##### Conversation read receipts

1. The message recipient sends a conversation read receipt.

    The message recipient opens the conversation page to check whether there are unread messages. If yes, call `send` to send a conversation read receipt.

    ```javascript
    let option = {
      chatType: "singleChat", // The chat type: singleChat for one-to-one.
      type: "channel", // The type of read receipt: channel indicates the conversation read receipt.
      to: "userId", // The user ID of the message recipient.
    };
    let msg = WebIM.message.create(option);
    conn.send(msg);
    ```

2. The message sender receives the conversation read receipt in the `onChannelMessage` callback.

    ```javascript
    conn.addEventHandler("customEvent", {
      onChannelMessage: (message) => {},
    });
    ```

##### Message read receipts

For one-to-one chats, message read receipts are stored as long as messages on the Chat server. Specifically, message read receipts can be sent whenever the messages are available on the Chat server. The message storage period on the Chat server depends on your product plan. For details, see the [pricing plan details](../../reference/pricing-plan-details#message).

Refer to the following steps to implement message read receipt in one-to-one chats:

1. The message recipient sends a message read receipt.

   - If there are several unread messages in the conversation, to minimize the number of sent message read receipts, we recommend that a conversation read receipt be sent when the message recipient enters the conversation.

   ```javascript
   let option = {
     chatType: "singleChat", // The chat type: singleChat for one-to-one chat.
     type: "channel", // The type of read receipt: channel indicates the conversation read receipt.
     to: "userId", // The user ID of the message receipt.
   };
   let msg = WebIM.message.create(option);
   conn.send(msg);
   ```

   - If there is only one unread message in the conversation, after reading it, call `send` from the recipient's client to send the message read receipt.

    ```javascript
    let option = {
      type: "read", // The message read receipt.
      chatType: "singleChat", // The chat type: singleChat for one-to-one chat.
      to: "userId", // The user ID of the message receipt.
      id: "id", // The ID of the message that requires the read receipt.
    };
    let msg = WebIM.message.create(option);
    conn.send(msg);
    ```

2. The message sender listens for `onReadMessage` to receive the message read receipt.

   ```javascript
   conn.addEventHandler("customEvent", {
     onReadMessage: (message) => {},
   });
   ```

#### Group chat

For a group chat, group members can determine whether to require message read receipts when sending a message. If yes, after a group member reads the message, the SDK sends a read receipt. In a group chat, the number of message read receipts that are sent for the message refers to the number of group members that have read this message.

The read receipts for group messages are valid only for three days. Specifically, if a read receipt is sent three days after the message is sent in the group, the Chat server does not record the group member that reads the message, nor sends the read receipt.

1. When sending a message, a group member can set whether to require a message read receipt by setting `allowGroupAck` to `true`.

    ```javascript
    sendGroupReadMsg = () => {
       let option = {
           type: 'txt',            // Message type.
           chatType: 'groupChat',  // Conversation type: groupChat for group chat.
           to: 'groupId',          // The message recipient: group ID.
           msg: 'message content'  // Message content.
           msgConfig: { allowGroupAck: true } // Setting that this message requires a read receipt.
       }

      let msg = WebIM.message.create(option);
      conn.send(msg).then((res) => {
          console.log('send message success');
      }).catch((e) => {
          console.log("send message error");
      })
   }
    ```

2. After reading the group message, the recipient calls `send` to send the message read receipt.

    ```javascript
    sendReadMsg = () => {
     let option = {
       type: "read", // Whether the message has been read.
       chatType: "groupChat", // Conversation type: groupChat means group chat.
       id: "msgId", // The message ID for which the read receipt is sent.
       to: "groupId", // Group ID.
       ackContent: JSON.stringify({}), // The content of the message read receipt.
     };
     let msg = WebIM.message.create(option);
     conn.send(msg);
   };
    ```

3. The message sender receives the message read receipt by listening for either of the following callbacks:
    - `onReadMessage`, when the message sender is online.
    - `onStatisticsMessage`, when the message sender is offline. 

   ```javascript
   // You can listen in onReadMessage when online.
   conn.addEventHandler('customEvent', {
    onReadMessage: (message) => {
      let { mid } = message;
      let msg = {
           id: mid,
      };
      if (message.groupReadCount){
              // The message has been read.
          msg.groupReadCount = message.groupReadCount[message.mid];
      }
   },
   // You can listen for onStatisticMessage upon login when the read receipt is received when you are offline.
    onStatisticMessage: (message) => {
      let statisticMsg = message.location && JSON.parse(message.location);
      let groupAck = statisticMsg.group_ack || [];
    },
    });
    ```

4. After receiving the read receipt, the message sender can retrieve the detailed information of the group members that have read the message.

    ```javascript
    conn.getGroupMsgReadUser({
        msgId: "messageId", // Message ID.
        groupId: "groupId", // Group ID.
     })
       .then((res) => {
         console.log(res);
     });
    ```

</PlatformWrapper>