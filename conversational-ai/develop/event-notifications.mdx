---
title: Receive event notifications
sidebar_position: 5
platform_selector: false
description: >
  Receive notification of Conversational AI Engine events.
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';
import AndroidImplementation from '@docs/shared/conversational-ai/receive-notifications/implementation/android.mdx';
import SwiftImplementation from '@docs/shared/conversational-ai/receive-notifications/implementation/swift.mdx';
import WebImplementation from '@docs/shared/conversational-ai/receive-notifications/implementation/web.mdx';

A webhook is a user-defined callback over HTTP that allows your app or back-end system to receive notifications when certain events occur. Agora calls your webhook endpoint from its servers to send notifications about Conversational AI Engine events.

The Agora message notification service offers low latency, high concurrency, stability, and reliability. In high-concurrency scenarios with conversational AI agents, the service maintains a real-time synchronized agent state machine at the business layer, enabling the following functions:

* Monitor agent join and leave events in real time.
* Monitor agent error events in real time.

## Understand the tech 

Agora provides a flexible, scalable, and standardized conversational AI engine toolkit. The toolkit supports **iOS**, **Android**, and **Web** platforms, and encapsulates scenario-based APIs. You can use these APIs to integrate the capabilities of the Agora Chat SDK and Video SDK to enable the following features:

* [`Interrupt agents`](/conversational-ai/develop/interrupt-agent)
* [`Display live subtitles`](/conversational-ai/develop/subtitles)
* [`Receive event notifications`](/conversational-ai/develop/event-notifications)
* [`Set optimal audio parameters`](/conversational-ai/best-practices/audio-setup) (iOS and Android only)

The component provides a set of callback methods that allow you to listen for various agent-related events and system information:

* **`onAgentStateChanged`** :
  Listens for agent state changes via RTM presence events. Possible states include: `silent`, `listening`, `thinking`, and `speaking`. Use this callback to update the agent UI or track the conversation flow.

* **`onAgentInterrupted`** :
  Listens for agent interruption events via RTM messages. Use this to handle scenarios where the agent is interrupted mid-response.

* **`onAgentMetrics`** :
  Listens for agent performance metrics via RTM messages. Metrics include LLM reasoning delay, TTS synthesis delay, and others. Use this callback to monitor system performance.

* **`onAgentError`** :
  Listens for agent error events via RTM messages. These may include errors in agent modules such as LLM or TTS. Use this callback for error monitoring, logging, and implementing graceful degradation strategies.

## Understand the tech

Using <Vg k="CONSOLE" /> you subscribe to specific events for your project and configure the URL of the webhooks to receive these events. <Vg k="COMPANY" /> sends notifications of your events to your webhook every time they occur. Your server authenticates the notification and returns `200 Ok` to confirm reception. You use the information in the JSON payload of each notification to give the best user experience to your users.

When an event you subscribe to occurs, the Agora business server sends the event message to the Agora message notification server, which then delivers the event notification to your server via an HTTPS POST request.

![](/images/conversational-ai/convo-ai-notifications.svg)


## Prerequisites

Before you begin, make sure that you have:

- A valid Agora developer account and <Vg k="CONSOLE" /> project. See [Enable Conversational AI](../get-started/manage-agora-account) for details .
- Servers that meet the following requirements:
    - Support HTTPS protocol. To improve security, Agora message notification service no longer supports HTTP server addresses.
    - Support HTTPS connection reuse (recommended), also known as keep-alive mode, to reduce message delivery delay. Agora recommends the following settings:
        - `MaxKeepAliveRequests`: greater than or equal to 100.
        - `KeepAliveTimeout`: Greater than or equal to 10 seconds.

## Enable notifications

To enable <Vg k="NCS_LONG" />:

1. Log in to the <Vg k="CONSOLE" />. Click **Projects** in the left navigation menu. Find the project for which you want to enable notifications and click ✎ to configure the project.

1. Under **All Features**, select **Notifications**. You see a list of <Vg k="COMPANY" /> products for which notifications are available.

1. In the list of products, find **<Vpd k="NAME" />** and expand the block to reveal configuration options.

1. Fill in the following information:

    * **Event**: Select all the events that you want to subscribe to. See [Notification event types](../develop/event-types) for details.

        If the selected events generate a high number of queries per second (QPS), ensure that your server has sufficient processing capacity.

    * **Receiving Server Region**: Select the region where your server that receives the notifications is located. <Vg k="COMPANY" /> connects to the nearest <Vg k="COMPANY" /> node server based on your selection.

    * **Receiving Server URL Endpoint**: The `HTTPS` public address of your server that receives the notifications. 

        <Admonition type="info">
        For enhanced security, <Vg k="NCS_LONG" /> no longer supports `HTTP` addresses.
        </Admonition>

        * To reduce the delay in notification delivery, best practice is to activate `HTTPS` persistent connection (also called `HTTP` keep-alive) on your server with the following settings:

            * `MaxKeepAliveRequests`: 100 or more
            * `KeepAliveTimeout`: 10 seconds or more
    
    * **Status**: Set to enabled.

    * **Whitelist**: If your server is behind a firewall, check the box here, and ensure that you call the [IP address query API](#ip-address-query-api) to get the IP addresses of the <Vg k="COMPANY" /> <Vg k="NCS_LONG" /> server and add them to the firewall's allowed IP list.

1. Copy the **Secret** by clicking the copy icon. You use this secret to [Verify the Signature​](#verify-the-signature).

1. To test your configuration, press **Check**. Agora performs a health test for your configuration as follows:

    1. The <Vg k="NCS_LONG" /> health test generates test events that correspond to your subscribed events, and then sends test event callbacks to your server. 
        
        In test event callbacks, the channelName is `test_webhook`, and the uid is `12121212`.

    1. After receiving each test event callback, your server must respond within 10 seconds with a status code of `200`. The response body must be in JSON format.

    1. When the <Vg k="NCS_LONG" /> health test succeeds, press **Apply Settings**. 

        If the <Vg k="NCS_LONG" /> health test fails, follow the prompt on the <Vg k="CONSOLE" /> to [troubleshoot the error](#troubleshoot-common-errors). 

## Implementation

This section describes how to implement Conversational AI engine events using the subtitle processing toolkit.

<Tabs groupId="platform">
<TabItem value="android" label="Android" default>
<AndroidImplementation />
</TabItem>

<TabItem value="swift" label="iOS/macOS" default>
<SwiftImplementation />
</TabItem>

<TabItem value="web" label="Web" default>
<WebImplementation />
</TabItem>
</Tabs>

## Reference 

This section contains content that completes the information on this page, or points you to documentation that explains other aspects to this product.

### Sample project

Refer to the following open-source sample code for your reference.

- [`Conversational-AI-Demo`](https://github.com/Shengwang-Community/Conversational-AI-Demo/)


### Toolkit structure 

The client component folder is organized as follows, with each file serving a specific purpose:

<Admonition type="info" info="info">
To integrate the client components, only the files and folders listed below are required. You do not need to copy any other files.
</Admonition>

<Tabs groupId="platform">
<TabItem value="android" label="Android" default>
* `IConversationalAIAPI.kt`: Defines the API interface, data structures, and enumerations.
* `ConversationalAIAPIImpl.kt`: Contains the main implementation logic of the ConversationalAI API.
* `ConversationalAIUtils.kt`: Provides utility functions and manages event callbacks.
* `subRender/v3/`: Contains the subtitle rendering module.
* `TranscriptionController.kt`: Controls subtitle rendering and synchronization.
* `MessageParser.kt`: Parses transcription and message data.

</TabItem>

<TabItem value="swift" label="iOS/macOS" default>

* `ConversationalAIAPI.swift`: Defines the API interface, data structures, and enumerations.
* `ConversationalAIAPIImpl.swift`: Contains the main implementation logic of the ConversationalAI API.
* `Transcription/TranscriptionController.swift`: Manages subtitle rendering and transcription control.

</TabItem>

<TabItem value="web" label="Web" default>

* `index.ts`: Defines the main API class.
* `type.ts`: Contains API interfaces, data structures, and enumerations.
* `utils/index.ts`: Provides general utility functions for the API.
* `utils/events.ts`: Defines the event management class, which can be extended to support event listening and broadcasting.
* `utils/sub-render.ts`: Implements the subtitle rendering module.

</TabItem>
</Tabs>



