<PlatformWrapper platform="windows">

<a name="older-v"></a>
### Implementation of earlier versions

This section describes how to implement Media Push using versions of the SDK earlier than v3.6.0.

1. Refer to [Start Interactive Live Video Streaming](start_live_windows) or [Start Interactive Live Audio Streaming](start_live_audio_windows) to implement the basic audio and video interaction.

2. The host in a channel calls the `setLiveTranscoding` method to set the transcoding configuration of the media streams (`LiveTranscoding`), such as the resolution, bitrate, frame rate, and position of the watermark/background image. If you need a transcoded picture, set the picture-in-picture layout for each user in the `TranscodingUser` class.

   <div class="alert note">To push streams without transcoding for single-host live streaming, skip steps 2 and 3, directly call <code>addPublishStreamUrl</code>, and set <code>transcodingEnabled (false)</code>.</div>

3. The host in a channel can call the `addPublishStreamUrl` method to add a media stream to the CDN.

   <div class="alert note">Use <code>transcodingEnabled</code> to set whether transcoding is enabled or not.</div>

4. (Optional) The host in a channel calls the `setLiveTranscoding` method again to update the transcoding configuration of media streams.

   <div class="alert note">When the transcoding configuration is updated, the SDK triggers the <code>onTranscodingUpdated</code> callback and reports the update information to the host.</div>

5. The host in a channel calls the `removePublishStreamUrl` method to remove a media stream from the Media Push.

When the streaming state changes, the SDK triggers the `onRtmpStreamingStateChanged` callback to report the current streaming state to the host. Make sure to wait until you receive the `onRtmpStreamingStateChanged` callback before performing any other actions. If adding or removing a CDN address fails, see <a href="./cdn_streaming_error">Exception Handling for Media Push</a>.


```c++
// C++
// CDN transcoding settings.
LiveTranscoding config;
config.audioSampleRate = TYPE_44100;
config.audioChannels = 2;
config.audioBitrate = 48;
// Width of the video (px). The default value is 360.
config.width = 360;
// Height of the video (px). The default value is 640.
config.height = 640;
// Bitrate of the video (Kbps). The default value is 400.
cofig.videoBitrate = 400;
// Frame rate of the video (fps). The default value is 15. Agora adjusts all values over 30 to 30.
config.videoFramerate = 15;
// If userCount > 1, set the layout for each user with transcodingUser.
config.userCount = 1;
// Video codec profile. Choose to set as Baseline (66), Main (77), or High (100). If you set this parameter to other values, Agora adjusts it to the default value of 100.
config.videoCodecProfile = HIGH;

// Sets the output layout for each user.
config.transcodingUser = new TranscodingUser[config.userCount];
config.transcodingUser[0].uid = 123456;
config.transcodingUser[0].x = 0;
config.transcodingUser[0].audioChannel = 0;
config.transcodingUser[0].y = 0;
config.transcodingUser[0].width = 640;
config.transcodingUser[0].height = 720;

// CDN transcoding settings when using transcoding.
m_rtcEngine->setLiveTranscoding(config);

// Adds a URL to which the host pushes a stream. Set the transcodingEnabled parameter as true to enable the transcoding service. Once transcoding is enabled, you need to set the live transcoding configurations by calling the setLiveTranscoding method. Agora does not recommend transcoding in the case of a single host.
m_rtcEngine->addPublishStreamUrl(url, true);

 if (config.transcodingUsers)
   {
      delete[] config.transcodingUsers;
   }

// Removes a URL to which the host pushes a stream.
m_rtcEngine->removePublishStreamUrl(url);
```


### API reference

The following APIs are recommended by Agora when implementing Media Push:

- [`startRtmpStreamWithoutTranscoding`](./API%20Reference/cpp/classagora_1_1rtc_1_1_i_rtc_engine.html#acfc4de5d9454cad1dfd1d154e180d78c)
- [`startRtmpStreamWithTranscoding`](./API%20Reference/cpp/classagora_1_1rtc_1_1_i_rtc_engine.html#a0f91aa3af0a7c9a8428966028b5a010c)
- [`updateRtmpTranscoding`](./API%20Reference/cpp/classagora_1_1rtc_1_1_i_rtc_engine.html#a8689685218a15a34a376944555340261)
- [`stopRtmpStream`](./API%20Reference/cpp/classagora_1_1rtc_1_1_i_rtc_engine.html#ab9807b2e5fb708d01066759af02cc630)
- [`onTranscodingUpdated`](./API%20Reference/cpp/classagora_1_1rtc_1_1_i_rtc_engine_event_handler.html#a0583fb2aecbd4c51bba1af97ce1aa318)
- [`onRtmpStreamingStateChanged`](./API%20Reference/cpp/classagora_1_1rtc_1_1_i_rtc_engine_event_handler.html#a29754dc9d527cbff57dbc55067e3287d)
- [`onRtmpStreamingEvent`](./API%20Reference/cpp/classagora_1_1rtc_1_1_i_rtc_engine_event_handler.html#aa2beb17562a3be9b5ddbe9366245cb0e)


The following APIs are still functional but not recommended by Agora when implementing Media Push:

- [`setLiveTranscoding`](./API%20Reference/cpp/classagora_1_1rtc_1_1_i_rtc_engine.html#a0601e4671357dc1ec942cccc5a6a1dde)
- [`addPublishStreamUrl`](./API%20Reference/cpp/classagora_1_1rtc_1_1_i_rtc_engine.html#a5d62a13bd8391af83fb4ce123450f839)
- [`removePublishStreamUrl`](./API%20Reference/cpp/classagora_1_1rtc_1_1_i_rtc_engine.html#a30e6c64cb616fbd78bedd8c516c320e7)
- [`onStreamPublished`](./API%20Reference/cpp/classagora_1_1rtc_1_1_i_rtc_engine_event_handler.html#a475fb73ea513eb367cea2d73299b5f91)
- [`onStreamUnpublished`](./API%20Reference/cpp/classagora_1_1rtc_1_1_i_rtc_engine_event_handler.html#a318ea7cd8fc614038850bf7791d4106e)

</PlatformWrapper>