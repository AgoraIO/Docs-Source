  <PlatformWrapper platform="web">

1. **Import the required dependencies**

    ```javascript
    import AgoraRTCManager from "../agora_manager/agora_manager.js";
    import AgoraRTC from "agora-rtc-sdk-ng";
    ```

1. **Implement best practice for app initiation**

    When you start your <Vpl k="CLIENT" />, it does the following:

    <PlatformWrapper platform="web">
    - _Display the available audio and video devices_: Populate the dropdowns with the list of available audio/video devices connected to the user's device.
    - _Set an audio profile_: Setting an audio profile is optional and only required if you have special requirements such as streaming  music. If you do not set an audio profile, the default audio profile for web is `music_standard`.
    </PlatformWrapper>
    <PlatformWrapper notAllowed="web">
    - _Set an audio profile_: Setting an audio profile is optional and only required if you have special requirements such as streaming  music.
    </PlatformWrapper>
    - _Set a video profile_: Setting a video profile is also optional. It is useful when you want to change one or more of  `frameRate`, `bitrate`, `width`, and `height` from the default setting to custom values.
       For more information, see  [video profile table](#video-profile-table).
    - _Set a transmission optimization mode_: Required to ensure video quality and smoothness under poor network conditions.
    - _Enable dual stream mode_: Required for fallback and multi-user scenarios.
    - _Set video stream fallback_: Define fallback for publishing the local video stream and subscription to remote streams.

    To implement these features in your <Vpl k="CLIENT" />, do the following:

    1. Enable dual stream mode

        To enable dual-stream mode, call `enableDualStream` before joining a channel. In `agora_manager_call_quality.js` add the following code in `const AgoraRTCCallQuality = async (eventsCallback) => {`:

        ```javascript
        const enableDualStreamMode = () => {
            // Enable dual-stream mode.
            agoraEngine.enableDualStream();
        };
        ```

    1. Set the audio profile

        In `agora_manager_call_quality.js`, add the following code in `const AgoraRTCCallQuality = async (eventsCallback) => {`:

        ```javascript
        const setAudioProfile = async () => {
            // Create a local audio track and set an audio profile for the local audio track.
            channelParameters.localAudioTrack =
            await AgoraRTC.createMicrophoneAudioTrack({
                encoderConfig: "high_quality_stereo",
            });
        };
        ```

    1. Set the video profile

        In `agora_manager_call_quality.js`, add the following code:

        ```javascript
        const setVideoProfile = async () => {
            // Set a video profile.
            channelParameters.localVideoTrack = await AgoraRTC.createCameraVideoTrack({
            optimizationMode: "detail",
            encoderConfig: {
                width: 640,
                // Specify a value range and an ideal value
                height: { ideal: 480, min: 400, max: 500 },
                frameRate: 15,
                bitrateMin: 600,
                bitrateMax: 1000,
            },
            });
        };
        ```

    1. Set a transmission optimization mode

        When you call `createCameraVideoTrack`, select an `optimizationMode` to set your strategy for managing video quality under poor network conditions. <Vg k="VSDK" /> provides the following optimization modes:

        - `detail`: Prioritizes video quality by keeping the bitrate value above the minimum bitrate.
        - `motion`: Prioritizes video smoothness by reducing the bitrate and retaining the framerate.

        To set an optimization mode, in `agora_manager_call_quality.js`, add the following code after `channelParameters.localVideoTrack = await AgoraRTC.createCameraVideoTrack({`:

        ```javascript
        optimizationMode: "detail",
        ```
        
    1. Set a stream fallback strategy

        To set a stream fallback strategy for a remote user, in `agora_manager_call_quality.js`, add the following code:

        ```javascript
        // Set a stream fallback option to automatically switch remote video quality when network conditions degrade. 
        const setStreamFallbackStrategy = async () => {
            agoraManager
            .getAgoraEngine()
            .setStreamFallbackOption(channelParameters.remoteUid, 1);
        };
        ```
    1. Display the available audio and video devices

       You use `getDevices` to retrieve the list of available audio and video devices connected to the user's device. You then filters the list to separate audio and video devices, create an HTML option element for each device and appends it to the appropriate dropdown list in the web page. To implement this logic, in `agora_manager_call_quality.js`, add the following code:

        ```javascript
        const getDevices = async () => {
            const devices = await AgoraRTC.getDevices();
            const audioDevices = devices.filter(function (device) {
                return device.kind === "audioinput";
            });
            const videoDevices = devices.filter(function (device) {
                return device.kind === "videoinput";
            });
            return {
                audioDevices,
                videoDevices,
            };
        };
        ```

1. **Enable the user to test the selected audio/video devices**

    Create a video track and an audio track using the selected device IDs and append a container element to the body of the document and play the video and audio tracks in that container. To implement this logic, in `agora_manager_call_quality.js`, add the following code:

    ```javascript
    const createTestTracks = async (camera, mic) => {
        const videoTrack = AgoraRTC.createCameraVideoTrack({
            cameraId: camera,
        });
        const audioTrack = AgoraRTC.createMicrophoneAudioTrack({
            microphoneId: mic,
        });
        return {
            videoTrack,
            audioTrack,
        };
    };
    ```
    Due to browser security limitations, the <Vg k="COMPANY" /> Web SDK does not provide any API method for testing the audio playback device. You can test the audio playback device in either of the following ways:

      1. Use the HTML5 `<audio>` element to create an audio player on the web page for users to play an online audio file and confirm whether they can hear the sound.
      2. After creating a microphone audio track, call `MicrophoneAudioTrack.play` to play the audio and check whether they can hear the audio.

1. **Add the connection state monitoring callback function**

    To monitor the <Vpl k="CLIENT" /> connection state, add the following callback:

    ```javascript
    agoraManager
    .getAgoraEngine()
    .on("connection-state-change", (curState, prevState, reason) => {
      eventsCallback("connection-state-change", curState, prevState, reason);
    });
    ```

    The sample project uses the following eventsCallback to handle this event:

    ```javascript
    const handleVSDKEvents = (eventName, ...args) => {
        switch (eventName) {
        case "connection-state-change":
            // The sample code uses debug console to show the connection state. In a real-world application, you can add
            // a label or a icon to the user interface to show the connection state.

            // Display the current connection state.
            console.log("Connection state has changed to :" + args[0]);
            // Display the previous connection state.
            console.log("Connection state was : " + args[1]);
            // Display the connection state change reason.
            console.log("Connection state change reason : " + args[2]);
        }
    };
    ```

1. **Switch stream quality when the user taps the remote video**

    To take advantage of dual-stream mode and switch remote video quality to high or low, add the following code:

    ```javascript
    const setRemoteVideoStreamType = (remoteuid, quality) => {
        agoraEngine.setRemoteVideoStreamType(remoteuid, quality);
    };
    ```

1. **Enable the user to test the last-mile network quality**

    To get the last-mile uplink and downlink network quality, in `agora_manager_call_quality.js`, add the following code:

    ```javascript
    // Get the uplink network condition
    agoraEngine.on("network-quality", (quality) => {
        if (quality.uplinkNetworkQuality == 1) {
            document.getElementById("upLinkIndicator").innerHTML = "Excellent";
            document.getElementById("upLinkIndicator").style.color = "green";
        } else if (quality.uplinkNetworkQuality == 2) {
            document.getElementById("upLinkIndicator").innerHTML = "Good";
            document.getElementById("upLinkIndicator").style.color = "yellow";
        } else quality.uplinkNetworkQuality >= 4;
        {
            document.getElementById("upLinkIndicator").innerHTML = "Poor";
            document.getElementById("upLinkIndicator").style.color = "red";
        }
    });

    // Get the downlink network condition
    agoraEngine.on("network-quality", (quality) => {
        if (quality.downlinkNetworkQuality == 1) {
            document.getElementById("downLinkIndicator").innerHTML = "Excellent";
            document.getElementById("downLinkIndicator").style.color = "green";
        } else if (quality.downlinkNetworkQuality == 2) {
            document.getElementById("downLinkIndicator").innerHTML = "Good";
            document.getElementById("downLinkIndicator").style.color = "yellow";
        } else if (quality.downlinkNetworkQuality >= 4) {
            document.getElementById("downLinkIndicator").innerHTML = "Poor";
            document.getElementById("downLinkIndicator").style.color = "red";
        }
    });
    ```

1. **Implement the logic to get the call-quality statistics**

    When user presses *Enable statistics*, the <Vpl k="CLIENT" /> calls the following methods to get the statistics:

    - `getLocalAudioStats`: Retrieves statistics about the local audio.
    - `getLocalVideoStats`: Retrieves statistics about the local video.
    - `getRemoteAudioStats`: Retrieves statistics about the remote audio.
    - `getRemoteVideoStats`: Retrieves statistics about the remote video.
    - `getRTCStats`: Retrieve the Agora Engine stats.

    In `agora_manager_call_quality.js`, add the following code:

    ```javascript
    const getStatistics = async (remoteUid) => {
        const localAudioStats = agoraEngine.getLocalAudioStats();
        const localVideoStats = agoraEngine.getLocalVideoStats();
        let remoteAudioStats;
        let remoteVideoStats;
        if (remoteUid !== undefined) {
            remoteAudioStats = agoraEngine.getRemoteAudioStats()[remoteUid];
            remoteVideoStats = agoraEngine.getRemoteVideoStats()[remoteUid];
        }
        const rtcStats = agoraEngine.getRTCStats();
        return {
            localAudioStats,
            localVideoStats,
            remoteAudioStats,
            remoteVideoStats,
            rtcStats,
        };
    };
    ```

</PlatformWrapper>
