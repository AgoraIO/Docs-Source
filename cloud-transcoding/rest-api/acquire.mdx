---
title: 'Acquire a builder token'
sidebar_position: 1
type: docs
platform_selector: false
description: >
   Acquire a builderToken to start a cloud transcoding task.
---

import RestAPILayout from '@site/src/components/rest-api/RestAPILayout';
import LeftColumn from '@site/src/components/rest-api/LeftColumn';
import RightColumn, { Section } from '@site/src/components/rest-api/RightColumn';
import ParameterList, { Parameter } from '@site/src/components/rest-api/ParameterList';
import PathParameter from '@site/src/components/rest-api/PathParameter';
import { Tabs, TabItem } from '@site/src/components/rest-api/Tabs';

<RestAPILayout>
  <LeftColumn
    title={frontMatter.title}
    method="POST"
    endpoint="https://api.sd-rtn.com/v1/projects/{appId}/rtsc/cloud-transcoder/builderTokens"
  >

Before you create a <Vpd k='NAME' /> task, call the `builderTokens` endpoint to retrieve a builder token.

## Request

### Path parameters

<PathParameter name="appId" type="string" required={true}>
The App ID of your project from <Vg k="CONSOLE" />.
</PathParameter>

### Request body

<div class="api-mime-type">APPLICATION/JSON</div>

<ParameterList title="BODY" required={true}>
  <Parameter name="instanceId" type="string" required={true}>
    User-specified instance ID. The length must be within 64 characters. The supported character sets are:

    - All lowercase English letters (a-z)
    - All capital letters (A-Z)
    - Numbers 0-9
    - `-`, `_`

    An `instanceId` can generate multiple builder tokens, but only one token can be used to initiate a request in a task.
  </Parameter>

  <Parameter name="services" type="object" required={true}>

    <Parameter name="cloudTranscoder" type="object" required={true}>

      <Parameter name="serviceType" type="string" required={true}>
      The service type. Use `"cloudTranscoderV2"`.
      </Parameter>

      <Parameter name="config" type="object" required={true}>
        <Parameter name="transcoder" type="object" required={true}>

          <Parameter name="idleTimeout" type="number" required={false} defaultValue="300" possibleValues="1 to 86400">
          The maximum period (in seconds) that Cloud Transcoder can be idle. Idle means that all hosts corresponding to the audio and video streams processed by Cloud Transcoder have left the channel. If the idle state exceeds the set time, Cloud Transcoder is automatically destroyed.
          </Parameter>

          <Parameter name="streamProcessMode" type="string" required={false} defaultValue="mix">
          If this parameter is not specified, the working mode of Cloud transcoder is the merge mode. You can specify the following modes:

          - `heterogeneous-single`: Heterogeneous single stream mode. The types of input stream and output stream can be different or the same. The currently supported stream types are RTC and CDN.
          - `single`: RTC stream relay mode. Relays the host's audio and video data and signaling in the source channel to the destination channel.

          <Admonition type="info">
          - If you set `streamProcessMode` to `heterogeneous-single` or `single`, then the `audioInputs` or `videoInputs` list may contain at most one item.
          
          - If you need to mix audio, combine images, or mix audio and combine images, no `streamProcessMode` settings are required.
          </Admonition>
          </Parameter>

          <Parameter name="audioInputs" type="array" required={false}>
            Audio input source list, supports two types: RTC audio stream and CDN audio stream. If you specify multiple input audio sources, the streams are mixed.

            <Admonition type="info">Either `rtc` or `streamUrl` must be filled in.</Admonition>

            <Parameter name="streamUrl" type="string" required={false}>
            The URL of the audio source stream. Required when the audio input source is CDN.
            </Parameter>

            <Parameter name="volume" type="number" defaultValue="100" possibleValues="0 to 200" required={false}>
            The volume of the audio source stream. This parameter only takes effect when the audio input source is CDN.
            </Parameter>

            <Parameter name="repeat" type="number" required={false} defaultValue="1">
            The number of times to play the media stream. This parameter only takes effect when the audio input source is CDN.

            - `1`: Play the media stream once.
            - `-1`: Play the media stream in a loop.
            - `n`: Specify the number of times to play the media stream. Cannot be set to 0.
            </Parameter>

            <Parameter name="rtc" type="object" required={false}>

              When the audio input source is RTC, this object is required.

              <Parameter name="rtcChannel" type="string" required={true}>
              The RTC channel name for the audio input source. Currently, only audio and video sources that subscribe to a single channel are supported. The audio source and video source must belong to the same channel.
              </Parameter>

              <Parameter name="rtcUid" type="number" required={true}>
              The UID corresponding to the audio input source. The same UID must not exist in the RTC channel.
              </Parameter>

              <Parameter name="rtcToken" type="string" required={true}>
              The token that the Cloud Transcoder uses to join the RTC channel for transcoding. Using a token ensures channel security and prevents malicious users from disrupting other users in the channel. See [Token authentication](/video-calling/token-authentication/deploy-token-server) for details.

              The UID of Cloud Transcoder in the RTC channel is randomly assigned by Agora. Therefore, when generating a token, set the uid to `0`.
              </Parameter>
            </Parameter>
          </Parameter>

          <Parameter name="videoInputs" type="array" required={false}>
            Video input source list, supports RTC video stream and CDN video stream. If you specify multiple input video sources, the streams are merged.

            <Parameter name="streamUrl" type="string" required={false}>
            The URL of the video source stream. Required when the video input source is CDN.
            </Parameter>

            <Parameter name="repeat" type="number" required={false} defaultValue="1">
            The number of times to play the media stream. This parameter only takes effect when the input source is CDN.

            - `1`: Play the media stream once.
            - `-1`: Play the media stream in a loop.
            - `n`: Specify the number of times to play the media stream. Cannot be set to 0.
            </Parameter>            

            <Parameter name="rtc" type="object" required={false}>
              This object is required when the video input source is RTC.

              <Parameter name="rtcChannel" type="string" required={true}>
              The RTC channel name for the video input source. Currently, only audio and video sources that subscribe to a single channel are supported. The audio source and video source must belong to the same channel.
              </Parameter>

              <Parameter name="rtcUid" type="number" required={true}>
              The UID corresponding to the video input source. The same UID must not exist in the RTC channel.
              </Parameter>

              <Parameter name="rtcToken" type="string" required={true}>
              The token that the Cloud Transcoder uses to join the RTC channel for transcoding. Using a token ensures channel security and prevents malicious users from disrupting other users in the channel. See [Token authentication](/video-calling/token-authentication/deploy-token-server) for details.

              The UID of Cloud Transcoder in the RTC channel is randomly assigned by Agora. Therefore, when generating a token, set the uid to `0`.
              </Parameter>
            </Parameter>

            <Parameter name="placeholderImageUrl" type="string" required={false}>
            The URL of the placeholder image displayed when the user is offline. It must be a valid image URL and contain the `jpg` or `png` suffix.
            </Parameter>

            <Parameter name="region" type="object" required={true}>
              <Parameter name="x" type="number" required={true} possibleValues="0 to 3840">
              The x coordinate of the image on the canvas (px). The x coordinate is the horizontal displacement of the upper left corner of the image relative to the origin, where the upper left corner of the canvas is the origin.
              </Parameter>

              <Parameter name="y" type="number" required={true} possibleValues="0 to 3840">
              The y coordinate of the image on the canvas (px). The y coordinate is the vertical displacement of the upper left corner of the image relative to the origin, where the upper left corner of the canvas is the origin.
              </Parameter>
            
              <Parameter name="width" type="number" required={true} possibleValues="120 to 3840">
              The width of the screen (px).
              </Parameter>

              <Parameter name="height" type="number" required={true} possibleValues="120 to 3840">
              The height of the screen (px).
              </Parameter>

              <Parameter name="zOrder" type="number" required={true} possibleValues="2 to 100">
              The layer order of the host screen. `2` represents the layer above the placeholder layer. `100` represents the top layer.
              </Parameter>
            </Parameter>
          </Parameter>

          <Parameter name="canvas" type="object" required={true}>
              <Parameter name="width" type="number" required={true} possibleValues="120 to 3840">
              The width of the canvas (px).
              </Parameter>

              <Parameter name="height" type="number" required={true} possibleValues="120 to 3840">
              The height of the canvas (px).
              </Parameter>

              <Parameter name="color" type="number" required={true} possibleValues="0 to 16777215">
              The background color of the canvas. The RGB color value represented as a decimal number
              </Parameter>

              <Parameter name="backgroundImage" type="string" required={false}>
              Canvas background image. Must be a valid image URL with a `jpg` or `png` suffix. If omitted, there is no canvas background image.
              </Parameter>

              <Parameter name="fillMode" type="string" required={false} defaultValue='"FILL"'>
              Fill mode for the canvas background image:

              - `"FILL"`: Scale the image and crop it in the center while maintaining the aspect ratio. 
              - `"FIT"`: Scale the image to fill the display while maintaining the aspect ratio. 
              </Parameter>
          </Parameter>

          <Parameter name="watermarks" type="array" required={true}>

            <Parameter name="imageUrl" type="string" required={true}>
            The URL of the watermark image. It must be a valid URL with a `jpg` or `png` suffix.
            </Parameter>

            <Parameter name="region" type="object" required={true}>
              <Parameter name="x" type="number" required={true} possibleValues="0 to 3840">
              The x coordinate of the watermark on the canvas (px). The x coordinate is the horizontal displacement of the upper left corner of the image relative to the origin.
              </Parameter>

              <Parameter name="y" type="number" required={true} possibleValues="0 to 3840">
              The y coordinate of the watermark on the canvas (px). The y coordinate is the vertical displacement of the upper left corner of the image relative to the origin.
              </Parameter>
            
              <Parameter name="width" type="number" required={true} possibleValues="120 to 3840">
              The width of the watermark (px).
              </Parameter>

              <Parameter name="height" type="number" required={true} possibleValues="120 to 3840">
              The height of the watermark (px).
              </Parameter>

              <Parameter name="zOrder" type="number" required={true} possibleValues="0 to 100">
              The layer order of the watermark. `0` represents the bottom layer. `100` represents the top layer.
              </Parameter>
            </Parameter>

            <Parameter name="fillMode" type="string" required={false} defaultValue='"FILL"'>
            Watermark fill mode:

            - `"FILL"`: Scale the image and crop it in the center while maintaining the aspect ratio.
            - `"FIT"`: Scale the image to fill the display while maintaining the aspect ratio. 
            </Parameter>      
          </Parameter>

          <Parameter name="outputs" type="array" required={true}>
            Configure output settings to publish to an RTC channel or CDN address.

            You must specify either `streamUrl` or `rtc`.

            <Parameter name="streamUrl" type="string" required={false}>
            CDN streaming address.
            </Parameter>

            <Parameter name="rtc" type="object" required={false}>
              Required for publishing to an RTC channel.

              <Parameter name="rtcChannel" type="string" required={true}>
              The RTC channel name for the transcoded audio and video. 
              </Parameter>

              <Parameter name="rtcUid" type="number" required={true}>
              The UID of the RTC channel for the transcoded audio and video streams. Make sure this value is different from the UID of other users in the channel.
              </Parameter>

              <Parameter name="rtcToken" type="string" required={true}>
              The token that the Cloud Transcoder uses to join the output RTC channel. Using a token ensures channel security and prevents malicious users from disrupting other users in the channel. See [Token authentication](/video-calling/token-authentication/deploy-token-server) for details.

              When generating this token, use `outputs.rtc.rtcUid` to generate the token.

              </Parameter>
            </Parameter>

            <Parameter name="audioOption" type="object" required={false}>

              <Parameter name="profileType" type="string" required={false} defaultValue="AUDIO_PROFILE_DEFAULT">
              Audio properties of the transcoded output:

              - `"AUDIO_PROFILE_DEFAULT"`: 48 kHz sampling rate, music encoding, mono channel, maximum encoding bitrate is 64 Kbps.
              - `"AUDIO_PROFILE_SPEECH_STANDARD"`: 32 kHz sampling rate, speech encoding, mono channel, maximum encoding bitrate is 18 Kbps.
              - `"AUDIO_PROFILE_MUSIC_STANDARD"`: 48 KHz sampling rate, music encoding, mono channel, maximum encoding bitrate is 64 Kbps.
              - `"AUDIO_PROFILE_MUSIC_STANDARD_STEREO"`: 48 KHz sampling rate, music encoding, stereo channel, maximum encoding bitrate is 80 Kbps.
              - `"AUDIO_PROFILE_MUSIC_HIGH_QUALITY"`: 48 KHz sampling rate, music encoding, mono channel, maximum encoding bitrate is 96 Kbps.
              - `"AUDIO_PROFILE_MUSIC_HIGH_QUALITY_STEREO"`: 48 kHz sampling rate, music encoding, dual channels, and a maximum encoding bitrate of 128 Kbps.

              </Parameter>
                
            </Parameter>

            <Parameter name="videoOption" type="object" required={false}>

              <Parameter name="width" type="number" required={true} possibleValues="120 to 3840">
              The width of the transcoded output video (px).
              </Parameter>
 
              <Parameter name="height" type="number" required={true} possibleValues="120 to 3840">
              The height of the transcoded output video (px).
              </Parameter>

              <Parameter name="bitrate" type="number" required={true} possibleValues="1 to 10000">
              The bitrate of the transcoded output video.
              </Parameter>
              
              <Parameter name="codec" type="string" required={true}>
              The codec used to transcode the output video. 
              
              **Possible values**:
              - `"H264"`: Standard H.264 encoding.
              - `"VP8"`: Standard VP8 encoding.
              </Parameter>              

              <Parameter name="fps" type="number" required={false} defaultValue="15" possibleValues="1 to 30">
              The frame rate (fps) of the transcoded output video.
              </Parameter>

              <Parameter name="mode" type="string" required={false}>
              Can be set to `RAW`, which means the output video is not transcoded. The encoding format of the input video remains unchanged.

              If the output video is transcoded, do not set this field.
              In `RAW` mode, the number of inputs set in `videInputs` can only be 1.
              </Parameter>
            </Parameter>

          </Parameter>
        </Parameter>
      </Parameter>

    </Parameter>
  </Parameter>
</ParameterList>

## Response

### Response header

<PathParameter name="X-Request-ID" type="string">
UUID (Universally Unique Identifier), used to identify this request.

If the request fails, print out the value in the log to troubleshoot the problem. If the response status code of the request is not 2XX, then the response header may not contain this field.
</PathParameter>

### Response body

- If the returned status code is `200`, the request was successful. The response body contains the result of the request.

  <ParameterList title="OK">
      <Parameter name="createTs" type="number">
      Unix timestamp (seconds) when the `builderToken` was generated
      </Parameter>
      
      <Parameter name="instanceId" type="string">
      The `instanceId` you specified in the request.
      </Parameter>
      
      <Parameter name="tokenName" type="string">
      The value of the `builderToken`. Use this value when calling other methods for this instance.
      </Parameter>
  </ParameterList>

- If the returned status code is not `200`, the request failed. 

  <ParameterList title="Non 200">   
      <Parameter name="message" type="string">
      Describes why the request failed.
      </Parameter>
  </ParameterList>

## Reference

- After calling the `Acquire` method successfully, you receive a `builderToken` in the response body. You can use a `builderToken` for a single cloud transcoding task.
- The validity period of a `builderToken` for creating cloud transcoding is 5 minutes. However, to ensure successful cloud transcoding, best practice is to initiate the corresponding `Create` request within 2 seconds after each `Acquire` response is received.
- Making batch `Create` requests after batch `builderToken` requests may cause the request to fail.

</LeftColumn>

<RightColumn>

<Section title="Authorization">
This endpoint requires [Basic Auth](../rest-api/restful-authentication).
</Section>

<Section title="Request example">

  <Tabs groupId="code-examples">
    <TabItem value="curl" label="curl" default>
      ```bash
      curl --request post \
        --url https://api.sd-rtn.com/v1/projects/:appId/rtsc/cloud-transcoder/builderTokens \
        --header 'Authorization: Basic <credentials>' \
        --header 'Content-Type: <string>' \
        --data '
      {
        "instanceId": "abc13328",
        "services": {
          "cloudTranscoder": {
            "serviceType": "cloudTranscoderV2",
            "config": {
              "transcoder": {
                "idleTimeout": 300,
                "audioInputs": [
                  {
                    "rtc": {
                      "rtcChannel": "test01",
                      "rtcUid": 123,
                      "rtcToken": "<your_rtc_token>"
                    }
                  },
                  {
                    "rtc": {
                      "rtcChannel": "test01",
                      "rtcUid": 456,
                      "rtcToken": "<your_rtc_token>"
                    }
                  }
                ],
                "canvas": {
                  "width": 960,
                  "height": 480,
                  "color": 0,
                  "backgroundImage": "https://web-cdn.agora.io/website-files/images/new-home-2-banne-online-karaoke-bg.jpg",
                  "fillMode": "FIT"
                },
                "waterMarks": [
                  {
                    "imageUrl": "https://web-cdn.agora.io/website-files/images/advantage-interactive-live-streaming.png",
                    "region": {
                      "x": 0,
                      "y": 0,
                      "width": 100,
                      "height": 100,
                      "zOrder": 50
                    }
                  }
                ],
                "videoInputs": [
                  {
                    "rtc": {
                      "rtcChannel": "test01",
                      "rtcUid": 123,
                      "rtcToken": "<your_rtc_token>"
                    },
                    "placeholderImageUrl": "https://web-cdn.agora.io/website-files/images/new-home-2-banner-realtime-bg.jpg",
                    "region": {
                      "x": 0,
                      "y": 0,
                      "width": 320,
                      "height": 360,
                      "zOrder": 2
                    }
                  },
                  {
                    "rtc": {
                      "rtcChannel": "test01",
                      "rtcUid": 456,
                      "rtcToken": "<your_rtc_token>"
                    },
                    "region": {
                      "x": 320,
                      "y": 0,
                      "width": 320,
                      "height": 320,
                      "zOrder": 2
                    }
                  }
                ],
                "outputs": [
                  {
                    "rtc": {
                      "rtcChannel": "test02",
                      "rtcUid": 1000,
                      "rtcToken": "<your_rtc_token>"
                    },
                    "audioOption": {
                      "profileType": "AUDIO_PROFILE_MUSIC_STANDARD"
                    },
                    "videoOption": {
                      "fps": 30,
                      "codec": "H264",
                      "bitrate": 800,
                      "width": 960,
                      "height": 48
                    }
                  }
                ]
              }
            }
          }
        }
      }'
      ```
    </TabItem>
    <TabItem value="python" label="Python">

    ```python
    import requests
    import json

    url = "https://api.sd-rtn.com/v1/projects/:appId/rtsc/cloud-transcoder/builderTokens"
    headers = {
        "Authorization": "Basic <credentials>",
        "Content-Type": "<string>"
    }

    data = {
        "instanceId": "abc13328",
        "services": {
            "cloudTranscoder": {
                "serviceType": "cloudTranscoderV2",
                "config": {
                    "transcoder": {
                        "idleTimeout": 300,
                        "audioInputs": [
                            {
                                "rtc": {
                                    "rtcChannel": "test01",
                                    "rtcUid": 123,
                                    "rtcToken": "<your_rtc_token>"
                                }
                            },
                            {
                                "rtc": {
                                    "rtcChannel": "test01",
                                    "rtcUid": 456,
                                    "rtcToken": "<your_rtc_token>"
                                }
                            }
                        ],
                        "canvas": {
                            "width": 960,
                            "height": 480,
                            "color": 0,
                            "backgroundImage": "https://web-cdn.agora.io/website-files/images/new-home-2-banne-online-karaoke-bg.jpg",
                            "fillMode": "FIT"
                        },
                        "waterMarks": [
                            {
                                "imageUrl": "https://web-cdn.agora.io/website-files/images/advantage-interactive-live-streaming.png",
                                "region": {
                                    "x": 0,
                                    "y": 0,
                                    "width": 100,
                                    "height": 100,
                                    "zOrder": 50
                                }
                            }
                        ],
                        "videoInputs": [
                            {
                                "rtc": {
                                    "rtcChannel": "test01",
                                    "rtcUid": 123,
                                    "rtcToken": "<your_rtc_token>"
                                },
                                "placeholderImageUrl": "https://web-cdn.agora.io/website-files/images/new-home-2-banner-realtime-bg.jpg",
                                "region": {
                                    "x": 0,
                                    "y": 0,
                                    "width": 320,
                                    "height": 360,
                                    "zOrder": 2
                                }
                            },
                            {
                                "rtc": {
                                    "rtcChannel": "test01",
                                    "rtcUid": 456,
                                    "rtcToken": "<your_rtc_token>"
                                },
                                "region": {
                                    "x": 320,
                                    "y": 0,
                                    "width": 320,
                                    "height": 320,
                                    "zOrder": 2
                                }
                            }
                        ],
                        "outputs": [
                            {
                                "rtc": {
                                    "rtcChannel": "test02",
                                    "rtcUid": 1000,
                                    "rtcToken": "<your_rtc_token>"
                                },
                                "audioOption": {
                                    "profileType": "AUDIO_PROFILE_MUSIC_STANDARD"
                                },
                                "videoOption": {
                                    "fps": 30,
                                    "codec": "H264",
                                    "bitrate": 800,
                                    "width": 960,
                                    "height": 480
                                }
                            }
                        ]
                    }
                }
            }
        }
    }

    response = requests.post(url, headers=headers, data=json.dumps(data))

    print(response.status_code)
    print(response.json())
    ```
    </TabItem>

    <TabItem value="node" label="Node.js">

    ```js
    const axios = require('axios');

    const url = 'https://api.sd-rtn.com/v1/projects/:appId/rtsc/cloud-transcoder/builderTokens';
    const headers = {
      'Authorization': 'Basic <credentials>',
      'Content-Type': '<string>'
    };

    const data = {
      instanceId: "abc13328",
      services: {
        cloudTranscoder: {
          serviceType: "cloudTranscoderV2",
          config: {
            transcoder: {
              idleTimeout: 300,
              audioInputs: [
                {
                  rtc: {
                    rtcChannel: "test01",
                    rtcUid: 123,
                    rtcToken: "<your_rtc_token>"
                  }
                },
                {
                  rtc: {
                    rtcChannel: "test01",
                    rtcUid: 456,
                    rtcToken: "<your_rtc_token>"
                  }
                }
              ],
              canvas: {
                width: 960,
                height: 480,
                color: 0,
                backgroundImage: "https://web-cdn.agora.io/website-files/images/new-home-2-banne-online-karaoke-bg.jpg",
                fillMode: "FIT"
              },
              waterMarks: [
                {
                  imageUrl: "https://web-cdn.agora.io/website-files/images/advantage-interactive-live-streaming.png",
                  region: {
                    x: 0,
                    y: 0,
                    width: 100,
                    height: 100,
                    zOrder: 50
                  }
                }
              ],
              videoInputs: [
                {
                  rtc: {
                    rtcChannel: "test01",
                    rtcUid: 123,
                    rtcToken: "<your_rtc_token>"
                  },
                  placeholderImageUrl: "https://web-cdn.agora.io/website-files/images/new-home-2-banner-realtime-bg.jpg",
                  region: {
                    x: 0,
                    y: 0,
                    width: 320,
                    height: 360,
                    zOrder: 2
                  }
                },
                {
                  rtc: {
                    rtcChannel: "test01",
                    rtcUid: 456,
                    rtcToken: "<your_rtc_token>"
                  },
                  region: {
                    x: 320,
                    y: 0,
                    width: 320,
                    height: 320,
                    zOrder: 2
                  }
                }
              ],
              outputs: [
                {
                  rtc: {
                    rtcChannel: "test02",
                    rtcUid: 1000,
                    rtcToken: "<your_rtc_token>"
                  },
                  audioOption: {
                    profileType: "AUDIO_PROFILE_MUSIC_STANDARD"
                  },
                  videoOption: {
                    fps: 30,
                    codec: "H264",
                    bitrate: 800,
                    width: 960,
                    height: 480
                  }
                }
              ]
            }
          }
        }
      }
    };

    axios.post(url, data, { headers })
      .then(response => {
        console.log('Status:', response.status);
        console.log('Data:', response.data);
      })
      .catch(error => {
        console.error('Error:', error.response ? error.response.data : error.message);
      });
    ```
    </TabItem>
  </Tabs>

</Section>
<Section title="Response example">

  <Tabs groupId="response">
    <TabItem value="ok" label="200" default>
    ```json
    {
      "createTs": 1661324606,
      "instanceId": "abc13328",
      "tokenName": "xUwUbQf9ZxxxxxtLslGnDg0lk8RYaUE0***"
    }
    ```
    </TabItem>

    <TabItem value="error" label="Non-200">

    ```json
    {
      "message": "Describes why the request failed."
    }
    ```
    
    </TabItem>
  </Tabs>
</Section>
</RightColumn>
</RestAPILayout>