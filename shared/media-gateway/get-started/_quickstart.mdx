import * as data from '@site/data/variables';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

To push online media streams as live video source streams into <Vg k="COMPANY" /> channels using <Vpd k="NAME" />, you need to obtain a server domain name and streaming key. Taking the OBS streaming software as an example, you configure the server's domain name and streaming key in the following way:

![Server settings](/images/media-gateway/obs-server-setting.png)

This page explains how to obtain the server domain name and generate a streaming key.

## Prerequisites

In order to follow this procedure you must:

- Have a project that implements real-time interaction
- Generate app ID, app certificate, customer ID, and customer secret
- Contact [<Vg k="COMPANY" /> support](mailto:support@agora.io) to activate <Vpd k="NAME" />
- Pass basic HTTP or HMAC authentication

## Get server domain name

You can use <Vg k="COMPANY" />â€™s unified domain name or your own one. The server appends the `/live` suffix to the domain name.

- The <Vg k="COMPANY" />'s unified domain name is `rtls-ingress-prod-<region>.agoramdn.com`. Replace `<region>` with the code for your geographical region.

     The supported regions and their codes are:

            * `na`: North America
            * `eu`: Europe
            * `ap`: Asia, except Mainland China
            * `cn`: Mainland China

- To use your own domain name, [contact technical support](mailto:support@agora.io) for configuration.

## Get streaming key

The stream key generation method depends on whether you use the <Vg k="COMPANY" />'s domain name or a custom domain name.

 - If you use <Vg k="COMPANY" />'s domain name, create a stream key using the <Vpd k="NAME" /> RESTful API.
 - If you use your own domain name, you can either call the <Vpd k="NAME" /> RESTful API or generate the key locally.

### Generate streaming key with RESTful API

Create and publish the streaming key by calling the following endpoint:

`PUT https://api.agora.io/:region/v1/projects/:appId/rtls/ingress/streamkeys`

See [API reference](https://documenter.getpostman.com/view/6319646/SVSLr9AM#6aed9690-285e-45f0-a329-c995adbd0956) for details.

### Generate streaming key locally

<Admonition type="caution" title="Note">Before starting, please make sure you have contacted technical support and configured your domain name.</Admonition>

To generate a stream key locally, you use the following information:

* The app ID of the <Vg k="COMPANY" /> project from <Link to="{{Global.AGORA_CONSOLE_URL}}"><Vg k="CONSOLE" /></Link>.
* The app certificate corresponding to your app ID.
* The channel name (`channelName`).
* The user ID (`uid`) of the host in the channel.
* The effective duration of the stream key, in seconds (`expiresAfter`).
* (Optional) The associated flow configuration template (`template`). See [API reference](https://documenter.getpostman.com/view/6319646/SVSLr9AM#6aed9690-285e-45f0-a329-c995adbd0956) for details.

The following Node.js sample code demonstrates how to generate a stream key locally.

<Admonition type="caution" title="Note">The following example code relies on the `msgpack-lite` module. If you haven't installed it yet, execute `npm install msgpack-lite` and run `node app.js` in the project root directory .</Admonition>

```javascript
const crypto = require('crypto');
const msgpack = require('msgpack-lite');

appcert = "" // Your app certificate from Agora
channel = ""; // The Video SDK channel name
uid = ""; // The UID of the host in the channel
expiresAfter = 86400; // Valid duration of stream key (seconds)

const expiresAt = Math.floor(Date.now() / 1000) + expiresAfter;

const rtcInfo = {
   C: channel,
   U: uid,
   E: expiresAt,
   // If you are not sure whether to use the flow configuration template, keep the following line commented
   // T: templateId,
};

// Serialize using msgpack
const data = msgpack.encode(rtcInfo);

// Randomly generate an initialization vector
const iv = crypto.randomBytes(16);

// Use app certificate as encryption key
const key = Buffer.from(appcert, 'hex');

// Create an AES-128 CTR encryptor
const encrypter = crypto.createCipheriv('aes-128-ctr', key, iv);

// Encrypt the data
const encrypted = Buffer.concat([iv, encrypter.update(data), encrypter.final()]);

// Base64 conversion
const streamkey = encrypted.toString('base64').replace(/\+/g, '-').replace(/\//g, '_').replace(/\=+$/, '');

console.log(`streamkey is ${streamkey}`);
```

## Advanced configuration: Avoid source streams containing B-frames

To avoid compatibility issues with <Vg k="COMPANY" /> viewer on the web when transcoding is not enabled, and the source stream contains B-frames, use one of the following methods in OBS Studio:

<Tabs>
  <TabItem value="encoding parameter" label="x264 Options parameter" default>
    In OBS Studio, go to **Settings > Output > Encoder Settings**, and set the **x264 Options** to `bframes=0`

    ![zero B frames](/images/media-gateway/obs-setting-bframes.png)
  </TabItem>
  <TabItem value="tune parameter" label="Tune parameter">
    In OBS Studio, go to **Settings > Output > Encoder Settings**, and set the **Tune** parameter to `zerolatency`

    ![Zero latency](/images/media-gateway/obs-setting-zerolatency.png)
  </TabItem>
</Tabs>

Save the configuration and return to the main screen.

## Next steps

After completing the configuration, you can push RTMP or SRT protocol streams to <Vg k="COMPANY" /> channels, and these streams will be published to the corresponding channels by the host.

By default, after the <Vpd k="NAME" /> receives the pushed stream, it will not transcode the video stream, but directly publish it to the <Vg k="COMPANY" /> channel. If you want to transcode the streams, use the stream configuration template API to implement related functions.













