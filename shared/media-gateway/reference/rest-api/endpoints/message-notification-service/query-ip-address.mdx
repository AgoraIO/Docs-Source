import CodeBlock from '@theme/CodeBlock';
import PostmanLink from '@docs/shared/media-gateway/reference/rest-api/postman-link.mdx';
import Authorization from '@docs/shared/media-gateway/reference/rest-api/authorization.mdx';
import RestAPILayout from '@site/src/components/rest-api/RestAPILayout'; 
import LeftColumn from '@site/src/components/rest-api/LeftColumn'; 
import RightColumn, { Section } from '@site/src/components/rest-api/RightColumn'; 
import ParameterList, { Parameter } from '@site/src/components/rest-api/ParameterList'; 
import PathParameter from '@site/src/components/rest-api/PathParameter'; 
import { Tabs, TabItem } from '@site/src/components/rest-api/Tabs';

<RestAPILayout>

  <LeftColumn
    title={frontMatter.title}
    method="GET"
    endpoint="https://api.agora.io/v2/ncs/ip"
  >

When using Agora real-time audio and video, you can use the [<Vg k="NCS_LONG" /> service](#ncs-service) to receive channel events.

<Admonition type="info" info="info">
Agora adjusts the <Vg k="NCS_LONG" /> IP addresses every 24 hours. Best practice is to call this endpoint at least every 24 hours and automatically update the firewall configuration.
</Admonition>

### Request 

<ParameterList title="HEADER" required={true}>
  <Parameter name="Authorization" type="string" required={true}>
  <Authorization/>
  </Parameter>
</ParameterList>


### Response

If the status code is `200`, the request succeeds, and the response body includes the following parameters:

<ParameterList>
  <Parameter name="data" type="Object">
    <Parameter name="service" type="Object">
      <Parameter name="hosts" type="Object">
        <Parameter name="primaryIP" type="String">
          The IP address of the <Vg k="NCS_LONG" /> server. When you receive a response, you need to add the IP address (or list of IP addresses) from this field to the whitelist.
        </Parameter>
      </Parameter>
    </Parameter>
  </Parameter>
</ParameterList>

If the status code is not `200`, the request fails. See the `message` field in the response body for the reason for this failure. For details about possible response status codes, see [Response status codes](../../response-status-codes).

<PostmanLink />
## Reference

This section contains content that completes the information on this page, or points you to documentation that explains other aspects to this product.

### NCS service

After activating the service, when a channel event occurs, the <Vg k="NCS_LONG" /> server will deliver the event notification to your message receiving server.

If your server is behind a firewall, you need to call the IP address query API to retrieve the IP addresses of <Vg k="NCS_LONG" /> and configure your firewall to trust all these IP addresses.

</LeftColumn>
<RightColumn>
<Section title="Authorization">
The endpoint requires [RESTful Authentication](/media-gateway/reference/restful-authentication#implement-basic-http-authentication).
</Section>
<Section title="Request example">

  <Tabs groupId="code-examples">
    <TabItem value="curl" label="cURL" default>
    ```js
    curl -X GET "http://api.sd-rtn.com/v2/ncs/ip" \
     -H "Authorization: Bearer YOUR_TOKEN_HERE" \
     -H "Accept: application/json"
    ```
    </TabItem>
    <TabItem value="node" label="Node" default>
    ```js
    fetch("http://api.sd-rtn.com/v2/ncs/ip", {
        method: "GET",
        headers: {
            "Authorization": "Bearer YOUR_TOKEN_HERE",
            "Accept": "application/json"
        }
    })
    .then(res => res.json())
    .then(console.log)
    .catch(console.error);
    ```
    </TabItem>
    <TabItem value="python" label="Python" default>
    ```python
    url = "http://api.sd-rtn.com/v2/ncs/ip"
    headers = {
        "Authorization": "Bearer YOUR_TOKEN_HERE",
        "Accept": "application/json"
    }

    res = requests.get(url, headers=headers)
    print(res.json() if res.status_code == 200 else res.text)
    ```
    </TabItem>
  </Tabs>
</Section>
<Section title="Response example">
```json
{
  "data": {
    "service": {
      "hosts": [
        {
          "primaryIP": "string"
        }
      ]
    }
  }`      
}
```
</Section>
</RightColumn>
</RestAPILayout>
