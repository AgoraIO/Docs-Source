import * as data from '@site/data/variables';
import ProjectSetup from '@docs/shared/video-sdk/develop/screenshot-upload/project-setup/index.mdx';
import ProjectImplement from '@docs/shared/video-sdk/develop/screenshot-upload/project-implementation/index.mdx';
import ProjectTest from '@docs/shared/video-sdk/develop/screenshot-upload/project-test/index.mdx';
import Reference from '@docs/shared/video-sdk/develop/screenshot-upload/reference/index.mdx';

In the real-time audio and video scenario, the Agora SDK supports taking screenshots of the video stream in the channel according to the frequency you set, and uploading the pictures to the third-party cloud storage you specify.

## Understand the tech

After calling the API to enable the video screenshot upload function, the SDK will take screenshots and upload videos sent by local users according to the frequency you set. After the screenshot is completed, the Agora cloud server will send a callback notification to your server in the form of an HTTPS request, and send all the screenshots to the third-party cloud storage you specified.

![](/images/screenshot-upload/screenshot-upload.png)

<PlatformWrapper notAllowed="ios,macos,android,windows">
**This feature is not yet available for <Vpl k="NAME" />**
</PlatformWrapper>

<PlatformWrapper platform="ios,macos,android,windows">

## Prerequisites

Before implementing the function of uploading video screenshots of Agora, please ensure that the following conditions are met:

* A work order has been submitted to enable and configure the <Vg k="COMPANY" /> video screenshot upload service.

* You have integrated RTC 4.x SDK (including video screenshot upload dynamic library) or RTC 3.x SDK v3.6.2 and above in your project, joined the channel and published the video stream. For details, see the [SDK quickstart](../get-started/get-started-sdk/).

## Implement screenshot upload

<ProjectImplement />

## Test your implementation

<ProjectTest />

## Reference

This section contains information that completes the information on this page, or points you to documentation that explains other aspects to this product.

### HTTP message notification

After a screenshot is successfully uploaded to the Agora cloud server, the Agora service sends a message notification callback to your application server in the form of an `HTTPS POST` request. The data format is `JSON`, and the character encoding is `UTF-8`.

After receiving a message notification, your application server responds with a status code of `200`. The response packet body format is `JSON`. Agora considers the notification to have failed under any of the following circumstances:

* The Agora service does not receive a response from your server within 5 seconds after sending the message notification.

* The HTTP status code of the response is not `200`, or the response body format is not `JSON`.

The Agora service retries immediately after the first notification failure, and sends a message notification again. A total of three notification attempts are made.

### HTTP Request

#### Request header

| Field name | value |
|:-----|:-------------|
| `Content-Type` | `application/json;charset=utf-8` |

#### Request body

The request body is a JSON Object and contains the following fields:

| Field          | Type         | Description  |
|:--------------|:------------|:-----------------------------------------------|
| `requestId`      | String       | Callback notification ID that identifies an event notification from the Agora service server. |
| `callbackParam`  | JSON Object  | Customize the incoming fields in the callback, currently only includes the `cname` field, which is the channel name. |
| `callbackData`   | String       | The string data transmitted by the SDK video screenshot upload module. |
| `checksum`       | String       | The MD5 value calculated from the four parameter values of , , and is used to verify whether the callback notification comes from the video screenshot upload service `callbackAddr.codeobjectrequestId` |
| `object`         | String       | The name of the screenshot file.<br/> The naming convention for this file is: `<OSS prefix>/<year month day>/<sid>_<cname>__uid_s_<uid>__uid_e_<type>_utc.jpg`. The meanings of each field in the file name are as follows:<ul><li> `<sid>`: screenshot ID. The ID is a unique identifier for a screenshot.</li><li> `<cname>`: The channel name of the screenshotted user.</li><li> `<uid>`: User ID. The user ID set when joining the channel.</li><li> `<type>`: file type, only supported video.</li><li> `<utc>`: The Unix timestamp of this screenshot. UTC time, consisting of year, month, day, hour, minute, second, and millisecond. For example, utc equals 20190611073246073 means that the start time of the slice file is 07:32:46:73 milliseconds on June 11, 2019 UTC.</li></ul>|
| `code`           | Number       | The status code of this screenshot. 200Indicates that the screenshot is complete. |
| `msg`            | String       | The status of this screenshot. "Supervise complete"Indicates that the screenshot is complete. |
| `channelName`    | String       | The name of the channel to which the screenshotted user belongs. Consistent with object.cname. |
| `userId`         | String       | The user ID of the user whose screenshot was taken this time. Consistent with object.uid. |
| `timestamp`      | Int          | Unix timestamp (in milliseconds) for this screenshot. UTC time, object.utcconsistent with . |

#### Example request

```json
{
    "requestId": "38f8e3cfdcXXXXXXXXX1ceba380d7e1a_1652693284_b5813fe2ae4fa5cdfe5abd8fef82526f",
    "callbackParam": {
        "cname": "httpClient463224"
    },
    "callbackData": "",
    "checksum": "75ee988XXXXXXc2ad4ec2aef58f178fd8",
    "object": "test/20201216/38f8e3cfdc474cd56fc1ceba380d7e1a_httpClient463224__uid_s_91__uid_e_video_20200413081128672.jpg",
    "code": 200,
    "msg": "Supervise complete",
    "channelName": "httpClient463224",
    "userId": "91",
    "timestamp": 20190611073246070
}
```

### HTTP status codes

| Status code | Description |
|:-------|:--------------------|
| 200 | The request was successful.|
| 201 | A new resource was successfully requested and created.|
| 206 | During the entire screenshot process, no user sent a stream, or some screenshot files were not uploaded to the third-party cloud storage. |
| 400 | The syntax of the request is incorrect (such as a wrong parameter), and the server cannot understand it.|
| 401 | Unauthorized (App ID/Customer Certificate mismatch).|
| 404 | The server could not find the resource (web page) according to the request.|
| 500 | An internal server error prevented the request from being completed.|
| 504 | Internal server error. The server acting as a gateway or proxy is not getting the request from the remote server.

### Video screenshot upload dynamic library

For details about uploading the dynamic library name and the increased volume of the integrated app after uploading video screenshots on each platform, see How to reduce the app volume after integrating the v4.x SDK? .

<Reference />

</PlatformWrapper>