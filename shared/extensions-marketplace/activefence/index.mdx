import ProjectImplementation from '@docs/shared/extensions-marketplace/activefence/project-implementation/index.mdx';
import Prerequisites from '@docs/shared/extensions-marketplace/common/_prerequities.mdx';

[<Vg k="RTEE_AF" />](https://www.activefence.com/) is the leader in providing Trust & Safety solutions to protect online platforms and their users from
malicious behavior and content. By integrating <Vg k="RTEE_AF" /> capabilities in your <Vpl k="CLIENT" />, design the
exact content moderation processes you want with the ActiveFence AI-driven automated detection for text,
audio, image and video content across multiple abuse areas and languages. Quickly moderate, enforce policies, manage
user flags, send notifications, and more.

<PlatformWrapper notAllowed="ios,macos">
  **This extension is not supported for this platform.**
</PlatformWrapper>
<PlatformWrapper platform="ios,macos">

The following figure shows the workflow for <Vg k="RTEE_AF" /> to moderate content sent by a specific user to a channel:

![rtc-channel](/images/extensions-marketplace/active-fence.svg)


This page shows you how to integrate and use the <Vg k="RTEE_AF" /> content detection and moderation extension in your
<Vpl k="CLIENT" />.

## Prerequisites

The development environment requirements are as follows:

<Prerequisites />
- Implemented <Link to="../../../video-calling/get-started/get-started-sdk"><Vg k="GET_STARTED"/> for <Vg
  k="VIDEO"/></Link> using the 4.1.1-special.8 release.

## Project Setup

In order to configure <Vg k="RTEE_AF" />:

1. **Setup your <Vg k="RTEE_AF" /> account**

    1. In your browser, navigate to https://www.activefence.com/demo/ and request a demo account.

        <Vg k="RTEE_AF" /> sets up your demo account and supplies the URL to your <Vg k="RTEE_AF_D" />.

    1. In your browser, log into <Vg k="RTEE_AF" /> Dashboard, then click the Settings icon on the top-right.

        **Account Settings** opens.

    1. Click **Data Management** > **<Vg k="RTEE_AF" /> API Keys**, then click **Add Key**.

    1. In **Add API Key**, fill in the form and click **Generate Key**.

    1. Click **Data Management** > **API Management** > **Key Management**, then click **Add Key**.

    1. In **Add API Key**, fill in the API Key and press **Save**.


1. **Configure the content that is unacceptable in your  <Vpl k="CLIENT" />**

    Content moderation workflows are the core of <Vg k="RTEE_AF" />. A workflow defines the action that is taken
    when content streamed to a channel is above a percentage risk of being unacceptable. For example, there is an
    80% chance that a user is streaming images of graphic violence, you suspend that user. To setup a workflow:

    1. In <Vg k="RTEE_AF_D" />, click the hamburger menu at the top left, click **Workflows**, then click **Create
   New**.

    1. In your workflow, drag the initiator, condition and action to your workflow. For example:
        - Initiator - `Abuse or Harmful` is `Graphic Violence`.
        - Condition - `Risk Score` equals `90`.
        - Action - `Suspend`.

    When your workflow is defined, you configure the format and data sent to your webhook every time content matches
    the conditions.

1. **Define the information <Vg k="RTEE_AF" /> sends to your webhook**

    <Vg k="RTEE_AF" /> monitors the data sent in a channel. When content matches condtions in a workflow, <Vg
   k="RTEE_AF" /> sends a PUSH request to your webhook with information about the channel the data was sent and the
   user who sent it. To enable this, you configure the data that is sent to your webhook:

    1. In <Vg k="RTEE_AF" />, click **MODERATION CAPABILITIES** > **Custom Fields**.

    1. Add the following editable custom fields:

        | Title      | Key | Type | Tooltip |
        | ----------- | ----------- | ----------- | ----------- |
        |  cname    |   cname    |  Text     |  The name of the channel being monitored.     |
        |  requestId    | requestId      |  Text     |   The Id of the request used to upload an image.    |
        |  sid    |  sid     |  Text     |    The SID uploaded by Video SDK. (I don't understand what this is)   |
        |  source    |  source     |  Text     |   This value is hardcoded as `agora`.   |
        |    timestamp  |  timestamp     |  Number     | The time the image was uploaded in the format; YYYY MM DD HH MM SS SSS |
        |  uid  | uid      |  Number     |   The ID of the user who sent the message to the channel.    |
<a name="define-webhook"/>
1. **Define the webhook <Vg k="RTEE_AF" /> sends information to when an action is triggered in your workflow**

    1. In <Vg k="RTEE_AF" />, click **DATA MANAGEMENT** > **Action Webhooks**, then click **Add Webhook**.

    1. In **Add Action Webhook**, update the following fields and click **Save**.

        - **Action** - The name for this webhook.
        - **Related Entity** - Set to `content`.
        - **Endpoint URL** - The FQDM for your webhook. For example: `https://my.super.duper/webhook`.
        - **Request Method** - Set to POST.
        - **API Key** - For authenticated requests to your webhook. Choose the key you configured earlier.   If you
        do not require authentication, set to No auth.


    1. In **Body**, configure the format of the JSON object and data sent to your webhook. Set the following:

        ```json
          {
              "contentUrl":"$contentUrl",
              "status":"$status",
              "userId":"$userId",
              "addedAt":"$addedAt",
              "contentId":"$contentId",
              "reason":"$violationsCategories",
              "metaData":{
                  "callbackData":"$callbackData",
                  "source":"$source",
                  "requestId":"$requestId",
                  "sid":"$sid",
                  "cname":"$cname",
                  "uid":"$uid",
                  "timestamp":"$timestamp"
              }
          }
        ```


1. **Connect your <Vpl k="CLIENT" /> to your <Vg k="RTEE_AF" /> account**

    In order for <Vg k="RTEE_AF" /> to monitor data streamed to a channel in your <Vpl k="CLIENT" />,   <Vg
    k="RTEE_AF"/>  needs to bind your App ID to your <Vg k="RTEE_AF" /> account. To do this:

    1. Send <Vg k="COMPANY" /> an email at support@agora.io requesting <Vg k="RTEE_AF" /> activation with your:
        - Company name
        - Company email
        - Agora APP-ID,
        - The Callback URL for the webhook you [defined in <Vg k="RTEE_AF" /> ](#define-webhook)

    1. <Vg k="COMPANY" /> activates communication between your  <Vpl k="CLIENT" /> and  <Vg k="RTEE_AF" /> and supplies any extra credentials to you.

    1. <Vg k="RTEE_AF" /> communicates any extra credentials to you.


## Integrate the extension

Now that  <Vg k="RTEE_AF" /> can check content sent in the channels in your <Vpl k="CLIENT" />,  you need to:

1. **Enable content moderation in your app**

    To ensure that content moderation is active in your app when a user joins a channel, add code such as the
    following to your app:

      ```swift
      extension AgoraManager {
          func setupContentInspect() {
              let inspectConfig = AgoraContentInspectConfig()
              let module = AgoraContentInspectModule()
              module.type = AgoraContentInspectType.imageModeration // Be sure to set type as cloudmoderation
              module.interval = 2 // Set content moderation to run every 2 seconds
              inspectConfig.modules = [module]
              let inspEnabled = engine.enableContentInspect(true, config: inspectConfig)
              print("inspect enabled = \(inspEnabled)")
          }
      }

      struct ContentView: View {
          @ObservedObject var agoraManager = AgoraManager(appId: "Your APP ID", role: .broadcaster)
          var channelId: String = "test"
          var body: some View {
              ScrollView {
                  VStack {
                      ForEach(Array(agoraManager.allUsers), id: \.self) { uid in
                          AgoraVideoCanvasView(manager: agoraManager, uid: uid)
                              .aspectRatio(contentMode: .fit).cornerRadius(10)
                      }
                  }.padding(20)
              }.onAppear {
                  agoraManager.joinChannel(channelId, token: nil)
                  agoraManager.setupContentInspect()
                  }
              }.onDisappear {
                  agoraManager.leaveChannel()
              }
          }
      }
      ```

1. **Setup your webhook**

    In order to react to calls made by <Vg k="RTEE_AF" /> for moderated content, your need to:

    1. Create a server that received and interprets the data sent to you in the webhook you [defined in <Vg
   k="RTEE_AF" /> ](#define-webhook)

    1. React to the webhook. For example, use the [Channel Management REST API](/en/video-calling/reference/channel-management-rest-api#creates-a-rule) to expel the user from a channel.




## Reference

- [<Vg k="RTEE_AF" /> docs](https://docs.activefence.com/#section/About-This-Guide)
- [Channel Management REST API](/en/video-calling/reference/channel-management-rest-api)
- You find complete documentation for <Vg k="RTEE_AF_D" /> in your environment: https://\<my <Vg k="RTEE_AF" /> app>.
  activefence.com/ts-platform/documentation.

</PlatformWrapper>