<PlatformWrapper platform="web">

To implement the use of metadata, take the following steps:

1. **Handle presence and metadata events in the channel**

      As the users interact in a channel, react to the events.

        ```javascript
        const handleSignalingEvents = (eventName, eventArgs) => {
        if (eventName == "MessageFromPeer") {
        } else if (eventName == "ConnectionStateChanged") {
          if (eventArgs.state == "CONNECTED") {
            setLocalUserMetadata();
          }
        } else if (eventName == "JoinedChannel") {
          updateChannelMemberList();
        } else if (eventName == "LeftChannel") {
          clearChannelMemberList();
        } else if (eventName == "ChannelMessage") {
        } else if (eventName == "MemberJoined") {
          updateChannelMemberList();
        } else if (eventName == "MemberLeft") {
          removeMemberFromList(eventArgs.memberId);
        } else if (eventName == "UserMetaDataUpdated") {
          const item = eventArgs.rtmMetadata.items.find(
            (obj) => obj.key === "myStatus"
          );
          if (item !== undefined) {
            const value = item.value;
            if (getSignalingChannel()) {
              updateMemberInList(eventArgs.uid, item.value == "busy");
            }
          }
        }
      };
      ```

1. **Handle local user metadata**

    Set and update metadata for the local user.

    1. Set local user metadata

        After a user successfully logs in to <Vpd k="PRODUCT" />, you clear unwanted metadata from a previous login,
        and add fresh metadata that you want to share with other users. To do this:

          ```javascript
          const setLocalUserMetadata = async function () {
            // Clear previous metadata
            try {
              await signalingManager.signalingEngine.clearLocalUserMetadata();
            } catch (status) {
              if (status) {
                const { code, message } = status;
                console.log(code, message);
              }
            }
            // Set local user metadata
            const item1 = signalingManager.signalingEngine.createMetadataItem();
            item1.setKey("myStatus");
            item1.setValue("available");

            try {
              await signalingManager.signalingEngine.setLocalUserMetadata([item1]);
            } catch (status) {
              if (status) {
                const { code, message } = status;
                messageCallback(code + ": " +  message);
              }
            }
          };
          ```

    1. Update local user metadata

        When the local user clicks the button to switch their status, you update the user's metadata:

        ```javascript
          const updateLocalUserMetadata = async function (key, value) {
            const metadataItem  = signalingManager.signalingEngine.createMetadataItem();
            metadataItem.setKey(key);
            metadataItem.setValue(value);

            try {
              await signalingManager.signalingEngine.updateLocalUserMetadata([metadataItem]);
            } catch (status) {
              if (status) {
                const { code, message } = status;
                messageCallback("Error:" + code + ": " + message);
              }
            }
          };
        ```

    1. Handle metadata changes

        ```javascript
        const handleMetadataEvents = async function () {
        signalingManager.signalingEngine.on("UserMetaDataUpdated", function (uid, rtmMetadata) {
          if (typeof rtmMetadata !== "undefined") {
            const eventArgs = { uid: uid, rtmMetadata: rtmMetadata }
            eventsCallback("UserMetaDataUpdated", eventArgs)
          }
        });
        }
        ```

1. **Handle other users and their metadata in the channel**

    When a user joins a channel, you subscribe to the user's metadata to receive notification of changes. To add or
  update an item in the user list:

        ```javascript
        const updateUserInList = async function (userID, busy) {
            var doesUserExist = false; // check if userID is in members list
            var userData = ""; // User data, `user ID: Busy` or `User ID: Available`
            var member;
            var ul = document.getElementById("members-list");
            var members = ul.getElementsByTagName("li");

            for (var i = 0; i < members.length; i++){
                if(members[i].innerHTML.includes(userID)){
                    userData = members[i].innerHTML;
                    member = members[i];
                    doesUserExist = true;
                    break;
                }
            }

            if (doesUserExist) {// User already in the list, update the status
                // switch the status if needed
                if (busy && userData.includes("Available")) {
                    member.innerHTML = userData.replace("Available", "Busy");
                }
                if (!busy && userData.includes("Busy")){
                    member.innerHTML =  userData.replace("Busy", "Available");
                }
            } else { // Add a new user to the list
                // Create a li item
                var li = document.createElement("li");
                li.setAttribute('id', userID);
                li.appendChild(document.createTextNode(userID + ": " + (busy ? "Busy" : "Available")));
                ul.appendChild(li)

                // Subscribe to metadata change event for the user
                await client.subscribeUserMetadata(userID);
            }
        }
        ```

1. **Handle user presence in a channel**

    1. Show the list of users in a channel

        When the local user successfully joins a <Vpd k="PRODUCT" /> channel, you call `channel.getMembers` to obtain a list of users in the channel and add each user to the user list. To do this:

            ```javascript
            const updateChannelMemberList = async function () {
              // Retrieve a list of members in the channel
              console.log(getSignalingChannel());
              const members = await getSignalingChannel().getMembers();
              for (let i = 0; i < members.length; i++) {
                updateMemberInList(members[i], false);
              }
            };
            ```


    1.  Remove a user from the list

        When a remote user leaves the channel, you remove the corresponding `li` item from the user list. To do this:

        1. Add the following method to the `index.js` class:

            ```javascript
            const removeUserFromList = function (userID) {
                var member = ul.getElementById(userID);
                ul.removeChild(member);
            }
            ```



</PlatformWrapper>