<PlatformWrapper platform="react-native">

Best practice is to separate the <Vpd k="NAME" /> workflows from your UI implementation. The <Vpd  k="SDK" />
  sample project implements <Vpd k="PRODUCT" /> logic in the
  [`AgoraManager`](https://github.com/AgoraIO/video-sdk-samples-reactnative/blob/main/src/agora-manager/agoraManager.tsx) hook.
  This hook encapsulates the `RTCEngine` instance and core functionality as illustrated by the excerpts below:

1. **Import the required modules**:

    ``` typescript
    import {
        createAgoraRtcEngine,
        ChannelProfileType,
        ClientRoleType,
        IRtcEngine,
        RtcConnection,
        UserOfflineReasonType
    } from 'react-native-agora';
    ```

1.  **Declare state variables to create an <Vg k="ENGINE" /> instance and join a channel**:

    ``` typescript
    const agoraEngineRef = useRef<IRtcEngine | null>(null);
    const [joined, setJoined] = useState(false);
    const [remoteUids, setRemoteUids] = useState<number[]>([]);
    ```

1. **Request Android permissions**

    ```typescript
    const getPermission = async () => {
    if (Platform.OS === 'android') {
        try {
            const result = await PermissionsAndroid.requestMultiple([
                PermissionsAndroid.PERMISSIONS.RECORD_AUDIO,
                PermissionsAndroid.PERMISSIONS.CAMERA,
            ]);
            const permissionsGranted =
            result['android.permission.RECORD_AUDIO'] === 'granted' &&
            result['android.permission.CAMERA'] === 'granted';
            if (permissionsGranted) {
                console.log('Permissions granted');
                } 
            else {
                console.log('Permissions denied');
                }
            } catch (error) {
                console.error('Permission request error:', error);
            }
        }
    };
    ```


1.  **Configure an <Vg k="ENGINE" /> instance and configure event handlers**:

    ``` typescript
    const setupAgoraEngine = async () => {
        try {
            await getPermission();
            agoraEngineRef.current = createAgoraRtcEngine();
            agoraEngineRef.current.registerEventHandler({
                onJoinChannelSuccess: onJoinChannelSuccess,
                onUserJoined: onUserJoined,
                onUserOffline: onUserOffline,
            });
            const channelProfile =
            config.product !== "ILS"
                ? ChannelProfileType.ChannelProfileLiveBroadcasting
                : ChannelProfileType.ChannelProfileCommunication;

            agoraEngineRef.current.initialize({
            appId: config.appId,
            channelProfile: channelProfile,
        });
        agoraEngineRef.current.enableVideo();
        console.log('Engine initialized');
        } 
        catch (e) {
            console.error('Error initializing engine:', e);
        }
    };
    ```

1.  **Respond to  <Vg k="ENGINE" /> events**:

    ``` typescript
    const onJoinChannelSuccess = () => {
        showMessage('Successfully joined the channel ' + config.channelName);
        };
    const onUserJoined = (connection: RtcConnection, remoteUid: number, elapsed: number) => {
        showMessage('Remote user joined with uid ' + remoteUid);
        if (!remoteUids.includes(remoteUid)) {
            setRemoteUids([...remoteUids, remoteUid]);
        }
    };
    const onUserOffline = (connection: RtcConnection, remoteUid: number, reason: UserOfflineReasonType) => {
        showMessage('Remote user left the channel. uid: ' + remoteUid + ' , Reason:' + reason);
        setRemoteUids(remoteUids.filter((uid) => uid !== remoteUid));
    };
    ```

1.  **Join a channel to start <Vpd k="PRODUCT" />**:

    ``` typescript
    const joinCall = async () => {
        if (agoraEngineRef.current === null) {
            await setupAgoraEngine();
        }
        try 
        {
            agoraEngineRef.current?.startPreview();
            agoraEngineRef.current?.joinChannel(
                config.rtcToken,
                config.channelName,
                config.uid,
                {
                    clientRoleType: ClientRoleType.ClientRoleBroadcaster,
                });
            setJoined(true);
        } catch (e) {
            console.error('Failed to join the call:', e);
        }
    };
    ```

1.  **Leave the channel when the local user ends the call**:

    ``` typescript
    const leaveCall = async () => {
        try {
            await agoraEngineRef.current?.leaveChannel();
            agoraEngineRef.current?.release();
            agoraEngineRef.current = null;
            setRemoteUids([]);
            setJoined(false);
            console.log('You left the channel');
        } catch (error) {
            console.error('Failed to leave channel:', error);
        }
    };
    ```

1.  **Clean up the resources used by the app**:

    ``` typescript
    useEffect(() => {
        return () => {
            if (agoraEngineRef.current) {
                try {
                    agoraEngineRef.current.release();
                    console.log('Engine destroyed');
                } 
                catch (error) {
                    console.error('Error releasing resources:', error);
                }
            }
        };
    }, []);
    ```
<ProductWrapper product="{['interactive-live-streaming', 'broadcast-streaming']}">
1. **Set the use role**

   ``` typescript
    const setUserRole = async (role: string) => {
        if (agoraEngineRef.current) {
            const clientRole =
                role === "Host"
                    ? ClientRoleType.ClientRoleBroadcaster
                    : ClientRoleType.ClientRoleAudience;
            agoraEngineRef.current.setClientRole(clientRole);
        }
    };
</ProductWrapper>

</PlatformWrapper>