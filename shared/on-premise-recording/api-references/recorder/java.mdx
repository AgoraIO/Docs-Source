## AgoraMediaRtcRecorder class

Used to record Agora RTC media streams.  
Supports recording audio and video streams in a channel, and provides features such as stream mixing, encryption, and selective subscription.

| API | Description |
|---|---|
|[`AgoraMediaRtcRecorder`](#agoramediartcrecorder) | Constructs an [`AgoraMediaRtcRecorder`](#agoramediartcrecorder) recorder instance. |
|[`initialize[1/2]`](#initialize12) | Initializes the recorder instance with service, whether to enable mixed mode, and whether to record encoded video only. |
|[`initialize[2/2]`](#initialize22) | Initializes the recorder and sets the service instance and whether to enable mixed mode. |
|[`joinChannel`](#joinchannel) | Joins an Agora RTC channel. |
|[`leaveChannel`](#leavechannel) | Leaves the current channel. |
|[`enableEncryption`](#enableencryption) | Enables or disables built-in encryption. |
|[`subscribeAllAudio`](#subscribeallaudio) | Subscribes to the audio streams of all remote users in the channel. |
|[`subscribeAllVideo`](#subscribeallvideo) | Subscribes to the video streams of all remote users in the channel. |
|[`unsubscribeAllAudio`](#unsubscribeallaudio) | Stops subscribing to all remote users' audio streams. |
|[`unsubscribeAllVideo`](#unsubscribeallvideo) | Stops subscribing to all remote users' video streams. |
|[`subscribeAudio`](#subscribeaudio) | Subscribes to the audio stream of a specified remote user. |
|[`unsubscribeAudio`](#unsubscribeaudio) | Stops subscribing to the audio stream of a specified remote user. |
|[`subscribeVideo`](#subscribevideo) | Subscribes to the video stream of a specified remote user. |
|[`unsubscribeVideo`](#unsubscribevideo) | Stops subscribing to the video stream of a specified remote user. |
|[`setAudioVolumeIndicationParameters`](#setaudiovolumeindicationparameters) | Sets the interval for the [`onAudioVolumeIndication`](#onaudiovolumeindication) callback. |
|[`setVideoMixingLayout`](#setvideomixinglayout) | Sets the video mixing layout. |
|[`setRecorderConfig`](#setrecorderconfig) | Configures the recorder instance settings. |
|[`setRecorderConfigByUid`](#setrecorderconfigbyuid) | Sets the recorder configuration for a specified user. |
|[`startRecording`](#startrecording) | Starts the recording process. |
|[`stopRecording`](#stoprecording) | Stops all ongoing recordings and saves the recorded files. |
|[`startSingleRecordingByUid`](#startsinglerecordingbyuid) | Starts recording for the specified user. |
|[`stopSingleRecordingByUid`](#stopsinglerecordingbyuid) | Stops recording for the specified user. |
|[`registerRecorderEventHandler`](#registerrecordereventhandler) | Registers the event handler for recording events. |
|[`unregisterRecorderEventHandler`](#unregisterrecordereventhandler) | Unregisters the previously registered event handler. |
|[`enableAndUpdateVideoWatermarks`](#enableandupdatevideowatermarks) | Adds watermarks to the video stream. |
|[`disableVideoWatermarks`](#disablevideowatermarks) | Disables watermarks in the video stream. |
|[`enableAndUpdateVideoWatermarksByUid`](#enableandupdatevideowatermarksbyuid) | Adds watermarks to the video stream of a specified user. |
|[`disableVideoWatermarksByUid`](#disablevideowatermarksbyuid) | Disables watermarks on the video stream of the specified user by user ID. |
|[`renewToken`](#renewtoken) | Renews the Token for the current session. |
|[`enableRecorderVideoFrameCapture`](#enablerecordervideoframecapture) | Enables or disables video frame capture for the recorder instance. |
|[`release`](#release) | Releases the native resources associated with the `Recorder` instance. |

### AgoraMediaRtcRecorder

```java
public AgoraMediaRtcRecorder(long handle)
```

Constructs an [`AgoraMediaRtcRecorder`](#agoramediartcrecorder) recorder instance.

| Parameter | Data type | Description |
|-----------|-----------|-------------|
| `handle` | `long` | The native handle of the recorder instance. |



### initialize\[1/2\]

```java
public int initialize(AgoraService service, boolean enableMix, boolean recordEncodedOnly)
```

Initializes the recorder instance, sets the service, whether to enable mixed mode, and whether to record encoded video only.

| Parameter | Data type | Description |
|-----------|-----------|-------------|
| `service` | `AgoraService` | The Agora service instance. You must initialize it before calling this method. See [`AgoraService`](#agoraservice). |
| `enableMix` | `boolean` | Whether to enable mixed mode:<br/>- `true`: Enable mixed mode.<br/>- `false`: Disable mixed mode. |
| `recordEncodedOnly` | `boolean` | Whether to record encoded video only (only effective when `enableMix` is `false`):<br/>- `true`: Do not decode received video. Write H.264 or H.265 bitstream directly to the container (watermark not supported).<br/>- `false`: Decode video to YUV and re-encode to H.264 before writing to the container (watermark supported). |

**Return value**

- `0`: The method call succeeds.  
- `< 0`: The method call fails.



### initialize\[2/2\]

```java
public int initialize(AgoraService service, boolean enableMix)
```

Initializes the recorder and sets the service instance and whether to enable mixed mode.

| Parameter | Data type | Description |
|-----------|-----------|-------------|
| `service` | `AgoraService` | The Agora service instance. You must initialize it before calling this method. See [`AgoraService`](#agoraservice). |
| `enableMix` | `boolean` | Whether to enable mixed mode during recording:<br/>- `true`: Enable mixed mode.<br/>- `false`: Disable mixed mode. |

**Return value**

- `0`: The method call succeeds.  
- `< 0`: The method call fails.

### joinChannel

```java
public int joinChannel(String token, String channelName, String userId)
```

Joins an Agora RTC channel.

| Parameter | Data type | Description |
|-----------|-----------|-------------|
| `token` | `String` | The Token used for authentication. |
| `channelName` | `String` | Name of the channel to join. The channel name must not exceed 64 bytes and supports the following characters:<br/>- Lowercase letters (a-z)<br/>- Uppercase letters (A-Z)<br/>- Numbers (0-9)<br/>- Space<br/>- Special characters: `!`, `#`, `$`, `%`, `&`, `(`, `)`, `+`, `-`, `:`, `;`, `<`, `=`, `.`, `>`, `?`, `@`, `[`, `]`, `^`, `_`, `{`, `}`, `\|`, `~`, `,` |
| `userId` | `String` | The local user ID. If `null` is passed, the system automatically assigns a user ID. |

**Return value**

- `0`: The method call succeeds.  
- `< 0`: The method call fails.



### leaveChannel

```java
public int leaveChannel()
```

Leaves the current channel.

**Return value**

- `0`: The method call succeeds.  
- `< 0`: The method call fails.



### enableEncryption

```java
public int enableEncryption(boolean enabled, EncryptionConfig config)
```

Enables or disables built-in encryption.

For high-security scenarios, call this method before joining the channel.  
All users in the same channel must use the same encryption mode and key. The encryption key is automatically cleared when all users leave the channel.

| Parameter | Data type | Description |
|-----------|-----------|-------------|
| `enabled` | `boolean` | Whether to enable built-in encryption:<br/>- `true`: Enable encryption.<br/>- `false` (default): Disable encryption. |
| `config` | `EncryptionConfig` | Encryption configuration. See [`EncryptionConfig`](#encryptionconfig). |

**Return value**

- `0`: The method call succeeds.  
- `< 0`: The method call fails.



### subscribeAllAudio

```java
public int subscribeAllAudio()
```

Subscribes to the audio streams of all remote users in the channel.  
This method automatically subscribes to the audio streams of new users who join the channel later.

**Return value**

- `0`: The method call succeeds.  
- `< 0`: The method call fails.



### subscribeAllVideo

```java
public int subscribeAllVideo(VideoSubscriptionOptions options)
```

Subscribes to the video streams of all remote users in the channel.  
This method automatically subscribes to the video streams of any new users who join the channel.

| Parameter | Data type | Description |
|-----------|-----------|-------------|
| `options` | `VideoSubscriptionOptions` | Video subscription options. See [`VideoSubscriptionOptions`](#videosubscriptionoptions). |

**Return value**

- `0`: The method call succeeds.  
- `< 0`: The method call fails.

### unsubscribeAllAudio

```java
public int unsubscribeAllAudio()
```

Stops subscribing to the audio streams of all remote users.

This method also stops subscribing to newly joined users’ audio unless you explicitly call [`subscribeAudio`](#subscribeaudio) or [`subscribeAllAudio`](#subscribeallaudio).

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.



### unsubscribeAllVideo

```java
public int unsubscribeAllVideo()
```

Stops subscribing to the video streams of all remote users.

Unless you explicitly call [`subscribeVideo`](#subscribevideo) or [`subscribeAllVideo`](#subscribeallvideo), this method also stops subscribing to the video streams of users who join later.

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.



### subscribeAudio

```java
public int subscribeAudio(String userId)
```

Subscribes to the audio stream of a specified remote user.

#### Parameters

| Parameter | Data type | Description |
|-----------|-----------|-------------|
| `userId`  | `String`  | User ID of the remote user whose audio you want to subscribe to. |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.  
  - -2: `userId` is invalid.



### unsubscribeAudio

```java
public int unsubscribeAudio(String userId)
```

Stops subscribing to the audio stream of a specified remote user.

#### Parameters

| Parameter | Data type | Description |
|-----------|-----------|-------------|
| `userId`  | `String`  | User ID of the remote user whose audio you want to unsubscribe from. |

#### Return value

- 0: The method call succeeds.  
- -2: `userId` is invalid.  
- < 0: The method call fails.



### subscribeVideo

```java
public int subscribeVideo(String userId, VideoSubscriptionOptions options)
```

Subscribes to the video stream of a specified remote user.

#### Parameters

| Parameter | Data type                  | Description |
|-----------|----------------------------|-------------|
| `userId`  | `String`                   | User ID of the remote user whose video you want to subscribe to. |
| `options` | `VideoSubscriptionOptions` | Video subscription options. See [`VideoSubscriptionOptions`](#videosubscriptionoptions). |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.  
  - -2: `userId` is invalid.



### unsubscribeVideo

```java
public int unsubscribeVideo(String userId)
```

Stops subscribing to the video stream of a specified remote user.

#### Parameters

| Parameter | Data type | Description |
|-----------|-----------|-------------|
| `userId`  | `String`  | User ID of the remote user whose video you want to unsubscribe from. |

#### Return value

- 0: The method call succeeds.  
- -2: `userId` is invalid.  
- < 0: The method call fails.

### setAudioVolumeIndicationParameters

```java
public int setAudioVolumeIndicationParameters(int intervalInMs)
```

Sets the interval for the [`onAudioVolumeIndication`](#onaudiovolumeindication) callback.

#### Parameters

| Parameter      | Data type | Description |
|----------------|-----------|-------------|
| `intervalInMs` | `int`     | Time interval between two volume indication callbacks, in milliseconds. Default is 500 ms.<br/>- ≤ 10: Disables volume indication.<br/>- > 10: Sets the interval in milliseconds. |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.



### setVideoMixingLayout

```java
public int setVideoMixingLayout(VideoMixingLayout layout)
```

Sets the video mixing layout.

Use this method to configure the position and size of different video streams in the mixed output.

#### Parameters

| Parameter | Data type           | Description |
|-----------|---------------------|-------------|
| `layout`  | `VideoMixingLayout` | Configuration for the video mixing layout. See [`VideoMixingLayout`](#videomixinglayout). |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.



### setRecorderConfig

```java
public int setRecorderConfig(MediaRecorderConfiguration config)
```

Configures the recorder instance settings.

You must call this method before starting the recording.

#### Parameters

| Parameter | Data type                  | Description |
|-----------|----------------------------|-------------|
| `config`  | `MediaRecorderConfiguration` | Configuration parameters for the recorder. See [`MediaRecorderConfiguration`](#mediarecorderconfiguration). |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.



### setRecorderConfigByUid

```java
public int setRecorderConfigByUid(MediaRecorderConfiguration config, String userId)
```

Sets the recorder configuration for a specified user.

#### Parameters

| Parameter | Data type                  | Description |
|-----------|----------------------------|-------------|
| `config`  | `MediaRecorderConfiguration` | Configuration parameters for the recorder instance. See [`MediaRecorderConfiguration`](#mediarecorderconfiguration). |
| `userId`  | `String`                   | User ID of the user whose recording configuration you want to set. |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.

### startRecording

```java
public int startRecording()
```

Starts the recording process.

Before calling this method, make sure to configure the recorder instance using [`setRecorderConfig`](#setrecorderconfig).

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.



### stopRecording

```java
public int stopRecording()
```

Stops all ongoing recordings and saves the recorded files.

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.



### startSingleRecordingByUid

```java
public int startSingleRecordingByUid(String userId)
```

Starts recording for the specified user.

#### Parameters

| Parameter | Data type | Description |
|-----------|-----------|-------------|
| `userId`  | `String`  | User ID of the user to start recording. |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.



### stopSingleRecordingByUid

```java
public int stopSingleRecordingByUid(String userId)
```

Stops recording for the specified user.

#### Parameters

| Parameter | Data type | Description |
|-----------|-----------|-------------|
| `userId`  | `String`  | User ID of the user to stop recording. |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.



### registerRecorderEventHandler

```java
public int registerRecorderEventHandler(IAgoraMediaRtcRecorderEventHandler handler)
```

Registers the event handler for recording events.

Use this method to register an event handler to receive recording-related callbacks such as state changes, errors, and progress updates.

#### Parameters

| Parameter | Data type                          | Description |
|-----------|------------------------------------|-------------|
| `handler` | `IAgoraMediaRtcRecorderEventHandler` | The event handler. See [`IAgoraMediaRtcRecorderEventHandler`](#iagoramediartcrecordereventhandler). |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.


### unregisterRecorderEventHandler

```java
public int unregisterRecorderEventHandler(IAgoraMediaRtcRecorderEventHandler handler)
```

Unregisters the previously registered event handler.

#### Parameters

| Parameter | Data type                          | Description |
|-----------|------------------------------------|-------------|
| `handler` | `IAgoraMediaRtcRecorderEventHandler` | The event handler to unregister. See [`IAgoraMediaRtcRecorderEventHandler`](#iagoramediartcrecordereventhandler). |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.



### enableAndUpdateVideoWatermarks

```java
public int enableAndUpdateVideoWatermarks(WatermarkConfig[] watermarkConfigs)
```

Adds watermarks to the video stream.

#### Parameters

| Parameter         | Data type           | Description |
|-------------------|---------------------|-------------|
| `watermarkConfigs` | `WatermarkConfig[]` | Watermark configuration. See [`WatermarkConfig`](#watermarkconfig). |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.

### disableVideoWatermarks

```java
public int disableVideoWatermarks()
```

Disables watermarks in the video stream.

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.



### enableAndUpdateVideoWatermarksByUid

```java
public int enableAndUpdateVideoWatermarksByUid(WatermarkConfig[] watermarkConfigs, String userId)
```

Adds watermarks to the video stream of a specified user.

#### Parameters

| Parameter         | Data type         | Description |
|-------------------|------------------|-------------|
| `watermarkConfigs` | `WatermarkConfig[]` | Watermark configuration. See [`WatermarkConfig`](#watermarkconfig). |
| `userId`          | `String`         | User ID of the video stream to which you want to add watermarks. |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.



### disableVideoWatermarksByUid

```java
public int disableVideoWatermarksByUid(String userId)
```

Disables watermarks on the video stream of the specified user by user ID.

#### Parameters

| Parameter | Data type | Description |
|-----------|-----------|-------------|
| `userId`  | `String`  | User ID of the video stream whose watermark you want to disable. |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.



### renewToken

```java
public int renewToken(String token)
```

Renews the Token for the current session.

When the [`onError`](#onerror) callback reports `ERR_TOKEN_EXPIRED (109)`, or the [`onTokenPrivilegeWillExpire`](#ontokenprivilegewillexpire) or [`onTokenPrivilegeDidExpire`](#ontokenprivilegedidexpire) callback is triggered, you must regenerate a new Token on your server and call [`renewToken`](#renewtoken) to update it. Otherwise, the SDK will disconnect from the Agora channel.

#### Parameters

| Parameter | Data type | Description |
|-----------|-----------|-------------|
| `token`   | `String`  | The new Token generated by your server. |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.



### enableRecorderVideoFrameCapture

```java
public int enableRecorderVideoFrameCapture(boolean enable, RecorderVideoFrameCaptureConfig config)
```

Enables or disables video frame capture for the recorder instance.

When enabled, video frames are delivered to the observer based on the configured [`VideoFrameCaptureType`](#videoframecapturetype), such as:
- `VIDEO_FORMAT_ENCODED_FRAME_TYPE`
- `VIDEO_FORMAT_YUV_FRAME_TYPE`
- `VIDEO_FORMAT_JPG_FRAME_TYPE`
- `VIDEO_FORMAT_JPG_FILE_TYPE`

When using `VIDEO_FORMAT_JPG_FILE_TYPE`, you must set both `jpgFileStorePath` and `jpgCaptureIntervalInSec` in [`RecorderVideoFrameCaptureConfig`](#recordervideoframecaptureconfig).

#### Parameters

| Parameter | Data type                        | Description |
|-----------|----------------------------------|-------------|
| `enable`  | `boolean`                        | Whether to enable video frame capture:<br/>- `true`: Enable.<br/>- `false`: Disable. |
| `config`  | `RecorderVideoFrameCaptureConfig` | Configuration for video frame capture. See [`RecorderVideoFrameCaptureConfig`](#recordervideoframecaptureconfig). |

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.

### release

```java
public int release()
```

Releases the native resources associated with the `Recorder` instance.

#### Return value

- 0: The method call succeeds.  
- < 0: The method call fails.
