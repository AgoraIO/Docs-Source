<PlatformWrapper platform="flutter">

1. **Enable the extension**

    After creating and initializing Agora engine, you call `enableExtension` to enable the <Vg k="RTEE_FU" /> extension. For Android, you need to load the extension before enabling it. TO do this, add the following code to `setupVideoSDKEngine` after `await agoraEngine.initialize(...)`:

    ```dart
    if (Platform.isAndroid) {
        await agoraEngine.loadExtensionProvider(path: 'AgoraFaceUnityExtension');
    }

    await agoraEngine.enableExtension(
        provider: "FaceUnity", extension: "Effect", enable: true);
    ```

1. **Handle the Agora engine extension callbacks**

    The `RtcEngineEventHandler` fires callbacks when an extension is successfully started or fails to start. After receiving the `onExtensionStarted` callback you initialize the extension. To handle the Agora engine callbacks, add the following code after `agoraEngine.registerEventHandler( RtcEngineEventHandler(`:

    ```dart
    onExtensionStarted: (provider, extension) {
        debugPrint(
            '[onExtensionStarted] provider: $provider, extension: $extension');
        if (provider == 'FaceUnity' && extension == 'Effect') {
            initializeFaceUnityExt();
        }
    },
    onExtensionError: (provider, extension, error, message) {
        debugPrint(
            '[onExtensionError] provider: $provider, '
                'extension: $extension, error: $error, message: $message');
    },
    ```

1. **Initialize the extension**

    To initialize and configure the extension, you call `setExtensionProperty` and pass in the corresponding `key` and `value` pairs. The specific call order is as follows:

    1. To initialize the extension and authenticate the user, use the `key` `fuSetup`. The `value` contains the `authdata`	JSON parameter with the path to the certificate file.

    2. To preload AI capabilities, use the key `fuLoadAIModelFromPackage`. The value contains the `data` and `type` JSON parameters with the path of the AI capability model file `ai_xxx.bundle`, and the AI capability type.

    ```dart
    // Initialize the extension and authenticate the user
    await agoraEngine.setExtensionProperty(
        provider: 'FaceUnity',
        extension: 'Effect',
        key: 'fuSetup',
        value: jsonEncode({'authdata': authpack.gAuthPackage}));

    // Load the AI model
    final aiFaceProcessorPath =
      await _copyAsset('Resource/model/ai_face_processor.bundle');

    await agoraEngine.setExtensionProperty(
        provider: 'FaceUnity',
        extension: 'Effect',
        key: 'fuLoadAIModelFromPackage',
        value: jsonEncode({'data': aiFaceProcessorPath, 'type': 1 << 10}));
    ```

1. **Set the beauty effect and human body recognition**

    Call setExtensionPropertyand pass in the corresponding key and value to achieve the following functions:

    * Load props, adjust beauty intensity
    * Face, Gesture and Human Recognition

    You can make combined calls according to the needs of the scene. For the corresponding key and value, see the interface description for details .

    An example of setting the cat ears effect is as follows:

    ```dart
    Future<void> _setupCatSparksEffect() async {
    final aiFaceProcessorPath =
        await _copyAsset('Resource/model/ai_face_processor.bundle');
    await agoraEngine.setExtensionProperty(
        provider: 'FaceUnity',
        extension: 'Effect',
        key: 'fuLoadAIModelFromPackage',
        value: jsonEncode({'data': aiFaceProcessorPath, 'type': 1 << 10}));

    final catSparksPath =
        await _copyAsset('Resource/items/ItemSticker/CatSparks.bundle');
    await agoraEngine.setExtensionProperty(
        provider: 'FaceUnity',
        extension: 'Effect',
        key: 'fuCreateItemFromPackage',
        value: jsonEncode({'data': catSparksPath}));
    }
    ```

1. **Release resources**

    When you need to stop using an extension, follow the steps below to release resources:

    1. Call `setExtensionProperty`, pass in the key to `fuDestroyLibData` release the resources occupied by the extension.
    1. After receiving the `fuDestroyLibData` callback , call the `destroy` method to `destroy` the `RtcEngine` object.


</PlatformWrapper>