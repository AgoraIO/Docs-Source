<PlatformWrapper platform="flutter">

You can use extended fields to implement customized push settings, collapse the notification bar, force push, and send silent messages.

## Set custom push fields

When creating a push message, you can add custom fields to the message to meet personalized business needs:

```dart
// This example takes text messages as an example. The setting methods for message types such as pictures and files are the same.
ChatMessage msg = ChatMessage.createTxtSendMessage(
  targetId: 'receiveId',
  content: 'content',
);
msg.attributes = {
  // Set the push extension to the message.
  "em_push_ext": {
        "custom": {
            "key1": "value1",
            "key2": "value2"
        }
    }
};
try {
  await ChatClient.getInstance.chatManager.sendMessage(msg);
} on ChatError catch (e) {}
```

The data structure of the custom field is as follows:

```json
{
    "em_push_ext": {
        "custom": {
            "key1": "value1",
            "key2": "value2"
        }
    }
}
```

| Parameters              | Description                |
| :--------------- | :----------------- |
|  `em_push_ext`   | The extension fixed value, cannot be modified.     |
|  `custom`          | The message extension. Use the extension method to add custom fields to the push, the value is fixed. |
|  `key1`/`key2`     | Customize the specific content of the message push extension. |

## Set certain group members to receive push notifications

In offline push is in the DND mode and you want only certain group members to receive offline push notifications in a group, you can achieve this by setting the message extension field:

```dart
// This example takes text messages as an example. The setting methods for message types such as pictures and files are the same.
ChatMessage msg = ChatMessage.createTxtSendMessage(
  targetId: 'groupId',
  content: 'content',
);
msg.chatType = ChatType.GroupChat;
// When pushing to all members in the group, set to `All`.
msg.attributes = {
  'em_apns_ext': {
    "em_at_list": 'All',
  }
};
// Push to specified group members and set as member list.
msg.attributes = {
  'em_apns_ext': {
    "em_at_list": ['userId1', 'userId2'],
  }
};
try {
  await ChatClient.getInstance.chatManager.sendMessage(msg);
} on ChatError catch (e) {}
```

The data structure of this extension field is as follows:

```json
{
    "em_apns_ext": {
        "em_at_list": "All"
    }
}

{
    "em_apns_ext": {
        "em_at_list": ["userId1", "userId2"]
    }
}
```

| Parameters              | Description                |
| :--------------- | :----------------- |
|  `em_apns_ext` |     Built -in push extension fields. |
|  `em_at_list` |  Custom key added by the user. `value` is an array indicating the user ID of the group member who receives the push notification. Set it to `All` to push notifications to all group members. |

## Set the notification bar to collapse

You can collapse multiple messages in the notification bar. The sample code is as follows:

```dart
// This example takes text messages as an example. The setting methods for message types such as pictures and files are the same.
ChatMessage msg = ChatMessage.createTxtSendMessage(
  targetId: 'receiveId',
  content: 'content',
);
msg.attributes = {
  'em_apns_ext': {
    "em_push_collapse_key": 'collapseKey',
  }
};
try {
  await ChatClient.getInstance.chatManager.sendMessage(msg);
} on ChatError catch (e) {}
```

The data structure of the notification bar collapse field is as follows:

```json
{
    "em_apns_ext": {
        "em_push_collapse_key": "collapseKey"
    }
}
```

| Parameters              | Description                |
| :--------------- | :----------------- |
|  `em_apns_ext` |     The built-in push extension fields. |
|  `em_push_collapse_key`    | Specifies a set of messages that can be collapsed, so that only the last message is sent when delivery is resumed, thus preventing sending too many identical messages when the device comes back online or becomes active.    |

## Force push

The user can set forced push to ignore the recipient's DND setting when sending messages:

```dart
// This example takes text messages as an example. The setting methods for message types such as pictures and files are the same.
ChatMessage msg = ChatMessage.createTxtSendMessage(
  targetId: 'receiveId',
  content: 'content',
);
msg.attributes = {
  'em_force_notification': true,
};
try {
  await ChatClient.getInstance.chatManager.sendMessage(msg);
} on ChatError catch (e) {}
```

## Send a silent message

Sending silent messages means that the sender sets the message not to be pushed when sending it. That is, when the user is offline, Chat will not push message notifications to the user's device through the FCM push service. When the user is online again, they will receive all the messages received during the offline period.

Both silent message sending and do not disturb mode pause push messages. The difference is that silent message sending is set by the sender when sending the message, while the DND mode is set by the receiver.

```dart
// This example takes text messages as an example. The setting methods for message types such as pictures and files are the same.
ChatMessage msg = ChatMessage.createTxtSendMessage(
  targetId: 'receiveId',
  content: 'content',
);
msg.attributes = {
  'em_ignore_notification': true,
};
try {
  await ChatClient.getInstance.chatManager.sendMessage(msg);
} on ChatError catch (e) {}
```

</PlatformWrapper>