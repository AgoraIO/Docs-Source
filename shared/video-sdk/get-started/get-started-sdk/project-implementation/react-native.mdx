<PlatformWrapper platform="react-native">

### Handle the system logic

When your app launches, ensure that the system libraries and permissions classes necessary to insert <Vpd k="NAME"/> feature into the app are loaded and the necessary permissions are granted.

1. **Import system and <Vg k="VSDK" /> classes**

    In `App.tsx`, replace the contents of the file with the following

    ```typescript
    import React, {useRef, useState, useEffect} from 'react';
    import {SafeAreaView, ScrollView, StyleSheet, Text, View} from 'react-native';
    import {PermissionsAndroid, Platform, ToastAndroid} from 'react-native';
    import {
    ClientRoleType,
    createAgoraRtcEngine,
    IRtcEngine,
    RtcSurfaceView,
    } from 'react-native-agora-rtc-ng';
    ```

1. **Set up the app framework**

    To set up the React Native app framework, you do the following:

    * Declare the connection variables including the `appId`, `channelName`, and `token`.
    * Add a method to display information to the user.
    * Define styles to apply to the UI elements.

    To create this framework, paste the following code in /lib/main.dart after the import statement

    ```typescript
    const appId = '<--Insert app ID here-->';
    const channelName = '<--Insert channel name here-->';
    const token = '<--Insert authentication token here-->';
    const uid = 0;

    function showMessage(msg: string) {
        if (Platform.OS === 'android') {
            ToastAndroid.show(msg, ToastAndroid.SHORT);
        } else {
            console.log(msg);
        }
    }

    const App = () => {
        const agoraEngineRef = useRef<IRtcEngine>();
        const [users, setUsers] = useState<number[]>([]);
        const [joined, setJoined] = useState(false);
   
    };

    const styles = StyleSheet.create({
    button: {
        paddingHorizontal: 25,
        paddingVertical: 4,
        fontWeight: 'bold',
        color: '#ffffff',
        backgroundColor: '#0055cc',
        margin: 5,
    },
    main: {flex: 1, alignItems: 'center'},
    scroll: {flex: 1, backgroundColor: '#ddeeff', width: '100%'},
    scrollContainer: {alignItems: 'center'},
    videoView: {width: '90%', height: 200},
    btnContainer: {flexDirection: 'row', justifyContent: 'center'},
    head: {fontSize: 20},
    });

    export default App;
    ```

1. **Add project permissions**

    Depending on your target platform, take the necessary step to add camera and microphone permissions.
    
     * *Android*

        Add the following code to the `App.tsx` file before `export default App;` to set a permissions prompt to use the microphone and camera on an Android device:

        ```typescript
        const getPermission = async () => {
            if (Platform.OS === 'android') {
                await PermissionsAndroid.requestMultiple([
                    PermissionsAndroid.PERMISSIONS.RECORD_AUDIO,
                    PermissionsAndroid.PERMISSIONS.CAMERA,
                ]);
            }
        };
        ```
     * *iOS*

        Open **Info** in the project navigation panel, then add the following properties to the [Information Property List](https://help.apple.com/xcode/mac/current/#/dev3f399a2a6):

        | Key                          | Type   | Value                  |
        |------------------------------|--------|------------------------|
        | NSMicrophoneUsageDescription | String | Access the microphone. |
        | NSCameraUsageDescription     | String | Access the camera.     |

### Implement the user interface

Add the following elements for <Vpd k="NAME"/> in the layout file of your project:

- A **Join** button
- A **Leave** button
- `RtcSurfaceView` elements for local and remote users

To return these UI elements, add the following code to the `const App` block in `App.tsx`:

```typescript
return (
<SafeAreaView style={styles.main}>
    <Text style={styles.head}>Get Started with Video Calling</Text>
    <View style={styles.btnContainer}>
    <Text onPress={join} style={styles.button}>
        Join
    </Text>
    <Text onPress={leave} style={styles.button}>
        Leave
    </Text>
    </View>
    <ScrollView
    style={styles.scroll}
    contentContainerStyle={styles.scrollContainer}>
    {joined &&
        users.map(user => (
        <React.Fragment key={user}>
            <RtcSurfaceView canvas={{uid: user}} style={styles.videoView} />
            <Text>{user}</Text>
        </React.Fragment>
        ))}
    </ScrollView>
</SafeAreaView>
);
```

### Implement the <Vpd k="NAME"/> logic

When a user opens this <Vpl k="CLIENT" />, you initialize the <Vg k="ENGINE" />. When the user taps a button, the <Vpl k="CLIENT" /> joins or leaves a channel.

The following figure shows the <Vpd k="SDK" /> call sequence of implementing   <Vpd k="PRODUCT" />.

<ProductWrapper product="video-calling">
![video call logic ios](/images/video-sdk/video-call-logic-ios.svg)
</ProductWrapper>
  <ProductWrapper product="interactive-live-streaming">
![ils call logic ios](/images/video-sdk/ils-call-logic-ios.svg)
</ProductWrapper>

To implement this logic, take the following steps:

1. **Check user permissions and instantiate Agora Engine**

    To set up an instance of <Vg k="ENGINE" />, you do the following:

    * Check camera and microphone permissions
    * Create an `IRtcEngine` instance with a call to `createAgoraRtcEngine`()
    * Initialize <Vg k="ENGINE" /> with the `appID`
    * Enable the video module
    * Register an event handler to receive <Vg k="ENGINE" /> callbacks

    In `App.tsx`, add the following code to the `const App` block:

    <ProductWrapper product="video-calling">
    ```typescript
    useEffect(() => {
        // Initialize Agora engine when the app starts
        setupVideoSDKEngine();
    }, []);

    const setupVideoSDKEngine = async () => {
        try {
            await getPermission(); // use helper function to get permissions on Android
            agoraEngineRef.current = createAgoraRtcEngine();
            const agoraEngine = agoraEngineRef.current;
            agoraEngine.registerEventHandler({
                onJoinChannelSuccess: () => {
                showMessage('Successfully joined the channel ' + channelName);
                setUsers(p => [...p, 0]);
                setJoined(true);
                },
                onUserJoined: (_connection, remoteUid) => {
                showMessage('Remote user joined with uid ' + remoteUid);
                setUsers(p => [...p, remoteUid]);
                },
                onUserOffline: (_connection, remoteUid) => {
                showMessage('Remote user left the channel. uid: ' + remoteUid);
                setUsers(p => p.filter(u => u !== remoteUid));
                },
            });
            agoraEngine.initialize({
                appId: appId,
            });
            agoraEngine.enableVideo();
        } catch (e) {
            console.log(e);
        }
    };
    ```
    </ProductWrapper>

    <ProductWrapper product="interactive-live-streaming">
    ```typescript
        // Add ILS Code
    ```
    </ProductWrapper>

1. **Join a channel to start Video Calling**

    When a local user presses **Join**, you call join(). This method securely connects the local user to a channel using the authentication token. It sets the client role and channel profile, and starts the local preview. In `App.tsx`, add the following code to the `const App` block:

    ```typescript
    const join = async () => {
        try {
            agoraEngineRef.current?.startPreview();
            agoraEngineRef.current?.joinChannelWithOptions(token, channelName, uid, {
            clientRoleType: ClientRoleType.ClientRoleBroadcaster,
            });
        } catch (e) {
            console.log(e);
        }
    };
    ```

1. **Leave the channel**

    Call `leaveChannel` to leave the current channel according to your scenario. For example, when the <Vpd k="NAME"/> ends, when you need to close the app, or when your app runs in the background.

    Add the following code to replace `// Next steps` line in `App.tsx`:

    ```typescript
    const leave = () => {
        try {
        setUsers([]);
        engineRef.current?.leaveChannel();
        engineRef.current?.unregisterEventHandler({
            onJoinChannelSuccess: () => {},
            onUserJoined: () => {},
            onUserOffline: () => {},
        });
        engineRef.current?.release();
        } catch (e) {
        console.log(e);
        }
    };
    ```

1. **Render UI elements**

    Add the following code after `const leave = () => {` code block in `App.tsx`:

    ```typescript
    return (
        <SafeAreaView style={styles.main}>
        <Text style={styles.head}>Agora NG SDK Demo</Text>
        <View style={styles.btnContainer}>
            <Text onPress={join} style={styles.button}>
            Join
            </Text>
            <Text onPress={leave} style={styles.button}>
            Leave
            </Text>
        </View>
        <ScrollView
            style={styles.scroll}
            contentContainerStyle={styles.scrollContainer}>
            {joined &&
            users.map(user => (
                <React.Fragment key={user}>
                <RtcSurfaceView canvas={{uid: user}} style={styles.videoView} />
                <Text>{user}</Text>
                </React.Fragment>
            ))}
        </ScrollView>
        </SafeAreaView>
    );
    ```
</PlatformWrapper>