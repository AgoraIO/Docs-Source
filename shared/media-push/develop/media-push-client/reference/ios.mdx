<PlatformWrapper platform="ios">

<a name="older-v"></a>
### Implementation of earlier versions

This section describes how to implement Media Push using versions of the SDK earlier than v3.6.0.

1. Refer to [Start Interactive Live Video Streaming](start_live_android) or [Start Interactive Live Audio Streaming](start_live_audio_android) to implement the basic audio and video interaction.

2. The host in a channel calls the `setLiveTranscoding` method to set the transcoding configuration of media streams (`AgoraLiveTranscoding`), such as the resolution, bitrate, frame rate, and position of any watermark/background. If you need a transcoded picture, set the picture-in-picture layout for each user in the `transcodingUser` class.

   <div class="alert note">To push streams without transcoding for single-host live streaming, skip steps 2 and 3, directly call <code>addPublishStreamUrl</code>, and set <code>transcodingEnabled (NO)</code>.</div>

3. The host in a channel calls the `addPublishStreamUrl` method to add a media stream to the CDN. The address can be dynamically added or deleted after the stream is pushed.

   <div class="alert note">Use <code>transcodingEnabled</code> to set whether transcoding is enabled or not.</div>

4. (Optional) The host in a channel calls the `setLiveTranscoding` method again to update the transcoding configuration of media streams.

   <div class="alert note">When the transcoding configuration is updated, the SDK triggers the <code>rtcEngineTranscodingUpdated</code> callback and reports the update information to the host.</div>

5. The host in a channel calls the `removePublishStreamUrl` method to remove a media stream from the Media Push.


When the streaming state changes, the SDK triggers the `rtmpStreamingChangedtoState` callback to report the current streaming state to the host. Make sure to wait until you receive the `rtmpStreamingChangedtoState` callback before performing any other actions. If adding or removing a CDN address fails, see <a href="./cdn_streaming_error">Exception Handling for Media Push</a>.



```objective-c
// Objective-C
// Sets the output layout for each user.
AgoraLiveTranscodingUser *user = [[AgoraLiveTranscodingUser alloc] init];
user.uid = 12345;
user.rect = CGRectMake(0, 0, 640, 720);
user.audioChannel = 0;

AgoraRtcEngineKit *rtcEngine = [AgoraRtcEngineKit sharedEngineWithAppId:@"" delegate:nil];
// CDN transcoding settings.
AgoraLiveTranscoding *transcoding = [[AgoraLiveTranscoding alloc] init];
transcoding.audioSampleRate = AgoraAudioSampleRateType44100;
transcoding.audioChannels = 2;
transcoding.audioBitrate = 48;
// Size of the video. The default value is 360 x 640 (px).
transcoding.size = CGSizeMake(360, 640);
// Bitrate of the video (Kbps). The default value is 400.
transcoding.videoBitrate = 400;
// Frame rate of the video (fps). The default value is 15. Agora adjusts all values over 30 to 30.
transcoding.videoFramerate = 30;
// Video codec profile. Choose to set as Baseline (66), Main (77), or High (100). If you set this parameter to other values, Agora adjusts it to the default value of 100.
transcoding.videoCodecProfile = AgoraVideoCodecProfileTypeHigh;
transcoding.transcodingUsers = @[user];

// CDN transcoding settings when using transcoding.
[rtcEngine setLiveTranscoding:transcoding];

// Adds a URL to which the host pushes a stream. Set the transcodingEnabled parameter as true to enable the transcoding service. Once transcoding is enabled, you need to set the live transcoding configurations by calling the setLiveTranscoding method. Agora does not recommend transcoding in the case of a single host.
[rtcEngine addPublishStreamUrl:streamUrl transcodingEnabled:YES];

// Removes a URL to which the host pushes a stream.
[rtcEngine removePublishStreamUrl:streamUrl];
```



### API reference

The following APIs are recommended by Agora when implementing Media Push:

- [`startRtmpStreamWithoutTranscoding`](./API%20Reference/oc/Classes/AgoraRtcEngineKit.html#//api/name/startRtmpStreamWithoutTranscoding:)
- [`startRtmpStreamWithTranscoding`](./API%20Reference/oc/Classes/AgoraRtcEngineKit.html#//api/name/startRtmpStreamWithTranscoding:transcoding:)
- [`updateRtmpTranscoding`](./API%20Reference/oc/Classes/AgoraRtcEngineKit.html#//api/name/updateRtmpTranscoding:)
- [`stopRtmpStream`](./API%20Reference/oc/Classes/AgoraRtcEngineKit.html#//api/name/stopRtmpStream:)
- [`rtcEngineTranscodingUpdated`](./API%20Reference/oc/Protocols/AgoraRtcEngineDelegate.html#//api/name/rtcEngineTranscodingUpdated:)
- [`rtmpStreamingChangedtoState`](./API%20Reference/oc/Protocols/AgoraRtcEngineDelegate.html#//api/name/rtcEngine:rtmpStreamingChangedToState:state:errorCode:)
- [`rtmpStreamingEventWithUrl`](./API%20Reference/oc/Protocols/AgoraRtcEngineDelegate.html#//api/name/rtcEngine:rtmpStreamingEventWithUrl:eventCode:)

The following APIs are still functional but not recommended by Agora when implementing Media Push:

- [`setLiveTranscoding`](./API%20Reference/oc/Classes/AgoraRtcEngineKit.html#//api/name/setLiveTranscoding:)
- [`addPublishStreamUrl`](./API%20Reference/oc/Classes/AgoraRtcEngineKit.html#//api/name/addPublishStreamUrl:transcodingEnabled:)
- [`removePublishStreamUrl`](./API%20Reference/oc/Classes/AgoraRtcEngineKit.html#//api/name/removePublishStreamUrl:)
- [`streamPublishedWithUrl`](./API%20Reference/oc/Protocols/AgoraRtcEngineDelegate.html#//api/name/rtcEngine:streamPublishedWithUrl:errorCode:)
- [`streamUnpublishedWithUrl`](./API%20Reference/oc/Protocols/AgoraRtcEngineDelegate.html#//api/name/rtcEngine:streamUnpublishedWithUrl:)

</PlatformWrapper>