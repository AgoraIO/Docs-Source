<PlatformWrapper platform="web">

This section shows how to use the Agora Chat SDK to implement peer-to-peer messaging in your app step by step.

### Create the UI

Copy the following code to the `index.html` file to implement the UI. 

`<script src="./dist/bundle.js"></script>` is used to refer to the `bundle.js` file packaged by webpack. A sample webpack configuration is shown in later steps.

```html
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Agora Chat Examples</title>
    <script src="./dist/bundle.js"></script>
</head>

<body>
    <h2 class="left-align">Agora Chat Examples</h5>
        <form id="loginForm">
            <div class="col" style="min-width: 433px; max-width: 443px">
                <div class="card" style="margin-top: 0px; margin-bottom: 0px;">
                    <div class="row card-content" style="margin-bottom: 0px; margin-top: 10px;">
                        <div class="input-field">
                            <label>Username</label>
                            <input type="text" placeholder="Username" id="userID">
                        </div>
                        <div class="input-field">
                            <label>Password</label>
                            <input type="passward" placeholder="Password" id="password">
                        </div>
                        <div class="row">
                            <div>
                                <button type="button" id="register">Register</button>
                                <button type="button" id="login">Login</button>
                                <button type="button" id="logout">Logout</button>
                            </div>
                        </div>
                        <div class="input-field">
                            <label>Peer username</label>
                            <input type="text" placeholder="Peer username" id="peerId">
                        </div>
                        <div class="input-field">
                            <label>Peer Message</label>
                            <input type="text" placeholder="Peer message" id="peerMessage">
                            <button type="button" id="send_peer_message">send</button>
                        </div>
                    </div>
                </div>
            </div>
        </form>

        <hr>

        <div id="log"></div>
</body>

</html>
```

### Implement the sending and receiving of messages

To enable your app to send and receive messages between individual users, do the following:

1. Import the Agora Chat SDK. Copy the following code to the `index.js` file:

   ```javascript
   // Javascript
   // Note that to avoid browser-compatibility issues, the sample uses the import command to import the SDK and webpack to package the JS file.
   import WebIM from 'agora-chat'
	 ```
	 
	 If you use typescript, use the following code:
	 
	```javascript
	// Typescript
	// import WebIM, { AgoraChat } from 'agora-chat'
	```
	
2. Implement peer-to-peer messaging with the core methods provided by the Agora Chat SDK. Copy the following code and add them behind the import function in the `index.js` file.

	```javascript
	var username, password;
	// Initializes the Web client
	WebIM.conn = new WebIM.connection({
		appKey: "41117440#383391",
	});
	// Adds the event handler
	WebIM.conn.addEventHandler("connection&message", {
		// Occurs when the app is connected to Agora Chat
		onConnected: () => {
			document
				.getElementById("log")
				.appendChild(document.createElement("div"))
				.append("Connect success !");
		},
		// Occurs when the app is disconnected from Agora Chat
		onDisconnected: () => {
			document
				.getElementById("log")
				.appendChild(document.createElement("div"))
				.append("Logout success !");
		},
		// Occurs when a text message is received
		onTextMessage: (message) => {
			console.log(message);
			document
				.getElementById("log")
				.appendChild(document.createElement("div"))
				.append("Message from: " + message.from + " Message: " + message.msg);
		},
		// Occurs when the token is about to expire
		onTokenWillExpire: (params) => {
			document
				.getElementById("log")
				.appendChild(document.createElement("div"))
				.append("Token is about to expire");
			refreshToken(username, password);
		},
		// Occurs when the token has expired. You need to get a token from your app server to log in to Agora Chat
		onTokenExpired: (params) => {
			document
				.getElementById("log")
				.appendChild(document.createElement("div"))
				.append("The token has expired");
			refreshToken(username, password);
		},
		onError: (error) => {
			console.log("on error", error);
		},
	});

	// Gets the token from the app server
	function refreshToken(username, password) {
		postData("https://a41.chat.agora.io/app/chat/user/login", {
			userAccount: username,
			userPassword: password,
		}).then((res) => {
			let agoraToken = res.accessToken;
			WebIM.conn.renewToken(agoraToken);
			document
				.getElementById("log")
				.appendChild(document.createElement("div"))
				.append("Token has been updated");
		});
	}
	// Sends a request for token
	function postData(url, data) {
		return fetch(url, {
			body: JSON.stringify(data),
			cache: "no-cache",
			headers: {
				"content-type": "application/json",
			},
			method: "POST",
			mode: "cors",
			redirect: "follow",
			referrer: "no-referrer",
		}).then((response) => response.json());
	}

	// Defines the functions of the buttons
	window.onload = function () {
		// Registration
		document.getElementById("register").onclick = function () {
			username = document.getElementById("userID").value.toString();
			password = document.getElementById("password").value.toString();
			// 1. Uses token to authenticate the user
			postData("https://a41.chat.agora.io/app/chat/user/register", {
				userAccount: username,
				userPassword: password,
			})
				.then((res) => {
					document
						.getElementById("log")
						.appendChild(document.createElement("div"))
						.append(`register user ${username} success`);
				})
				.catch((res) => {
					document
						.getElementById("log")
						.appendChild(document.createElement("div"))
						.append(`${username} already exists`);
				});
		};
		// Logs into Agora Chat
		document.getElementById("login").onclick = function () {
			document
				.getElementById("log")
				.appendChild(document.createElement("div"))
				.append("Logging in...");
			username = document.getElementById("userID").value.toString();
			password = document.getElementById("password").value.toString();
			// 1. Uses a token for authentication
			postData("https://a41.chat.agora.io/app/chat/user/login", {
				userAccount: username,
				userPassword: password,
			})
				.then((res) => {
					let agoraToken = res.accessToken;
					let easemobUserName = res.chatUserName;
					WebIM.conn.open({
						user: easemobUserName,
						agoraToken: agoraToken,
					});
				})
				.catch((res) => {
					document
						.getElementById("log")
						.appendChild(document.createElement("div"))
						.append(`Login failed`);
				});
		};

		// Logs out
		document.getElementById("logout").onclick = function () {
			WebIM.conn.close();
			document
				.getElementById("log")
				.appendChild(document.createElement("div"))
				.append("logout");
		};

		// Sends a peer-to-peer message
		document.getElementById("send_peer_message").onclick = function () {
			let peerId = document.getElementById("peerId").value.toString();
			let peerMessage = document.getElementById("peerMessage").value.toString();
			let option = {
				chatType: "singleChat", // Sets the chat type as single chat
				type: "txt", // Sets the message type
				to: peerId, // Sets the recipient of the meesage (userId)
				msg: peerMessage, // Sets the message content
			};
			let msg = WebIM.message.create(option);
			WebIM.conn
				.send(msg)
				.then((res) => {
					console.log("send private text success");
					document
						.getElementById("log")
						.appendChild(document.createElement("div"))
						.append("Message send to: " + peerId + " Message: " + peerMessage);
				})
				.catch(() => {
					console.log("send private text fail");
				});
		};
	};
	```

</PlatformWrapper>
