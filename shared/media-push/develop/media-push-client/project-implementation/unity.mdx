<PlatformWrapper platform="unity">

Refer to the following steps to push streams to the CDN:

<a name="single"></a>
1. The host in a channel calls the `SetLiveTranscoding` method to set the transcoding parameters of media streams (`LiveTranscoding`), such as the resolution, bitrate, frame rate, and position of any watermark/background. If you need a transcoded picture, set the picture-in-picture layout for each user in the `TranscodingUser` class, as described in [Sample code](#sample).

   <div class="alert note">The <tt>OnTranscodingUpdatedHandler</tt> callback occurs when the <tt>LiveTranscoding</tt> class updates, and reports update information to the local host.</div>

2. The host in a channel calls the `AddPublishStreamUrl` method to add a media stream to the CDN.

   <div class="alert note">Use <tt>transcodingEnabled</tt> to set whether transcoding is enabled or not.</div>

3. The host in a channel cans the `RemovePublishStreamUrl` method to remove a media stream from the Media Push.

When the state of media streams pushed to the CDN changes, the SDK triggers the `OnRtmpStreamingStateChangedHandler` callback to report current state of pushing streams to the local host. The local host can troubleshoot with the error code when exceptions occur.

<a name="sample"></a>
### Sample code

```c#
// CDN transcoding settings.
LiveTranscoding transcoding = new LiveTranscoding();
transcoding.audioSampleRate = AUDIO_SAMPLE_RATE_TYPE.AUDIO_SAMPLE_RATE_44100;
transcoding.audioChannels = 2;
transcoding.audioBitrate = 48;
// Width of the video (px). The default value is 360.
transcoding.width = 360;
// Height of the video (px). The default value is 640.
transcoding.height = 640;
// Video bitrate of the video (Kbps). The default value is 400.
transcoding.videoBitrate = 400;
// Video framerate of the video (fps). The default value is 15. Agora adjusts all values over 30 to 30.
transcoding.videoFramerate = 15;
// If userCount > 1ï¼Œset the layout for each user with transcodingUsers.
transcoding.userCount = 1;
// Video codec profile. Choose to set as Baseline (66), Main (77), or High (100). If you set this parameter to other values, Agora adjusts it to the default value 100.
transcoding.videoCodecProfile = VIDEO_CODEC_PROFILE_TYPE.VIDEO_CODEC_PROFILE_HIGH;
// Sets the output layout for each user.
TranscodingUser user = new TranscodingUser();
// The uid must be identical to the uid used in joinChannel().
user.uid = 123456;
user.x = 0;
user.y = 0;
user.audioChannel = 0;
user.width = 640;
user.height = 480;
user.alpha = 1;
transcoding.transcodingUsers = new TranscodingUser[] { user };
transcoding.userCount = (uint)transcoding.transcodingUsers.Length; 
transcoding.transcodingUsers = user;

// CDN transcoding settings when using transcoding.
mRtcEngine.SetLiveTranscoding(transcoding);
// Adds a URL to which the host pushes a stream. Set the transcodingEnabled parameter as true to enable the transcoding service. Once transcoding is enabled, you need to set the live transcoding configurations by calling the SetLiveTranscoding method. Agora does not recommend transcoding in the case of a single host.
mRtcEngine.AddPublishStreamUrl(url, true);
// Removes a URL to which the host pushes a stream.
mRtcEngine.RemovePublishStreamUrl(url);
```

~5eaf7290-df8d-11e9-b53b-13e6fcd0df87~

### API reference

- [`SetLiveTranscoding`](./API%20Reference/unity/classagora__gaming__rtc_1_1_i_rtc_engine.html#ade2c42adc26d8c56d8adfebf5c19e310)
- [`AddPublishStreamUrl`](./API%20Reference/unity/classagora__gaming__rtc_1_1_i_rtc_engine.html#a7af36af97846ff7f0535316ccabc7d05)
- [`RemovePublishStreamUrl`](./API%20Reference/unity/classagora__gaming__rtc_1_1_i_rtc_engine.html#a7b41d47fdce55b8a82e4ef4cee72b5cd)
- [`OnTranscodingUpdatedHandler`](./API%20Reference/unity/namespaceagora__gaming__rtc.html#abfa4d0ed623cf7b5776f2651caeea936)
- [`OnRtmpStreamingStateChangedHandler`](./API%20Reference/unity/namespaceagora__gaming__rtc.html#a589c11ed19b0638824aa1b2e23971271)

</PlatformWrapper>