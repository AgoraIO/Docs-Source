<PlatformWrapper platform="ios">


Follow the steps below to add built-in media stream encryption functionality to your <Vpl k="CLIENT" /> :

1. Generate a key and salt on your server.

    - Execute the following command on your server to randomly generate a String-type, 32-byte key via OpenSSL:
    ```shell
    # Randomly generate a String type, 32-byte key
    openssl rand -hex 32
    dba643c8ba6b6dc738df43d9fd624293b4b12d87a60f518253bd10ba98c48453
    ```
    - Execute the following command on your server to randomly generate a Base64 encoded, 32-byte salt using OpenSSL:
    ```shell
    # Randomly generate a Base64 encoded, 32-byte salt
    openssl rand -base64 32
    X5w9T+50kzxVOnkJKiY/lUk82/bES2kATOt3vBuGEDw=
    ```
1. Implement client-side logic:
    1. Follow the steps below to manually add the encryption library to your project:
        1. Copy the `AgoraRtcCryptoLoader.framework` from the <Vg k="COMPANY" /> <Vpd k="SDK"/> package to your project folder.

        1. Open Xcode (Xcode 11.0 for example), go to **TARGETS > Project Name > General > Frameworks, Libraries, and Embedded Content** menu.

        1. Click + and **Add Other**..., then add `AgoraRtcCryptoLoader.framework`.

        1. To ensure the dynamic library's signature is consistent with the <Vpl k="CLIENT" />'s signature, set the Embed attribute of the dynamic library to **Embed & Sign**.

        <Admonition type="caution" title="note" style="background-color:pink">According to Apple's requirements, an app's extension does not contain dynamic libraries. If you need to integrate the SDK into a dynamic library within an extension, you need to change the file status to **Do Not Embed**.</Admonition>
        <Admonition title="Information" type="info">
        For more integration methods, see [other integration methods](..\reference\ios.mdx#integrate-encryption-library-with-cocoapods).
        </Admonition>

    1. Add the following code in the `ViewController.swift` file to import the `AgoraRtcCryptoLoader` library:
        ```swift
        import AgoraRtcCryptoLoader
        ```
    1. Get the String type key and Base64 encoded salt from the server.

    1. Convert the salt from Base64 to uint8_t.

    1. Before joining the channel, call [enableEncryption](https://api-ref.agora.io/en/video-sdk/ios/4.x/documentation/agorartckit/agorartcenginekit/enableencryption(_:encryptionconfig:)), set the `AgoraEncryptionModeAES128GCM2` or `AgoraEncryptionModeAES256GCM2` encryption mode, and pass the key and salt into the SDK.

    <Admonition type="caution" title="note" style="background-color:pink">
    - All users within the same channel must use the same encryption mode, key, and salt. Otherwise, undefined behaviors such as black screens or audio loss may occur.
    - To ensure security, <Vg k="COMPANY" /> recommends using a new key and salt each time you enable media stream encryption.
    </Admonition>

    The following example code shows the implementation process of this logic:
    ```swift
    func getEncryptionSaltFromServer() -> Data {
        // Convert the Base64 encoded salt into uint8_t
        return "EncryptionKdfSaltInBase64Strings".data(using: .utf8)!
    }

    // Create an instance of AgoraEncryptionConfig
    let config = AgoraEncryptionConfig()
    // Set the encryption mode to AgoraEncryptionModeAES128GCM2
    config.encryptionMode = .AES128GCM2
    // Obtain the Base64 encoded salt from the server
    config.encryptionKdfSalt = getEncryptionKdfSaltBase64FromServer()
    // Obtain the String type key from the server
    config.encryptionKey = getEncryptionKeyFromServer()
    let ret = agoraKit.enableEncryption(true, encryptionConfig: config)
    if ret != 0 {
   self.showAlert(title: "Error", message: "enableEncryption call failed: \(ret), please check your params")
    }
    ```

</PlatformWrapper>