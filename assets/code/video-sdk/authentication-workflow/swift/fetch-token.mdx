
<PlatformWrapper platform="macos">
    ``` swift
    func fetchToken() -> Bool {
        // Construct the endpoint URL
        channelName = channelTextField.stringValue ?? ""
        if channelName.isEmpty {
            showMessage(title: "Channel", text: "Please set a channel to join")
            return false
        }
        guard let tokenServerURL = URL(string: "\(serverUrl)/rtc/\(channelName)/\(userRole.rawValue)/uid/\(userID)/?expiry=\(tokenExpireTime)") else {
            return false
        }
        /// Semaphore waits for the request to complete, before returning the token.
        let semaphore = DispatchSemaphore(value: 0)
        var request = URLRequest(url: tokenServerURL, timeoutInterval: 10)
        request.httpMethod = "GET"

        // Construct the GET request
        let task = URLSession.shared.dataTask(with: request) { data, response, err in
            defer {
                // Signal that the request has completed
                semaphore.signal()
            }
            guard let data = data else {
                // No data, no token
                return
            }
            let responseJSON = try? JSONSerialization.jsonObject(with: data, options: [])
            if let responseDict = responseJSON as? [String: Any], let tokenToReturn = responseDict["rtcToken"] as? String {
                // Key "rtcToken" found in response, assigning to tokenToReturn
                self.token = tokenToReturn
            }
        }

        task.resume()

        // Waiting for signal found inside the GET request handler
        semaphore.wait()
        return true
    }
    ```
</PlatformWrapper>

<PlatformWrapper platform="ios">
    ``` swift
    /** Fetches a token from the specified token server URL.

     - Parameters:
       - tokenUrl: The URL of the token server.
       - channel: The name of the channel for which the token will be used.
       - role: The role of the user for which the token will be generated.
       - userId: The ID of the user for which the token will be generated. Defaults to 0.

     - Returns: An optional string containing the RTC token, or `nil` if an error occurred.

     - Throws: An error of type `Error` if an error occurred during the token fetching process.
    */
    func fetchToken(
        from tokenUrl: String, channel: String,
        role: AgoraClientRole, userId: UInt = 0
    ) async throws -> String? {
        guard !tokenUrl.isEmpty else { return nil }

        guard let tokenServerURL = URL(
            string: "\(tokenUrl)/rtc/\(channel)/\(role.rawValue)/uid/\(userId)/"
        ) else { return nil }

        let (data, _) = try await URLSession.shared.data(from: tokenServerURL)
        let tokenResponse = try JSONDecoder().decode(TokenResponse.self, from: data)

        return tokenResponse.rtcToken
    }
    ```
</PlatformWrapper>