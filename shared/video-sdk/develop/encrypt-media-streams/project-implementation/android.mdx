
<PlatformWrapper platform="android">

To add built-in media stream encryption to your <Vpl k="CLIENT" />, refer to the following steps:

1. Generate a key and salt.

    - Execute the following command to generate a random 32-byte string key using OpenSSL:

        ```shell
        # Generate a random String type, 32-byte key
        openssl rand -hex 32
        dba643c8ba6b6dc738df43d9fd624293b4b12d87a60f518253bd10ba98c48453
        ```

    - Execute the following command to generate a random Base64 encoded, 32-byte salt using OpenSSL:

        ```shell
        # Generate a random a Base64 encoded, 32-byte salt
        openssl rand -base64 32
        X5w9T+50kzxVOnkJKiY/lUk82/bES2kATOt3vBuGEDw=
        ```

    <Admonition type="info" title="Information">In a real-world app, you generate the key and salt on your server.</Admonition>

1. Implement client-side logic:

    1. Obtain a String key and Base64-encoded salt from the server.

    1. Convert the salt from `Base64` to `uint8_t`.

    1. Before joining the channel, call [enableEncryption](https://api-ref.agora.io/en/video-sdk/android/4.x/API/class_irtcengine.html#api_irtcengine_enableencryption) to set the `AES_128_GCM2` or `AES_256_GCM2` encryption mode, and pass the key and salt to the SDK.

<Admonition type="caution" title="note" style="background-color:pink">
- All users in a channel must use the same encryption mode, key, and salt. Otherwise, unexpected behaviors such as black screens or audio loss may occur.
- To ensure security, best practice is to use a new key and salt each time you enable media stream encryption.
</Admonition>

The following sample code shows how this logic is implemented:

```java
import java.util.Base64;
import io.agora.rtc2.RtcEngine;
import io.agora.rtc2.internal.EncryptionConfig;

class Example
{
    public bool enableEncryption(RtcEngine engine) {
        if(engine == null)
            return false;
        // Obtain the Base64 encoded salt from the server
        String encryptionKdfSaltBase64 = Server.getEncryptionKdfSaltBase64();
        // Obtain the String type key from the server
        String encryptionSecret = Server.getEncryptionSecret();
        if(encryptionKdfSaltBase64 == null || encryptionSecret == null)
            return false;

        // Convert the Base64 encoded salt into uint8_t
        byte[] encryptionKdfSalt = Base64.getDecoder().decode(encryptionKdfSaltBase64);
        // Create an instance of EncryptionConfig
        EncryptionConfig config = new EncryptionConfig();
        // Set the encryption mode to AES_128_GCM2
        config.encryptionMode = EncryptionConfig.EncryptionMode.AES_128_GCM2;
        config.encryptionKey = encryptionSecret;
        // Copy the encryption KDF salt into the configuration
        System.arraycopy(encryptionKdfSalt, 0, config.encryptionKdfSalt, 0, config.encryptionKdfSalt.length);
        // Enable encryption with the configuration
        int result = engine.enableEncryption(true, config);
        // Return true if result is 0, meaning success
        return (result == 0);
    }
}
```

</PlatformWrapper>