import CodeBlock from '@theme/CodeBlock';

The following figure illustrates the essential steps:

<PlatformWrapper platform = "ios">
<details>
<summary>Quick start sequence</summary>

![](/images/rtc-sdk/quick-start-sequence.svg)
</details>
</PlatformWrapper>

<PlatformWrapper platform = "macos">
<details>
<summary>Quick start sequence</summary>

![](/images/rtc-sdk/quick-start-sequence-macos.svg)
</details>
</PlatformWrapper>

This guide includes [complete sample code](#complete-sample-code) that demonstrates implementing basic real-time interaction. To understand the core API calls in the sample code, review the following implementation steps.

### Import <Vg k="COMPANY"/> framework

Add the following import to your swift file:

```swift
import AgoraRtcKit
```

### Initialize the engine

Call `sharedEngine(withAppId:delegate:)` to create and initialize an `AgoraRtcEngineKit` instance. Provide your [App ID](../get-started/manage-agora-account#get-the-app-id) and an `AgoraRtcEngineDelegate` implementation to [handle SDK events](#subscribe-to--events).

```swift
var agoraKit: AgoraRtcEngineKit!
let appId = "YOUR_AGORA_APP_ID"

// Initialize the Agora engine
func initializeAgoraVideoSDK() {
    agoraKit = AgoraRtcEngineKit.sharedEngine(withAppId: appId, delegate: self)
}
```
### Join a channel

To join a channel, call `joinChannel` with the following parameters:

- **Channel name**: The name of the channel to join. Clients that pass the same channel name join the same channel. If a channel with the specified name does not exist, it is created when the first user joins.

- **Authentication token**: A dynamic key that authenticates a user when the client joins a channel. In a production environment, you obtain a token from a [token server](../token-authentication/deploy-token-server) in your security infrastructure. For the purpose of this guide [Generate a temporary token](../get-started/manage-agora-account#generate-temporary-tokens).

- **User ID**: A 32-bit signed integer that identifies a user in the channel. You can specify a unique user ID for each user yourself. If you set the user ID to `0` when joining a channel, the SDK generates a random number for the user ID and returns the value in the `didJoinChannel` callback. 

- **Channel media options**: Configure `AgoraRtcChannelMediaOptions` to define publishing and subscription settings, optimize performance for your specific use-case, and set optional parameters. 

Set the `channelProfile`, `clientRoleType` and `audienceLatencyLevel` according to your use case:

| Use case | Channel profile | Client Role | Latency level |
|----------|-----------------|---------------|-------------|
| **Voice calling** | `.communication` | `.broadcaster` | `.ultraLowLatency` (default) |
| **Video calling** | `.communication` | `.broadcaster` | `.ultraLowLatency` (default) |
| **Interactive live streaming** |  `.liveBroadcasting` | `.broadcaster` or `.audience` | `.ultraLowLatency` (default) |
| **Broadcast streaming** | `.liveBroadcasting` |  `.broadcaster` or `.audience` | `.lowLatency` |

<Admonition type="info" title="Note">
**Key considerations before joining a channel:**

- **Publishing permissions**: Only broadcasters can publish media. Audience members cannot publish until promoted to broadcaster.

- **Channel profile selection**: Choose communication mode for small group calls, typically under 17 participants, where all users publish. Use live broadcasting mode for larger events where you manage hosts and audience separately.

- **Latency and pricing**: Latency settings only apply to audience members. Choosing low latency instead of ultra-low latency affects your [pricing](/realtime-communication/overview/pricing#basic-service) tier.
</Admonition>

The following example shows the configuration for interactive live streaming with the broadcaster role:

```swift
let channelName = "demo"    // Replace with your actual channel name
let token = "<Authentication token>" // Replace with your token

// Join the channel with specified options
func joinChannel() {
    let options = AgoraRtcChannelMediaOptions()
    // In a live streaming use-case, set the channel use-case to liveBroadcasting
    options.channelProfile = .liveBroadcasting
    // Set the user role as broadcaster (default is audience)
    options.clientRoleType = .broadcaster
    // Publish audio captured by microphone
    options.publishMicrophoneTrack = true
    // Publish video captured by camera
    options.publishCameraTrack = true
    // Auto subscribe to all audio streams
    options.autoSubscribeAudio = true
    // Auto subscribe to all video streams
    options.autoSubscribeVideo = true
    // If setting the client role to audience, uncomment the following line to configure the latency level
    // options.audienceLatencyLevel = .ultraLowLatency
    // Use a temporary Token to join the channel
    agoraKit.joinChannel(
        byToken: token,
        channelId: channelName,
        uid: 0,
        mediaOptions: options
    )
}
```

You can also set the latency level after joining a channel by calling the `setClientRole` method with `role` set to `AgoraClientRole.audience` and `options.audienceLatencyLevel` set to `ultraLowLatency`.

```swift
// Set the user role to audience 
let role = AgoraClientRole.audience
let options = AgoraClientRoleOptions()
// Set the ultra low latency level
options.audienceLatencyLevel = .ultraLowLatency

agoraKit.setClientRole(role, options: options)
```

### Subscribe to <Vpd k="SDK" /> events

The <Vpd k="SDK" /> provides a delegate for handling channel events. To use it, conform to the `AgoraRtcEngineDelegate` protocol in your class and implement the event methods you want to handle. The following code implements the `didJoinChannel`, `didOfflineOfUid`, and `didJoinedOfUid` callbacks:

<Admonition type="info">
To ensure that you receive all <Vpd k="SDK" /> events, set the <Vg k="ENGINE" /> event handler before joining a channel.
</Admonition>


```swift
// Extension for handling Agora SDK callbacks
extension ViewController: AgoraRtcEngineDelegate {
    
    // Triggered when the local user successfully joins a channel
    func rtcEngine(_ engine: AgoraRtcEngineKit, didJoinChannel channel: String, withUid uid: UInt, elapsed: Int) {
        print("Successfully joined channel: \(channel) with UID: \(uid)")
    }
    
    // Triggered when a remote user joins the channel
    func rtcEngine(_ engine: AgoraRtcEngineKit, didJoinedOfUid uid: UInt, elapsed: Int) {
        setupRemoteVideo(uid: uid, view: remoteView)
    }
    // Triggered when a remote user leaves the channel
    func rtcEngine(_ engine: AgoraRtcEngineKit, didOfflineOfUid uid: UInt, reason: AgoraUserOfflineReason) {
        setupRemoteVideo(uid: uid, view: nil)
    }
}
```

To learn about the other SDK events, see <Link to="{{Global.API_REF_IOS_ROOT_RTC_KIT}}/agorartcenginedelegate">`AgoraRtcEngineDelegate`</Link>.

### Enable the video module

Follow the steps below to set up the video module.

1. To enable the video module, call `enableVideo`.
1. To enable local video preview, call `startPreview`.

```swift
// Enable video functionality (audio is enabled by default)
agoraKit.enableVideo()
// Enable local video preview
agoraKit.startPreview()
```

### Display the local video

Call `setupLocalVideo` to initialize the local view and set the local video display properties.

```swift
// Configures and starts displaying the local video feed
func setupLocalVideo() {
    let videoCanvas = AgoraRtcVideoCanvas()
    videoCanvas.view = localView
    videoCanvas.uid = 0  // UID 0 is assigned to the local user
    videoCanvas.renderMode = .hidden
    agoraKit.setupLocalVideo(videoCanvas)
}
```

### Display remote video
To initialize the remote user view, call `setupRemoteVideo` and set the local display properties for the remote user. Use the `didJoinedOfUid` callback to get the UID of the remote user.

```swift
func setupRemoteVideo(uid: UInt, view: UIView?) {
    let videoCanvas = AgoraRtcVideoCanvas()
    videoCanvas.uid = uid
    videoCanvas.view = view // Assign view for joining, set to nil for leaving
    videoCanvas.renderMode = .hidden
    agoraKit.setupRemoteVideo(videoCanvas)
}
```

### Handle permissions
To access the camera and microphone on <Vpl k="NAME" /> devices, add the required permissions for real-time interaction. Open the `info.plist` file from the project navigation bar, [edit the property list](https://help.apple.com/xcode/mac/current/#/dev3f399a2a6), to add the required permissions. These permissions are optional. However, if you do not add these permissions, you will not be able to use the corresponding devices.

| Key | Type | Value |
|:----|:-----|:------|
| Privacy - Microphone Usage Description | String | For the purpose of using the microphone. For example, for a call or live interactive streaming session. |
| Privacy - Camera Usage Description | String | For the purpose of using the camera. For example, for a call or live interactive streaming session. |

<Admonition type="info">
- If your project depends on third-party plugins or libraries, such as a third-party camera library, and the signature of the plug-in or library is inconsistent with the signature of the project, check the **Hardened Runtime** settings. Specifically, review and potentially disable **Runtime Exceptions** and **Library Validation** in the project configuration.
- For further information, refer to [Preparing your app for distribution](https://developer.apple.com/documentation/xcode/preparing_your_app_for_distribution).
</Admonition>

<PlatformWrapper platform="macos">
Configure your macOS project settings by navigating to **TARGETS > Project Name > Signing & Capabilities**. Enable **App Sandbox and Hardened Runtime**, and add the necessary permissions as follows:

| Capability | Category | Permission      |
|:-----------|:---------|:----------------|
| App Sandbox | Network | <ul><li>Incoming Connections (Server)</li><li>Outgoing Connections (Client)</li></ul> |
| App Sandbox | Hardware | <ul><li>Camera</li><li>Audio Input</li></ul> |
| Hardened Runtime | Resource Access | <ul><li>Camera</li><li>Audio Input</li></ul> |

</PlatformWrapper>

### Start and close the app

When the user launches the app, it joins the channel and starts <Vpd k="PRODUCT"/>. When the user closes the app, it leaves the channel and ends <Vpd k="PRODUCT"/>.

1. To start <Vpd k="PRODUCT"/>, call the following methods:

    ```swift
    // Initialize the Agora engine
    initializeAgoraVideoSDK()   
    // Start the local video preview
    setupLocalVideo()    
    // Join an Agora channel
    joinChannel()
    ```

1. To leave the channel and release SDK resources when the app is closed, call the following methods:

    ```swift
    // Stop local video preview
    agoraKit.stopPreview()
    // Leave the channel and release session-related resources
    agoraKit.leaveChannel(nil)
    // Release all resources used by the Agora SDK
    AgoraRtcEngineKit.destroy()
    ```

<Admonition type="caution" title="caution">After destroying the engine, you can no longer use SDK methods and callbacks. To use the real-time interaction functions again, create a new engine. See [Initialize the engine](#initialize-the-engine) for details.</Admonition>

### Complete sample code

A complete code sample demonstrating the basic process of real-time interaction is provided for your reference. Copy the following code into your `ViewController.swift` file:

<PlatformWrapper platform='ios'>
<details>
<summary>Complete sample code for real-time <Vpd k="PRODUCT"/> </summary>

<CodeBlock language="swift" showLineNumbers>
{`// ViewController.swift
import UIKit
import AgoraRtcKit

class ViewController: UIViewController {

    let appId = "<Your app ID>" // Replace with your actual App ID
    let channelName = "demo"    // Replace with your actual channel name
    let token = "<Authentication token>" // Replace with your token
    
    // UI view for displaying the local video stream
    var localView: UIView!
    // UI view for displaying the remote video stream
    var remoteView: UIView!
    // Instance of the Agora RTC engine
    var agoraKit: AgoraRtcEngineKit!

    override func viewDidLoad() {
        super.viewDidLoad()
        
        // Initialize the Agora engine
        initializeAgoraVideoSDK()
        // Set up the user interface
        setupUI()
        // Start the local video preview
        setupLocalVideo()
        // Join an Agora channel
        joinChannel()
    }

    // Clean up resources when the view controller is deallocated
    deinit {
        agoraKit.stopPreview()
        agoraKit.leaveChannel(nil)
        AgoraRtcEngineKit.destroy()
    }
    
    // Initializes the Video SDK instance
    func initializeAgoraVideoSDK() {
        // Create an instance of AgoraRtcEngineKit and set the delegate
        agoraKit = AgoraRtcEngineKit.sharedEngine(withAppId: appId, delegate: self)
    }
    
    // Sets up the UI layout for local and remote video views
    func setupUI() {
        // Create the local video view covering the full screen
        localView = UIView(frame: UIScreen.main.bounds)
        
        // Create the remote video view positioned in the top-right corner
        remoteView = UIView(frame: CGRect(x: self.view.bounds.width - 135, y: 50, width: 135, height: 240))
        
        // Add video views to the main view
        self.view.addSubview(localView)
        self.view.addSubview(remoteView)
    }
    
    // Configures and starts displaying the local video feed
    func setupLocalVideo() {
        // Enable video functionality (audio is enabled by default)
        agoraKit.enableVideo()
        let videoCanvas = AgoraRtcVideoCanvas()
        videoCanvas.view = localView
        videoCanvas.uid = 0  // UID 0 is assigned to the local user
        videoCanvas.renderMode = .hidden
        agoraKit.setupLocalVideo(videoCanvas)
        agoraKit.startPreview()
    }

    // Join the channel with specified options
    func joinChannel() {
        let options = AgoraRtcChannelMediaOptions()
        // In a live streaming use-case, set the channel use-case to liveBroadcasting
        options.channelProfile = .liveBroadcasting
        // Set the user role as broadcaster (default is audience)
        options.clientRoleType = .broadcaster
        // Publish audio captured by microphone
        options.publishMicrophoneTrack = true
        // Publish video captured by camera
        options.publishCameraTrack = true
        // Auto subscribe to all audio streams
        options.autoSubscribeAudio = true
        // Auto subscribe to all video streams
        options.autoSubscribeVideo = true
        // If setting the client role to audience, uncomment the following line to configure the latency level
        // options.audienceLatencyLevel = .ultraLowLatency
        // If you set uid=0, the engine generates a uid internally; on success, it triggers didJoinChannel callback
        // Join the channel with a temporary token
        agoraKit.joinChannel(
            byToken: token,
            channelId: channelName,
            uid: 0,
            mediaOptions: options
        )
    }
    
    func setupRemoteVideo(uid: UInt, view: UIView?) {
        let videoCanvas = AgoraRtcVideoCanvas()
        videoCanvas.uid = uid
        videoCanvas.view = view // Assign view for joining, set to nil for leaving
        videoCanvas.renderMode = .hidden
        agoraKit.setupRemoteVideo(videoCanvas)
    }
}

// Extension for handling Agora SDK callbacks
extension ViewController: AgoraRtcEngineDelegate {
    
    // Triggered when the local user successfully joins a channel
    func rtcEngine(_ engine: AgoraRtcEngineKit, didJoinChannel channel: String, withUid uid: UInt, elapsed: Int) {
        print("Successfully joined channel: \\(channel) with UID: \\(uid)")
    }
    
    // Triggered when a remote user joins the channel
    func rtcEngine(_ engine: AgoraRtcEngineKit, didJoinedOfUid uid: UInt, elapsed: Int) {
        // Assign the remote user’s video stream to the remote view
        setupRemoteVideo(uid: uid, view: remoteView)
    }

    // Triggered when a remote user leaves the channel
    func rtcEngine(_ engine: AgoraRtcEngineKit, didOfflineOfUid uid: UInt, reason: AgoraUserOfflineReason) {
        // Remove the remote video feed when the user disconnects
        setupRemoteVideo(uid: uid, view: nil)
    }
}`}
</CodeBlock>
</details>
</PlatformWrapper>

<PlatformWrapper platform='macos'>
<details>
<summary>Complete sample code for <Vpd k="PRODUCT"/></summary>

<CodeBlock language="swift" showLineNumbers>
{`// ViewController.swift
import Cocoa
import AgoraRtcKit

class ViewController: NSViewController {
    
    let appId = "<Your app ID>" // Replace with your actual App ID
    let channelName = "demo"    // Replace with your actual channel name
    let token = "<Authentication token>" // Replace with your token

    // UI view for displaying the local video stream
    var localView: NSView!
    // UI view for displaying the remote video stream
    var remoteView: NSView!
    // Instance of the Agora RTC engine
    var agoraKit: AgoraRtcEngineKit!

    override func viewDidLoad() {
        super.viewDidLoad()
        
        // Initialize the Agora engine
        initializeAgoraVideoSDK()
        // Set up the user interface
        setupUI()
        // Start the local video preview
        setupLocalVideo()
        // Join an Agora channel
        joinChannel()
    }

    // Clean up resources when the view controller is deallocated
    deinit {
        agoraKit.stopPreview()
        agoraKit.leaveChannel(nil)
        AgoraRtcEngineKit.destroy()
    }
    
    // Initializes the Video SDK instance
    func initializeAgoraVideoSDK() {
        // Create an instance of AgoraRtcEngineKit and set the delegate
        agoraKit = AgoraRtcEngineKit.sharedEngine(withAppId: appId, delegate: self)
    }
    
    func setupUI() {
        guard let screenFrame = NSScreen.main?.frame else { return } // Ensure screen is available

        // Create the local video view covering the full screen
        localView = NSView(frame: screenFrame)
        
        // Create the remote video view positioned in the top-right corner
        remoteView = NSView(frame: CGRect(x: self.view.bounds.width - 135, y: 50, width: 250, height: 250))
        
        // Add video views to the main view
        self.view.addSubview(localView)
        self.view.addSubview(remoteView)
    }

    
    // Configures and starts displaying the local video feed
    func setupLocalVideo() {
        // Enable video functionality (audio is enabled by default)
        agoraKit.enableVideo()
        let videoCanvas = AgoraRtcVideoCanvas()
        videoCanvas.view = localView
        videoCanvas.uid = 0  // UID 0 is assigned to the local user
        videoCanvas.renderMode = .hidden
        agoraKit.setupLocalVideo(videoCanvas)
        agoraKit.startPreview()
    }

    // Join the channel with specified options
    func joinChannel() {
        let options = AgoraRtcChannelMediaOptions()
        // In a live streaming use-case, set the channel use-case to liveBroadcasting
        options.channelProfile = .liveBroadcasting
        // Set the user role as broadcaster (default is audience)
        options.clientRoleType = .broadcaster
        // Publish audio captured by microphone
        options.publishMicrophoneTrack = true
        // Publish video captured by camera
        options.publishCameraTrack = true
        // Auto subscribe to all audio streams
        options.autoSubscribeAudio = true
        // Auto subscribe to all video streams
        options.autoSubscribeVideo = true
        // Set the audience latency level
        options.audienceLatencyLevel = .ultraLowLatency
        // Use a temporary Token to join the channel
        // If you set uid=0, the engine generates a uid internally; on success, it triggers didJoinChannel callback
        agoraKit.joinChannel(byToken: "<#Your Token#>", channelId: "<#Your Channel Name#>", uid: 0, mediaOptions: options)
    }
    
    func setupRemoteVideo(uid: UInt, view: NSView?) {
        let videoCanvas = AgoraRtcVideoCanvas()
        videoCanvas.uid = uid
        videoCanvas.view = view // Assign view for joining, set to nil for leaving
        videoCanvas.renderMode = .hidden
        agoraKit.setupRemoteVideo(videoCanvas)
    }
}

// Extension for handling Agora SDK callbacks
extension ViewController: AgoraRtcEngineDelegate {
    
    // Triggered when the local user successfully joins a channel
    func rtcEngine(_ engine: AgoraRtcEngineKit, didJoinChannel channel: String, withUid uid: UInt, elapsed: Int) {
        print("Successfully joined channel: \\(channel) with UID: \\(uid)")
    }
    
    // Triggered when a remote user joins the channel
    func rtcEngine(_ engine: AgoraRtcEngineKit, didJoinedOfUid uid: UInt, elapsed: Int) {
        // Assign the remote user’s video stream to the remote view
        setupRemoteVideo(uid: uid, view: remoteView)
    }

    // Triggered when a remote user leaves the channel
    func rtcEngine(_ engine: AgoraRtcEngineKit, didOfflineOfUid uid: UInt, reason: AgoraUserOfflineReason) {
        // Remove the remote video feed when the user disconnects
        setupRemoteVideo(uid: uid, view: nil)
    }
}`}
</CodeBlock>

</details>

</PlatformWrapper>

### Create a user interface

To connect the sample code to your existing UI, ensure that your `ViewController.swift` file includes the `UIView`s used to [Display the local video](#display-the-local-video) and [Display remote video](#display-remote-video).

Alternatively, use the following sample code to generate a basic user interface. To use this interface, replace the contents of the `ViewController.swift` file with the following code:

<PlatformWrapper platform="ios">

<details>
<summary>Sample code to create the user interface</summary>

<CodeBlock language="swift" showLineNumbers>
{`// ViewController.swift
import UIKit

class ViewController: UIViewController {

    // UI view for displaying the local video stream
    var localView: UIView!
    // UI view for displaying the remote video stream
    var remoteView: UIView!

    override func viewDidLoad() {
        super.viewDidLoad()

        // Set up the user interface
        setupUI()
    }
    
    // Sets up the UI layout for local and remote video views
    func setupUI() {
        // Create the local video view covering the full screen
        localView = UIView(frame: UIScreen.main.bounds)
        
        // Create the remote video view positioned in the top-right corner
        remoteView = UIView(frame: CGRect(x: self.view.bounds.width - 135, y: 50, width: 135, height: 240))
        
        // Add video views to the main view
        self.view.addSubview(localView)
        self.view.addSubview(remoteView)
    }
}`}
</CodeBlock>
</details>
</PlatformWrapper>

<PlatformWrapper platform="macos">
<details>
<summary>Sample code to create the user interface</summary>
<CodeBlock language="swift" showLineNumbers>
{`// ViewController.swift
import Cocoa
import AgoraRtcKit

class ViewController: NSViewController {
    
    // UI view for displaying the local video stream
    var localView: NSView!
    // UI view for displaying the remote video stream
    var remoteView: NSView!

    override func viewDidLoad() {
        super.viewDidLoad()
        
        // Set up the user interface
        setupUI()
    }

    func setupUI() {
        guard let screenFrame = NSScreen.main?.frame else { return } // Ensure screen is available

        // Create the local video view covering the full screen
        localView = NSView(frame: screenFrame)
        
        // Create the remote video view positioned in the top-right corner
        remoteView = NSView(frame: CGRect(x: self.view.bounds.width - 135, y: 50, width: 250, height: 250))
        
        // Add video views to the main view
        self.view.addSubview(localView)
        self.view.addSubview(remoteView)
    }
}`}
</CodeBlock>
</details>
</PlatformWrapper>
