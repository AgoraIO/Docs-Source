import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

<PlatformWrapper platform="windows">
![](/images/video-sdk/quick-start-sequence.svg)

<Tabs groupId="language" defaultValue="cs">
<TabItem value="cpp" label="C++">
#### Initialize the engine

Before calling other APIs, you create and initialize an instance of `IRtcEngine`.

Call `createAgoraRtcEngine` and and pass in the App ID to `initialize` the IRtcEngine.

```cpp
// Create an IRtcEngine instance
m_lpAgoraEngine = createAgoraRtcEngine();
RtcEngineContext ctx;

// Add registration callbacks and events
ctx.eventHandler = &m_engineEventHandler;

// Enter your App ID. You can get the App ID of your project from Agora console
ctx.appId = "Your App ID";

// Initialize IRtcEngine
m_lpAgoraEngine->initialize(ctx);
```

Add callbacks to receive notification of users joining and leaving the channel.

```cpp
// Inherit the callbacks and events in the IRtcEngineEventHandler class
    class CAGEngineEventHandler :
    public IRtcEngineEventHandler
{
 public:
    CAGEngineEventHandler();
    ~CAGEngineEventHandler();
    void setMainWnd(HWND wnd);
    HWND GetMsgReceiver() {return m_hMainWnd;};

    // Register onJoinChannelSuccess callback
    // This callback is triggered when a local user joins the channel
    virtual void onJoinChannelSuccess(const char* channel, uid_t uid, int elapsed);

    // Register onLeaveChannel callback
    // This callback is triggered when the local user leaves the channel
    virtual void onLeaveChannel(const RtcStats& stat);

    // Register onUserJoined callback
    // This callback is triggered when a remote host joins the channel
    // After receiving this callback, call setupRemoteVideo to set the view of the remote user.
    virtual void onUserJoined(uid_t uid, int elapsed) override;

    // Register onUserOffline callback
    // This callback is triggered when the remote user leaves the channel or goes offline
    virtual void onUserOffline(uid_t uid, USER_OFFLINE_REASON_TYPE reason);
 private:
    HWND m_hMainWnd;
 };
```

#### Set up local view

To display the local video during a call, refer to the following code:

```cpp
// Enable video module
m_lpAgoraEngine->enableVideo();
// Start local preview
m_lpAgoraEngine->startPreview();
// Set local view
VideoCanvas vc;
vc.uid = 0;
vc.view = hVideoWnd;
vc.renderMode = RENDER_MODE_TYPE::RENDER_MODE_HIDDEN;
m_lpAgoraEngine->setupLocalVideo(vc);
```

#### Join a channel

Set the channel name and user role, and use a temporary token to join a channel.

```cpp
void CLiveBroadcastingDlg::OnBnClickedButtonJoinchannel()
{
    if (!m_rtcEngine || !m_initialize)
        return;
    CString strInfo;
    if (!m_joinChannel) {
        CString strChannelName;
        m_edtChannelName.GetWindowText(strChannelName);
        if (strChannelName.IsEmpty()) {
            AfxMessageBox(_T("Fill channel name first"));
            return;
        }
		VideoEncoderConfiguration config;
		if (m_cmbVideoEncoder.GetCurSel() < 3)
			config.codecType = (VIDEO_CODEC_TYPE)(m_cmbVideoEncoder.GetCurSel() + 1);
		else
			config.codecType = (VIDEO_CODEC_TYPE)(m_cmbVideoEncoder.GetCurSel() + 2);
		m_rtcEngine->setVideoEncoderConfiguration(config);
        std::string szChannelId = cs2utf8(strChannelName);
		ChannelMediaOptions options;
		//Set channel profile to LIVE_BROADCASTING
		options.channelProfile = CHANNEL_PROFILE_LIVE_BROADCASTING;
		// Set the user role as host
		options.clientRoleType = CLIENT_ROLE_TYPE(m_cmbRole.GetCurSel() + 1);
		options.autoSubscribeAudio = true;
		options.autoSubscribeVideo = true;
        // Use a temporary Token you generated in the Agora console to join the channel
        if (0 == m_rtcEngine->joinChannel(APP_TOKEN, szChannelId.c_str(), 0, options)) {
            strInfo.Format(_T("join channel %s, use ChannelMediaOptions"), getCurrentTime());
            m_btnJoinChannel.EnableWindow(FALSE);
        }
    }
    else {
        if (0 == m_rtcEngine->leaveChannel()) {
            strInfo.Format(_T("leave channel %s"), getCurrentTime());
            m_btnJoinChannel.EnableWindow(FALSE);
        }
    }
    m_lstInfo.InsertString(m_lstInfo.GetCount(), strInfo);
}
```

#### Set up remote view

After a remote user successfully joins the channel, the SDK triggers the `onUserJoined` callback, with the user's `uid`. Call `setupRemoteVideo` from the callback, and pass in the obtained `uid`.

```cpp
// This callback will is triggered when a remote user successfully joins the channel.
// After receiving this callback, call setupRemoteVideo to set the view of the remote user.
void CAGEngineEventHandler::onUserJoined(uid_t uid, int elapsed)
{
	LPAGE_USER_JOINED lpData = new AGE_USER_JOINED;

	lpData->uid = uid;
	lpData->elapsed = elapsed;

	if(m_hMainWnd != NULL)
		::PostMessage(m_hMainWnd, WM_MSGID(EID_USER_JOINED), (WPARAM)lpData, 0);
}
```

```cpp
VideoCanvas canvas;
canvas.renderMode = RENDER_MODE_FIT;
POSITION pos = m_listWndInfo.GetHeadPosition();
......
AGVIDEO_WNDINFO &agvWndInfo = m_listWndInfo.GetNext(pos);
canvas.uid = agvWndInfo.nUID;
canvas.view = m_wndVideo[nIndex].GetSafeHwnd();
agvWndInfo.nIndex = nIndex;

// Set the remote view
CAgoraObject::GetEngine()->setupRemoteVideo(canvas);
```

#### Leave the channel

To end a call, or when closing the App, or switching the App to the background, call `leaveChannel` to leave the current channel.

```cpp
void CLiveBroadcastingDlg::UnInitAgora()
{
    if (m_rtcEngine) {
		if(m_joinChannel)
		// Leave the channel
		m_rtcEngine->leaveChannel();
		m_lstInfo.InsertString(m_lstInfo.GetCount(), _T("leaveChannel"));
        // Stop video preview
        m_rtcEngine->stopPreview();
        m_lstInfo.InsertString(m_lstInfo.GetCount(), _T("stopPreview"));
        // Close the video module
        m_rtcEngine->disableVideo();
        m_lstInfo.InsertString(m_lstInfo.GetCount(), _T("disableVideo"));
        // Release IRtcEngine
        m_rtcEngine->release(true);
        m_lstInfo.InsertString(m_lstInfo.GetCount(), _T("release rtc engine"));
        m_rtcEngine = NULL;
    }
}
```

</TabItem>
<TabItem value="cs" label="C#" default>

Refer to the following steps to implement audio and video interaction logic:

1. In **Solution Explorer**, right-click `Form1.cs` and select **View Code**.

1. In `Form1.cs`, add the following code after `using System.Windows.Forms;`:

    ```c#
    using Agora.Rtc;
    ```

1. In `Form1.cs`, declare variables to join a channel. Add the following code before `public Form1()`:

    ```c#
    // Fill in the App ID of the project from Agora console
    private readonly string APP_ID = "";

    // Fill in the temporary Token generated from Agora console
    private readonly string APP_TOKEN = "";

    // Declare a variable to hold an IRtcEngine instance
    private IRtcEngine engine_ = null;

    // Declare a variable to hold an RtcEventHandler instance
    private RtcEventHandler handler_ = null;
    ```

1. To declare a `RtcEventHandler` class that handles events, in `Form1.cs` add the following code after the class definition:

    ```c#
    internal class RtcEventHandler : IRtcEngineEventHandler
    {
        // Declare a delegate to handle the OnUserJoined event
        public delegate void OnUserJoinedHandler(RtcConnection connection, uint remoteUid, int elapsed);

        // Declare OnUserJoined callback
        public event OnUserJoinedHandler EventOnUserJoined;

        public RtcEventHandler()
        {
        }

        public override void OnError(int error, string msg)
        {
            Console.WriteLine("=====>OnError {0} {1}", error, msg);
        }

        public override void OnJoinChannelSuccess(RtcConnection connection, int elapsed)
        {
            Console.WriteLine("----->OnJoinChannelSuccess channel={0} uid={1}", connection.channelId, connection.localUid);
        }

        public override void OnLeaveChannel(RtcConnection connection, RtcStats stats)
        {
            Console.WriteLine("----->OnLeaveChannel duration={0}", stats.duration);
        }

        public override void OnUserJoined(RtcConnection connection, uint remoteUid, int elapsed)
        {
            Console.WriteLine("----->OnUserJoined uid={0}", remoteUid);

            if (EventOnUserJoined != null)
                EventOnUserJoined.Invoke(connection, remoteUid, elapsed);
        }

        public override void OnUserOffline(RtcConnection connection, uint remoteUid, USER_OFFLINE_REASON_TYPE reason)
        {
            Console.WriteLine("----->OnUserOffline, channel={0}, remoteUid={1}, reason={2}", connection.channelId, remoteUid, reason);
        }

        public override void OnRemoteVideoStateChanged(RtcConnection connection, uint remoteUid, REMOTE_VIDEO_STATE state, REMOTE_VIDEO_STATE_REASON reason, int elapsed)
        {
            Console.WriteLine("----->OnRemoteVideoStateChanged, channel={0}, remoteUid={1}, state={2}, reason={3}", connection.channelId, remoteUid, state, reason);
        }
    }
    ```

1. Create and initialize `IRtcEngine`

    1. Call `CreateAgoraRtcEngine` to create an `IRtcEngine` instance. Add the following code after `InitializeComponent();`:

        ```c#
        //Create IRtcEngine
        engine_ = RtcEngine.CreateAgoraRtcEngine();

        RtcEngineContext ctx = new RtcEngineContext()
        {
            appId = APP_ID,
            areaCode = AREA_CODE.AREA_CODE_GLOB,
            logConfig =
            {
                filePath = "rtc.log"
            }
        };

        //Initialize IRtcEngine
        var ret = engine_.Initialize(ctx);
        if(ret != 0)
        {
            Console.WriteLine("=====>Initialize failed {0}", ret);
            return;
        }

        ```

    1. To create and register event listeners, add the following code after the previous code:

        ```c#
        // Register event listener
        handler_ = new RtcEventHandler();
        handler_.EventOnUserJoined += OnUserJoined;
        engine_.InitEventHandler(handler_);
        ```

    1. To enable the video module, add the following code after the previous code:

        ```c#
        // Enable video module
        ret = engine_.EnableVideo();
        if (ret != 0)
        {
            Console.WriteLine("=====>EnableVideo failed {0}", ret);
        }
        ```

    1.  To enable local video, add the following code after the previous code:

        ```c#
        // Enable local video
        ret = engine_.EnableLocalVideo(true);
        if (ret != 0)
        {
            Console.WriteLine("=====>EnableLocalVideo failed {0}", ret);
        }
        ```

    1. To enable local camera screen preview, add the following code after the previous code:

        ```c#
        // Enable local video preview
        ret = engine_.StartPreview(VIDEO_SOURCE_TYPE.VIDEO_SOURCE_CAMERA_PRIMARY);
        if (ret != 0)
        {
            Console.WriteLine("=====>StartPreview failed {0}", ret);
        }
        ```

    1. To set up local camera preview, add the following code after the previous code

        ```c#
        // Set local video rendering properties
        VideoCanvas canvas = new VideoCanvas();
        canvas.view = (long)videoboxLocal.Handle;
        canvas.renderMode = RENDER_MODE_TYPE.RENDER_MODE_FIT;

        ret = engine_.SetupLocalVideo(canvas);
        if (ret != 0)
        {
            Console.WriteLine("=====>SetupLocalVideo failed {0}", ret);
        }
        ```

1. To join a channel when the app user clicks a button, replace the `btnJoin_Click` function with the following:

    ```c#
    private void btnJoin_Click(object sender, EventArgs e)
    {
        if (null != engine_)
        {
            ChannelMediaOptions options = new ChannelMediaOptions();
            // Set the channel profile to live broadcasting
            options.channelProfile.SetValue(CHANNEL_PROFILE_TYPE.CHANNEL_PROFILE_LIVE_BROADCASTING);
            // Set the user role as host
            options.clientRoleType.SetValue(CLIENT_ROLE_TYPE.CLIENT_ROLE_BROADCASTER);
            // Use a temporary token to join the channel
            var ret = engine_.JoinChannel(APP_TOKEN, txChannelName.Text, 0, options);

            Console.WriteLine("=====>JoinChannel result {0}", ret);
        }
    }
    ```

1. Implement leave channel logic. Replace the `btnLeave_Click` function with the following:

    ```c#
    private void btnLeave_Click(object sender, EventArgs e)
    {
        if (null != engine_)
        {
            var ret = engine_.LeaveChannel();
            Console.WriteLine("=====>LeaveChannel result {0}", ret);
        }
    }
    ```

1. Add a `OnUserJoined` function to receive notification when a remote user joins the channel. Use the callback to set up a video preview for the remote user. Add the following code after the `btnLeave_Click` function:

    ```c#
    private void OnUserJoined(RtcConnection connection, uint remoteUid, int elapsed)
    {
        VideoCanvas canvas = new VideoCanvas();
        canvas.view = (long)videoboxRemote.Handle;
        canvas.renderMode = RENDER_MODE_TYPE.RENDER_MODE_FIT;
        canvas.uid = remoteUid;

        int ret = engine_.SetupRemoteVideo(canvas);
        Console.WriteLine("----->SetupRemoteVideo, ret={0}", ret);
    }
    ```
</TabItem>

</Tabs>
</PlatformWrapper>