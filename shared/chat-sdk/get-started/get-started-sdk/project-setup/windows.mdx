<PlatformWrapper platform="windows">

This section shows how to prepare the development environment necessary to integrate Chat into your project.

### 1. Download the Windows sample project

1. Clone the [Windows demo repository](https://github.com/AgoraIO/Agora-Chat-API-Examples) to your local device.
2. Locate the `windows-example` folder in the downloaded repository, and double-click to open the `windows-example.sln` file in **Visual Studio**.
3. In the top menu of **Visual Studio**, select **Active solution configuration** as **Debug** and **Active solution platform** as **x64**.

### 2. Integrate the Chat SDK

1. Go to the [SDK download page](https://downloadsdk.easemob.com/downloads/SDK/WinSDK/agora_chat_sdk.1.0.2-beta.nupkg) to download the NuGet package to your local device.

2. In **Solution Explorer** of **Visual Studio**, right-click **windows-example**, and select **Manage NuGet Packages...** in the drop-down menu.

3. On the **NuGet: windows-example** page, select the **Gear** icon at the top right.

4. In the **Options** pop-up window, click the **+** button at the top right to add a package source. Select the new package source, specify its name in the **Name** box, set its path to the parent directory where the downloaded Nuget package resides in the **Source** box, and click **OK**.

5. Go back to the **NuGet: windows-example** page, open the **Package source** drop-down list at the top right, and select the newly-added one.

6. In the **Browse** tab of the **NuGet: windows-example** page, check the **Include prerelease** box, select the **agora_chat_sdk** item displayed below (if not, refresh the page), and click **Install**.

7. In the pop-up **Preview Changes** windows, click **OK** to proceed and complete the installation.

## Implement peer-to-peer messaging

This section shows how to use the Chat SDK to implement peer-to-peer messaging into your Windows .NET project, step-by-step.

### 1. Add namespaces

In **Solution Explorer** of **Visual Studio**, select **windows-example** > **MainWindow.xaml**, and double-click to open the `MainWindow.xaml.cs` file.

<div class="alert note">
A <code>JsonConvert.Undefined</code> error occurs when Newtonsoft.Json has not been imported to your project. Follow these steps to fix this issue:
<ol>1. Right-click <b>windows-example</b>, and select <b>Manage NuGet Packages...</b> in the drop-down menu.</ol>
<ol>2. In the <b>Installed</b> tab of the <b>NuGet: windows-example</b> page, select the <b>Newtonsoft.Json</b> entry, and click <b>Uninstalled</b>.</ol>
<ol>3. In the <b>Browse</b> tab of the <b>NuGet: windows-example</b> page, search <b>Newtonsoft.Json</b>, and click <b>Install</b> to reinstall Newtonsoft.Json.</ol>
</div>

At the top lines of the `MainWindow.xaml.cs` file, add the following:

```csharp
using ChatSDK;
using ChatSDK.MessageBody;
```

### 2. Initialize the SDK

In the `InitSDK` function, add the following to initialize the SDK:

```csharp
// In this sample project, replace `APPKEY` with `41117440#383391`.
var options = new Options(appKey: "APPKEY");
options.UsingHttpsOnly = true;
SDKClient.Instance.InitWithOptions(options);
```

### 3. Sign up an account

At the end of the `SignUp_Click` function, add the following to add the sign-up logic:

```csharp
bool result = await RegisterToAppServer(UserIdTextBox.Text, PasswordTextBox.Text);
if (result)
{
    AddLogToLogText("sign up succeed");
}
else
{
    AddLogToLogText("sign up failed");
}
```

### 4. Log in to an account

At the end of the `SignIn_Click` function, add the following to add the login logic:

```csharp
// Call `LoginToAppServer` to retrieve the Agora token.
string token = await LoginToAppServer(UserIdTextBox.Text, PasswordTextBox.Text);
if (token != null)
{
    // Call `LoginWithAgoraToken` to log in to the Chat service with username and Agora token.
   SDKClient.Instance.LoginWithAgoraToken(UserIdTextBox.Text, token, handle: new CallBack(
        onSuccess: () =>
        {
            AddLogToLogText("sign in sdk succeed");
        },
        onError: (code, desc) =>
        {
            AddLogToLogText($"sign in sdk failed, code: {code}, desc: {desc}");
        }
    ));
}
else
{
    AddLogToLogText($"fetch token error");
}
```

### 5. Log out of an account

At the end of the `SignOut_Click` function, add the following to add the logout logic:

```csharp
SDKClient.Instance.Logout(true, handle: new CallBack(
    onSuccess: () =>
    {
        AddLogToLogText("sign out sdk succeed");
    },
    onError: (code, desc) =>
    {
        AddLogToLogText($"sign out sdk failed, code: {code}, desc: {desc}");
    }
));
```

### 6. Send messages

At the end of the `SendBtn_Click` function, add the following to add the creating and sending logics for messages:

```csharp
Message msg = Message.CreateTextSendMessage(SingleChatIdTextBox.Text, MessageContentTextBox.Text);
    SDKClient.Instance.ChatManager.SendMessage(ref msg, new CallBack(
    onSuccess: () =>
    {
        // The success callback uses the System.Windows.Threading.Dispatcher to invoke UI elements `SingleChatIdTextBox.Text` and `MessageContentTextBox.Text`.
        Dip.Invoke(() =>
        {
            AddLogToLogText($"send message succeed, receiver: {SingleChatIdTextBox.Text},  message: {MessageContentTextBox.Text}");
        });
    },
    onError: (code, desc) =>
    {
        AddLogToLogText($"send message failed, code: {code}, desc: {desc}");
    }
));
```

### 7. Receive messages

To add the receiving logic for messages, refer to the following steps:

1. Declare and inherit the `IChatManagerDelegate` class. The sample code is as follows:

```csharp
public partial class MainWindow : Window, IChatManagerDelegate
```

2. Add the following callbacks to the `MainWindow` class:

```csharp
public void OnMessagesReceived(List<Message> messages)
{
    foreach (Message msg in messages)
    {
        if (msg.Body.Type == MessageBodyType.TXT)
        {
            TextBody txtBody = msg.Body as TextBody;
            AddLogToLogText($"received text message: {txtBody.Text}, from: {msg.From}");
        }
        else if (msg.Body.Type == MessageBodyType.IMAGE)
        {
            _ = msg.Body as ImageBody;
            AddLogToLogText($"received image message, from: {msg.From}");
        }
        else if (msg.Body.Type == MessageBodyType.VIDEO)
        {
            _ = msg.Body as VideoBody;
            AddLogToLogText($"received video message, from: {msg.From}");
        }
        else if (msg.Body.Type == MessageBodyType.VOICE)
        {
            _ = msg.Body as VoiceBody;
            AddLogToLogText($"received voice message, from: {msg.From}");
        }
        else if (msg.Body.Type == MessageBodyType.LOCATION)
        {
            _ = msg.Body as LocationBody;
            AddLogToLogText($"received location message, from: {msg.From}");
        }
        else if (msg.Body.Type == MessageBodyType.FILE)
        {
            _ = msg.Body as FileBody;
            AddLogToLogText($"received file message, from: {msg.From}");
        }
    }
}

public void OnCmdMessagesReceived(List<Message> messages)
{

}

public void OnMessagesRead(List<Message> messages)
{

}

public void OnMessagesDelivered(List<Message> messages)
{

}

public void OnMessagesRecalled(List<Message> messages)
{

}

public void OnReadAckForGroupMessageUpdated()
{

}

public void OnGroupMessageRead(List<GroupReadAck> list)
{

}

public void OnConversationsUpdate()
{

}

public void OnConversationRead(string from, string to)
{

}

```

3. In the `AddChatDelegate` function, add the following:

```csharp
// Add the listener for the `MainWindow` object.
SDKClient.Instance.ChatManager.AddChatManagerDelegate(this);
```

4. In the `RemoveChatDelegate`function, add the following:

```csharp
// Remove the listener when the object is released.
SDKClient.Instance.ChatManager.RemoveChatManagerDelegate(this);
```	

</PlatformWrapper>