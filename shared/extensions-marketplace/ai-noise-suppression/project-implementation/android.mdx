<PlatformWrapper platform="android">

1. Refer to the [Use an Extension](../develop/use-an-extension#project-setup) to see how to integrate the  <Vg k="RTEE_NS" /> extension in your project.

1.  **Import the necessary classes**

    2.  In `app/src/main/java/com.example.<projectname>/MainActivity`:

        1.  Add the following lines to import the Android classes used by the extension:

            ``` java
            import org.json.JSONException;
            import org.json.JSONObject;
            ```

        2.  Add the following lines to import the Agora classes used by the extension:

            ``` java
            // ExtensionManager is used to pass in basic info about the extension
            import io.agora.extension.ExtensionManager;
            import io.agora.rtc2.IMediaExtensionObserver;
            ```


1. **Add the extension and register the event handler**

    In `setupVideoSDKEngine`, add the following code before `agoraEngine = RtcEngine.create(config);`:

    ```java
    config.addExtension(ExtensionManager.<EXTENSION_NAME>);

    // Register IMediaExtensionObserver to receive events from the extension.
    config.mExtensionObserver = new IMediaExtensionObserver() {
        @Override
        public void onEvent(String vendor, String extension, String key, String value) {
            // Add callback handling logics for extension events.
            showMessage("Extension: " + extension + "\n Key: "
                + key + " \nValue:" + value);
        }

        @Override
        public void onStarted(String provider, String extension) {
            showMessage("Extension started");
        }

        @Override
        public void onStopped(String provider, String extension) {
            showMessage("Extension stopped");
        }

        @Override
        public void onError(String provider, String extension, int error, String message) {
            showMessage(message);
        }
    };
    ```

1. **Enable the extension**

    Call enableExtension to enable the extension. To enable multiple extensions, call `enableExtension` as many times. The sequence of enabling multiple extensions determines the order of these extensions in the transmission pipeline. For example, if you enable extension A before extension B, extension A processes data from the SDK before extension B.

    In `setupVideoSDKEngine`, add the following code before `agoraEngine = RtcEngine.create(config);`:

    ```java
    agoraEngine.enableExtension(ExtensionManager.EXTENSION_VENDOR_NAME,
        ExtensionManager.EXTENSION_VIDEO_FILTER_NAME, true);
    ```

1. **Set the default extension configuration**

    In the `joinChannel(View view)` method, add the following code after `agoraEngine.joinChannel`:

    ```java
    JSONObject o = new JSONObject();
    try {
        // Enables the AI noise reduction feature.
        o.put("che.audio.enable.nsng", "true");
        // Sets the mode of the AI noise reduction feature as hybrid mode('2'), which uses both the traditional and deep-learning noise reduction.
        // You can pass in '1' instead of '2' to change the mode to use deep-learning noise reduction only.
        // To disable the deep-learning noise reduction, pass in '0'.
        o.put("che.audio.ns.mode", 2);

        // Call setExtensionProperty to use the watermark feature.
        agoraEngine.setExtensionProperty(ExtensionManager.<EXTENSION_VENDOR_NAME>,
                ExtensionManager.<EXTENSION_VIDEO_FILTER_NAME>, "key", o.toString());
    } catch (JSONException e) {
        e.printStackTrace();
    }
    ```

1. **Enable a custom strategy**

    In a production environment you either implement this programmatically, or create a UI for you user to set the custom strategy.
    ``` java
    JSONObject o = new JSONObject();
    try {
        //lowerBound: The limit of noise suppression gain mapping index. The default value is 80.
        o.put("che.audio.nsng.lowerBound", 10");
        //lowerMask: The limit of noise suppression gain mapping value. The default value is 50.
        o.put("che.audio.nsng.lowerMask", 10");
        //statsticalbound: The limit of statistical noise suppression gain. The default value is 5.
        o.put("che.audio.nsng.statisticalbound", 0");
        //finallowermask: The gain limit of the whole noise suppression framework. The default value is 30.
        o.put("che.audio.nsng.finallowermask", 10");

        // Call setExtensionProperty to use the watermark feature.
        agoraEngine.setExtensionProperty(ExtensionManager.<EXTENSION_VENDOR_NAME>,
                ExtensionManager.<EXTENSION_VIDEO_FILTER_NAME>, "key", o.toString());
    } catch (JSONException e) {
        e.printStackTrace();
    }
    ```

1. **Enable troubleshooting**

    Best practice is to dump audio data, this significantly improves the efficiency of troubleshooting. The <Vg k="RTEE_NS" /> extension dumps an audio file in the WAV format in a specified path. To do this set the following extension properties:

    ``` java
    JSONObject o = new JSONObject();
    try {
        //lowerBound: The limit of noise suppression gain mapping index. The default value is 80.
        o.put("che.audio.start_debug_recording", "/path/to/debug/folder");
        //lowerMask: The limit of noise suppression gain mapping value. The default value is 50.
        o.put("che.audio.stop_debug_recording", true);


        // Call setExtensionProperty to use the watermark feature.
        agoraEngine.setExtensionProperty(ExtensionManager.<EXTENSION_VENDOR_NAME>,
                ExtensionManager.<EXTENSION_VIDEO_FILTER_NAME>, "key", o.toString());
    } catch (JSONException e) {
        e.printStackTrace();
    }

    ```

</PlatformWrapper>
