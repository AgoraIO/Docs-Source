import CodeBlock from '@theme/CodeBlock';

The following figure illustrates the essential steps:

<PlatformWrapper platform = "ios">
<details>
<summary>Quick start sequence</summary>

![](/images/rtc-sdk/quick-start-sequence.svg)
</details>
</PlatformWrapper>

<PlatformWrapper platform = "macos">
<details>
<summary>Quick start sequence</summary>

![](/images/rtc-sdk/quick-start-sequence-macos.svg)
</details>
</PlatformWrapper>

This guide includes [complete sample code](#complete-sample-code) that demonstrates implementing basic real-time interaction. To understand the core API calls in the sample code, review the following implementation steps.

### Import <Vg k="COMPANY"/> framework

Add the following import to your swift file:

```swift
import AgoraRtcKit
```

### Initialize the engine

Call `sharedEngine(withAppId:delegate:)` to create and initialize an `AgoraRtcEngineKit` instance. Provide your [App ID](../get-started/manage-agora-account#get-the-app-id) and an `AgoraRtcEngineDelegate` implementation to [handle SDK events](#subscribe-to--events).

```swift
var agoraKit: AgoraRtcEngineKit!
let appId = "YOUR_AGORA_APP_ID"

// Initialize the Agora engine
func initializeAgoraSDK() {
    agoraKit = AgoraRtcEngineKit.sharedEngine(withAppId: appId, delegate: self)
}
```

### Join a channel

To join a channel, call `joinChannel` with the following parameters:

- **Channel name**: The name of the channel to join. Clients that pass the same channel name join the same channel. If a channel with the specified name does not exist, it is created when the first user joins.

- **Authentication token**: A dynamic key that authenticates a user when the client joins a channel. In a production environment, you obtain a token from a [token server](../token-authentication/deploy-token-server) in your security infrastructure. For the purpose of this guide [Generate a temporary token](../get-started/manage-agora-account#generate-temporary-tokens).

- **User ID**: A 32-bit signed integer that identifies a user in the channel. You can specify a unique user ID for each user yourself. If you set the user ID to `0` when joining a channel, the SDK generates a random number for the user ID and returns the value in the `didJoinChannel` callback. 

- **Channel media options**: Configure `AgoraRtcChannelMediaOptions` to define publishing and subscription settings, optimize performance for your specific use-case, and set optional parameters. 

For voice calling, set the `channelProfile` to `.communication` and the user role to `.broadcaster`.

```swift
let channelName = "demo"    // Replace with your actual channel name
let token = "<Authentication token>" // Replace with your token

// Join the channel with specified options
func joinChannel() {
    let options = AgoraRtcChannelMediaOptions()
    // Set the channel profile
    // For voice calling use .communication,for live streaming use .liveBroadcasting
    options.channelProfile = .communication
    // Set the user role as broadcaster (default is audience)
    options.clientRoleType = .broadcaster
    // Publish audio captured by microphone
    options.publishMicrophoneTrack = true
    // Auto subscribe to all audio streams
    options.autoSubscribeAudio = true
    // Use a temporary Token to join the channel
    // If you set uid=0, the engine generates a uid internally; on success, it triggers didJoinChannel callback
    agoraKit.joinChannel(byToken: token, channelId: channelName, uid: 0, mediaOptions: options)
}
```


### Subscribe to <Vpd k="SDK" /> events

The <Vpd k="SDK" /> provides a delegate for handling channel events. To use it, conform to the `AgoraRtcEngineDelegate` protocol in your class and implement the event methods you want to handle. The following code implements the `didJoinChannel`, `didOfflineOfUid`, and `didJoinedOfUid` callbacks:

<Admonition type="info">
To ensure that you receive all <Vpd k="SDK" /> events, set the <Vg k="ENGINE" /> event handler before joining a channel.
</Admonition>


```swift
// Extension for handling Agora SDK callbacks
extension ViewController: AgoraRtcEngineDelegate {
    
    // Triggered when the local user successfully joins a channel
    func rtcEngine(_ engine: AgoraRtcEngineKit, didJoinChannel channel: String, withUid uid: UInt, elapsed: Int) {
        print("Successfully joined channel: \(channel) with UID: \(uid)")
    }
    
    // Triggered when a remote user joins the channel
    func rtcEngine(_ engine: AgoraRtcEngineKit, didJoinedOfUid uid: UInt, elapsed: Int) {
        print("Remote user joined with UID: \(uid)")
    }

    // Triggered when a remote user leaves the channel
    func rtcEngine(_ engine: AgoraRtcEngineKit, didOfflineOfUid uid: UInt, reason: AgoraUserOfflineReason) {
        print("Remote user left with UID: \(uid)")
    }
}
```

To learn about the other SDK events, see <Link to="{{Global.API_REF_IOS_ROOT_RTC_KIT}}/agorartcenginedelegate">`AgoraRtcEngineDelegate`</Link>.

### Handle permissions
To access the microphone on <Vpl k="NAME" /> devices, add the required permissions for real-time interaction. Open the `info.plist` file from the project navigation bar, [edit the property list](https://help.apple.com/xcode/mac/current/#/dev3f399a2a6), to add the required permissions. These permissions are optional. However, if you do not add these permissions, you will not be able to use the corresponding devices.

| Key | Type | Value |
|:----|:-----|:------|
| Privacy - Microphone Usage Description | String | For the purpose of using the microphone. For example, for a call or live interactive streaming session. |


<Admonition type="info">
- If your project depends on third-party plugins or libraries and the signature of the plug-in or library is inconsistent with the signature of the project, check the **Hardened Runtime** settings. Specifically, review and potentially disable **Runtime Exceptions** and **Library Validation** in the project configuration.
- For further information, refer to [Preparing your app for distribution](https://developer.apple.com/documentation/xcode/preparing_your_app_for_distribution).
</Admonition>

<PlatformWrapper platform="macos">
Configure your macOS project settings by navigating to **TARGETS > Project Name > Signing & Capabilities**. Enable **App Sandbox and Hardened Runtime**, and add the necessary permissions as follows:

| Capability | Category | Permission      |
|:-----------|:---------|:----------------|
| App Sandbox | Network | <ul><li>Incoming Connections (Server)</li><li>Outgoing Connections (Client)</li></ul> |
| App Sandbox | Hardware | <ul><li>Audio Input</li></ul> |
| Hardened Runtime | Resource Access | <ul><li>Audio Input</li></ul> |

</PlatformWrapper>

### Start and close the app

When the user launches the app, it joins the channel and starts <Vpd k="PRODUCT"/>. When the user closes the app, it leaves the channel and ends <Vpd k="PRODUCT"/>.

1. To start <Vpd k="PRODUCT"/>, call the following methods:

    ```swift
    // Initialize the Agora engine
    initializeAgoraSDK()   
    // Join an Agora channel
    joinChannel()
    ```

1. To leave the channel and release SDK resources when the app is closed, call the following methods:

    ```swift
    // Leave the channel and release session-related resources
    agoraKit.leaveChannel(nil)
    // Release all resources used by the Agora SDK
    AgoraRtcEngineKit.destroy()
    ```

<Admonition type="caution" title="caution">After destroying the engine, you can no longer use SDK methods and callbacks. To use the real-time interaction functions again, create a new engine. See [Initialize the engine](#initialize-the-engine) for details.</Admonition>

### Complete sample code

A complete code sample demonstrating the basic process of real-time interaction is provided for your reference. Copy the following code into your `ViewController.swift` file:

<PlatformWrapper platform='ios'>
<details>
<summary>Complete sample code for real-time <Vpd k="PRODUCT"/> </summary>

<CodeBlock language="swift" showLineNumbers>
{`// ViewController.swift
import UIKit
import AgoraRtcKit

class ViewController: UIViewController {
    
    let appId = "<Your app ID>" // Replace with your actual App ID
    let channelName = "demo"    // Replace with your actual channel name
    let token = "<Authentication token>" // Replace with your token

    // Instance of the Agora RTC engine
    var agoraKit: AgoraRtcEngineKit!

    override func viewDidLoad() {
        super.viewDidLoad()
        
        // Initialize the Agora engine
        initializeAgoraSDK()
        // Join an Agora channel
        joinChannel()
    }

    // Clean up resources when the view controller is deallocated
    deinit {
        agoraKit.leaveChannel(nil)
        AgoraRtcEngineKit.destroy()
    }
    
    // Initializes the Audio SDK instance
    func initializeAgoraSDK() {
        // Create an instance of AgoraRtcEngineKit and set the delegate
        agoraKit = AgoraRtcEngineKit.sharedEngine(withAppId: appId, delegate: self)
    }

    // Join the channel with specified options
    func joinChannel() {
        let options = AgoraRtcChannelMediaOptions()
        // In a live streaming use-case, set the channel use-case to liveBroadcasting
        options.channelProfile = .liveBroadcasting
        // Set the user role as broadcaster (default is audience)
        options.clientRoleType = .broadcaster
        // Publish audio captured by microphone
        options.publishMicrophoneTrack = true
        // Auto subscribe to all audio streams
        options.autoSubscribeAudio = true
        // Use a temporary Token to join the channel
        // If you set uid=0, the engine generates a uid internally; on success, it triggers didJoinChannel callback
        agoraKit.joinChannel(byToken: token, channelId: channelName, uid: 0, mediaOptions: options)
    }
}

// Extension for handling Agora SDK callbacks
extension ViewController: AgoraRtcEngineDelegate {
    
    // Triggered when the local user successfully joins a channel
    func rtcEngine(_ engine: AgoraRtcEngineKit, didJoinChannel channel: String, withUid uid: UInt, elapsed: Int) {
        print("Successfully joined channel: \(channel) with UID: \(uid)")
    }
    
    // Triggered when a remote user joins the channel
    func rtcEngine(_ engine: AgoraRtcEngineKit, didJoinedOfUid uid: UInt, elapsed: Int) {
        print("Remote user joined with UID: \(uid)")
    }

    // Triggered when a remote user leaves the channel
    func rtcEngine(_ engine: AgoraRtcEngineKit, didOfflineOfUid uid: UInt, reason: AgoraUserOfflineReason) {
        print("Remote user left with UID: \(uid)")
    }
}`}
</CodeBlock>
</details>
</PlatformWrapper>

<PlatformWrapper platform='macos'>
<details>
<summary>Complete sample code for <Vpd k="PRODUCT"/></summary>

<CodeBlock language="swift" showLineNumbers>
{`// ViewController.swift 
import Cocoa
import AgoraRtcKit

class ViewController: NSViewController {
    
    let appId = "<Your app ID>" // Replace with your actual App ID
    let channelName = "demo"    // Replace with your actual channel name
    let token = "<Authentication token>" // Replace with your token

    // Instance of the Agora RTC engine
    var agoraKit: AgoraRtcEngineKit!

    override func viewDidLoad() {
        super.viewDidLoad()
        
        // Initialize the Agora engine
        initializeAgoraSDK()
        // Join an Agora channel
        joinChannel()
    }

    // Clean up resources when the view controller is deallocated
    deinit {
        agoraKit.leaveChannel(nil)
        AgoraRtcEngineKit.destroy()
    }
    
    // Initializes the Audio SDK instance
    func initializeAgoraSDK() {
        // Create an instance of AgoraRtcEngineKit and set the delegate
        agoraKit = AgoraRtcEngineKit.sharedEngine(withAppId: appId, delegate: self)
    }

    // Join the channel with specified options
    func joinChannel() {
        let options = AgoraRtcChannelMediaOptions()
        // In a live streaming use-case, set the channel use-case to liveBroadcasting
        options.channelProfile = .liveBroadcasting
        // Set the user role as broadcaster (default is audience)
        options.clientRoleType = .broadcaster
        // Publish audio captured by microphone
        options.publishMicrophoneTrack = true
        // Auto subscribe to all audio streams
        options.autoSubscribeAudio = true
        // Use a temporary Token to join the channel
        // If you set uid=0, the engine generates a uid internally; on success, it triggers didJoinChannel callback
        agoraKit.joinChannel(byToken: token, channelId: channelName, uid: 0, mediaOptions: options)
    }
}

// Extension for handling Agora SDK callbacks
extension ViewController: AgoraRtcEngineDelegate {
    
    // Triggered when the local user successfully joins a channel
    func rtcEngine(_ engine: AgoraRtcEngineKit, didJoinChannel channel: String, withUid uid: UInt, elapsed: Int) {
        print("Successfully joined channel: \(channel) with UID: \(uid)")
    }
    
    // Triggered when a remote user joins the channel
    func rtcEngine(_ engine: AgoraRtcEngineKit, didJoinedOfUid uid: UInt, elapsed: Int) {
        print("Remote user joined with UID: \(uid)")
    }

    // Triggered when a remote user leaves the channel
    func rtcEngine(_ engine: AgoraRtcEngineKit, didOfflineOfUid uid: UInt, reason: AgoraUserOfflineReason) {
        print("Remote user left with UID: \(uid)")
    }
}`}
</CodeBlock>

</details>

</PlatformWrapper>

### Create a user interface

Use the following sample code to generate a basic user interface. Replace the contents of the `ViewController.swift` file with the following code:

<PlatformWrapper platform="ios">

<details>
<summary>Sample code to create the user interface</summary>

<CodeBlock language="swift" showLineNumbers>
{`import UIKit
import AgoraRtcKit

class ViewController: UIViewController {
    // RTC Engine
    var agoraKit: AgoraRtcEngineKit!
}`}
</CodeBlock>
</details>
</PlatformWrapper>

<PlatformWrapper platform="macos">
<details>
<summary>Sample code to create the user interface</summary>
<CodeBlock language="swift" showLineNumbers>
{`import Cocoa  
import AgoraRtcKit
class ViewController: NSViewController {  // ✅ macOS view controller
    var agoraKit: AgoraRtcEngineKit!
}`}
</CodeBlock>
</details>
</PlatformWrapper>
