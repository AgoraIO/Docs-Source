import CodeBlock from '@theme/CodeBlock';

1. **Integrate the toolkit**

    Copy the [`conversational-ai-api`](https://github.com/AgoraIO-Community/Conversational-AI-Demo/tree/main/Web/Scenes/VoiceAgent/src/conversational-ai-api) file to your project and import the toolkit before calling its API. Refer to [Folder structure](#folder-structure) to understand the role of each file.

1. **Create a toolkit instance**

    Before joining a <Vg k="VSDK"/> channel, create video and <Vg k="SIG" /> engine instances and pass in to the toolkit instance.

    <CodeBlock language="tsx" showLineNumbers>
    {`// Create configuration objects for RTC and RTM instances
    ConversationalAIAPI.init({
        rtcEngine,
        rtmEngine,
    })

    // Get the API instance (singleton)
    const conversationalAIAPI = ConversationalAIAPI.getInstance()`}
    </CodeBlock>

1. **Register events**

    Call the `addHandler` method to register and implement agent-related event callbacks.

    <CodeBlock language="tsx" showLineNumbers>
    {`// Listen for agent state changes
    conversationalAIAPI.on(EConversationalAIAPIEvents.AGENT_STATE_CHANGED, onAgentStateChanged)
    // Listen for agent performance metrics
    conversationalAIAPI.on(EConversationalAIAPIEvents.AGENT_METRICS, onAgentMetricsChanged)
    // Listen for agent error events
    conversationalAIAPI.on(EConversationalAIAPIEvents.AGENT_ERROR, onAgentError)`}
    </CodeBlock>

1. **Subscribe to the channel**
    Agent-related events are delivered through <Vg k="SIG" /> messages. Before starting an agent session, call `subscribeMessage` to receive these events:

    <CodeBlock language="ts" >
    {`conversationalAIAPI.subscribeMessage(channel_name)`}
    </CodeBlock>
    
1. **Add a Conversational AI agent to the channel**

    To [start a <Vpd k="AGENT" />](/conversational-ai/rest-api/join), configure the following parameters in your `POST` request:

    | Parameter       | Description   | Required |
    | ----------------| ------------- | -------- |
    | `advanced_features.enable_rtm: true`    | Starts the <Vg k="SIG" /> service | Yes  |
    | `parameters.data_channel: "rtm"`  | Enables <Vg k="SIG" /> as the data transmission channel | Yes |
    | `parameters.enable_metrics: true`  | Enables agent performance data collection    | Optional |
    | `parameters.enable_error_message: true` | Enables reporting of agent error events  | Optional |

    After a successful response, the agent joins the specified <Vg k="VSDK"/> channel and is ready to interact with the user.


1. **Unsubscribe from the channel**

    After each agent session ends, unsubscribe from channel messages to release resources associated with callback events:

    <CodeBlock language="ts" >
    {`conversationalAIAPI.unsubscribeMessage(channel_name)`}
    </CodeBlock>

1. **Release resources**

    At the end of each call, use the `destroy` method to clean up the cache.

    <CodeBlock language="ts" >
    {`conversationalAIAPI.destroy()`}
    </CodeBlock>


