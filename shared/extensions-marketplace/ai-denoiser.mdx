

<PlatformWrapper notAllowed="web">
<PlatformWrapper notAllowed="ios">
This extension is for Web and iOS only.
</PlatformWrapper>
</PlatformWrapper>

<PlatformWrapper notAllowed="android">
<PlatformWrapper notAllowed="macos">
<PlatformWrapper notAllowed="windows">
<PlatformWrapper notAllowed="flutter">
<PlatformWrapper notAllowed="react-native">
<PlatformWrapper notAllowed="electron">
<PlatformWrapper notAllowed="unity">

<PlatformWrapper platform="web">
With an AI-powered noise reduction algorithm, the AI Noise Suppression extension is used together with the Agora Web SDK (v4.10.0 or later) to suppress hundreds of types of noise and reduce distortion for human voices when multiple people speak simultaneously.
</PlatformWrapper>
<PlatformWrapper platform="ios">
With Agora deep learning noise reduction algorithms, the AI noise reduction feature of the Native SDK can suppress hundreds of types of noise and reduce distortion for human voices when multiple people speak simultaneously.
</PlatformWrapper>

In scenarios such as online meetings, online chat rooms, video consultations with doctors, and online gaming, the AI Noise Suppression extension makes virtual communication as smooth as face-to-face communication.

<div class="alert info">Click the <a href="https://webdemo.agora.io/aiDenoiser/index.html">online demo</a> to try this feature out.</div>

### Noise types<a name="type"></a>

The AI Noise Suppression extension suppresses the following types of noise:
- Television noise
- Kitchen noise
- Street noise, such as birds chirping, traffic, and subway noise.
- Machine noise, such as noise coming from fans, air conditioners, vacuum cleaners, and copiers.
- Office noise, such as keyboard clicks and mouse clicks.
- Household noise, such as noise coming from doors, creaking chairs, crying babies, and house renovations.
- Constant knocking
- Beeps and clapping sounds.
- Music
- Reverberation
- Howling

### Noise reduction strategy

The AI Noise Suppression extension supports the following noise reduction strategies:
- Default strategy: Reduces noise to a comfortable level without distorting the human voice.
- Custom strategy: If you need a more enhanced or custom noise reduction strategy for your business scenario, [submit a ticket](https://agora-ticket.agora.io/) to Agora technical support.

<PlatformWrapper platform="web">
### Considerations

Currently, the AI Noise Suppression extension has the following limitations:
- If the sample rate of the input signal is not 16 KHz, the extension downsamples the signal to 16 KHz, removes noise, and resamples the output signal to the original sample rate. This means the audio data above 8 KHz is removed in the output signal.
- In some unknown scenarios, the extension could cause audio quality to decrease by a certain degree.
- When multiple people speak at the same time, the audio quality of lowest human voices could be decreased by a certain degree.
- If only some of the audio tracks on the current web page enable the extension, the audio tracks that do not enable the extension could be affected because the extension turns on AEC and AGC and turns off NS in the browser.
- While the extension supports Safari later than 14.1, Agora does not recommend using the extension on Safari because of Safari's performance issues.
- Currently, the extension does not support browsers on mobile devices.
</PlatformWrapper>
## Understand the tech

A typical transmission pipeline in the Agora Web SDK consists of a chain of procedures, including capture, preprocessing, encoding, transmitting, decoding, post-processing, and playback. In the preprocessing stage, extensions can modify the audio and video data in the pipeline to implement features such as virtual background and noise cancellation.

![](https://web-cdn.agora.io/docs-files/1647326674232)

## Prerequisites

To use the AI Noise Suppression extension, you must meet the following requirements:

- [Noise type](#type) matches your business scenario.  For example, if you want the microphone to collect background music, the extension is not applicable because it categorizes such background music as noise.
<PlatformWrapper platform="web">
- You have the latest version of Desktop Chrome (recommended), Edge, or Firefox.
</PlatformWrapper>
<PlatformWrapper platform="ios">
- Minimum device requirements
    - iOS iPhone 6S
    - iPadOS
    - iPad Pro (2nd generation)
    - iPad mini (5th generation)
    - iPad Air (3rd generation)
    - macOS MacBook Pro 2015
- Ensure that the SDK version is v3.7.0 or later.
- Ensure that the dynamical extension library `AgoraAIDenoiseExtension.xcframework` is integrated into your project.

After successfully enabling AI noise reduction, if the SDK detects that the device performance is not sufficient, it automatically disables AI noise reduction but enables traditional noise reduction and throws the error code -1054(WARN_APM_AINS_CLOSED) reported by the onWarning callback.
</PlatformWrapper>

## Implementation

Follow these steps to integrate the AI Noise Suppression extension and implement the noise reduction feature:

<PlatformWrapper platform="web">
1. Refer to the <Vpl k="NAME" /> Quickstart Guide to integrate the <Vpl k="NAME" /> SDK (v4.10.0 or later) and implement the basic real-time communication functions in your project.
2. Integrate the AI Noise Suppression extension ([agora-extension-ai-denoiser](https://www.npmjs.com/package/agora-extension-ai-denoiser)) into your project via npm:
   1. To install the AI Noise Suppression extension, run the following command:
      `npm install agora-extension-ai-denoiser`
   2. To import the required module, add the following code to your `.js` file:
      ```javascript
      import {AIDenoiserExtension} from "agora-extension-ai-denoiser";
      ```
3. Dynamically load the Wasm and JS dependencies: The AI Noise Suppression extension depends on a few Wasm and JS files. To ensure that the browser can load and execute these files, you need to follow these steps:
  1. Publish the files located in the `node_modules/agora-extension-ai-denoiser/external` directory to the CDN or static resource server, and put them under one public path. In subsequent steps, you need to pass in the public path URL to create an` AIDenoiserExtension` instance. The extension then dynamically loads these files.
   <div class="alert note"><ul><li>If the host URL of the Wasm and JS files is not the same as that of the web application, enable the CORS policy.</li><li>Do not put the Wasm and JS files in an HTTP service, because loading HTTP resources in the HTTPS domain is blocked by the browsers' security policy.</li></ul></div>
  2. If you have enabled the Content Security Policy (CSP), because Wasm files are not allowed to load in Chrome and Edge by default, you need to configure the CSP as follows:

        - For versions later than Chrome 97 and Edge 97 (Chrome 97 and Edge 97 included): Add `'wasm-unsafe-eval'` in the [`script-src`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/script-src) options. For example:
           ``` xml
             <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'wasm-unsafe-eval'">
             ```

        - For versions earlier than Chrome 97 and Edge 97: Add `'unsafe-eval'` in the `script-src` options.

4. Register the AI Noise Suppression extension: Call <Link to= "{{global.API_REF_WEB_ROOT}}/interfaces/iagorartc.html#registerextensions">AgoraRTC.registerExtensionsAgoraRTC.registerExtensions</Link>, and pass in the created `AIDenoiserExtension` instance. Optionally, listen for the callback reporting that the Wasm and JS files fail to load.
    <div class="alert note">Ensure that you create one <code>AIDenoiserExtension</code> instance only.</div>

   ```typescript
   // Create an AIDenoiserExtension instance, and pass in the host URL of the Wasm and JS files
   const denoiser = new AIDenoiserExtension({assetsPath:'./external'});
   // Register the extension
   AgoraRTC.registerExtensions([denoiser]);
   // (Optional) Listen for the callback reporting that the Wasm and JS files fail to load
   denoiser.onloaderror = (e) => {
     // If the Wasm and JS files fail to load, you can disable the plugin, for example:
     // openDenoiserButton.enabled = false;
     console.log(e);
   }
   ```
5. Create an `IAIDenoiserProcessor` instance: Call the `createProcessor` method to create a `processor`, and set whether to enable the extension by default. Optionally, you can listen for the callback reporting that the noise reduction process takes too long.

   ```typescript
   //  Create a processor
   const processor = denoiser.createProcessor();
   // Enable the extension by default
   processor.enable();
   // Disable the extension by default
   // processor.disable();
   // (Optional) Listen for the callback reporting that the noise reduction process takes too long
   processor.onoverload = async () => {
     console.log("overload!!!");
     // If noise reduction takes too long, turn off the extension
     await processor.disable();
   }
   ```

6. Inject the extension to the audio processing pipeline: Call <Link to="{{global.API_REF_WEB_ROOT}}/interfaces/imicrophoneaudiotrack.html#pipe">pipe</Link> and specify the <Link to="{{global.API_REF_WEB_ROOT}}/interfaces/imicrophoneaudiotrack.html#processordestination">processorDestination</Link> property.

       ```typescript
       // Create a local video track
       const audioTrack = await AgoraRTC.createMicrophoneAudioTrack();
       // Inject the extension to the audio processing pipeline
       audioTrack.pipe(processor).pipe(audioTrack.processorDestination);
    await processor.enable();
       ```

7. Enable or disable the extension as needed: Call the `enable` or `disable` methods.

      ```typescript
      () => {
        if (processor.enabled) {
          await processor.disable();
        } else {
          await processor.enable();
        }
      }
      ```

8. Dump audio data from the noise reduction process: Call the `dump` method, and listen for the `ondump` and `ondumpend` callbacks.<div class="alert note">Agora strongly recommends dumping audio data, because it significantly improves the efficiency of troubleshooting.</div>

   ```typescript
   processor.ondump = (blob, name) => {
     // Dump the audio data to a local folder in WAV format
     const objectURL = URL.createObjectURL(blob);
     const tag = document.createElement("a");
     tag.download = name + ".wav";
     tag.href = objectURL;
     tag.click();
   }

   processor.ondumpend = () => {
     console.log("dump ended!!");
   }

   processor.dump();
   ```
</PlatformWrapper>
<PlatformWrapper platform="ios">
1. Refer to the <Vpl k="NAME" /> [SDK Quickstart Guide](/video-calling/get-started/get-started-sdk) to integrate the <Vpl k="NAME" /> SDK(RtcBasic) and AI Noise Suppression(AINS) in your project.

2. Enable the AI noise reduction feature: In `ViewController` class, add the following line in `initializeAgoraEngine` after `config.appId = appID`:
    ```swift
    agoraEngine.setParameters("{\"che.audio.enable.nsng\":true}")
    ```

3. Set the AI noise reduction mode: To set the mode of the AI noise reduction feature to hybrid mode('2'), which uses both the traditional and deep-learning noise reduction, add the following code before `agoraEngine = AgoraRtcEngineKit.sharedEngine(with: config, delegate: self)`. Optionally, pass in '1' instead of '2' to change the mode to use deep-learning noise reduction only and to disable the deep-learning noise reduction, pass in '0'.
    ```swift
    agoraEngine.setParameters("{\"che.audio.ns.mode\":2}")
    ```

4. Dump audio data from the noise reduction process: The AI Noise Suppression extension supports dumping an audio file in the WAV format in a specified path:<div class="alert note">Agora strongly recommends dumping audio data, because it significantly improves the efficiency of troubleshooting.</div>
    1. To dump an audio file, set the following parameters before `agoraEngine = AgoraRtcEngineKit.sharedEngine(with: config, delegate: self)`:
    ```swift
    agoraEngine.setParameters("{\"che.audio.start_debug_recording\":\"folder_path\"}")
    ```
    2. To stop dumping the audio file, add these parameters after `agoraEngine.setParameters("{\"che.audio.start_debug_recording\":\"folder_path\"}")`:
    ```swift
    agoraEngine.setParameters("{\"che.audio.stop_debug_recording\":true}")
    ```

5. Enable AI noise reduction with the custom strategy

The default noise reduction effect is "soft". To flexibly adjust the noise reduction effect, you can additionally change the following parameters before joining a channel:
- lowerBound: The limit of noise suppression gain mapping index. The default value is 80.
- lowerMask: The limit of noise suppression gain mapping value. The default value is 50.
- statisticalbound: The limit of statistical noise suppression gain. The default value is 5.
- finallowermask: The gain limit of the whole noise suppression framework. The default value is 30.

To make the reduction effect more aggressive than the default values, set lower than default value parameters before `agoraEngine = AgoraRtcEngineKit.sharedEngine(with: config, delegate: self)`:
    ```swift
    agoraEngine.setParameters("{\"che.audio.nsng.lowerBound\":10}")
    agoraEngine.setParameters("{\"che.audio.nsng.lowerMask\":10}")
    agoraEngine.setParameters("{\"che.audio.nsng.statisticalbound\":0}")
    agoraEngine.setParameters("{\"che.audio.nsng.finallowermask\":10}")
    ```
</PlatformWrapper>

<PlatformWrapper platform="web">
## API reference

### IAIDenoiserExtension

#### createProcessor

```typescript
createProcessor(): IAIDenoiserProcessor;
```

Creates an `IAIDenoiserProcessor` instance.

#### onloaderror

```typescript
onloaderror?: () => void;
```

Reports when the Wasm and JS files fail to load.

### IAIDenoiserProcessor
#### kind

```typescript
get kind(): 'video' | 'audio';
```

The processor type, which is categorized as video or audio.

#### enabled

```typescript
get enabled(): boolean;
```

Whether the extension is enabled:
- true: The extension is enabled.
- false: The extension is disabled.

#### enable

```typescript
enable(): void | Promise<void>;
```

Enables the AI Noise Suppression extension.

#### disable

```typescript
disable(): void | Promise<void>;
```

Disables the AI Noise Suppression extension.

#### dump

```typescript
dump(): void;
```

Dumps audio data in order to help troubleshoot noise reduction issues.

Calling this method triggers the `ondump` callback nine times, returning nine WAV files (see the description below) for the audio data processed by the extension 30 seconds before and 60 seconds after the method call, then triggers the `ondumpend` callback to inform you that the audio data ends dumping.

**Audio file description**

- Format: WAV
- Length: The length of each audio file is 30 seconds.
- Name: The second half of the file name indicates the created time, and the first half identifies the stage of the audio data through the following prefixes:
   - input: Indicates the audio data is not processed yet.
   - ns_out: Indicates the audio data is processed by the noise reduction algorithm.
   - agc_out: Indicates the audio data is processed by the speech enhancement algorithm.

**Notes**

- If you disable the AI Noise Suppression extension before the `ondump` callback is triggered nine times, the dumping process ends immediately and the `ondumpend `callback is triggered. In this case, fewer than nine audio data files are returned.
- If the actual audio data processed by the extension is less than 30 seconds long, the returned audio file is less than 30 seconds long.

#### ondump

```typescript
ondump?: (blob: Blob, name: string) => void;
```

Reports that audio data is dumped.

This callback returns the following parameters:

- `blob`: The audio data file.
- `name`: The `name `of the audio data file.

#### ondumpend

```typescript
ondumpend?: () => void;
```

Reports that audio data ends dumping.

#### onoverload

```typescript
onoverload?: () => void;
```

Reports that the noise reduction process takes too long.  This callback could be triggered by mistake and is for reference only.

### Type definition

#### AIDenoiserExtensionOptions

```typescript
export interface AIDenoiserExtensionOptions {
  assetsPath: string
}
```

Options for initializing the AI Noise Suppression extension:
- `assetsPath`: The host URL of the .wasm and .js files required by the AI Noise Suppression extension.

</PlatformWrapper>

</PlatformWrapper>
</PlatformWrapper>
</PlatformWrapper>
</PlatformWrapper>
</PlatformWrapper>
</PlatformWrapper>
</PlatformWrapper>