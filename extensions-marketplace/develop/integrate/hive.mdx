---
title: "Hive"
sidebar_position: 6
type: docs
description: >
    Use Hive Visual Moderation API in Agora SDK to empower your app with accurate content moderation
---
export const toc = [{}];

Hive content moderation enables you to monitor livestream for inappropriate content such as nudity, violence, drugs, and hate. This page shows you how to use Hive Visual Moderation API in Agora's Video SDK for accurate content moderation of livestreams.

<PlatformWrapper notAllowed="android,ios,macos,windows">
This extension is not provided for this platform.
</PlatformWrapper>
<PlatformWrapper notAllowed="web,flutter,react-native">


## Understand the tech

Hive Visual Moderation API and Agora SDK work together as follows:

![](/images/extensions-marketplace/hive-diagram.png)

1. The video frame captured from the video stream of the channel is encrypted and transmitted to the Agora proxy server.
2. The proxy server encapsulates the video frame information, encrypts it, and transmits it to Hive, a third-party moderation service provider.
3. The moderation service provider returns the review results to your callback server.
4. You implement your own business logic based on the review results.

The server-server transmission scheme simplifies monitoring and ensures security of the service. In addition, it gives you complete control over the business logic. When your business server receives a review result indicating content violation, you can close the channel, show a prompt in the UI, ban the user, or deduct points for the client.

## Prerequisites

In order to set up Hive content moderation you must have:

- Implemented <Link to="../../../interactive-live-streaming/get-started/get-started-sdk"><Vg k="GET_STARTED"/> for
  <Vg k="ILS" /></Link> using <Vg k="VSDK" /> `4.2.0` or greater.
- Activated <Link to="{{Global.AGORA_CONSOLE_URL}}/marketplace/extension/introduce?serviceName=hive">Hive Visual Moderation API</Link> on <Vg k="CONSOLE" />.
- Configured Hive Visual Moderation API by sending an email to support@agora.io with the following information:
    - **App ID**: Your App ID from <Vg k="CONSOLE"/>.
    - **Detection interval**: The time interval between capturing content from a video stream and submitting it for review.
    - **Callback server address**:	The address of your `HTTPS` callback server that you use to receive review results from Hive. The review effect starts automatically when the user joins the channel and continues for the duration of the call.

Reach out to us via email if you want to modify your existing configurations.


## Receive review results from Hive

To use Hive, you set up an `HTTPS` business server that receives review result callbacks from the moderation service provider. Hive returns review results to your callback URL in the form of an `HTTPS` request. The request body contains the `classes` array under `output`, showing the likelihood `score` for each type of content. The following is an example of a review result callback from Hive:

```json
{
    "id": "7abf0750-e328-11ed-b222-87f337abe867",
    "project_id": 42682,
    "metadata": "{\"callbackData\":\"\",\"cname\":\"emmatest\",\"requestId\":\"6E00C4019738446CBE766B307F163A5B\",\"sid\":\"1274C35C8A87482EB8A7504CB9CAC0DD\",\"source\":\"agora\",\"timestamp\":20230425051731571,\"uid\":2951920349}",
    "from_cache": false,
    "status": [
        {
            "status": {
                "code": 0,
                "message": "SUCCESS"
            },
            "response": {
                "input": {
                    "id": "7abf0750-e328-11ed-b222-87f337abe867",
                    "project_id": 42682,
                    "created_on": "2023-04-25T05:17:31.589Z",
                    "user_id": 4762,
                    "charge": 0,
                    "model": "mod55_dense",
                    "model_version": 1,
                    "model_type": "CATEGORIZATION",
                    "media": {
                        "url": null,
                        "filename": "1274C35C8A87482EB8A7504CB9CAC0DD_emmatest__uid_s_2951920349__uid_e_video_1682399851.jpg",
                        "type": "PHOTO",
                        "mime_type": "jpeg",
                        "mimetype": "image/jpeg",
                        "width": 360,
                        "height": 640,
                        "num_frames": 1,
                        "duration": 0
                    }
                },
                "output": [
                    {
                        "time": 0,
                        "classes": [
                            {
                                "class": "general_not_nsfw_not_suggestive",
                                "score": 0.9999998902596876
                            },
                            {
                                "class": "general_nsfw",
                                "score": 4.564771031813554e-8
                            },
                            {
                                "class": "general_suggestive",
                                "score": 6.409260203331096e-8
                            },
                            {
                                "class": "no_female_underwear",
                                "score": 0.999999995221794
                            },
                            {
                                "class": "yes_female_underwear",
                                "score": 4.778206007574724e-9
                            },
                            {
                                "class": "no_male_underwear",
                                "score": 0.9999999420403065
                            },
                            {
                                "class": "yes_male_underwear",
                                "score": 5.795969336742469e-8
                            },
                            {
                                "class": "no_sex_toy",
                                "score": 0.9999999801237609
                            },
                            {
                                "class": "yes_sex_toy",
                                "score": 1.9876239243892952e-8
                            },
                            {
                                "class": "no_female_nudity",
                                "score": 0.9999999923322097
                            },
                            {
                                "class": "yes_female_nudity",
                                "score": 7.66779042791356e-9
                            },
                            {
                                "class": "no_male_nudity",
                                "score": 0.9999999530245216
                            },
                            {
                                "class": "yes_male_nudity",
                                "score": 4.6975478407420044e-8
                            },
                            {
                                "class": "no_female_swimwear",
                                "score": 0.9999999895442114
                            },
                            {
                                "class": "yes_female_swimwear",
                                "score": 1.0455788511391486e-8
                            },
                            {
                                "class": "no_male_shirtless",
                                "score": 0.9999999726705345
                            },
                            {
                                "class": "yes_male_shirtless",
                                "score": 2.7329465441749975e-8
                            },
                            {
                                "class": "no_text",
                                "score": 0.999941838886264
                            },
                            {
                                "class": "text",
                                "score": 0.000058161113736056707
                            },
                            {
                                "class": "animated",
                                "score": 0.011601083343045507
                            },
                            {
                                "class": "hybrid",
                                "score": 0.000025449723867909695
                            },
                            {
                                "class": "natural",
                                "score": 0.9883734669330867
                            },
                            {
                                "class": "animated_gun",
                                "score": 2.258308627382419e-8
                            },
                            {
                                "class": "gun_in_hand",
                                "score": 1.9502628431912492e-8
                            },
                            {
                                "class": "gun_not_in_hand",
                                "score": 5.704125135634898e-9
                            },
                            {
                                "class": "no_gun",
                                "score": 0.9999999522101602
                            },
                            {
                                "class": "culinary_knife_in_hand",
                                "score": 7.210302019599915e-8
                            },
                            {
                                "class": "culinary_knife_not_in_hand",
                                "score": 1.1011147205976612e-7
                            },
                            {
                                "class": "knife_in_hand",
                                "score": 7.748133260553014e-9
                            },
                            {
                                "class": "knife_not_in_hand",
                                "score": 2.731155404466e-8
                            },
                            {
                                "class": "no_knife",
                                "score": 0.9999997827258204
                            },
                            {
                                "class": "a_little_bloody",
                                "score": 2.078834356775777e-8
                            },
                            {
                                "class": "no_blood",
                                "score": 0.9999998782944378
                            },
                            {
                                "class": "other_blood",
                                "score": 9.637454786047037e-8
                            },
                            {
                                "class": "very_bloody",
                                "score": 4.542670536098148e-9
                            },
                            {
                                "class": "no_pills",
                                "score": 0.9999998536118161
                            },
                            {
                                "class": "yes_pills",
                                "score": 1.46388183914744e-7
                            },
                            {
                                "class": "no_smoking",
                                "score": 0.9999999712273652
                            },
                            {
                                "class": "yes_smoking",
                                "score": 2.877263469847298e-8
                            },
                            {
                                "class": "illicit_injectables",
                                "score": 1.0423143272654016e-8
                            },
                            {
                                "class": "medical_injectables",
                                "score": 3.0554338647010042e-9
                            },
                            {
                                "class": "no_injectables",
                                "score": 0.9999999865214229
                            },
                            {
                                "class": "no_nazi",
                                "score": 0.9999999886696963
                            },
                            {
                                "class": "yes_nazi",
                                "score": 1.1330303651692805e-8
                            },
                            {
                                "class": "no_kkk",
                                "score": 0.9999999993491384
                            },
                            {
                                "class": "yes_kkk",
                                "score": 6.508614865058557e-10
                            },
                            {
                                "class": "no_middle_finger",
                                "score": 0.999999605609723
                            },
                            {
                                "class": "yes_middle_finger",
                                "score": 3.943902769840415e-7
                            },
                            {
                                "class": "no_terrorist",
                                "score": 0.9999999194182783
                            },
                            {
                                "class": "yes_terrorist",
                                "score": 8.058172159867429e-8
                            },
                            {
                                "class": "no_overlay_text",
                                "score": 0.9999991321671602
                            },
                            {
                                "class": "yes_overlay_text",
                                "score": 8.678328397936324e-7
                            },
                            {
                                "class": "no_sexual_activity",
                                "score": 0.9999993251769279
                            },
                            {
                                "class": "yes_sexual_activity",
                                "score": 6.74823072130068e-7
                            },
                            {
                                "class": "hanging",
                                "score": 4.375774136500247e-9
                            },
                            {
                                "class": "no_hanging_no_noose",
                                "score": 0.9999999819281092
                            },
                            {
                                "class": "noose",
                                "score": 1.3696116571479398e-8
                            },
                            {
                                "class": "no_realistic_nsfw",
                                "score": 0.999999960336948
                            },
                            {
                                "class": "yes_realistic_nsfw",
                                "score": 3.966305188217718e-8
                            },
                            {
                                "class": "animated_corpse",
                                "score": 1.4855407428590516e-9
                            },
                            {
                                "class": "human_corpse",
                                "score": 1.0001050962696124e-9
                            },
                            {
                                "class": "no_corpse",
                                "score": 0.9999999975143541
                            },
                            {
                                "class": "no_self_harm",
                                "score": 0.9999999686384823
                            },
                            {
                                "class": "yes_self_harm",
                                "score": 3.136151780966688e-8
                            },
                            {
                                "class": "no_drawing",
                                "score": 0.9999995746187147
                            },
                            {
                                "class": "yes_drawing",
                                "score": 4.2538128533439687e-7
                            },
                            {
                                "class": "no_emaciated_body",
                                "score": 0.999999992170776
                            },
                            {
                                "class": "yes_emaciated_body",
                                "score": 7.829224137902412e-9
                            },
                            {
                                "class": "no_child_present",
                                "score": 0.9999999632360723
                            },
                            {
                                "class": "yes_child_present",
                                "score": 3.676392756876583e-8
                            },
                            {
                                "class": "no_sexual_intent",
                                "score": 0.9999998289049783
                            },
                            {
                                "class": "yes_sexual_intent",
                                "score": 1.7109502169291475e-7
                            },
                            {
                                "class": "animal_genitalia_and_human",
                                "score": 8.734663272600194e-11
                            },
                            {
                                "class": "animal_genitalia_only",
                                "score": 1.3596234294945623e-9
                            },
                            {
                                "class": "animated_animal_genitalia",
                                "score": 6.630630819675252e-10
                            },
                            {
                                "class": "no_animal_genitalia",
                                "score": 0.9999999978899667
                            },
                            {
                                "class": "no_gambling",
                                "score": 0.999999992967229
                            },
                            {
                                "class": "yes_gambling",
                                "score": 7.032770880009595e-9
                            },
                            {
                                "class": "no_undressed",
                                "score": 0.9999999960521992
                            },
                            {
                                "class": "yes_undressed",
                                "score": 3.9478007038086995e-9
                            },
                            {
                                "class": "no_confederate",
                                "score": 0.9999999786738745
                            },
                            {
                                "class": "yes_confederate",
                                "score": 2.132612562919904e-8
                            },
                            {
                                "class": "animated_alcohol",
                                "score": 6.003958669904696e-9
                            },
                            {
                                "class": "no_alcohol",
                                "score": 0.9999998841726657
                            },
                            {
                                "class": "yes_alcohol",
                                "score": 9.934285965274742e-8
                            },
                            {
                                "class": "yes_drinking_alcohol",
                                "score": 1.0480515802698813e-8
                            },
                            {
                                "class": "no_religious_icon",
                                "score": 0.9999979696576353
                            },
                            {
                                "class": "yes_religious_icon",
                                "score": 0.000002030342364705881
                            }
                        ],
                        "media_link": "https://nvme-s3.castle.fm/hive-data-prod/project/42682/task/real/7abf0750-e328-11ed-b222-87f337abe867_0?AWSAccessKeyId=76QRDYRY4V3APOR2DYEO&Expires=1697951854&Signature=eamFnMJBoINUCjBlnzKHld9iAPM%3D",
                        "subtask_no": 701
                    }
                ]
            }
        }
    ]
}
```

After the review, the results are received from Hive at the specified callback URL. The following code shows how to
  process and analyze the results using the [Visual Content Moderation subclass](https://docs.thehive.ai/docs/visual-content-moderation).

```java
import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

// Parse the review results from the request body
JSONObject reviewResults = new JSONObject(requestBody);
JSONArray status = reviewResults.getJSONArray("status");
JSONObject response = status.getJSONObject(0).getJSONObject("response");
JSONArray output = response.getJSONArray("output");
JSONObject outputObj = output.getJSONObject(0);

// Retrieve the classes from the output
JSONArray classes = outputObj.getJSONArray("classes");

// Define the thresholds for each class
JSONObject thresholds = new JSONObject();
thresholds.put("suggestive", 0.1);
thresholds.put("sexual", 0.2);
thresholds.put("self_harm", 0.1);
thresholds.put("violence", 0.1);
thresholds.put("spam", 0.1);

// Analyze the classes using the thresholds
for (int i = 0; i < classes.length(); i++) {
    JSONObject c = classes.getJSONObject(i);
    String className = c.getString("class");
    double score = c.getDouble("score");
    double threshold = thresholds.getDouble(className);
    if (score > threshold) {
        System.out.println("The response contains sensitive material of type " + className + " with score " + score + ".");
    }
}
```

</PlatformWrapper>