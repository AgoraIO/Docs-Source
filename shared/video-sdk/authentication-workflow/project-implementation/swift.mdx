### Use a token

The client requests a token from your authentication server corresponding to the user Id and the channel name. You use the received token to join a channel.

```swift
// Channel name
let channelId: String = "xxxx"
// User ID
let uid: UInt = 0
// Request the server to generate a token corresponding to channelId and uid
let token = getToken()
// Set channel media options
let mediaOption = AgoraRtcChannelMediaOptions()
// Set the user role as host
mediaOption.clientRoleType = .broadcaster
// Use the token to join a channel
agoraKit.joinChannel(byToken: token, channelId: channelId, uid: uid, mediaOptions: mediaOption)
```

### Token expiration 

After you join a channel using a token, the SDK triggers an `onTokenPrivilegeWillExpire` callback, 30 seconds before the token is set to expire.

When the token expires, the SDK triggers an `onRequestToken` callback. After receiving the callback, you regenerate a new token on the server side, and then update the token in one of the following ways:

#### Single channel scenario

* Call `renewToken` to pass in the newly generated Token. (Recommended)

* Call `updateChannelWithMediaOptions` to update the token.

* Call `leaveChannel` [2/2] to leave the current channel, and then pass in a new token when calling `joinChannelByToken` [2/4] to rejoin the channel.

#### Multi-channel scenario

If you call `joinChannelEx` to join multiple channels, call the `updateChannelExWithMediaOptions` method to update the token.

The following sample code shows calling `renewToken` to update the token when receiving an `onTokenPrivilegeWillExpire` callback notification.

```swift
extension JoinChannelVideoToken: AgoraRtcEngineDelegate {
    // Callback is triggered when the token is about to expire
    func rtcEngine(_ engine: AgoraRtcEngineKit, tokenPrivilegeWillExpire token: String) {
        // Request to generate a fresh token
        let token = getToken()
        // Update Token
        engine.renewToken(token)
    }
}
```
