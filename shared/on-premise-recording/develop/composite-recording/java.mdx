<PlatformWrapper platform="linux-java">

1. Initialize the recorder with [`enableMix`](/on-premise-recording/reference/api-reference#initialize) set to `true`.
2. Subscribe to the audio and video streams of the users you want to record.
3. Join the channel using [`joinChannel`](/on-premise-recording/reference/api-reference#joinchannel).
4. After joining the channel:
   - Use [`setRecorderConfig`](/on-premise-recording/reference/api-reference#setrecorderconfig) to set video resolution, frame rate, duration, and output path.
   - Optionally, use [`enableAndUpdateVideoWatermarks`](/on-premise-recording/reference/api-reference#enableandupdatevideowatermarks) to apply video watermarks.
   - Use [`setVideoMixingLayout`](/on-premise-recording/reference/api-reference#setvideomixinglayout) to configure the layout of multiple video streams.
5. Start and stop recording using:
   - [`startRecording`](/on-premise-recording/reference/api-reference#startrecording)
   - [`stopRecording`](/on-premise-recording/reference/api-reference#stoprecording)

Refer to the following code to implement these steps:

```java
// Initialize the recorder in composite recording mode
agoraMediaRtcRecorder.initialize(agoraService, true);

// Subscribe to all audio and video streams
agoraMediaRtcRecorder.subscribeAllAudio();
VideoSubscriptionOptions options = new VideoSubscriptionOptions();
options.setEncodedFrameOnly(false);
options.setType(Constants.VideoStreamType.VIDEO_STREAM_HIGH);
agoraMediaRtcRecorder.subscribeAllVideo(options);

// Join the channel
agoraMediaRtcRecorder.joinChannel(
    recorderConfig.getToken(),
    recorderConfig.getChannelName(),
    recorderConfig.getUserId()
);

// Configure the recorder
agoraMediaRtcRecorder.setRecorderConfig(recorderConfig);
agoraMediaRtcRecorder.enableAndUpdateVideoWatermarks(watermarks); // Optional
agoraMediaRtcRecorder.setVideoMixingLayout(layout);

// Start recording
agoraMediaRtcRecorder.startRecording();

// ...

// Stop recording
agoraMediaRtcRecorder.stopRecording();
```

</PlatformWrapper>