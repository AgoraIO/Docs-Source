<PlatformWrapper platform = "flutter">

![](/images/video-sdk/quick-start-sequence.svg)

A complete code sample that implements the basic process of real-time interaction is presented here for your reference. Copy the following code to replace the entire content of the `/lib/main.dart` file in your project to quickly experience the basic functions of real-time audio and video interaction. 

<details> 
<summary>Complete sample code for real-time audio and video interaction</summary>

```dart
import 'dart:async';

import 'package:agora_rtc_engine/agora_rtc_engine.dart';
import 'package:flutter/material.dart';
import 'package:permission_handler/permission_handler.dart';

void main() => runApp(MyApp());

// Fill in the App ID of your project, generated from Agora console
const appId = "<-- Insert App Id -->";
// Fill in the temporary Token generated from Agora console
const token = "<-- Insert Token -->";
// Fill in the channel name you used to generate the token
const channel = "<-- Insert Channel Name -->";

// Application class
class MyApp extends StatefulWidget {
  const MyApp({Key? key}) : super(key: key);

  @override
  _MyAppState createState() => _MyAppState();
}

// Application state class
class _MyAppState extends State<MyApp> {
  int? _remoteUid; // The uid of the remote user
  bool _localUserJoined = false; // Indicates whether the local user has joined the channel
  late RtcEngine _engine; // The RtcEngine instances

  @override
  void initState() {
    super.initState();
    initAgora();
  }

  Future<void> initAgora() async {
    // Get microphone and camera permissions
    await [Permission.microphone, Permission.camera].request();

    // Create RtcEngine instance
    _engine = await createAgoraRtcEngine();

    // Initialize RtcEngine and set the channel profile to live broadcasting
    await _engine.initialize(const RtcEngineContext(
      appId: appId,
      channelProfile: ChannelProfileType.channelProfileLiveBroadcasting,
    ));

    // Add an event handler
    _engine.registerEventHandler(
      RtcEngineEventHandler(
        // Occurs when the local user joins the channel successfully
        onJoinChannelSuccess: (RtcConnection connection, int elapsed) {
          debugPrint("local user ${connection.localUid} joined");
          setState(() {
            _localUserJoined = true;
          });
        },
        // Occurs when a remote user join the channel
        onUserJoined: (RtcConnection connection, int remoteUid, int elapsed) {
          debugPrint("remote user $remoteUid joined");
          setState(() {
            _remoteUid = remoteUid;
          });
        },
        // Occurs when a remote user leaves the channel
        onUserOffline: (RtcConnection connection, int remoteUid,
            UserOfflineReasonType reason) {
          debugPrint("remote user $remoteUid left channel");
          setState(() {
            _remoteUid = null;
          });
        },
      ),
    );
    // Enable the video module
    await _engine.enableVideo();
    // Enable local video preview
    await _engine.startPreview();
    // Join a channel
    await _engine.joinChannel(
      token: token,
      channelId: channel,
      options: const ChannelMediaOptions(
          // Set the user role as host
          // To set the user role to audience, change clientRoleBroadcaster to clientRoleAudience
          clientRoleType: ClientRoleType.clientRoleBroadcaster),
      uid: 0,
    );
  }

  @override
  void dispose() {
    super.dispose();
    _dispose();
  }

  Future<void> _dispose() async {
    // Leave the channel
    await _engine.leaveChannel();
    // Release resources
    await _engine.release(); 
  }

  // Build the UI to display local and remote videos
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      home: Scaffold(
        appBar: AppBar(
          title: const Text('Agora Video Call'),
        ),
        body: Stack(
          children: [
            Center(
              child: _remoteVideo(),
            ),
           Align(
              alignment: Alignment.topLeft,
              child: SizedBox(
                width: 100,
                height: 150,
                child: Center(
                  child: _localUserJoined
                      ? AgoraVideoView(
                          controller: VideoViewController(
                            rtcEngine: _engine,
                            canvas: const VideoCanvas(uid: 0),
                          ),
                        )
                      : const CircularProgressIndicator(),
                ),
              ),
            ),
          ],
        ),
      ),
    );
  }

  // Widget to display remote video
  Widget _remoteVideo() {
    if (_remoteUid != null) {
      return AgoraVideoView(
        controller: VideoViewController.remote(
          rtcEngine: _engine,
          canvas: VideoCanvas(uid: _remoteUid),
          connection: const RtcConnection(channelId: channel),
        ),
      );
    } else {
      return const Text(
        'Please wait for remote user to join',
        textAlign: TextAlign.center,
      );
    }
  }
}
```
</details>

<Admonition title="Information" type="info">In the `appId` and `token` fields, enter the corresponding values you obtained from <Vg k="CONSOLE"/>. Use the same `channel` name you filled in when generating the temporary token.</Admonition>

Follow the implementation steps to understand the core API calls in the sample code.

### Import package​s
Import the packages required to build the App

```dart
import 'dart:async';

import 'package:agora_rtc_engine/agora_rtc_engine.dart';
import 'package:flutter/material.dart';
import 'package:permission_handler/permission_handler.dart';
```

### Declare variables
Pass in the App ID, temporary token obtained from the Shengwang console, and the channel name filled in when generating the temporary token, which will be used for subsequent initialization of the engine and joining the channel.

```dart
// Fill in the App ID of your project, generated from Agora console
const appId = "<-- Insert App Id -->";
// Fill in the temporary Token generated from Agora console
const token = "<-- Insert Token -->";
// Fill in the channel name you used to generate the token
const channel = "<-- Insert Channel Name -->";
```

### Handle permissions​
Get the microphone and camera permissions you need to experience live audio and video.

```dart
await [Permission.microphone, Permission.camera].request();
```

### Initialize the engine
Call `createAgoraRtcEngine` to create an `RtcEngine` instance, then `initialize` the engine and set the channel profile.

```dart
// Create RtcEngine instance
_engine = await createAgoraRtcEngine();

// Initialize RtcEngine and set the channel profile to live broadcasting
await _engine.initialize(const RtcEngineContext(
    appId: appId,
    channelProfile: ChannelProfileType.channelProfileLiveBroadcasting,
));
```

### Enable the video module​
Follow these steps to enable the video module:

1. Call `enableVideo` to enable the video module.
1. Call `startPreview` to enable local video preview.

```dart
// Enable the video module
await _engine.enableVideo();
// Enable local video preview
await _engine.startPreview();
```

### Join a channel and publish audio and video streams​
Configure `ChannelMediaOptions` and call `joinChannel` to join a channel. In `ChannelMediaOptions`, set the `clientRoleType` to `clientRoleBroadcaster` to act as a host or `clientRoleAudience` for audience.

```dart
await _engine.joinChannel(
    token: token,
    channelId: channel,
    options: const ChannelMediaOptions(
        // Set the user role as host
        // To set the user role to audience, change clientRoleBroadcaster to clientRoleAudience
        clientRoleType: ClientRoleType.clientRoleBroadcaster),
    uid: 0,
);
```

### Set up an event handler
Call `registerEventHandler` to add callback events and handle event logic.

```dart
// Add an event handler
_engine.registerEventHandler(
    RtcEngineEventHandler(
    // Occurs when the local user joins the channel successfully
    onJoinChannelSuccess: (RtcConnection connection, int elapsed) {
        debugPrint("local user ${connection.localUid} joined");
        setState(() {
        _localUserJoined = true;
        });
    },
    // Occurs when a remote user join the channel
    onUserJoined: (RtcConnection connection, int remoteUid, int elapsed) {
        debugPrint("remote user $remoteUid joined");
        setState(() {
        _remoteUid = remoteUid;
        });
    },
    // Occurs when a remote user leaves the channel
    onUserOffline: (RtcConnection connection, int remoteUid,
        UserOfflineReasonType reason) {
        debugPrint("remote user $remoteUid left channel");
        setState(() {
        _remoteUid = null;
        });
    },
    ),
);
```

When a remote user joins the channel, the `onUserJoined` callback is triggered. Use the remote user's `uid` returned in the callback, to create an AgoraVideoView control for displaying the video stream from the remote user.

### Set up remote video
Create a widget to display the remote video.

```dart
// Widget to display remote video
Widget _remoteVideo() {
    if (_remoteUid != null) {
        return AgoraVideoView(
        controller: VideoViewController.remote(
            rtcEngine: _engine,
            canvas: VideoCanvas(uid: _remoteUid),
            connection: const RtcConnection(channelId: channel),
        ),
        );
    } else {
        return const Text(
        'Please wait for remote user to join',
        textAlign: TextAlign.center,
        );
    }
}
```

### Leave the channel and release resources​
When a user closes the <Vpl k="CLIENT"/>, or switches the <Vpl k="CLIENT"/> to the background, call `leaveChannel` to leave the channel and then `release` all session-related resources.

```dart
Future<void> _dispose() async {
  await _engine.leaveChannel(); // 离开频道
  await _engine.release(); // 释放资源
}
```

</PlatformWrapper>