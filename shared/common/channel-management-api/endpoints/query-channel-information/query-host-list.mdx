import Authorization from '@docs/shared/common/channel-management-api/authorization.mdx';
import CodeBlock from '@theme/CodeBlock';
import MultiCodeBlock, { CodeGroup, CodeItem } from '@app/mdx-components/MultiCodeBlock';
import RestAPILayout from '@site/src/components/rest-api/RestAPILayout';
import LeftColumn from '@site/src/components/rest-api/LeftColumn';
import RightColumn, { Section } from '@site/src/components/rest-api/RightColumn';
import ParameterList, { Parameter } from '@site/src/components/rest-api/ParameterList';
import PathParameter from '@site/src/components/rest-api/PathParameter';
import { Tabs, TabItem } from '@site/src/components/rest-api/Tabs';

<RestAPILayout>

<LeftColumn
  title="Query host list"
  method="GET"
  endpoint="https://api.agora.io/dev/v1/channel/{appid}"
>
This method gets the list of hosts in the specified channel in the live broadcast use-case.

For details on how the API works, see the [Reference](#reference) section.

### Request

**Path parameters**

Pass the following path parameters in the request URL:

  <PathParameter name="appid" type="string" required={true}>
    The App ID of the project. You can get it through one of the following methods:
    <ul>
      <li>Copy from the <Link to="{{Global.AGORA_CONSOLE_URL}}"><Vg k="CONSOLE" /></Link></li>
      <li> Call the [Get all projects](../../agora-console-rest-api#get-all-projects) API, and read the value of the `vendor_key` field in the response body.</li>
    </ul>
  </PathParameter>
  <PathParameter name="channelName" type="string" required={false}>
    The channel name. 
   </PathParameter>

**Request header**

<Authorization/>

### Response

If the status code is `200`, the request succeeds, and the response body includes the following parameters:

<ParameterList title="OK">
  <Parameter name="success" type="boolean" required={true}>
    The state of this request:
    <ul>
      <li>``true``: Success.</li>
      <li>``false``: Reserved for future use.</li>
    </ul>
  </Parameter>

  <Parameter name="data" type="object" required={true}>
    User information, including the following fields:
    <Parameter name="channel_exist" type="boolean" required={true}>
      Whether the specified channel exists:
      <ul>
        <li>``true``: The channel exists.</li>
        <li>``false``: The channel does not exist.</li>
      </ul>
      **Note**: All other fields are not returned when the value of ``channel_exist`` is ``false``.
    </Parameter>

    <Parameter name="mode" type="number" required={true}>
      The channel profile:
      <ul>
        <li>``1``: The ``COMMUNICATION`` profile.</li>
        <li>``2``: The ``LIVE_BROADCASTING`` profile.</li>
      </ul>
    </Parameter>

    <Parameter name="broadcasters" type="array" required={false}>
      User IDs of all hosts in the channel. This field is returned only when ``mode`` is ``2``.
    </Parameter>
  </Parameter>
</ParameterList>
If the status code is not `200`, the request fails. See the `message` field in the response body for the reason for this failure. For details about possible response status codes, see [Response status codes](../../response-status-code).

### Reference

This API is only used in the live broadcast profile (`mode` is set to `2`). Users in the same channel must use the same profile. Otherwise, the query results may be inaccurate.

Use this API instead of the [query user status](query-user-status) API to synchronize the online status of hosts. This API is more efficient and requires fewer calls.

</LeftColumn>
<RightColumn>
<Section title="Authorization">
The endpoint requires [RESTful authentication](/video-calling/channel-management-api/restful-authentication).
</Section>
<Section title="Request example">
  <Tabs groupId="code-examples">
    <TabItem value="curl" label="curl" default>
    ```bash
    curl --request GET \
      --url https://api.sd-rtn.com/dev/v1/channel/user/appid/channelName/hosts_only \
      --header 'Accept: application/json' \
      --header 'Authorization: Basic 123'
    ```
    </TabItem>
    <TabItem value="python" label="Python" default>
    ```python
    import http.client

    conn = http.client.HTTPSConnection("api.sd-rtn.com")

    headers = {
        'Accept': "application/json",
        'Authorization': "Basic 123"
    }

    conn.request("GET", "/dev/v1/channel/user/appid/channelName/hosts_only", headers=headers)

    res = conn.getresponse()
    data = res.read()

    print(data.decode("utf-8"))
    ```
    </TabItem>
    <TabItem value="node" label="Node.js" default>
    ```js
    const fetch = require('node-fetch');

    const url = 'https://api.sd-rtn.com/dev/v1/channel/user/appid/channelName/hosts_only';
    const options = {
      method: 'GET',
      headers: {Accept: 'application/json', Authorization: 'Basic 123'}
    };

    try {
      const response = await fetch(url, options);
      const data = await response.json();
      console.log(data);
    } catch (error) {
      console.error(error);
    }
    ```
    </TabItem>
  </Tabs>
</Section>
<Section title="Response example">
```json
{
  "success": true,
  "data": {
    "channel_exist": true,
    "mode": 2,
    "broadcasters": [
      574332,
      1347839
    ]
  }
}
```
</Section>
</RightColumn>
</RestAPILayout>

