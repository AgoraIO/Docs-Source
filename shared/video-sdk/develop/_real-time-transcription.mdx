import * as data from '@site/data/variables';
import Prerequites from '@docs/shared/common/prerequities.mdx';
import ProjectSetup from '@docs/shared/video-sdk/develop/real-time-transcription/project-setup/index.mdx';
import ProjectImplement from '@docs/shared/video-sdk/develop/real-time-transcription/project-implementation/index.mdx';
import ProjectTest from '@docs/shared/video-sdk/develop/real-time-transcription/project-test/index.mdx';
import Reference from '@docs/shared/video-sdk/develop/real-time-transcription/reference/index.mdx'; import {
  PlatformWrapper
} from '../../../../src/mdx-components/PlatformWrapper';

<Vg k="RTT" /> takes the audio content of a host's media stream and transcribes it into written words in real time.
This page explains how to start and stop speech recognition in your <Vpl k="CLIENT" />, then download and present the transcript.

## Understand the tech

To start transcription in real time, you send an `HTTP` request to the <Vg k="AGORA_BACKEND" />  through your
business server. <Vg k="RTT" /> provides the following modes:

* Transcribe speech in real time, then stream this data to the channel.
* Transcribe speech in real time, store the text in the `WebVTT` format, and upload the file to third-party cloud storage.

In order to use the RESTful API to transcribe speech, take the following steps:

1. Call `acquire`: Request a `builderToken` for transcription. Each `buildToken` is valid for 5 minutes.
1. Call `start`: Begin the transcription task. You must call `start` within five minutes of receiving the `builderToken`.
1. Call `query`: Check the task status.
1. Call `stop`: Stop the transcription task.

The following figure shows the workflow to integrate <Vg k="RTT" /> functionality into your <Vpl k="CLIENT" />:

![Real-Time Transcription](/images/video-sdk/real-time-transcription.svg)

## Prerequisites

In order to follow this procedure you must have:

* Implemented <Link to="../get-started/get-started-sdk">Get Started with <Vpd k="NAME"/></Link>
* Enabled <Vg k="RTT" /> for your project. Contact sales@agora.io
* Activated a [supported cloud storage service](#supported-third-party-cloud-storage-services) to record and store <Vg k="RTT" /> videos and texts
* To run the post-processing script:
  * Python 3.0
  * [`ffmpeg`](https://ffmpeg.org/download.html) and `ffplay`


## Project setup

To create the environment necessary to play media files in your <Vpl k="CLIENT" />, open the project you created in <Link to="../get-started/get-started-sdk">Get Started with <Vpd k="NAME"/></Link>.

<ProjectSetup />

## Implement <Vg k="RTT" /> in your <Vpl k="CLIENT" />

This section shows how to create a user interface, handle the system logic, and manage a transcription task in your <Vpl k="CLIENT" />, step-by-step.

The code provided in this section is for demonstration purposes only. Best practice is to [Implement a business
server](#implement-a-business-server) to manage your <Vg k="RTT" /> tasks rather than hardcode the customer secret
in your <Vpl k="CLIENT" />

<ProjectImplement />

## Synchronize transcription files  with the cloud recording

The `m3u8+vtt` file generated by <Vg k="RTT" />, and the `m3u8+ts` file generated by [Cloud Recording](../../..
/cloud-recording/overview/product-overview.mdx) are two independent files. The time stamp references in these media
files are different, and not synchronized. The cloud recording time stamp starts at 0, the `m3u8+vtt` uses the system
time stamp. If either process starts abnormally, it the media files generated by the two
services to be out of sync during playback.

Post-processing ensures synchronization of subtitles and recorded audio. It enables you to associate the `m3u8+ts` file generated by cloud recording with the `m3u8+vtt` file generated by <Vg k="RTT" />.

<Vg k="COMPANY" /> provides a post-processing script that enables you to synchronize the two files.

#### Run the post-processing script

To synchronize files generated by <Vg k="RTT" />, take the following steps:

1. Unzip the [post-processing script](https://github.com/AgoraIO/Docs-Source/files/10931258/add_webvtt.zip) to a local folder.

1. Run the script on your <Vg k="RTT" /> files:

    ```shell
     python3 insert_subtitle.py --av audio_dir/audio_ts.m3u8 --subtitle subtitle_dir/subtitle.m3u8 --output output_dir/ --overwrite
     ```

     If `ffmpeg/ffprob` are not in your `PATH`, use`â€“ffmpeg_path` to specify the path.

1. Play the synchronized files:

    1. Start the HTTP server by running the following command:

       ```shell
       python3 -m http.server --bind 127.0.0.1 -doutput_dir
       ```

    1. In your browser, enter the following URL:

       ```
       http://127.0.0.1:8000/player_demo.html
       ```

## Implement a business server

Implementing a business server (API Server) for managing your <Vg k="RTT" /> tasks provides the following benefits:

* Improved security as your `apiKey`, `apiSecret`, `builderToken`, and `taskId`, are not exposed to the client.
* Token processing is securely handled on the API Server.
* Avoid splicing complex request body strings on the client side to reduce the probability of errors.
* Implement additional functionality on the API Server, such as billing for the use of <Vg k="RTT" />, and checking the privileges, and payment status of the user.
* If the REST API is updated, you do not need to update the client.

To import the API collection for testing and to obtain sample code for your business server, see the [Postman Collection
](https://documenter.getpostman.com/view/6319646/SVSLr9AM#69bd200a-7543-4104-8ccc-415741abbeb7). The following figure shows how the API
Server acts as a bridge between your client and the <Vg k="COMPANY"/> <Vg k="RTT" /> API Server:

![Real-Time Transcription API Server](/images/video-sdk/real-time-transcription-server.svg)




## Test your implementation

To ensure that you have implemented <Vg k="RTT" /> features into your <Vpl k="CLIENT" />:

1. [Generate a temporary token](../reference/manage-agora-account#generate-a-temporary-token) in <Vg k="CONSOLE" />.

2. In your browser, navigate to the <Link target="_blank" to="{{Global.DEMO_BASIC_VIDEO_CALL_URL}}"><Vg k="COMPANY" /> web demo</Link> and update _App ID_, _Channel_, and _Token_ with the values for your temporary token, then click **Join**.

<ProjectTest />


## Reference

This section contains information that completes the information in this page, or points you to documentation that explains other aspects to this product.

### REST API

Refer to the <Vg k="RTT" /> [REST API documentation](/en/api-reference?platform=rest) for parameter details.

### List of supported languages

| Language                         | Code*  | 
| -------------------------------- | ----- |
| Chinese (Cantonese, Traditional) | zh-HK |
| Indonesian (Indonesia)           | id-ID |
| Arabic (Jordan)                  | ar-JO |
| Arabic (Egyptian)                | ar-EG |
| Arabic (Saudi Arabia)            | ar-SA |
| Arabic (United Arab Emirates)    | ar-AE |
| Chinese (Taiwanese Putonghua)    | zh-TW |
| English(US)                      | en-US |
| English (India)                  | en-IN |
| Hindi (India)                    | hi-IN |
| Korean (South Korea)             | ko-KR |
| Japanese (Japan)                 | ja-JP |
| German (Germany)                 | de-DE |
| Spanish (Spain)                  | es-ES |
| French (French)                  | fr-FR |
| Italian (Italy)                  | it-IT |
| Chinese (Mandarin, Simplified)   | zh-CN |
| Portuguese (Portugal)            | pt-PT |

*Use Code in request body of Start API

### Supported third-party cloud storage services

The following third-party cloud storage service providers are supported:

* [Alibaba Cloud](https://www.alibabacloud.com/product/oss)
* [Amazon S3](https://aws.amazon.com/s3/?nc1=h_ls)
* [Baidu AI Cloud](https://intl.cloud.baidu.com/product/bos.html)
* [Google Cloud](https://cloud.google.com/storage)
* [Huawei Cloud](https://www.huaweicloud.com/intl/en-us/product/obs.html)
* [Kingsoft Cloud](https://en.ksyun.com/nv/product/KS3.html)
* [Microsoft Azure](https://azure.microsoft.com/en-us/services/storage/blobs/)
* [Qiniu Cloud](https://www.qiniu.com/en/products/kodo)
* [Tencent Cloud](https://intl.cloud.tencent.com/product/cos)

<Reference />