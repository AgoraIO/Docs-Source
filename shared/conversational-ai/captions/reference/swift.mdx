import CodeBlock from '@theme/CodeBlock';

#### `ConversationSubtitleController` 

<CodeBlock language="swift" showLineNumbers>
{`class ConversationSubtitleController {
    func setupWithConfig(_ config: SubtitleRenderConfig)
    func reset()
}`}
</CodeBlock>

- `setupWithConfig(_ config:)`: Set caption rendering configuration.
    - `config`: Caption rendering configuration. See [`SubtitleRenderConfig`](#subtitlerenderconfig) for details.
- `reset()`: Clear the cache.

#### `SubtitleRenderConfig`

<CodeBlock language="swift" showLineNumbers>
{`struct SubtitleRenderConfig {
    let rtcEngine: AgoraRtcEngineKit
    let renderMode: SubtitleRenderMode
    let delegate: ConversationSubtitleDelegate?
}`}
</CodeBlock>

- `rtcEngine`：Agora `AgoraRtcEngineKit` instance.
- `renderMode`: Caption rendering mode. See [`SubtitleRenderMode`](#subtitlerendermode) for details.
- `delegate`: Callback protocol for receiving caption content update events. See [`ConversationSubtitleDelegate`](#conversationsubtitledelegate) for details.

#### `SubtitleRenderMode`

<CodeBlock language="swift" showLineNumbers>
{`enum SubtitleRenderMode {
    case words
    case text
}`}
</CodeBlock>
- `words`: Word-by-word rendering mode. The caption content received by the callback is rendered word by word on the UI
- `text`: Sentence-by-sentence rendering mode. The caption content received by the callback is fully rendered on the UI.

<Admonition type="caution"> 
Using the word-by-word rendering mode (`words`) requires that your chosen TTS vendor supports word-by-word output, otherwise, it will automatically fall back to sentence-by-sentence rendering mode (`text`). 
</Admonition>

#### `ConversationSubtitleDelegate`

Callback protocol for caption content update events.

<CodeBlock language="swift" showLineNumbers>
{`protocol ConversationSubtitleDelegate: AnyObject {
    func onSubtitleUpdated(subtitle: SubtitleMessage)
}`}
</CodeBlock>

- `ConversationSubtitleDelegate`: Caption update callback protocol.
    - `onSubtitleUpdated`: Caption update callback.
        - `subtitle`: Updated caption message. See [`SubtitleMessage`](#subtitlemessage) for details.

#### `SubtitleMessage`

<CodeBlock language="swift" showLineNumbers>
{`struct SubtitleMessage {
    let turnId: Int
    let userId: UInt
    let text: String
    var status: SubtitleStatus
}`}
</CodeBlock>

- `turnId`: The identifier of the conversation turn. One conversation turn between the user and the agent corresponds to one `turnId`, and follows the following rules:
    - `turnId = 0`, This is the welcome message of the agent, and there is no caption for the user.
    - `turnId ≥ 1`, The captions for the user or agent in that round. Use the `userId` to display the user's captions before the agent's captions, and then repeat the process for round +1.

    <Admonition type="caution">
    There is no guarantee that callbacks will be in strictly increasing `turnId` order. If you encounter out-of-order situations, implement the sorting logic yourself.
    </Admonition>

- `userId`: The user ID associated with this caption message. In the current version, `0` represents the user, non-zero represents the agent ID.
- `text`: Caption text content.
- `status`: The current status of the captions. See [`SubtitleStatus`](#subtitlestatus) for details.

####  `SubtitleStatus`

<CodeBlock language="swift" showLineNumbers>
{`enum SubtitleStatus: Int {
    case inprogress = 0
    case end = 1
    case interrupt = 2
}`}
</CodeBlock>

- `inprogress`: The captions are still being generated; the user or agent has not finished speaking.
- `end`: The caption generation is complete; the user or agent has finished speaking.
- `interrupted`: The captions were interrupted before completion; the user actively stopped the agent’s response.
