---
title: 'Update a cloud transcoding task'
sidebar_position: 4
type: docs
platform_selector: false
description: >
   Update an existing cloud transcoding task.
---

import RestAPILayout from '@site/src/components/rest-api/RestAPILayout';
import LeftColumn from '@site/src/components/rest-api/LeftColumn';
import RightColumn, { Section } from '@site/src/components/rest-api/RightColumn';
import ParameterList, { Parameter } from '@site/src/components/rest-api/ParameterList';
import PathParameter from '@site/src/components/rest-api/PathParameter';
import { Tabs, TabItem } from '@site/src/components/rest-api/Tabs';

<RestAPILayout>
  <LeftColumn
    title={frontMatter.title}
    method="PATCH"
    endpoint="https://api.sd-rtn.com/v1/projects/{appId}/rtsc/cloud-transcoder/tasks/{taskId}"
  >

Use this endpoint to `Update` a <Vpd k='NAME' /> task.

## Request

### Path parameters

<PathParameter name="appid" type="string" required={true}>
The App ID of your project from <Vg k="CONSOLE" />.
</PathParameter>
<PathParameter name="taskid" type="string" required={true}>
The transcoding task UUID used to identify the cloud transcoder for this request.
</PathParameter>

### Query parameters

<PathParameter name="builderToken" type="string" required={true}>
The `tokenName` you obtained in the response body of the `Acquire` method. See [Acquire a builder token](../rest-api/acquire).
</PathParameter>

<PathParameter name="sequenceId" type="string" required={true}>
The sequence number of the `Update` request. The value must be greater than or equal to 0. Ensure that each subsequent `Update` request has a sequence number greater than the previous one. The sequence number ensures that the Agora server updates the cloud transcoder based on the latest specified configuration.

Agora recommends setting `sequenceId` to `0` for the first `Update` request, `1` for the second request, `2` for the third request, and so on. The Agora server updates the cloud transcoder according to the latest request, that is, the one with the highest sequence number.
</PathParameter>

<PathParameter name="updateMask" type="string" required={true}>
Specifies the configuration item to be updated. Set it to `services.cloudTranscoder.config` to indicate a full update.
</PathParameter>

### Request body

When updating a cloud transcoder, the request body must contain all the fields from the `Create` request in the request body. For fields that you do not need to update, use the original values. See [Updatable fields](#updatable-fields) for the <Vpd k="NAME" /> parameters you can modify.

<div class="api-mime-type">APPLICATION/JSON</div>

<ParameterList title="BODY" required={true}>

  <Parameter name="services" type="object" required={true}>

    <Parameter name="cloudTranscoder" type="object" required={true}>

      <Parameter name="serviceType" type="string" required={true}>
      The service type. Use `"cloudTranscoderV2"`.
      </Parameter>

      <Parameter name="config" type="object" required={true}>
        <Parameter name="transcoder" type="object" required={true}>

          <Parameter name="idleTimeout" type="number" required={false} defaultValue="300" possibleValues="1 to 86400">
          The maximum period (in seconds) that Cloud Transcoder can be idle. Idle means that all hosts corresponding to the audio and video streams processed by Cloud Transcoder have left the channel. If the idle state exceeds the set time, Cloud Transcoder is automatically destroyed.
          </Parameter>

          <Parameter name="audioInputs" type="array" required={false}>
            <Parameter name="rtc" type="object" required={true}>

              <Parameter name="rtcChannel" type="string" required={true}>
              The RTC channel name for the audio input source. Currently, only audio and video sources that subscribe to a single channel are supported. The audio source and video source must belong to the same channel.
              </Parameter>

              <Parameter name="rtcUid" type="number" required={true}>
              The UID corresponding to the audio input source. The same UID must not exist in the RTC channel.
              </Parameter>

              <Parameter name="rtcToken" type="string" required={true}>
              The token that the Cloud Transcoder uses to join the RTC channel for transcoding. Using a token ensures channel security and prevents malicious users from disrupting other users in the channel. See [Token authentication](/video-calling/token-authentication/deploy-token-server) for details.

              The UID of Cloud Transcoder in the RTC channel is randomly assigned by Agora. Therefore, when generating a token, set the uid to `0`.
              </Parameter>
            </Parameter>
          </Parameter>

          <Parameter name="videoInputs" type="array" required={false}>
            <Parameter name="rtc" type="object" required={true}>

              <Parameter name="rtcChannel" type="string" required={true}>
              The RTC channel name for the video input source. Currently, only audio and video sources that subscribe to a single channel are supported. The audio source and video source must belong to the same channel.
              </Parameter>

              <Parameter name="rtcUid" type="number" required={true}>
              The UID corresponding to the video input source. The same UID must not exist in the RTC channel.
              </Parameter>

              <Parameter name="rtcToken" type="string" required={true}>
              The token that the Cloud Transcoder uses to join the RTC channel for transcoding. Using a token ensures channel security and prevents malicious users from disrupting other users in the channel. See [Token authentication](/video-calling/token-authentication/deploy-token-server) for details.

              The UID of Cloud Transcoder in the RTC channel is randomly assigned by Agora. Therefore, when generating a token, set the uid to `0`.
              </Parameter>
            </Parameter>

            <Parameter name="placeholderImageUrl" type="string" required={true}>
            The URL of the placeholder image displayed when the user is offline. It must be a valid image URL and contain the `jpg` or `png` suffix.
            </Parameter>

            <Parameter name="region" type="object" required={true}>
              <Parameter name="x" type="number" required={true} possibleValues="0 to 3840">
              The x coordinate of the image on the canvas (px). The x coordinate is the horizontal displacement of the upper left corner of the image relative to the origin, where the upper left corner of the canvas is the origin.
              </Parameter>

              <Parameter name="y" type="number" required={true} possibleValues="0 to 3840">
              The y coordinate of the image on the canvas (px). The y coordinate is the vertical displacement of the upper left corner of the image relative to the origin, where the upper left corner of the canvas is the origin.
              </Parameter>
            
              <Parameter name="width" type="number" required={true} possibleValues="120 to 3840">
              The width of the screen (px).
              </Parameter>

              <Parameter name="height" type="number" required={true} possibleValues="120 to 3840">
              The height of the screen (px).
              </Parameter>

              <Parameter name="zorder" type="number" required={true} possibleValues="2 to 100">
              The layer order of the host screen. `2` represents the layer above the placeholder layer. `100` represents the top layer.
              </Parameter>
            </Parameter>
          </Parameter>

          <Parameter name="canvas" type="object" required={true}>
              <Parameter name="width" type="number" required={true} possibleValues="120 to 3840">
              The width of the canvas (px).
              </Parameter>

              <Parameter name="height" type="number" required={true} possibleValues="120 to 3840">
              The height of the canvas (px).
              </Parameter>

              <Parameter name="color" type="number" required={true} possibleValues="0 to 16777215">
              The background color of the canvas. The RGB color value represented as a decimal number
              </Parameter>

              <Parameter name="backgroundImage" type="string" required={false}>
              Canvas background image. Must be a valid image URL with a `jpg` or `png` suffix. If omitted, there is no canvas background image.
              </Parameter>

              <Parameter name="fillMode" type="string" required={false} defaultValue='"FILL"'>
              Fill mode for the canvas background image:

              - `"FILL"`: Scale the image and crop it in the center while maintaining the aspect ratio. 
              - `"FIT"`: Scale the image to fill the display while maintaining the aspect ratio. 
              </Parameter>
          </Parameter>

          <Parameter name="watermarks" type="array" required={true}>

            <Parameter name="imageUrl" type="string" required={true}>
            The URL of the watermark image. It must be a valid URL with a `jpg` or `png` suffix.
            </Parameter>

            <Parameter name="region" type="object" required={true}>
              <Parameter name="x" type="number" required={true} possibleValues="0 to 3840">
              The x coordinate of the watermark on the canvas (px). The x coordinate is the horizontal displacement of the upper left corner of the image relative to the origin.
              </Parameter>

              <Parameter name="y" type="number" required={true} possibleValues="0 to 3840">
              The y coordinate of the watermark on the canvas (px). The y coordinate is the vertical displacement of the upper left corner of the image relative to the origin.
              </Parameter>
            
              <Parameter name="width" type="number" required={true} possibleValues="120 to 3840">
              The width of the watermark (px).
              </Parameter>

              <Parameter name="height" type="number" required={true} possibleValues="120 to 3840">
              The height of the watermark (px).
              </Parameter>

              <Parameter name="zorder" type="number" required={true} possibleValues="0 to 100">
              The layer order of the watermark. `0` represents the bottom layer. `100` represents the top layer.
              </Parameter>
            </Parameter>

            <Parameter name="fillMode" type="string" required={false} defaultValue='"FILL"'>
            Watermark fill mode:

            - `"FILL"`: Scale the image and crop it in the center while maintaining the aspect ratio.
            - `"FIT"`: Scale the image to fill the display while maintaining the aspect ratio. 
            </Parameter>      
          </Parameter>

          <Parameter name="outputs" type="array" required={true}>

            <Parameter name="rtc" type="object" required={true}>

              <Parameter name="rtcChannel" type="string" required={true}>
              The RTC channel name for the transcoded audio and video. 
              </Parameter>

              <Parameter name="rtcUid" type="number" required={true}>
              The UID of the RTC channel for the transcoded audio and video streams. Make sure this value is different from the UID of other users in the channel.
              </Parameter>

              <Parameter name="rtcToken" type="string" required={true}>
              The token that the Cloud Transcoder uses to join the output RTC channel. Using a token ensures channel security and prevents malicious users from disrupting other users in the channel. See [Token authentication](/video-calling/token-authentication/deploy-token-server) for details.

              When generating this token, use `outputs.rtc.rtcUid` to generate the token.

              </Parameter>
            </Parameter>

            <Parameter name="audioOption" type="object" required={false}>

              <Parameter name="profileType" type="string" required={false} defaultValue='"AUDIO_PROFILE_DEFAULT"'>
              Audio properties of the transcoded output:

              - `"AUDIO_PROFILE_DEFAULT"`: 48 kHz sampling rate, music encoding, mono channel, maximum encoding bitrate is 64 Kbps.
              - `"AUDIO_PROFILE_SPEECH_STANDARD"`: 32 kHz sampling rate, speech encoding, mono channel, maximum encoding bitrate is 18 Kbps.
              - `"AUDIO_PROFILE_MUSIC_STANDARD"`: 48 KHz sampling rate, music encoding, mono channel, maximum encoding bitrate is 64 Kbps.
              - `"AUDIO_PROFILE_MUSIC_STANDARD_STEREO"`: 48 KHz sampling rate, music encoding, stereo channel, maximum encoding bitrate is 80 Kbps.
              - `"AUDIO_PROFILE_MUSIC_HIGH_QUALITY"`: 48 KHz sampling rate, music encoding, mono channel, maximum encoding bitrate is 96 Kbps.
              - `"AUDIO_PROFILE_MUSIC_HIGH_QUALITY_STEREO"`: 48 kHz sampling rate, music encoding, dual channels, and a maximum encoding bitrate of 128 Kbps.

              </Parameter>
                
            </Parameter>

            <Parameter name="videoOption" type="object" required={false}>

              <Parameter name="fps" type="string" required={false} defaultValue="15" possibleValues="1 to 30">
              The frame rate (fps) of the transcoded output video.
              </Parameter>

              <Parameter name="codec" type="string" required={true}>
              The codec used to transcode the output video. 
              
              **Possible values**:
              - `"H264"`: Standard H.264 encoding.
              - `"VP8"`: Standard VP8 encoding.
              </Parameter>

              <Parameter name="bitrate" type="number" required={true} possibleValues="1 to 10000">
              The bitrate of the transcoded output video.
              </Parameter>

              <Parameter name="width" type="number" required={true} possibleValues="120 to 3840">
              The width of the transcoded output video (px).
              </Parameter>
 
              <Parameter name="height" type="number" required={true} possibleValues="120 to 3840">
              The height of the transcoded output video (px).
              </Parameter>

              <Parameter name="lowBitrateHighQuality" type="boolean" required={false} defaultValue="false">
              Whether to enable the low-code high-definition function for the transcoded audio and video streams:
              - `true`: Enable.
              - `false`: Disable. The low-code HD feature can achieve a higher quality video effect perceived by the human eye at a lower bit rate. This feature increases the cost. Please contact [Agora sales](mailto:sales@agora.io) for consultation before activation.

              </Parameter>
            </Parameter>
          </Parameter>
        </Parameter>
      </Parameter>
    </Parameter>
  </Parameter>
</ParameterList>

## Response

### Response header

<PathParameter name="X-Request-ID" type="string">
UUID (Universally Unique Identifier), used to identify this request.

If the request fails, print out the value in the log to troubleshoot the problem. If the response status code of the request is not 2XX, then the response header may not contain this field.
</PathParameter>

### Response body

- If the returned status code is `2XX`, the request was successful. The response body is empty.

- If the returned status code is not `200`, the request failed. 

  <ParameterList title="Non 200">   
      <Parameter name="message" type="string">
      Describes why the request failed.
      </Parameter>
  </ParameterList>

   If the request fails, use the `X-Request-ID` value in the log to troubleshoot the problem. If the response status code is not `2XX`, then the response header may not contain this field.

## Reference

### Updatable fields

The `Update` request supports modifying the following fields only:

- Add or delete `rtc` members in `audioInputs[]` and `videoInputs[]` to subscribe or unsubscribe from the host's audio and video streams.
- Modify the `region` field in `videoInputs[]` to update the host's combined picture layout.
- Modify the `audioOption` and `videoOption` fields in `outputs[]` to update the transcoding output audio and video configurations.

</LeftColumn>

<RightColumn>

<Section title="Authorization">
This endpoint requires [Basic Auth](../rest-api/restful-authentication).
</Section>

<Section title="Request example">

  <Tabs groupId="code-examples">
    <TabItem value="curl" label="curl" default>
      ```bash
      curl --request post \
        --url 'https://api.sd-rtn.com/v1/projects/:appId/rtsc/cloud-transcoder/tasks?builderToken=' \
        --header 'Authorization: Basic <credentials>' \
        --header 'Content-Type: <string>' \
        --data '
      {
        "services": {
          "cloudTranscoder": {
            "serviceType": "cloudTranscoderV2",
            "config": {
              "transcoder": {
                "idleTimeout": 300,
                "audioInputs": [
                  {
                    "rtc": {
                      "rtcChannel": "test01",
                      "rtcUid": 123,
                      "rtcToken": "aab8b8f5a8cd4469a63042fcfafe7***"
                    }
                  },
                  {
                    "rtc": {
                      "rtcChannel": "test01",
                      "rtcUid": 456,
                      "rtcToken": "aab8b8f5a8cd4469a63042fcfafe7***"
                    }
                  }
                ],
                "canvas": {
                  "width": 960,
                  "height": 480,
                  "color": 0,
                  "backgroundImage": "https://example.jpg",
                  "fillMode": "FIT"
                },
                "waterMarks": [
                  {
                    "imageUrl": "https://example.png",
                    "region": {
                      "x": 0,
                      "y": 0,
                      "width": 120,
                      "height": 120,
                      "zOrder": 50
                    }
                  }
                ],
                "videoInputs": [
                  {
                    "rtc": {
                      "rtcChannel": "test01",
                      "rtcUid": 123,
                      "rtcToken": "aab8b8f5a8cd4469a63042fcfafe7***"
                    },
                    "placeholderImageUrl": "https://example.jpg",
                    "region": {
                      "x": 0,
                      "y": 0,
                      "width": 320,
                      "height": 360,
                      "zOrder": 2
                    }
                  },
                  {
                    "rtc": {
                      "rtcChannel": "test01",
                      "rtcUid": 456,
                      "rtcToken": "aab8b8f5a8cd4469a63042fcfafe7***"
                    },
                    "placeholderImageUrl": "https://example.jpg",
                    "region": {
                      "x": 320,
                      "y": 0,
                      "width": 320,
                      "height": 320,
                      "zOrder": 2
                    }
                  }
                ],
                "outputs": [
                  {
                    "rtc": {
                      "rtcChannel": "test",
                      "rtcUid": 1000,
                      "rtcToken": "aab8b8f5a8cd4469a63042fcfafe7***"
                    },
                    "audioOption": {
                      "profileType": "AUDIO_PROFILE_MUSIC_STANDARD"
                    },
                    "videoOption": {
                      "fps": 30,
                      "codec": "H264",
                      "bitrate": 800,
                      "width": 960,
                      "height": 480,
                      "lowBitrateHighQuality": false
                    }
                  }
                ]
              }
            }
          }
        }
      }'
      ```
    </TabItem>
    <TabItem value="python" label="Python">

    ```python
    import requests
    import json

    url = "https://api.sd-rtn.com/v1/projects/:appId/rtsc/cloud-transcoder/tasks?builderToken="

    headers = {
        "Authorization": "Basic <credentials>",
        "Content-Type": "<string>"
    }

    data = {
        "services": {
            "cloudTranscoder": {
                "serviceType": "cloudTranscoderV2",
                "config": {
                    "transcoder": {
                        "idleTimeout": 300,
                        "audioInputs": [
                            {
                                "rtc": {
                                    "rtcChannel": "test01",
                                    "rtcUid": 123,
                                    "rtcToken": "aab8b8f5a8cd4469a63042fcfafe7***"
                                }
                            },
                            {
                                "rtc": {
                                    "rtcChannel": "test01",
                                    "rtcUid": 456,
                                    "rtcToken": "aab8b8f5a8cd4469a63042fcfafe7***"
                                }
                            }
                        ],
                        "canvas": {
                            "width": 960,
                            "height": 480,
                            "color": 0,
                            "backgroundImage": "https://example.jpg",
                            "fillMode": "FIT"
                        },
                        "waterMarks": [
                            {
                                "imageUrl": "https://example.png",
                                "region": {
                                    "x": 0,
                                    "y": 0,
                                    "width": 120,
                                    "height": 120,
                                    "zOrder": 50
                                }
                            }
                        ],
                        "videoInputs": [
                            {
                                "rtc": {
                                    "rtcChannel": "test01",
                                    "rtcUid": 123,
                                    "rtcToken": "aab8b8f5a8cd4469a63042fcfafe7***"
                                },
                                "placeholderImageUrl": "https://example.jpg",
                                "region": {
                                    "x": 0,
                                    "y": 0,
                                    "width": 320,
                                    "height": 360,
                                    "zOrder": 2
                                }
                            },
                            {
                                "rtc": {
                                    "rtcChannel": "test01",
                                    "rtcUid": 456,
                                    "rtcToken": "aab8b8f5a8cd4469a63042fcfafe7***"
                                },
                                "placeholderImageUrl": "https://example.jpg",
                                "region": {
                                    "x": 320,
                                    "y": 0,
                                    "width": 320,
                                    "height": 320,
                                    "zOrder": 2
                                }
                            }
                        ],
                        "outputs": [
                            {
                                "rtc": {
                                    "rtcChannel": "test",
                                    "rtcUid": 1000,
                                    "rtcToken": "aab8b8f5a8cd4469a63042fcfafe7***"
                                },
                                "audioOption": {
                                    "profileType": "AUDIO_PROFILE_MUSIC_STANDARD"
                                },
                                "videoOption": {
                                    "fps": 30,
                                    "codec": "H264",
                                    "bitrate": 800,
                                    "width": 960,
                                    "height": 480,
                                    "lowBitrateHighQuality": False
                                }
                            }
                        ]
                    }
                }
            }
        }
    }

    response = requests.post(url, headers=headers, data=json.dumps(data))

    print(response.status_code)
    print(response.json())   
    ```
    </TabItem>

    <TabItem value="node" label="Node.js">

    ```js
    const axios = require("axios");

    const url = "https://api.sd-rtn.com/v1/projects/:appId/rtsc/cloud-transcoder/tasks?builderToken=";

    const headers = {
      Authorization: "Basic <credentials>",
      "Content-Type": "<string>",
    };

    const data = {
      services: {
        cloudTranscoder: {
          serviceType: "cloudTranscoderV2",
          config: {
            transcoder: {
              idleTimeout: 300,
              audioInputs: [
                {
                  rtc: {
                    rtcChannel: "test01",
                    rtcUid: 123,
                    rtcToken: "aab8b8f5a8cd4469a63042fcfafe7***",
                  },
                },
                {
                  rtc: {
                    rtcChannel: "test01",
                    rtcUid: 456,
                    rtcToken: "aab8b8f5a8cd4469a63042fcfafe7***",
                  },
                },
              ],
              canvas: {
                width: 960,
                height: 480,
                color: 0,
                backgroundImage: "https://example.jpg",
                fillMode: "FIT",
              },
              waterMarks: [
                {
                  imageUrl: "https://example.png",
                  region: {
                    x: 0,
                    y: 0,
                    width: 120,
                    height: 120,
                    zOrder: 50,
                  },
                },
              ],
              videoInputs: [
                {
                  rtc: {
                    rtcChannel: "test01",
                    rtcUid: 123,
                    rtcToken: "aab8b8f5a8cd4469a63042fcfafe7***",
                  },
                  placeholderImageUrl: "https://example.jpg",
                  region: {
                    x: 0,
                    y: 0,
                    width: 320,
                    height: 360,
                    zOrder: 2,
                  },
                },
                {
                  rtc: {
                    rtcChannel: "test01",
                    rtcUid: 456,
                    rtcToken: "aab8b8f5a8cd4469a63042fcfafe7***",
                  },
                  placeholderImageUrl: "https://example.jpg",
                  region: {
                    x: 320,
                    y: 0,
                    width: 320,
                    height: 320,
                    zOrder: 2,
                  },
                },
              ],
              outputs: [
                {
                  rtc: {
                    rtcChannel: "test",
                    rtcUid: 1000,
                    rtcToken: "aab8b8f5a8cd4469a63042fcfafe7***",
                  },
                  audioOption: {
                    profileType: "AUDIO_PROFILE_MUSIC_STANDARD",
                  },
                  videoOption: {
                    fps: 30,
                    codec: "H264",
                    bitrate: 800,
                    width: 960,
                    height: 480,
                    lowBitrateHighQuality: false,
                  },
                },
              ],
            },
          },
        },
      },
    };

    axios
      .post(url, data, { headers })
      .then((response) => {
        console.log(response.status);
        console.log(response.data);
      })
      .catch((error) => {
        console.error("Error:", error.response ? error.response.data : error.message);
      });    
    ```
    </TabItem>
  </Tabs>

  </Section>
<Section title="Response example">

  <Tabs groupId="response">
  <TabItem value="ok" label="200" default>
  
  If the status code is 2XX, the request
  is successful and the response body is empty.
  
  </TabItem>
  <TabItem value="error" label="Non-200">
    ```json
    {
      "message": "Describes why the request failed."
    }
    ```
    
    </TabItem>
  </Tabs>
</Section>
</RightColumn>
</RestAPILayout>