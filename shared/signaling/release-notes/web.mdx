import * as channel from '@docs/shared/signaling/reference/api-ref/shared/_channel.mdx'
import * as config from '@docs/shared/signaling/reference/api-ref/shared/_configuration.mdx'
import * as enumv from '@docs/shared/signaling/reference/api-ref/shared/_enumv.mdx'
import * as code from '@docs/shared/signaling/reference/api-ref/shared/_error-codes.mdx'
import * as topic from '@docs/shared/signaling/reference/api-ref/shared/_topic.mdx'
import * as message from '@docs/shared/signaling/reference/api-ref/shared/_message.mdx'
import * as presence from '@docs/shared/signaling/reference/api-ref/shared/_presence.mdx'
import * as storage from '@docs/shared/signaling/reference/api-ref/shared/_storage.mdx'
import * as lock from '@docs/shared/signaling/reference/api-ref/shared/_lock.mdx'

<PlatformWrapper platform="web">

### v2.1.5

v2.1.5 was released on October 17, 2023

#### Compatibility changes

This release makes changes to the following APIs. You need to modify your implementation code after upgrading the SDK:

- Change the parameter type of the `messageType` from `string | binary` to `STRING | BINARY`.
- Rename the `TokenPrivilegeWillExpire` callback to `tokenPrivilegeWillExpire`.

#### New features

**Removing Event Listeners**

This release adds the `removeEventListener` method. You can use it to remove a specified event listener.

**Interval Mode**

This release supports the interval mode of presence function. When the number of online users in a channel exceeds the specified **Announce Max** value, the channel enters the interval mode. The SDK triggers the `presence` event notification at regular intervals and provides aggregated incremental information about user join, leave, timeout, and state changes in the `interval` property. For more details, see [Interval Mode](../reference/api?platform=web#presence-event-types).

#### Improvements

**Presence Service**

This release improvements the behavior of calling presence APIs when the presence service is not ready. After joining a stream channel or subscribing to a message channel, if the presence service is not ready, the SDK locally stores your operations related to the presence module and sends them out once the presence service becomes ready.

Additionally, in the return value of the `getOnlineUsers` method, this release removes the information of timed-out users.

**Subscribing Message Publisher**

This release improvements the behavior of subscribing to message publishers with invalid user IDs. When calling the `{topic.subscribe[frontMatter.ag_platform]}` method, if the list of publishers (`users` property) contains invalid user IDs, the SDK ignores the invalid user IDs and can successfully subscribe to the valid users.

**Custom Message Type**

This release supports to pass special characters such as Chinese characters into the `customType` parameter when calling the `{message.publish[frontMatter.ag_platform]}` or `{topic.publish[frontMatter.ag_platform]}` methods.

**Encryption Salt**

This release allows to omit the `salt` parameter when setting encryption.

**Error Message Optimization**

To facilitate troubleshooting, this release adds error descriptions for each error code and adds error stacks in the error messages of the storage and lock modules. Additionally, this release removes the `RTM_ERROR_INVALID_ARGUMENT(-2)` and `RTM_ERROR_TOO_OFTEN(-12)` error codes, and adds the following error codes:

- `RTM_ERROR_LOGIN_NOT_AUTHORIZED(-10015)`
- `RTM_ERROR_INCONSISTENT_APPID(-10016)`
- `RTM_ERROR_INVALID_CHANNEL_TYPE(-10019)`
- `RTM_ERROR_INVALID_ENCRYPTION_PARAMETER(-10020)`
- `RTM_ERROR_OPERATION_RATE_EXCEED_LIMITATION(-10021)`

For error code descriptions and troubleshooting ways, see [Error Codes](../reference/api?platform=web#error-codes-table).

#### Fixed issues

This release fixed the following issues:

- Exceptions in poor network scenarios.
- When joining a channel and setting the parameter as `withPresence: false`, the `userId` property returned by the <code>{presence.getstate[props.ag_platform]}</code> method was empty.
- During network disconnection and reconnection, any API call failed and returned the `RTM_ERROR_NOT_LOGIN(-10002)` error code.
- Calling any API of the presence module failed when the client woke up from sleep mode.
- Calling the `login` method failed when the resource was not loaded.
- If special characters such as Chinese were passed into the API of the presence module, messages sent to the remote client were truncated.


### v2.1.4

v2.1.4 was released on September 8, 2023

#### Compatibility changes

This release changes the writing style of event listeners. After upgrading, you need to modify your implementation code as follows:

- Before v2.1.4:

    ```javascript
    rtmClient.addEventListener({
    message: msgEvent => {
      // Message event notification processing logic
    },

    presence: presenceEvent => {
      // Presence event notification processing logic
    },

    // Add other event listeners
    });
    ```

- Since v2.1.4:

    ```javascript
    rtmClient.addEventListener('message', msgEvent => {
      // Message event notification processing logic
    });

    rtmClient.addEventListener('presence', presenceEvent => {
      // Presence event notification processing logic
    });

    // Add other event listeners
    ```

#### Improvements

This release reduces the response time of the `logout` method.


#### Issues fixed

This release fixes the following issues:

- The SDK version information was lost in the log file.
- The `userId` property of the `GetStateResponse` data type was null.
- After calling the `removeState` method, the SDK returned the `RemoveStateResponse` data type before the removing operation.


</PlatformWrapper>
