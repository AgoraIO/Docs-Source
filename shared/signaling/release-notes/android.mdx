
<PlatformWrapper platform='android'>

### v2.1.9

v2.1.9 was released on February 22, 2024.

#### Compatibility changes

This release improves message publishing options as follows:

- Removes the `sendTs` parameter and adds the `channelType` parameter in `PublishOptions`. See details in [`PublishOptions`](../reference/api/#messagepublishpropsag_platform).
- Modifies the type of the `options` parameter in the `publishTopicMessage` method from `PublishOptions` to `TopicMessageOptions`. See details in [`TopicMessageOptions`](../reference/api/#topicpublishpropsag_platform).

Make sure to modify the implementation of the relevant features after upgrading the SDK.

#### Improvements

This release adds the following improvements:

- Adds error codes: `INVALID_CHANNEL_TYPE`, `RTM_ERROR_INVALID_ENCRYPTION_PARAMETER`, and `RTM_ERROR_OPERATION_RATE_EXCEED_LIMITATION`. For error code descriptions and solutions, see [Error Codes](../reference/api#error-codes-table).
- Optimizes the handling logic for expired user status data during reconnection.

#### Fixed issues

This release fixed the occasional crash issue when calling the `getOnlineUsers` method to retrieve paginated results.

### v2.1.7

v2.1.7 was released on November 17, 2023.

### v2.1.6

v2.1.6 was released on September 18, 2023.

#### Compatibility changes

If you use the features mentioned in this section, ensure that you modify the implementation of the relevant features after upgrading the SDK.

1. Multiple connection region settings

    To support setting multiple connection regions simultaneously, this release changes the parameter type of `areaCode` from `RtmAreaCode` to `EnumSet<RtmAreaCode>`. Refer to the following sample code to update your implementation:

    ```java
    // Before v2.1.6
    RtmConfig config = new RtmConfig();
    config.code = RtmConstants.RtmAreaCode.GLOB;
    ```

    ```java
    // v2.1.6
    RtmConfig config = new RtmConfig.Builder(myAppId, mUserId)
                            .eventListener(eventListener)
                            .areaCode(EnumSet.of(RtmConstants.RtmAreaCode.AS, RtmConstants.RtmAreaCode.CN))
                            .build();
    ```

1. `RTMConfig` Constructor optimization

    This release changes the constructor pattern of `RTMConfig` to the builder pattern. Refer to the following sample code to update your implementation:

    ```java
    // Before v2.1.6
    RtmConfig config = new RtmConfig();
    config.appId = myAppId;
    config.userId = mUserId;
    config.eventListener = eventListener;
    config.logConfig = logConfig;
    ```

    ```java
    // v2.1.6
    RtmConfig config = new RtmConfig.Builder(myAppId, mUserId)
                        .eventListener(eventListener)
                        .logConfig(logConfig)
                        .build();
    ```

1. Callback name changes

    This release changes the name of the `onConnectionStateChange` callback to `onConnectionStateChanged`.

#### New features

1. Multiple ways to add event listeners

    This release adds the `addEventListener` and `removeEventListener` methods. In addition to adding or removing an event listener object during initialization, you can also call the new methods to add or remove one or more event listener objects at any time during the app's lifecycle.

    Furthermore, to enhance the experience of setting event listeners, this release no longer requires implementing all events of the `RtmEventListener`. You only need to implement the events that you need. See the following sample code:

    ```java
    RtmEventListener eventListener = new RtmEventListener() {
        @Override
        public void onMessageEvent(MessageEvent event) {
            String text = "Message received from " + event.publisher + " Message: " + event.message.getData() + "\n";
            writeToMessageHistory(text);
        }

        @Override
        public void onPresenceEvent(PresenceEvent event) {
            String text = "receive presence event, user: " + event.publisher + " event: " + event.type + "\n";
            writeToMessageHistory(text);
        }

        @Override
        public void onConnectionStateChanged(String mChannelName, RtmConstants.RtmConnectionState state, RtmConstants.RtmConnectionChangeReason reason) {
            String text = "Connection state changed to " + state + ", Reason: " + reason + "\n";
            writeToMessageHistory(text);
        }
    };
    ```

1. New struct constructors

    This release adds the constructor for the following structs:

    - `JoinChannelOptions`
    - `JoinTopicOptions`
    - `MetadataItem`
    - `MetadataOptions`
    - `GetOnlineUsersOptions`
    - `RtmEncryptionConfig`
    - `RtmLogConfig`
    - `RtmProxyConfig`
    - `StateItem`
    - `SubscribeOptions`
    - `TopicOptions`

    You can continue using the previous implementation, or refer to the following sample code to update your implementation:

    ```java
    // Before v2.1.6
    SubscribeOptions options = new SubscribeOptions();
    options.withMessage = true;
    options.withMetadata = false;
    options.withPresence = true;
    options.withLock = false;
    ```
    ```java
    // v2.1.6
    // Method one: passing parameters
    SubscribeOptions options = new SubscribeOptions(true, true, false, false);
    // Method two: set method
    SubscribeOptions options = new SubscribeOptions();
    options.setWithMessage(true);
    options.setWithMetadata(false);
    options.setWithPresence(true);
    options.setWithLock(false);
    ```

#### Improvements

This release improves the performance of setting the presence event notification in `JoinChannelOptions`.

#### Fixed issues

This release fixed the following issues:

- Occasional inability to log out of the RTM system when the network status changed.
- Occasional inability to log in to the RTM system after logging out when the network status changed.
- When the network was disconnected, users occasionally did not receive the `SNAPSHOT` event notification due to that the app did not clear data.
- When a user joined a channel and switched the app to the background and then back to the foreground, the SDK occasionally triggered the `REMOTE_JOIN` event notification multiple times.

</PlatformWrapper>